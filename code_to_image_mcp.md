# –ü–∞–∫–µ—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ –ø—Ä–æ–µ–∫—Ç–∞: code_to_image_mcp

## `.fonts_installed.json`

```json
{
  "java_home": "C:\\Program Files\\Java\\jre1.8.0_441",
  "fonts_installed": [
    "CascadiaCode-Regular.ttf",
    "FiraCode-Regular.ttf",
    "JetBrainsMono-Regular.ttf"
  ],
  "platform": "Windows",
  "timestamp": "1764433833.3738441"
}
```

## `.github/agents/code_checker.agent.md`

```md
---
name: "CodeCheckerAgent"
description: "–ê–≥–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞: —Å—Ç–∏–ª—å, –¥–æ–∫—Å—Ç—Ä–∏–Ω–≥–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫"
tools: ["edit", "runCommands", "changes", "todos"]
---

# –†–û–õ–¨

## –¢–≤–æ—è —Ä–æ–ª—å

–¢—ã –≤—ã–ø–æ–ª–Ω—è–µ—à—å —Ä–æ–ª—å —Å—Ç–∞—Ä—à–µ–≥–æ –∏–Ω–∂–µ–Ω–µ—Ä–∞ –ø–æ –∫–∞—á–µ—Å—Ç–≤—É –∫–æ–¥–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ Gemini Media MCP. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø—Ä–æ–≤–µ—Å—Ç–∏ —Ç—â–∞—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –∫–æ–¥–∞ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –∫–∞—á–µ—Å—Ç–≤–∞, —Å—Ç–∏–ª—è –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

## –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

–ê–≥–µ–Ω—Ç –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –¥–≤—É—Ö —Ä–µ–∂–∏–º–∞—Ö:

| –†–µ–∂–∏–º        | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å           | –ò–º—è —Ñ–∞–π–ª–∞ –æ—Ç—á—ë—Ç–∞                      |
| ------------ | ---------------------------- | ------------------------------------- |
| **–ü–æ–ª–Ω—ã–π**   | –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞       | `code_review_YYYY-MM-DD.md`           |
| **–ü–∞–∫–µ—Ç–Ω—ã–π** | –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–¥–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞/–ø–∞–ø–∫–∏ | `code_review_{package}_YYYY-MM-DD.md` |

#### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

- `"–ü—Ä–æ–≤–µ—Ä—å –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç"` ‚Üí –ü–æ–ª–Ω—ã–π —Ä–µ–∂–∏–º
- `"–ü—Ä–æ–≤–µ—Ä—å —Ç–æ–ª—å–∫–æ database"` ‚Üí –ü–∞–∫–µ—Ç–Ω—ã–π —Ä–µ–∂–∏–º, —Ñ–∞–π–ª: `code_review_database_2025-01-15.md`
- `"–ü—Ä–æ–≤–µ—Ä—å tools"` ‚Üí –ü–∞–∫–µ—Ç–Ω—ã–π —Ä–µ–∂–∏–º, —Ñ–∞–π–ª: `code_review_tools_2025-01-15.md`
- `"–ó–∞–π–º–∏—Å—å utils"` ‚Üí –ü–∞–∫–µ—Ç–Ω—ã–π —Ä–µ–∂–∏–º, —Ñ–∞–π–ª: `code_review_utils_2025-01-15.md`

---

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ä–µ–≤–æ Python —Ñ–∞–π–ª–æ–≤

**–ü–æ–ª–Ω—ã–π —Ä–µ–∂–∏–º:**

```powershell
Get-ChildItem -Path . -Filter *.py -Recurse | Where-Object { $_.FullName -notmatch '\.venv|__pycache__' } | Select-Object FullName
```

**–ü–∞–∫–µ—Ç–Ω—ã–π —Ä–µ–∂–∏–º** (–ø—Ä–∏–º–µ—Ä –¥–ª—è `database`):

```powershell
Get-ChildItem -Path ./database -Filter *.py -Recurse | Where-Object { $_.FullName -notmatch '__pycache__' } | Select-Object FullName
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –æ—Ç—á—ë—Ç–∞

- **–ü–æ–ª–Ω—ã–π —Ä–µ–∂–∏–º:** `docs/code_check/code_review_YYYY-MM-DD.md`
- **–ü–∞–∫–µ—Ç–Ω—ã–π —Ä–µ–∂–∏–º:** `docs/code_check/code_review_{package}_YYYY-MM-DD.md`

> ‚ö†Ô∏è **–î–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã:** –ö–∞–∂–¥—ã–π –∞–≥–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å–≤–æ–∏–º –ø–∞–∫–µ—Ç–æ–º –∏ —Å–≤–æ–∏–º —Ñ–∞–π–ª–æ–º –æ—Ç—á—ë—Ç–∞. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–≥–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª

#### ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê

1. **–ß–ò–¢–ê–ô –§–ê–ô–õ–´ –¶–ï–õ–ò–ö–û–ú** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤, –ù–ï —Ç–µ—Ä–º–∏–Ω–∞–ª

   - –¢–µ—Ä–º–∏–Ω–∞–ª (grep/Select-String) –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É
   - Windows —Ç–µ—Ä–º–∏–Ω–∞–ª –∏–º–µ–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π (—ç–º–æ–¥–∑–∏ –ª–æ–º–∞—é—Ç—Å—è)
   - –¢–æ–ª—å–∫–æ –ø–æ–ª–Ω–æ–µ —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á–µ—Å—Ç–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É

2. **–ü–û–°–õ–ï –ö–ê–ñ–î–û–ì–û –§–ê–ô–õ–ê –û–ë–ù–û–í–õ–Ø–ô –û–¢–ß–Å–¢** ‚Äî –Ω–µ –ø–æ—Å–ª–µ –ø–∞–∫–µ—Ç–∞, –Ω–µ –≤ –∫–æ–Ω—Ü–µ!

   - –ü—Ä–æ—á–∏—Ç–∞–ª —Ñ–∞–π–ª ‚Üí –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª ‚Üí –°–†–ê–ó–£ –∑–∞–ø–∏—Å–∞–ª –≤ –æ—Ç—á—ë—Ç
   - –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç "–∑–∞–±—ã–≤–∞–Ω–∏–µ" –∏ –ª–æ–∂–Ω—ã–µ ‚úÖ

3. **–ù–ï –°–¢–ê–í–¨ ‚úÖ –ë–ï–ó –î–û–ö–ê–ó–ê–¢–ï–õ–¨–°–¢–í**
   - –ö–∞–∂–¥—ã–π ‚úÖ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±–æ—Å–Ω–æ–≤–∞–Ω —Ä–µ–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π
   - –õ—É—á—à–µ üü° —Å —á–µ—Å—Ç–Ω—ã–º–∏ –∑–∞–º–µ—á–∞–Ω–∏—è–º–∏, —á–µ–º —Ñ–µ–π–∫–æ–≤—ã–π ‚úÖ

#### –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞

–ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–π –ø–æ –ø–æ—Ä—è–¥–∫—É:

```
‚ñ° –ú–æ–¥—É–ª—å–Ω—ã–π –¥–æ–∫—Å—Ç—Ä–∏–Ω–≥ (–≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞)
‚ñ° –ò–º–ø–æ—Ä—Ç logger (from utils.logger import logger)
‚ñ° –ö–∞–∂–¥—ã–π class ‚Äî –µ—Å—Ç—å –¥–æ–∫—Å—Ç—Ä–∏–Ω–≥?
‚ñ° –ö–∞–∂–¥—ã–π def/async def ‚Äî –µ—Å—Ç—å –¥–æ–∫—Å—Ç—Ä–∏–Ω–≥?
‚ñ° –ö–∞–∂–¥—ã–π except –±–ª–æ–∫ ‚Äî –µ—Å—Ç—å logger.error() –∏–ª–∏ logger.exception()?
‚ñ° –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —ç–º–æ–¥–∑–∏ (–µ—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç —ç–º–æ–¥–∑–∏)
‚ñ° –ù–µ—Ç GOD-—Ñ—É–Ω–∫—Ü–∏–π (150+ —Å—Ç—Ä–æ–∫)
‚ñ° –ù–µ—Ç –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (OVER_COMMENT)
‚ñ° –ù–µ—Ç –º—ë—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞
```

#### –ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

```
1. –û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª –¶–ï–õ–ò–ö–û–ú (–Ω–µ grep!)
2. –ü—Ä–æ–≤–µ—Ä—å –ø–æ —á–µ–∫-–ª–∏—Å—Ç—É –≤—ã—à–µ
3. –ó–∞–ø–∏—à–∏ –∑–∞–º–µ—á–∞–Ω–∏—è
4. –°–†–ê–ó–£ –æ–±–Ω–æ–≤–∏ –æ—Ç—á—ë—Ç (–¥–æ–±–∞–≤—å —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü—É + –¥–µ—Ç–∞–ª–∏ –µ—Å–ª–∏ –µ—Å—Ç—å)
5. –ü–µ—Ä–µ—Ö–æ–¥–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ñ–∞–π–ª—É
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

**–ü–ï–†–ï–î —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π –æ—Ç—á—ë—Ç–∞** –∑–∞–ø—É—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—É –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å –∏–∑–±—ã—Ç–æ—á–Ω—ã–º–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ (—Å–º. —Ä–∞–∑–¥–µ–ª "–ö–∞–∫ –≤—ã—è–≤–ª—è—Ç—å OVER_COMMENT"). –î–æ–±–∞–≤—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ –æ—Ç—á—ë—Ç.

---

## –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å

### –°—Ç–∞–Ω–¥–∞—Ä—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞

**–ü–ï–†–ï–î –ù–ê–ß–ê–õ–û–ú –ü–†–û–í–ï–†–ö–ò** –ø—Ä–æ—á–∏—Ç–∞–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é –ø—Ä–æ–µ–∫—Ç–∞ (`docs/ru/logging.md` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥).
–¢–∏–ø–∏—á–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç —ç–º–æ–¥–∑–∏ –≤ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ:

| –≠–º–æ–¥–∑–∏ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ           |
| ------ | -------------------- |
| üé¨     | GIF –æ–ø–µ—Ä–∞—Ü–∏–∏         |
| üñºÔ∏è     | –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è          |
| üéµ     | –ê—É–¥–∏–æ                |
| üé•     | –í–∏–¥–µ–æ                |
| üìä     | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã/—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| üí∞üíµ   | –¢–æ–∫–µ–Ω—ã/—Å—Ç–æ–∏–º–æ—Å—Ç—å     |
| üöÄ     | API –≤—ã–∑–æ–≤—ã           |
| ‚úÖ     | –£—Å–ø–µ—Ö                |
| ‚ùå     | –û—à–∏–±–∫–∞               |
| ‚ö†Ô∏è     | –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ       |
| üíæ     | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤    |

### –°–ø–∏—Å–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫

1. **–î–æ–∫—Å—Ç—Ä–∏–Ω–≥–∏** ‚Äî –µ—Å—Ç—å –ª–∏ —É —Ñ—É–Ω–∫—Ü–∏–π/–∫–ª–∞—Å—Å–æ–≤/–º–æ–¥—É–ª–µ–π
2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –µ—Å—Ç—å –ª–∏ logger –≤ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Å—Ç–∞—Ö –∏ exception-–±–ª–æ–∫–∞—Ö
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** ‚Äî –µ—Å—Ç—å –ª–∏ try/except, –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∏
4. **–°—Ç–∏–ª—å –∫–æ–¥–∞** ‚Äî —á–∏—Ç–∞–µ–º–æ—Å—Ç—å, "–≥—Ä—è–∑–Ω—ã–π" –∫–æ–¥, GOD-—Ñ—É–Ω–∫—Ü–∏–∏
5. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏** ‚Äî –ø—Ä–æ–≤–µ—Ä—è–π –Ω–∞ –û–ë–û–ò–• –∫–æ–Ω—Ü–∞—Ö —Å–ø–µ–∫—Ç—Ä–∞:
   - `OVER_COMMENT` ‚Äî –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ—è—Å–Ω–µ–Ω–∏—è –æ—á–µ–≤–∏–¥–Ω–æ–≥–æ –∫–æ–¥–∞ ("# –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ" –Ω–∞–¥ `get_data()`)
   - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ —Ç–∞–º, –≥–¥–µ –ª–æ–≥–∏–∫–∞ –Ω–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω–∞—è
6. **–ú—ë—Ä—Ç–≤—ã–π –∫–æ–¥** ‚Äî –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏, –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–∞–π–ª—ã

### –ö–∞–∫ –≤—ã—è–≤–ª—è—Ç—å OVER_COMMENT

–ó–∞–ø—É—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—É –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:

```powershell
Get-ChildItem -Path . -Filter *.py -Recurse | Where-Object { $_.FullName -notmatch '\.venv|__pycache__|tests' } | ForEach-Object { $total = (Get-Content $_.FullName).Count; $comments = (Get-Content $_.FullName | Select-String -Pattern '^\s*#' | Measure-Object).Count; $pct = [math]::Round(($comments / $total) * 100, 1); if ($pct -gt 10 -and $comments -gt 20) { Write-Output "$pct% ($comments/$total) $($_.FullName)" } }
```

**–ö—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏ (>10% –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø—Ä–∏ >20 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö):**

- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Ç–∏–ø–∞ "# –ü–æ–ª—É—á–∏—Ç—å X" –Ω–∞–¥ `get_x()`
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ "# –ü—Ä–æ–≤–µ—Ä—è–µ–º Y" –Ω–∞–¥ `if y:`
- –°–µ–∫—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ `# ====` –∫–∞–∂–¥—ã–µ 10-15 —Å—Ç—Ä–æ–∫
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ "# –®–∞–≥ 1:", "# –®–∞–≥ 2:" –≤ –ø—Ä–æ—Å—Ç–æ–º –∫–æ–¥–µ

**–ù–ï –ü–†–û–í–ï–†–Ø–¢–¨:** –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º)

---

## –°—Ç–∞—Ç—É—Å—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

| –≠–º–æ–¥–∑–∏ | –ó–Ω–∞—á–µ–Ω–∏–µ             |
| ------ | -------------------- |
| ‚ùì     | –ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ         |
| ‚úÖ     | –í—Å—ë –æ—Ç–ª–∏—á–Ω–æ          |
| üü°     | –ï—Å—Ç—å –∑–∞–º–µ—á–∞–Ω–∏—è (1-3) |
| üî¥     | –ú–Ω–æ–≥–æ –∑–∞–º–µ—á–∞–Ω–∏–π (4+) |

---

---

## ‚õî –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω—ã (—á–µ–≥–æ –ù–ï –¥–µ–ª–∞—Ç—å)

### 1. –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞

```powershell
# ‚ùå –ü–õ–û–•–û ‚Äî —Ç–∞–∫ –¥–µ–ª–∞—Ç—å –ù–ï–õ–¨–ó–Ø:
Select-String -Path "*.py" -Pattern "logger"
grep -r "def " .
```

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**

- –ù–µ –≤–∏–¥–∏—à—å –∫–æ–Ω—Ç–µ–∫—Å—Ç (—á—Ç–æ –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏? –µ—Å—Ç—å –ª–∏ –¥–æ–∫—Å—Ç—Ä–∏–Ω–≥?)
- Windows —Ç–µ—Ä–º–∏–Ω–∞–ª –ª–æ–º–∞–µ—Ç –∫–æ–¥–∏—Ä–æ–≤–∫—É —ç–º–æ–¥–∑–∏
- –ü–æ–∏—Å–∫ "logger" –Ω–µ –≥–æ–≤–æ—Ä–∏—Ç, –µ—Å—Ç—å –ª–∏ —ç–º–æ–¥–∑–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏

### 2. –ù–ï –ø—Ä–æ–≤–µ—Ä—è—Ç—å "–ø–∞–∫–µ—Ç–∞–º–∏"

```
# ‚ùå –ü–õ–û–•–û:
1. –ü—Ä–æ—á–∏—Ç–∞–ª 5 —Ñ–∞–π–ª–æ–≤ database/
2. –ó–∞–ø–∏—Å–∞–ª –≤ –æ—Ç—á—ë—Ç 5 —Å—Ç—Ä–æ–∫

# ‚úÖ –•–û–†–û–®–û:
1. –ü—Ä–æ—á–∏—Ç–∞–ª database/manager.py
2. –ó–∞–ø–∏—Å–∞–ª –≤ –æ—Ç—á—ë—Ç 1 —Å—Ç—Ä–æ–∫—É
3. –ü—Ä–æ—á–∏—Ç–∞–ª database/queries.py
4. –ó–∞–ø–∏—Å–∞–ª –≤ –æ—Ç—á—ë—Ç 1 —Å—Ç—Ä–æ–∫—É
...
```

### 3. –ù–ï —Å—Ç–∞–≤–∏—Ç—å ‚úÖ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

```
# ‚ùå –ü–õ–û–•–û ‚Äî –≤—Ä–∞–Ω—å–µ:
| ‚úÖ | config.py | ‚Äî |  (–∞ —Ñ–∞–π–ª –Ω–µ —á–∏—Ç–∞–ª!)

# ‚úÖ –•–û–†–û–®–û ‚Äî —á–µ—Å—Ç–Ω–æ:
| ‚ùì | config.py | –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω |
| üü° | config.py | NO_DOC –º–æ–¥—É–ª—å |
```

### 4. –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–º—ã—Ç—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏

```
# ‚ùå –ü–õ–û–•–û:
"–ü–æ—á—Ç–∏ –≤—Å–µ —Ñ–∞–π–ª—ã –∏–º–µ—é—Ç –¥–æ–∫—Å—Ç—Ä–∏–Ω–≥–∏"
"–í —Ü–µ–ª–æ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö–æ—Ä–æ—à–µ–µ"
"–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ñ—É–Ω–∫—Ü–∏–π –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã"

# ‚úÖ –•–û–†–û–®–û:
"tools/image_analyzer.py: —Ñ—É–Ω–∫—Ü–∏–∏ analyze_image(), process_batch() –±–µ–∑ –¥–æ–∫—Å—Ç—Ä–∏–Ω–≥–æ–≤"
"database/manager.py: 3 except –±–ª–æ–∫–∞ –±–µ–∑ logger.error()"
```

---

## –ü—Ä–∏–º–µ—Ä —Å–≤–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã

| –°—Ç–∞—Ç—É—Å | –§–∞–π–ª                | –ü—É—Ç—å                        | –ó–∞–º–µ—á–∞–Ω–∏—è |
| ------ | ------------------- | --------------------------- | --------- |
| ‚úÖ     | `config.py`         | `./config.py`               | ‚Äî         |
| üü°     | `server.py`         | `./server.py`               | 2         |
| üî¥     | `manager.py`        | `./database/manager.py`     | 5         |
| ‚ùì     | `audio_analyzer.py` | `./tools/audio_analyzer.py` | ‚Äî         |

---

## –§–æ—Ä–º–∞—Ç –∑–∞–º–µ—á–∞–Ω–∏–π –ø–æ —Ñ–∞–π–ª—É

–ü–æ—Å–ª–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ —Å –∑–∞–º–µ—á–∞–Ω–∏—è–º–∏ –ø–∏—à–∏ —Ä–∞–∑–¥–µ–ª:

### –ü—Ä–∏–º–µ—Ä: üü° `server.py`

**–ü—É—Ç—å:** `./server.py`

| ‚Ññ   | –§—É–Ω–∫—Ü–∏—è/–ú–µ—Ç–æ–¥      | –ü—Ä–æ–±–ª–µ–º–∞                  |
| --- | ------------------ | ------------------------- |
| 1   | `start_server()`   | –ù–µ—Ç –¥–æ–∫—Å—Ç—Ä–∏–Ω–≥–∞            |
| 2   | `handle_request()` | Exception –±–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è |

---

### –ü—Ä–∏–º–µ—Ä: üî¥ `manager.py`

**–ü—É—Ç—å:** `./database/manager.py`

| ‚Ññ   | –§—É–Ω–∫—Ü–∏—è/–ú–µ—Ç–æ–¥                | –ü—Ä–æ–±–ª–µ–º–∞                        |
| --- | ---------------------------- | ------------------------------- |
| 1   | `DatabaseManager.__init__()` | –ù–µ—Ç –¥–æ–∫—Å—Ç—Ä–∏–Ω–≥–∞                  |
| 2   | `process_all_data()`         | GOD-—Ñ—É–Ω–∫—Ü–∏—è (150+ —Å—Ç—Ä–æ–∫)        |
| 3   | `_internal_helper()`         | Bare except –±–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è     |
| 4   | `run_query()`                | –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫          |
| 5   | –º–æ–¥—É–ª—å                       | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –º–æ–¥—É–ª—å–Ω—ã–π –¥–æ–∫—Å—Ç—Ä–∏–Ω–≥ |

---

## –ö—Ä–∞—Ç–∫–∏–µ –∫–æ–¥—ã –ø—Ä–æ–±–ª–µ–º

–î–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–ø–∏—Å–∏ –∏—Å–ø–æ–ª—å–∑—É–π —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è:

| –ö–æ–¥            | –û–ø–∏—Å–∞–Ω–∏–µ                              | –ü—Ä–∏–º–µ—Ä                                         |
| -------------- | ------------------------------------- | ---------------------------------------------- |
| `NO_DOC`       | –ù–µ—Ç –¥–æ–∫—Å—Ç—Ä–∏–Ω–≥–∞                        | –§—É–Ω–∫—Ü–∏—è –±–µ–∑ `"""`                              |
| `NO_MOD_DOC`   | –ù–µ—Ç –º–æ–¥—É–ª—å–Ω–æ–≥–æ –¥–æ–∫—Å—Ç—Ä–∏–Ω–≥–∞             | –§–∞–π–ª –±–µ–∑ `"""..."""` –≤ –Ω–∞—á–∞–ª–µ                  |
| `NO_LOG`       | –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–ª—é—á–µ–≤–æ–º –º–µ—Å—Ç–µ      | –ù–µ—Ç `logger.info()` –ø—Ä–∏ –≤–∞–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö       |
| `NO_EMOJI`     | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ —ç–º–æ–¥–∑–∏                | `logger.info("Started")` –≤–º–µ—Å—Ç–æ `"üöÄ Started"` |
| `EXC_NO_LOG`   | Exception –±–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è             | `except Exception: pass`                       |
| `BARE_EXC`     | –ì–æ–ª—ã–π except (–±–µ–∑ —Ç–∏–ø–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è)    | `except:` –≤–º–µ—Å—Ç–æ `except ValueError:`          |
| `GOD_FUNC`     | GOD-—Ñ—É–Ω–∫—Ü–∏—è (—Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∞—è/—Å–ª–æ–∂–Ω–∞—è) | –§—É–Ω–∫—Ü–∏—è 150+ —Å—Ç—Ä–æ–∫                             |
| `GOD_CLASS`    | GOD-–∫–ª–∞—Å—Å                             | –ö–ª–∞—Å—Å —Å 20+ –º–µ—Ç–æ–¥–∞–º–∏                           |
| `DIRTY`        | –ì—Ä—è–∑–Ω—ã–π/–Ω–µ—á–∏—Ç–∞–µ–º—ã–π –∫–æ–¥                | –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞, –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å 5+               |
| `OVER_COMMENT` | –ò–∑–±—ã—Ç–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤                  | `# –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ` –Ω–∞–¥ `data = get_data()`    |
| `DEAD_CODE`    | –ú—ë—Ä—Ç–≤—ã–π/–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥        | `# old_function()` –∏–ª–∏ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —Ñ–∞–π–ª     |

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–¥–æ–≤

| ‚Ññ   | –§—É–Ω–∫—Ü–∏—è/–ú–µ—Ç–æ–¥ | –ü—Ä–æ–±–ª–µ–º–∞                           |
| --- | ------------- | ---------------------------------- |
| 1   | `__init__()`  | `NO_DOC`                           |
| 2   | `process()`   | `EXC_NO_LOG`, `BARE_EXC`           |
| 3   | `run()`       | `GOD_FUNC` (200 —Å—Ç—Ä–æ–∫)             |
| 4   | –≤–µ—Å—å —Ñ–∞–π–ª     | `OVER_COMMENT` (15%, 80/530 —Å—Ç—Ä–æ–∫) |

### –ü—Ä–∏–º–µ—Ä: —á—Ç–æ —Å—á–∏—Ç–∞—Ç—å OVER_COMMENT

```python
# ‚ùå –ü–õ–û–•–û ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥—É–±–ª–∏—Ä—É–µ—Ç –∫–æ–¥:
# –ü–æ–ª—É—á–∏—Ç—å pending –±–∞—Ç—á–∏
pending_batches = db.get_pending_batches()

# –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ batch-—Ä–µ–∂–∏–º
batch_mode = [b for b in batches if b["mode"] == "batch"]

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
if status == "COMPLETED":

# ‚úÖ –•–û–†–û–®–û ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ–±—ä—è—Å–Ω—è–µ—Ç –ü–û–ß–ï–ú–£:
# Flash –º–æ–¥–µ–ª—å –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 2K, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–Ω–∏–∂–∞–µ–º
if model_type == "fast" and resolution != "1K":
    resolution = "1K"

# –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞: Google –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ç–æ–º –∂–µ –ø–æ—Ä—è–¥–∫–µ
tasks.sort(key=lambda t: (t["created_at"], t["id"]))
```

---

## –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç—á—ë—Ç–∞

```markdown
# Code Review ‚Äî YYYY-MM-DD

## –î–µ—Ä–µ–≤–æ –ø—Ä–æ–µ–∫—Ç–∞

‚Äã`
project/
‚îú‚îÄ‚îÄ config.py
‚îú‚îÄ‚îÄ server.py
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ manager.py
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ tools/
    ‚îî‚îÄ‚îÄ ...
‚Äã`

## –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –°—Ç–∞—Ç—É—Å | –§–∞–π–ª | –ü—É—Ç—å | –ó–∞–º–µ—á–∞–Ω–∏—è |
| ------ | ---- | ---- | --------- |
| ...    | ...  | ...  | ...       |

## –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä

### üü° `server.py`

...

### üî¥ `manager.py`

...

## –û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. ...
2. ...
```

```

## `.github/instructions/commit_message.md.instructions.md`

```md
---
applyTo: "**"
name: "CommitMessageInstructions"
description: "–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π –∫–æ–º–º–∏—Ç–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤"
---

–ö–æ–≥–¥–∞ —Ç–µ–±—è –ø—Ä–æ—Å—è—Ç –Ω–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞, —Å–ª–µ–¥—É–π —ç—Ç–∏–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º:
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∞–Ω–≥–ª–æ—è–∑—ã—á–Ω—ã—Ö –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤:

- feat: –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- bugfix: –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –æ—à–∏–±–æ–∫
- docs: –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- style: –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π, –Ω–µ –≤–ª–∏—è—é—â–∏—Ö –Ω–∞ —Å–º—ã—Å–ª –∫–æ–¥–∞ (–ø—Ä–æ–±–µ–ª—ã, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–æ—á–∫–∏ —Å –∑–∞–ø—è—Ç–æ–π –∏ —Ç.–¥.)
- refactor: –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∏—Å–ø—Ä–∞–≤–ª—è—é—Ç –æ—à–∏–±–∫—É –∏ –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç —Ñ—É–Ω–∫—Ü–∏—é

–ö–æ–º–º–∏—Ç—ã –≤—ã–≥–ª—è–¥—è—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:

```
feat: –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ò–ò
- –°–æ–∑–¥–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏: analyze_image() –∏ generate_image_description()
- ... {–¢–∞–∫–∏—Ö –ø—É–Ω–∫—Ç–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å 5-10 —à—Ç—É–∫}
```

–û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ. –ü—Ä–µ—Ñ–∏–∫—Å –∞–Ω–≥–ª–∏–π—Å–∫–∏–π

- feat, –∏–ª–∏ –∏–Ω–æ–π

–û—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å –ø–æ—Å–ª–µ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º. –í —Ç.—á. —Ç–µ–∑–∏—Å—ã.

–û—Ç–¥–∞–≤–∞—Ç—å –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –≤ –±–ª–æ–∫–µ –∫–æ–¥–∞ MD!

```

## `.github/instructions/doc_tools_and_terminal.instructions.md`

```md
---
applyTo: "**"
name: "DocToolsAndTerminalInstructions"
description: "–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π –∫–æ–º–º–∏—Ç–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤"
---

–ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π

–ö–û–ì–î–ê –ü–†–û–°–Ø–¢ –ü–û–ò–°–ö–ê–¢–¨ –í –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–ò —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å Context7.
–ù–ï –ò–©–ò ID –ë–ò–ë–õ–ò–û–¢–ï–ö - –°–†–ê–ó–£ –ò–°–ü–û–õ–¨–ó–£–ô –≠–¢–ò:

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º python-sdk –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è MCP —Å–µ—Ä–≤–µ—Ä–∞
ID –≤ Context7 `/modelcontextprotocol/python-sdk`

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å PlantUML –∏—Å–ø–æ–ª—å–∑—É–µ–º:
ID –≤ Context7 `/plantuml/plantuml` - –æ—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è PlantUML
ID –≤ Context7 `/websites/plantuml` - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (8911 –ø—Ä–∏–º–µ—Ä–æ–≤ –∫–æ–¥–∞)
ID –≤ Context7 `/websites/crashedmind_github_io_plantumlhitchhikersguide` - Hitchhiker's Guide to PlantUML

–î–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∫–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º:
ID –≤ Context7 `/python-pillow/pillow` - Pillow (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—Ä–æ–µ–∫—Ç–∞)
ID –≤ Context7 `/websites/pillow_readthedocs_io_en_stable` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Pillow (ReadTheDocs)

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º Pytest –∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –µ—Å—Ç—å –ø–∞–∫–µ—Ç. –ù–µ –º—É—Å–æ—Ä–∏—Ç—å –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–º–∏ —Å–∫—Ä–∏–ø—Ç–∞–º–∏ –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞. –ù—É–∂–µ–Ω —Ç–µ—Å—Ç - –Ω–∞–ø–∏—à–∏ —Ç–µ—Å—Ç.

---

```

## `.github/instructions/docstring_guide.instructions.md`

```md
---
applyTo: "**/*.py"
name: "DocstringGuideInstructions"
description: "–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—é docstring"
---

# –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ (–Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ)

## –ú–æ–¥—É–ª–∏ (—Ñ–∞–π–ª—ã .py)

–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ. –î–∞–ª–µ–µ ‚Äî –ø—É–±–ª–∏—á–Ω—ã–π API –º–æ–¥—É–ª—è:

```python
"""–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏.

–§—É–Ω–∫—Ü–∏–∏:
    get_file_mime_type(file_path: str) -> str | None
        –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç MIME-—Ç–∏–ø —Ñ–∞–π–ª–∞.
    read_file_as_bytes(file_path: str) -> bytes
        –ß–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª –∫–∞–∫ –±–∞–π—Ç—ã.
    is_image_valid(file_path: str) -> bool
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ª–∏ —Ñ–æ—Ä–º–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
"""
```

–î–ª—è –º–æ–¥—É–ª–µ–π —Å –∫–ª–∞—Å—Å–∞–º–∏:

```python
"""–ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Gemini API.

–ö–ª–∞—Å—Å—ã:
    GeminiClient
        –ö–ª–∏–µ–Ω—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Gemini API.

        –ú–µ—Ç–æ–¥—ã:
            generate_content(prompt: str, image: bytes) -> dict
                –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–º–ø—Ç–∞ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
            analyze_video(video_path: str, mode: str) -> VideoAnalysis
                –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤–∏–¥–µ–æ —Å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –∫–∞–¥—Ä–æ–≤.
"""
```

## –§—É–Ω–∫—Ü–∏–∏ –∏ –º–µ—Ç–æ–¥—ã

Google-style docstring:

```python
def analyze_image(image_path: str, model: str = "default") -> dict:
    """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Gemini API.

    Args:
        image_path: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
        model: –ú–æ–¥–µ–ª—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "default").

    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∞–Ω–∞–ª–∏–∑–∞.

    Raises:
        ValueError: –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.
        FileNotFoundError: –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω.
    """
```

**–ü—Ä–∞–≤–∏–ª–∞:**

- Args, Returns, Raises ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏
- –¢–∏–ø—ã –≤ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ, –ù–ï –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –≤ docstring
- –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ ‚Äî –≥–ª–∞–≥–æ–ª: "–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç", "–ü–æ–ª—É—á–∞–µ—Ç", "–°–æ–∑–¥–∞—ë—Ç"

## –ö–ª–∞—Å—Å—ã

```python
class ImageProcessor:
    """–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

    Attributes:
        client: –ö–ª–∏–µ–Ω—Ç –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤.
        config: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞.
    """
```

## –ß—Ç–æ –ù–ï –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å

- –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã (`_parse_response`)
- –ü—Ä–æ—Å—Ç—ã–µ getter/setter
- `__init__` —Å –ø—Ä–æ—Å—Ç—ã–º –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–µ–º
- –û–¥–Ω–æ—Å—Ç—Ä–æ—á–Ω—ã–µ lambda

```

## `.github/instructions/logger_guide.instructions.md`

```md
---
applyTo: "**/*.py"
name: "LoggerGuideInstructions"
description: "–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–µ–∫—Ç–µ Gemini Media MCP"
---

# –ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º, —Ç–µ–±–µ –Ω–∞–¥–æ —Ü–µ–ª–∏–∫–æ–º –≤—ã—á–∏—Ç–∞—Ç—å —ç—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é. –û–¢ –Ω–∞—á–∞–ª–∞ –∏ –¥–æ –∫–æ–Ω—Ü–∞ —Ñ–∞–π–ª–∞

## `doc/logging.md`

```

## `.pytest_cache/README.md`

```md
# pytest cache directory #

This directory contains data from the pytest's cache plugin,
which provides the `--lf` and `--ff` options, as well as the `cache` fixture.

**Do not** commit this to version control.

See [the docs](https://docs.pytest.org/en/stable/how-to/cache.html) for more information.

```

## `asset/fonts/LICENSE-FiraCode.txt`

```txt
Installing
==========

Windows
-------

In the ttf folder, double-click each font file, click ‚ÄúInstall font‚Äù; to install all at once, select all files, right-click, and choose ‚ÄúInstall‚Äù

OR

Use https://chocolatey.org:

    choco install firacode


macOS
-----

In the downloaded TTF folder:

1.  Select all font files
2.  Right click and select `Open` (alternatively `Open With Font Book`)
3.  Select "Install Font"

OR

Use http://brew.sh:

    `brew tap homebrew/cask-fonts`
    `brew install font-fira-code`


Ubuntu Zesty (17.04), Debian Stretch (9) or newer
-------------------------------------------------

1. Make sure that the `universe` (for Ubuntu) or `contrib` (for Debian) repository is enabled (see https://askubuntu.com/questions/148638/how-do-i-enable-the-universe-repository or https://wiki.debian.org/SourcesList#Component)
2. Install `fonts-firacode` package either by executing `sudo apt install fonts-firacode` in the terminal or via GUI tool (like ‚ÄúSoftware Center‚Äù)


Arch Linux
----------

Fira Code package is available in the official repository: https://www.archlinux.org/packages/community/any/ttf-fira-code/.

Variant of Fira Code package is available in the AUR: https://aur.archlinux.org/packages/otf-fira-code-git/.


Gentoo
------

    emerge -av media-fonts/fira-code


Fedora
------

To install, perform the following commands:

    dnf install fira-code-fonts


Solus
-----

Fira Code package is available in the official repository: `font-firacode-ttf` and `font-firacode-otf`.  
They can be installed by running:

    sudo eopkg install font-firacode-ttf font-firacode-otf


Void linux
----------

    xbps-install font-firacode


Linux Manual Installation
-------------------------

With most desktop-oriented distributions, double-clicking each font file in the ttf folder and selecting ‚ÄúInstall font‚Äù should be enough. If it isn‚Äôt, create and run `download_and_install.sh` script:

    #!/usr/bin/env bash

    fonts_dir="${HOME}/.local/share/fonts"
    if [ ! -d "${fonts_dir}" ]; then
        echo "mkdir -p $fonts_dir"
        mkdir -p "${fonts_dir}"
    else
        echo "Found fonts dir $fonts_dir"
    fi

    for type in Bold Light Medium Regular Retina; do
        file_path="${HOME}/.local/share/fonts/FiraCode-${type}.ttf"
        file_url="https://github.com/tonsky/FiraCode/blob/master/distr/ttf/FiraCode-${type}.ttf?raw=true"
        if [ ! -e "${file_path}" ]; then
            echo "wget -O $file_path $file_url"
            wget -O "${file_path}" "${file_url}"
        else
      echo "Found existing file $file_path"
        fi;
    done

    echo "fc-cache -f"
    fc-cache -f

More details: https://github.com/tonsky/FiraCode/issues/4


FreeBSD
-------

Using pkg(8):

    pkg install firacode

OR

Using ports:

    cd /usr/ports/x11-fonts/firacode && make install clean


Enabling ligatures
==================

Atom
----

To change your font to Fira Code, open Atom's preferences (`cmd + ,` on a Mac, `ctrl + ,` on PC), make sure the "Settings" tab is selected, or the "Editor" in Atom 1.10+, and scroll down to "Editor Settings". In the "Font Family" field, enter `Fira Code`.

If you wish to specify a font weight, for example, Light, use `Fira Code Light` as a font name (Windows) or `FiraCode-Light` (macOS).

Ligatures are enabled by default in Atom 1.9 and above.


VS Code
-------

To open the settings editor, first from the File menu choose Preferences, Settings or use keyboard shortcut `Ctrl + ,` (Windows) or `Cmd + ,` (macOS).

To enable FiraCode in the settings editor, under "Commonly Used", expand the "Text Editor" settings and then click on "Font". In the "Font Family" input box type `Fira Code`, replacing any content. Tick the check box "Enables/Disables font ligatures" under "Font Ligatures" to enable the special ligatures.

If you wish to specify a font weight, for example, Light, use `Fira Code Light` as a font name (Windows) or `FiraCode-Light` (macOS).


IntelliJ products
-----------------

1. Enable in Settings ‚Üí Editor ‚Üí Font ‚Üí Enable Font Ligatures
2. Select `Fira Code` as "Primary font" under Settings ‚Üí Editor ‚Üí Font

Additionally, if a Color Scheme is selected:

3. Enable in Settings ‚Üí Editor ‚Üí Color Scheme ‚Üí Color Scheme Font ‚Üí Enable Font Ligatures
4. Select Fira Code as "Primary font" under Settings ‚Üí Editor ‚Üí Color Scheme ‚Üí Color Scheme Font


BBEdit, TextWrangler
--------------------

Run in your terminal:

    defaults write com.barebones.bbedit "EnableFontLigatures_Fira Code" -bool YES

Source: https://www.barebones.com/support/bbedit/ExpertPreferences.html


Brackets
--------

1. From the `View` menu choose `Themes....`
2. Paste `'Fira Code'`, at the beginning of `Font Family`


Emacs
-----

There are a few options when it comes down to using ligatures in
Emacs. They are listed in order of preferred to less-preferred. Pick one!

1. Using composition mode in Emacs Mac port

If you're using the latest Mac port of Emacs (https://bitbucket.org/mituharu/emacs-mac by Mitsuharu Yamamoto) for macOS, you can use:

    (mac-auto-operator-composition-mode)

This is generally the easiest solution, but can only be used on macOS.

2. Using prettify-symbols

These instructions are pieced together by https://github.com/Triavanicus, taking some pieces from https://github.com/minad/hasklig-mode.

This method requires you to install the Fira Code Symbol font, made by https://github.com/siegebell:
https://github.com/tonsky/FiraCode/issues/211#issuecomment-239058632

    (defun fira-code-mode--make-alist (list)
      "Generate prettify-symbols alist from LIST."
      (let ((idx -1))
        (mapcar
         (lambda (s)
           (setq idx (1+ idx))
           (let* ((code (+ #Xe100 idx))
              (width (string-width s))
              (prefix ())
              (suffix '(?\s (Br . Br)))
              (n 1))
         (while (< n width)
           (setq prefix (append prefix '(?\s (Br . Bl))))
           (setq n (1+ n)))
         (cons s (append prefix suffix (list (decode-char 'ucs code))))))
         list)))

    (defconst fira-code-mode--ligatures
      '("www" "**" "***" "**/" "*>" "*/" "\\\\" "\\\\\\"
        "{-" "[]" "::" ":::" ":=" "!!" "!=" "!==" "-}"
        "--" "---" "-->" "->" "->>" "-<" "-<<" "-~"
        "#{" "#[" "##" "###" "####" "#(" "#?" "#_" "#_("
        ".-" ".=" ".." "..<" "..." "?=" "??" ";;" "/*"
        "/**" "/=" "/==" "/>" "//" "///" "&&" "||" "||="
        "|=" "|>" "^=" "$>" "++" "+++" "+>" "=:=" "=="
        "===" "==>" "=>" "=>>" "<=" "=<<" "=/=" ">-" ">="
        ">=>" ">>" ">>-" ">>=" ">>>" "<*" "<*>" "<|" "<|>"
        "<$" "<$>" "<!--" "<-" "<--" "<->" "<+" "<+>" "<="
        "<==" "<=>" "<=<" "<>" "<<" "<<-" "<<=" "<<<" "<~"
        "<~~" "</" "</>" "~@" "~-" "~=" "~>" "~~" "~~>" "%%"
        "x" ":" "+" "+" "*"))

    (defvar fira-code-mode--old-prettify-alist)

    (defun fira-code-mode--enable ()
      "Enable Fira Code ligatures in current buffer."
      (setq-local fira-code-mode--old-prettify-alist prettify-symbols-alist)
      (setq-local prettify-symbols-alist (append (fira-code-mode--make-alist fira-code-mode--ligatures) fira-code-mode--old-prettify-alist))
      (prettify-symbols-mode t))

    (defun fira-code-mode--disable ()
      "Disable Fira Code ligatures in current buffer."
      (setq-local prettify-symbols-alist fira-code-mode--old-prettify-alist)
      (prettify-symbols-mode -1))

    (define-minor-mode fira-code-mode
      "Fira Code ligatures minor mode"
      :lighter " Fira Code"
      (setq-local prettify-symbols-unprettify-at-point 'right-edge)
      (if fira-code-mode
          (fira-code-mode--enable)
        (fira-code-mode--disable)))

    (defun fira-code-mode--setup ()
      "Setup Fira Code Symbols"
      (set-fontset-font t '(#Xe100 . #Xe16f) "Fira Code Symbol"))

    (provide 'fira-code-mode)

Alternative instructions: https://github.com/Profpatsch/blog/blob/master/posts/ligature-emulation-in-emacs/post.md#appendix-b-update-1-firacode-integration

3. Using composition char table

Thanks to https://github.com/seanfarley for putting this together; extended by https://github.com/jrblevin.

Put this lisp in your .emacs:

    (when (window-system)
      (set-frame-font "Fira Code"))
    (let ((alist '((33 . ".\\(?:\\(?:==\\|!!\\)\\|[!=]\\)")
                   (35 . ".\\(?:###\\|##\\|_(\\|[#(?[_{]\\)")
                   (36 . ".\\(?:>\\)")
                   (37 . ".\\(?:\\(?:%%\\)\\|%\\)")
                   (38 . ".\\(?:\\(?:&&\\)\\|&\\)")
                   (42 . ".\\(?:\\(?:\\*\\*/\\)\\|\\(?:\\*[*/]\\)\\|[*/>]\\)")
                   (43 . ".\\(?:\\(?:\\+\\+\\)\\|[+>]\\)")
                   (45 . ".\\(?:\\(?:-[>-]\\|<<\\|>>\\)\\|[<>}~-]\\)")
                   (46 . ".\\(?:\\(?:\\.[.<]\\)\\|[.=-]\\)")
                   (47 . ".\\(?:\\(?:\\*\\*\\|//\\|==\\)\\|[*/=>]\\)")
                   (48 . ".\\(?:x[a-zA-Z]\\)")
                   (58 . ".\\(?:::\\|[:=]\\)")
                   (59 . ".\\(?:;;\\|;\\)")
                   (60 . ".\\(?:\\(?:!--\\)\\|\\(?:~~\\|->\\|\\$>\\|\\*>\\|\\+>\\|--\\|<[<=-]\\|=[<=>]\\||>\\)\\|[*$+~/<=>|-]\\)")
                   (61 . ".\\(?:\\(?:/=\\|:=\\|<<\\|=[=>]\\|>>\\)\\|[<=>~]\\)")
                   (62 . ".\\(?:\\(?:=>\\|>[=>-]\\)\\|[=>-]\\)")
                   (63 . ".\\(?:\\(\\?\\?\\)\\|[:=?]\\)")
                   (91 . ".\\(?:]\\)")
                   (92 . ".\\(?:\\(?:\\\\\\\\\\)\\|\\\\\\)")
                   (94 . ".\\(?:=\\)")
                   (119 . ".\\(?:ww\\)")
                   (123 . ".\\(?:-\\)")
                   (124 . ".\\(?:\\(?:|[=|]\\)\\|[=>|]\\)")
                   (126 . ".\\(?:~>\\|~~\\|[>=@~-]\\)")
                   )
                 ))
      (dolist (char-regexp alist)
        (set-char-table-range composition-function-table (car char-regexp)
                              `([,(cdr char-regexp) 0 font-shape-gstring]))))

**Note!** If you get `error in process filter: Attempt to shape unibyte text`, check out https://github.com/tonsky/FiraCode/issues/42. Emacs Cider users may avoid this issue by commenting the following line from the above config:

    ;; (46 . ".\\(?:\\(?:\\.[.<]\\)\\|[.=-]\\)")

Char `45` is also known to have issues in macOS Mojave.

If you are having problems with helm you can disable ligatures in helm:

    (add-hook 'helm-major-mode-hook
           (lambda ()
             (setq auto-composition-mode nil)))

4. Using font-lock keywords

If none of the above worked, you can try this method.

This method requires you to install the Fira Code Symbol font, made by https://github.com/siegebell:
https://github.com/tonsky/FiraCode/issues/211#issuecomment-239058632

    ;;; Fira code
    ;; This works when using emacs --daemon + emacsclient
    (add-hook 'after-make-frame-functions (lambda (frame) (set-fontset-font t '(#Xe100 . #Xe16f) "Fira Code Symbol")))
    ;; This works when using emacs without server/client
    (set-fontset-font t '(#Xe100 . #Xe16f) "Fira Code Symbol")
    ;; I haven't found one statement that makes both of the above situations work, so I use both for now

    (defconst fira-code-font-lock-keywords-alist
      (mapcar (lambda (regex-char-pair)
                `(,(car regex-char-pair)
                  (0 (prog1 ()
                       (compose-region (match-beginning 1)
                                       (match-end 1)
                                       ;; The first argument to concat is a string containing a literal tab
                                       ,(concat "   " (list (decode-char 'ucs (cadr regex-char-pair)))))))))
              '(("\\(www\\)"                   #Xe100)
                ("[^/]\\(\\*\\*\\)[^/]"        #Xe101)
                ("\\(\\*\\*\\*\\)"             #Xe102)
                ("\\(\\*\\*/\\)"               #Xe103)
                ("\\(\\*>\\)"                  #Xe104)
                ("[^*]\\(\\*/\\)"              #Xe105)
                ("\\(\\\\\\\\\\)"              #Xe106)
                ("\\(\\\\\\\\\\\\\\)"          #Xe107)
                ("\\({-\\)"                    #Xe108)
                ("\\(\\[\\]\\)"                #Xe109)
                ("\\(::\\)"                    #Xe10a)
                ("\\(:::\\)"                   #Xe10b)
                ("[^=]\\(:=\\)"                #Xe10c)
                ("\\(!!\\)"                    #Xe10d)
                ("\\(!=\\)"                    #Xe10e)
                ("\\(!==\\)"                   #Xe10f)
                ("\\(-}\\)"                    #Xe110)
                ("\\(--\\)"                    #Xe111)
                ("\\(---\\)"                   #Xe112)
                ("\\(-->\\)"                   #Xe113)
                ("[^-]\\(->\\)"                #Xe114)
                ("\\(->>\\)"                   #Xe115)
                ("\\(-<\\)"                    #Xe116)
                ("\\(-<<\\)"                   #Xe117)
                ("\\(-~\\)"                    #Xe118)
                ("\\(#{\\)"                    #Xe119)
                ("\\(#\\[\\)"                  #Xe11a)
                ("\\(##\\)"                    #Xe11b)
                ("\\(###\\)"                   #Xe11c)
                ("\\(####\\)"                  #Xe11d)
                ("\\(#(\\)"                    #Xe11e)
                ("\\(#\\?\\)"                  #Xe11f)
                ("\\(#_\\)"                    #Xe120)
                ("\\(#_(\\)"                   #Xe121)
                ("\\(\\.-\\)"                  #Xe122)
                ("\\(\\.=\\)"                  #Xe123)
                ("\\(\\.\\.\\)"                #Xe124)
                ("\\(\\.\\.<\\)"               #Xe125)
                ("\\(\\.\\.\\.\\)"             #Xe126)
                ("\\(\\?=\\)"                  #Xe127)
                ("\\(\\?\\?\\)"                #Xe128)
                ("\\(;;\\)"                    #Xe129)
                ("\\(/\\*\\)"                  #Xe12a)
                ("\\(/\\*\\*\\)"               #Xe12b)
                ("\\(/=\\)"                    #Xe12c)
                ("\\(/==\\)"                   #Xe12d)
                ("\\(/>\\)"                    #Xe12e)
                ("\\(//\\)"                    #Xe12f)
                ("\\(///\\)"                   #Xe130)
                ("\\(&&\\)"                    #Xe131)
                ("\\(||\\)"                    #Xe132)
                ("\\(||=\\)"                   #Xe133)
                ("[^|]\\(|=\\)"                #Xe134)
                ("\\(|>\\)"                    #Xe135)
                ("\\(\\^=\\)"                  #Xe136)
                ("\\(\\$>\\)"                  #Xe137)
                ("\\(\\+\\+\\)"                #Xe138)
                ("\\(\\+\\+\\+\\)"             #Xe139)
                ("\\(\\+>\\)"                  #Xe13a)
                ("\\(=:=\\)"                   #Xe13b)
                ("[^!/]\\(==\\)[^>]"           #Xe13c)
                ("\\(===\\)"                   #Xe13d)
                ("\\(==>\\)"                   #Xe13e)
                ("[^=]\\(=>\\)"                #Xe13f)
                ("\\(=>>\\)"                   #Xe140)
                ("\\(<=\\)"                    #Xe141)
                ("\\(=<<\\)"                   #Xe142)
                ("\\(=/=\\)"                   #Xe143)
                ("\\(>-\\)"                    #Xe144)
                ("\\(>=\\)"                    #Xe145)
                ("\\(>=>\\)"                   #Xe146)
                ("[^-=]\\(>>\\)"               #Xe147)
                ("\\(>>-\\)"                   #Xe148)
                ("\\(>>=\\)"                   #Xe149)
                ("\\(>>>\\)"                   #Xe14a)
                ("\\(<\\*\\)"                  #Xe14b)
                ("\\(<\\*>\\)"                 #Xe14c)
                ("\\(<|\\)"                    #Xe14d)
                ("\\(<|>\\)"                   #Xe14e)
                ("\\(<\\$\\)"                  #Xe14f)
                ("\\(<\\$>\\)"                 #Xe150)
                ("\\(<!--\\)"                  #Xe151)
                ("\\(<-\\)"                    #Xe152)
                ("\\(<--\\)"                   #Xe153)
                ("\\(<->\\)"                   #Xe154)
                ("\\(<\\+\\)"                  #Xe155)
                ("\\(<\\+>\\)"                 #Xe156)
                ("\\(<=\\)"                    #Xe157)
                ("\\(<==\\)"                   #Xe158)
                ("\\(<=>\\)"                   #Xe159)
                ("\\(<=<\\)"                   #Xe15a)
                ("\\(<>\\)"                    #Xe15b)
                ("[^-=]\\(<<\\)"               #Xe15c)
                ("\\(<<-\\)"                   #Xe15d)
                ("\\(<<=\\)"                   #Xe15e)
                ("\\(<<<\\)"                   #Xe15f)
                ("\\(<~\\)"                    #Xe160)
                ("\\(<~~\\)"                   #Xe161)
                ("\\(</\\)"                    #Xe162)
                ("\\(</>\\)"                   #Xe163)
                ("\\(~@\\)"                    #Xe164)
                ("\\(~-\\)"                    #Xe165)
                ("\\(~=\\)"                    #Xe166)
                ("\\(~>\\)"                    #Xe167)
                ("[^<]\\(~~\\)"                #Xe168)
                ("\\(~~>\\)"                   #Xe169)
                ("\\(%%\\)"                    #Xe16a)
                ("[0\[]\\(x\\)"                #Xe16b)
                ("[^:=]\\(:\\)[^:=]"           #Xe16c)
                ("[^\\+<>]\\(\\+\\)[^\\+<>]"   #Xe16d)
                ("[^\\*/<>]\\(\\*\\)[^\\*/<>]" #Xe16f))))

    (defun add-fira-code-symbol-keywords ()
      (font-lock-add-keywords nil fira-code-font-lock-keywords-alist))

    (add-hook 'prog-mode-hook
              #'add-fira-code-symbol-keywords)

On some systems, `==` will appear incorrectly as a blank space in certain modes unless you add the following lines to your init file:

    (set-language-environment "UTF-8")
    (set-default-coding-systems 'utf-8)


GoormIDE
--------

In a workspace:

1. Click goormIDE, then Preferences.
2. Go to Theme, then focus Custom Theme CSS.
3. Copy & paste the following:

    @font-face{
        font-family: 'Fira Code';
        src: url('https://raw.githubusercontent.com/tonsky/FiraCode/master/distr/eot/FiraCode-Regular.eot') format('embedded-opentype'),
             url('https://raw.githubusercontent.com/tonsky/FiraCode/master/distr/woff2/FiraCode-Regular.woff2') format('woff2'),
             url('https://raw.githubusercontent.com/tonsky/FiraCode/master/distr/woff/FiraCode-Regular.woff') format('woff'),
             url('https://raw.githubusercontent.com/tonsky/FiraCode/master/distr/ttf/FiraCode-Regular.ttf') format('truetype');
        font-weight: normal;
        font-style: normal;
    }

    .editor_container pre {
        -webkit-font-feature-settings: "liga" on, "calt" on;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        font-family: 'Fira Code';
    }

4. Click Aplly or OK
5. Happy coding!


Cloud9
------

In a workspace:

1. Click Cloud9, then Preferences (or use keyboard shortcut CTRL + ,)
2. Go to Themes, then click on You can also style Cloud9 by editing your stylesheet (this will open a blank styles.css file in the C9 editor)
3. Copy & paste the following:

    @font-face{
        font-family: 'Fira Code';
        src: url('https://raw.githubusercontent.com/tonsky/FiraCode/master/distr/eot/FiraCode-Regular.eot') format('embedded-opentype'),
             url('https://raw.githubusercontent.com/tonsky/FiraCode/master/distr/woff2/FiraCode-Regular.woff2') format('woff2'),
             url('https://raw.githubusercontent.com/tonsky/FiraCode/master/distr/woff/FiraCode-Regular.woff') format('woff'),
             url('https://raw.githubusercontent.com/tonsky/FiraCode/master/distr/ttf/FiraCode-Regular.ttf') format('truetype');
        font-weight: normal;
        font-style: normal;
    }

    .ace_editor{
        -webkit-font-feature-settings: "liga" on, "calt" on;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        font-family: 'Fira Code';
    }

4. Back in Preferences tab, click on User Settings, then click on Code Editor (Ace)
5. In Font Family field, enter Fira Code
6. Optionally, repeat step 5 for Preferences > User Settings > Terminal, if you want Fira Code font in C9 terminal.


MacVim
------

Add this to ~/.gvimrc:

    set macligatures
    set guifont=Fira\ Code:h12

MacVim supports ligatures starting from version 7.4.


RStudio
-------

In RStudio:

1. Go to Tools > Global Options > Appearance
2. Select "Fira Code" as Editor Font. In older versions of RStudio, check "Use Ligatures".
3. Hit "OK" and enjoy


Sublime Text
------------

Preferences --> Settings

Add before "ignored_packages":

    "font_face": "Fira Code",
    "font_options": ["subpixel_antialias"],

If you want enable antialias, add in font_options: "gray_antialias"


Visual Studio
-------------

1. Launch Visual Studio (2015 or later).
2. Launch the Options dialog by opening the "Tools" menu and selecting "Options". 
3. In the Options dialog, under the "Environment" category, you'll find "Fonts and Colors". Click on that. You'll see a combo-box on the right hand side of the dialog labelled "Font". Select "Fira Code" from that combo-box. 
4. Click "OK" to dismiss.
5. Restart Visual Studio.

Now, most FiraCode ligatures will work. A notable exception is the hyphen-based ligatures (e.g. the C++ dereference '->'). See https://github.com/tonsky/FiraCode/issues/422 for details.


Troubleshooting
===============

See https://github.com/tonsky/FiraCode/wiki/Troubleshooting

```

## `asset/fonts/LICENSE-JetBrainsMono.txt`

```txt
Copyright 2020 The JetBrains Mono Project Authors (https://github.com/JetBrains/JetBrainsMono)

This Font Software is licensed under the SIL Open Font License, Version 1.1.
This license is copied below, and is also available with a FAQ at:
https://scripts.sil.org/OFL


-----------------------------------------------------------
SIL OPEN FONT LICENSE Version 1.1 - 26 February 2007
-----------------------------------------------------------

PREAMBLE
The goals of the Open Font License (OFL) are to stimulate worldwide
development of collaborative font projects, to support the font creation
efforts of academic and linguistic communities, and to provide a free and
open framework in which fonts may be shared and improved in partnership
with others.

The OFL allows the licensed fonts to be used, studied, modified and
redistributed freely as long as they are not sold by themselves. The
fonts, including any derivative works, can be bundled, embedded, 
redistributed and/or sold with any software provided that any reserved
names are not used by derivative works. The fonts and derivatives,
however, cannot be released under any other type of license. The
requirement for fonts to remain under this license does not apply
to any document created using the fonts or their derivatives.

DEFINITIONS
"Font Software" refers to the set of files released by the Copyright
Holder(s) under this license and clearly marked as such. This may
include source files, build scripts and documentation.

"Reserved Font Name" refers to any names specified as such after the
copyright statement(s).

"Original Version" refers to the collection of Font Software components as
distributed by the Copyright Holder(s).

"Modified Version" refers to any derivative made by adding to, deleting,
or substituting -- in part or in whole -- any of the components of the
Original Version, by changing formats or by porting the Font Software to a
new environment.

"Author" refers to any designer, engineer, programmer, technical
writer or other person who contributed to the Font Software.

PERMISSION & CONDITIONS
Permission is hereby granted, free of charge, to any person obtaining
a copy of the Font Software, to use, study, copy, merge, embed, modify,
redistribute, and sell modified and unmodified copies of the Font
Software, subject to the following conditions:

1) Neither the Font Software nor any of its individual components,
in Original or Modified Versions, may be sold by itself.

2) Original or Modified Versions of the Font Software may be bundled,
redistributed and/or sold with any software, provided that each copy
contains the above copyright notice and this license. These can be
included either as stand-alone text files, human-readable headers or
in the appropriate machine-readable metadata fields within text or
binary files as long as those fields can be easily viewed by the user.

3) No Modified Version of the Font Software may use the Reserved Font
Name(s) unless explicit written permission is granted by the corresponding
Copyright Holder. This restriction only applies to the primary font name as
presented to the users.

4) The name(s) of the Copyright Holder(s) or the Author(s) of the Font
Software shall not be used to promote, endorse or advertise any
Modified Version, except to acknowledge the contribution(s) of the
Copyright Holder(s) and the Author(s) or with their explicit written
permission.

5) The Font Software, modified or unmodified, in part or in whole,
must be distributed entirely under this license, and must not be
distributed under any other license. The requirement for fonts to
remain under this license does not apply to any document created
using the Font Software.

TERMINATION
This license becomes null and void if any of the above conditions are
not met.

DISCLAIMER
THE FONT SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT
OF COPYRIGHT, PATENT, TRADEMARK, OR OTHER RIGHT. IN NO EVENT SHALL THE
COPYRIGHT HOLDER BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
INCLUDING ANY GENERAL, SPECIAL, INDIRECT, INCIDENTAL, OR CONSEQUENTIAL
DAMAGES, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF THE USE OR INABILITY TO USE THE FONT SOFTWARE OR FROM
OTHER DEALINGS IN THE FONT SOFTWARE.

```

## `asset/fonts/LICENSES.md`

```md
# –õ–∏—Ü–µ–Ω–∑–∏–∏ —à—Ä–∏—Ñ—Ç–æ–≤

–í—Å–µ —à—Ä–∏—Ñ—Ç—ã –≤ —ç—Ç–æ–π –ø–∞–ø–∫–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ–¥ —Å–≤–æ–±–æ–¥–Ω—ã–º–∏ –ª–∏—Ü–µ–Ω–∑–∏—è–º–∏ –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –≤ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –∏ –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.

## JetBrains Mono

**–õ–∏—Ü–µ–Ω–∑–∏—è:** SIL Open Font License 1.1  
**–ò—Å—Ç–æ—á–Ω–∏–∫:** <https://www.jetbrains.com/lp/mono/>  
**–§–∞–π–ª –ª–∏—Ü–µ–Ω–∑–∏–∏:** LICENSE-JetBrainsMono.txt

–†–∞–∑—Ä–µ—à–µ–Ω–æ:

- ‚úÖ –ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ
- ‚úÖ –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## Fira Code

**–õ–∏—Ü–µ–Ω–∑–∏—è:** SIL Open Font License 1.1  
**–ò—Å—Ç–æ—á–Ω–∏–∫:** <https://github.com/tonsky/FiraCode>  
**–§–∞–π–ª –ª–∏—Ü–µ–Ω–∑–∏–∏:** LICENSE-FiraCode.txt

–†–∞–∑—Ä–µ—à–µ–Ω–æ:

- ‚úÖ –ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ
- ‚úÖ –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## Cascadia Code

**–õ–∏—Ü–µ–Ω–∑–∏—è:** SIL Open Font License 1.1  
**–ò—Å—Ç–æ—á–Ω–∏–∫:** <https://github.com/microsoft/cascadia-code>  
**–ê–≤—Ç–æ—Ä:** Microsoft Corporation

–†–∞–∑—Ä–µ—à–µ–Ω–æ:

- ‚úÖ –ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ
- ‚úÖ –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

**–ò—Ç–æ–≥–æ:** –í—Å–µ —Ç—Ä–∏ —à—Ä–∏—Ñ—Ç–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø–æ–¥ –∏—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –ª–∏—Ü–µ–Ω–∑–∏—è–º–∏ OFL.

```

## `doc/analysis_report.md`

```md
# –û—Ç—á—ë—Ç –æ–± –∞–Ω–∞–ª–∏–∑–µ –ø—Ä–æ–µ–∫—Ç–∞ Code to Image MCP

## –î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞
2024-11-29

## –û–±–∑–æ—Ä

–ü—Ä–æ–≤–µ–¥—ë–Ω –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ —Å —Ü–µ–ª—å—é —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞, –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –ø—Ä–æ–µ–∫—Ç–∞.

## –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

#### 1.1 –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `render_diagram_from_string` (diagram_renderer.py)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –§—É–Ω–∫—Ü–∏—è `render_diagram_from_string` –±—ã–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –¥–≤–∞–∂–¥—ã –≤ —Ñ–∞–π–ª–µ:
- –ü–µ—Ä–≤–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (—Å—Ç—Ä–æ–∫–∏ 124-191) ‚Äî –Ω–µ–ø–æ–ª–Ω–æ–µ, –±–µ–∑ return statement
- –í—Ç–æ—Ä–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (—Å—Ç—Ä–æ–∫–∏ 194-421) ‚Äî –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–ü—Ä–∏—á–∏–Ω–∞:** AI-–ø–æ–º–æ—â–Ω–∏–∫ –æ—Å—Ç–∞–≤–∏–ª –º—É—Å–æ—Ä–Ω—ã–π –∫–æ–¥ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –£–¥–∞–ª–µ–Ω–æ –ø–µ—Ä–≤–æ–µ –Ω–µ–ø–æ–ª–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏.

#### 1.2 –ú—ë—Ä—Ç–≤—ã–π –∫–æ–¥ –ø–æ—Å–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏ (diagram_renderer.py)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ—Å–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏ `render_diagram_from_string` –Ω–∞—Ö–æ–¥–∏–ª—Å—è –±–ª–æ–∫ –∫–æ–¥–∞ (—Å—Ç—Ä–æ–∫–∏ 287-350), –∫–æ—Ç–æ—Ä—ã–π –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª—Å—è ‚Äî –¥—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è –∫–æ–¥ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã PlantUML –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –£–¥–∞–ª—ë–Ω –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥.

### 2. –ü—Ä–æ–±–ª–µ–º—ã —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

**–û–ø–∏—Å–∞–Ω–∏–µ:** –í–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –≤—ã–∑–æ–≤—ã `print()` –≤–º–µ—Å—Ç–æ —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

**–§–∞–π–ª—ã:**
- `code_to_image.py` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª print() –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å—Ç–∞—Ç—É—Å–∞
- `diagram_renderer.py` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª print() –≤ –¥–µ–º–æ-–±–ª–æ–∫–µ

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ `logging.getLogger(__name__)` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —ç–º–æ–¥–∑–∏-–ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É `doc/logging.md`.

### 3. –ü—Ä–æ–±–ª–µ–º—ã —Å –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

**–û–ø–∏—Å–∞–Ω–∏–µ:** Docstrings –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É –ø—Ä–æ–µ–∫—Ç–∞ (Google-style –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ).

**–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–±–ª–µ–º:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `str:` –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ –æ–ø–∏—Å–∞–Ω–∏—è
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–æ—á–µ–∫ –≤ –∫–æ–Ω—Ü–µ –æ–ø–∏—Å–∞–Ω–∏–π
- –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –í—Å–µ docstrings –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω—ã —Å–æ–≥–ª–∞—Å–Ω–æ `.github/instructions/docstring_guide.instructions.md`.

### 4. AI-–º—É—Å–æ—Ä –∏ –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

**–§–∞–π–ª:** `code_to_image.py`

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å –Ω–æ–º–µ—Ä–∞–º–∏ –≤–µ—Ä—Å–∏–π (`–í–µ—Ä—Å–∏—è 4.1:`)
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ docstring –º–æ–¥—É–ª—è
- –ü–æ—è—Å–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ —Å—Ç–∏–ª–µ –æ–±—É—á–µ–Ω–∏—è (`# --- 1. –§—É–Ω–∫—Ü–∏—è-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä ---`)
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Ç–∏–ø–∞ `# <-- –¢–µ–ø–µ—Ä—å —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ TTF`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è.

### 5. –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã

**–§–∞–π–ª:** `diagram_renderer.py`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–º–ø–æ—Ä—Ç `import os` –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –£–¥–∞–ª—ë–Ω –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∏–º–ø–æ—Ä—Ç.

## –í–Ω–µ—Å—ë–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### diagram_renderer.py

1. –û–±–Ω–æ–≤–ª—ë–Ω docstring –º–æ–¥—É–ª—è —Å –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ–º –ø—É–±–ª–∏—á–Ω–æ–≥–æ API
2. –î–æ–±–∞–≤–ª–µ–Ω –ª–æ–≥–≥–µ—Ä `logger = logging.getLogger(__name__)`
3. –£–¥–∞–ª–µ–Ω–∞ –¥—É–±–ª–∏—Ä—É—é—â–∞—è—Å—è —Ñ—É–Ω–∫—Ü–∏—è `render_diagram_from_string`
4. –£–¥–∞–ª—ë–Ω –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥ (—Å—Ç—Ä–æ–∫–∏ 287-350)
5. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏
6. –£–¥–∞–ª—ë–Ω –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∏–º–ø–æ—Ä—Ç `os`
7. –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω—ã docstrings –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É

### code_to_image.py

1. –û–±–Ω–æ–≤–ª—ë–Ω docstring –º–æ–¥—É–ª—è
2. –î–æ–±–∞–≤–ª–µ–Ω –ª–æ–≥–≥–µ—Ä
3. –ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ `print()` –Ω–∞ –≤—ã–∑–æ–≤—ã –ª–æ–≥–≥–µ—Ä–∞
4. –£–¥–∞–ª–µ–Ω—ã –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
5. –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω—ã docstrings –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É
6. –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏
7. –§—É–Ω–∫—Ü–∏—è —Ç–µ–ø–µ—Ä—å –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏

### font_manager.py

1. –û–±–Ω–æ–≤–ª—ë–Ω docstring –º–æ–¥—É–ª—è —Å –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ–º API
2. –î–æ–±–∞–≤–ª–µ–Ω –ª–æ–≥–≥–µ—Ä
3. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
4. –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω—ã docstrings –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É

### server.py

1. –û–±–Ω–æ–≤–ª—ë–Ω docstring –º–æ–¥—É–ª—è —Å –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ–º MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
2. –î–æ–±–∞–≤–ª–µ–Ω –ª–æ–≥–≥–µ—Ä
3. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
4. –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω—ã docstrings –≤—Å–µ—Ö MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
5. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
6. –£–ø–æ—Ä—è–¥–æ—á–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –§–∞–π–ª | –°—Ç—Ä–æ–∫ –¥–æ | –°—Ç—Ä–æ–∫ –ø–æ—Å–ª–µ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|----------|-------------|-----------|
| diagram_renderer.py | 473 | 316 | -157 |
| code_to_image.py | 227 | 173 | -54 |
| font_manager.py | 59 | 68 | +9 |
| server.py | 386 | 374 | -12 |

**–ò—Ç–æ–≥–æ —É–¥–∞–ª–µ–Ω–æ –º—É—Å–æ—Ä–Ω–æ–≥–æ –∫–æ–¥–∞:** ~214 —Å—Ç—Ä–æ–∫

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –±—É–¥—É—â–µ–µ

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏–Ω—Ç–µ—Ä** ‚Äî –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å flake8 –∏–ª–∏ ruff –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞
2. **Pre-commit hooks** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
3. **Code review** ‚Äî —Ç—â–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å AI-–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
4. **–¢–µ—Å—Ç—ã** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è code_to_image.py –∏ server.py

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –æ—á–∏—â–µ–Ω –æ—Ç –º—É—Å–æ—Ä–Ω–æ–≥–æ –∫–æ–¥–∞, –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è. –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ.

```

## `doc/code_to_image.md`

```md
## üìú –ù–∞—à–µ –ù–∞—á–∞–ª–æ: –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –í—ã–±–æ—Ä

[cite_start]–í—Å—è –Ω–∞—à–∞ —Ä–∞–±–æ—Ç–∞ –Ω–∞—á–∞–ª–∞—Å—å —Å —Ç–æ–≥–æ —Å–∞–º–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞[cite: 1]. –û–Ω –ø—Ä–µ–¥–ª–æ–∂–∏–ª –Ω–∞–º –¥–≤–∞ –ø—É—Ç–∏:

1. [cite_start]**–ü—É—Ç—å `Playwright`**: –¢—è–∂–µ–ª—ã–π, —Å–ª–æ–∂–Ω—ã–π, —Å –∑–∞–ø—É—Å–∫–æ–º —Ü–µ–ª–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞, –Ω–æ –¥–∞—é—â–∏–π –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —á–µ—Ä–µ–∑ `CSS`[cite: 6, 51, 65].
2. [cite_start]**–ü—É—Ç—å `Pygments` –∏ `Pillow`**: –õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π, ¬´–Ω–∞—Ç–∏–≤–Ω—ã–π¬ª –¥–ª—è `Python`, –±—ã—Å—Ç—Ä—ã–π, –Ω–æ –Ω–∞ –ø–µ—Ä–≤—ã–π –≤–∑–≥–ª—è–¥ ‚Äî –±–æ–ª–µ–µ —Ç–æ–ø–æ—Ä–Ω—ã–π[cite: 7, 75, 93].

–ú—ã —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ –≤—ã–±—Ä–∞–ª–∏ –≤—Ç–æ—Ä–æ–π –ø—É—Ç—å. –ù–∞—à–∞ –≥–∏–ø–æ—Ç–µ–∑–∞ –±—ã–ª–∞ –≤ —Ç–æ–º, —á—Ç–æ –º—ã —Å–º–æ–∂–µ–º ¬´–¥–æ–≤–µ—Å—Ç–∏¬ª –µ–≥–æ –¥–æ —É–º–∞ –∏ –ø–æ–ª—É—á–∏—Ç—å 99% –≤–∏–∑—É–∞–ª—å–Ω–æ–π –∫—Ä–∞—Å–æ—Ç—ã `Playwright`, –Ω–æ –±–µ–∑ –µ–≥–æ ¬´—Ç—è–∂–µ—Å—Ç–∏¬ª. –ò –º—ã —ç—Ç–æ —Å–¥–µ–ª–∞–ª–∏.

---

## üî¨ –ê–Ω–∞—Ç–æ–º–∏—è –ö–æ–¥–∞: ¬´–û—Ç –∏ –î–æ¬ª

–î–∞–≤–∞–π –ø—Ä–æ–π–¥–µ–º—Å—è –ø–æ –ª–æ–≥–∏–∫–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ `create code screenshot`, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤ –∫–∞–∂–¥–æ–π –µ–≥–æ —á–∞—Å—Ç–∏ ‚Äî –æ–¥–Ω–æ –∏–∑ –Ω–∞—à–∏—Ö —Ä–µ—à–µ–Ω–∏–π.

### –®–∞–≥ 1: –ò–º–ø–æ—Ä—Ç—ã –∏ ¬´–ú–æ–∑–≥¬ª

[cite_start]–í —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ –º—ã –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º `pygments` (–Ω–∞—à ¬´–º–æ–∑–≥¬ª, –æ—Ç–≤–µ—á–∞—é—â–∏–π –∑–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å [cite: 77, 78][cite_start]), `PIL` (–æ–Ω –∂–µ `Pillow` ‚Äî –Ω–∞—à ¬´—Ö—É–¥–æ–∂–Ω–∏–∫¬ª [cite: 80]) –∏ `io` (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞—è —á–∞—Å—Ç—å, –Ω–∞—à–∞ ¬´–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–º—è—Ç—å¬ª –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π).

–§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–¥ –∏ —è–∑—ã–∫. –ü–µ—Ä–≤–æ–µ, —á—Ç–æ –æ–Ω–∞ –¥–µ–ª–∞–µ—Ç, ‚Äî –Ω–∞—Ö–æ–¥–∏—Ç –≤ `Pygments` –Ω—É–∂–Ω—ã–π ¬´–ª–µ–∫—Å–µ—Ä¬ª. –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ: —Å–∫–∞–∑–∞–ª–∏ `typescript` ‚Äî –æ–Ω –≤–∑—è–ª –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è `typescript`.

### –®–∞–≥ 2: ¬´–ü–∞–Ω–µ–ª—å –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è¬ª (–ù–∞—à–∏ `options`)

–í–æ—Ç –∑–¥–µ—Å—å –∏ –∫—Ä–æ–µ—Ç—Å—è –≤—Å—è –º–∞–≥–∏—è, –∫–æ—Ç–æ—Ä—É—é –º—ã –¥–æ–±–∞–≤–∏–ª–∏. –≠—Ç–æ —Ü–µ–Ω—Ç—Ä –≤—Å–µ—Ö –Ω–∞—à–∏—Ö —Ä–µ—à–µ–Ω–∏–π.

* [cite_start]**`style`**: –≠—Ç–æ —Å–∞–º–æ–µ –ø—Ä–æ—Å—Ç–æ–µ ‚Äî –≤—ã–±–æ—Ä —Ü–≤–µ—Ç–æ–≤–æ–π —Å—Ö–µ–º—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä, `'dracula'` –∏–ª–∏ `'github-dark'`[cite: 84].
* **`transparent`**: –≠—Ç–æ –±—ã–ª–∞ –Ω–∞—à–∞ –ø–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏. –ú—ã –±—ã—Å—Ç—Ä–æ –≤—ã—è—Å–Ω–∏–ª–∏, —á—Ç–æ —ç—Ç–∞ –æ–ø—Ü–∏—è –ø–æ–ª–µ–∑–Ω–∞, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å *—Å–≤–µ—Ç–ª—É—é* —Ç–µ–º—É (—Å —Ç–µ–º–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º). –ò–Ω–∞—á–µ, –∫–∞–∫ —Ç—ã —Å–∞–º —Å–∫–∞–∑–∞–ª, –ø–æ–ª—É—á–∞–µ—Ç—Å—è ¬´–Ω–µ—á–∏—Ç–∞–µ–º–æ–µ –≥–æ–≤–Ω–æ¬ª ‚Äî —Å–≤–µ—Ç–ª—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–º —Ñ–æ–Ω–µ.
* **`font_name`**: –ó–¥–µ—Å—å –º—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å –ø–µ—Ä–≤–æ–π –ø—Ä–æ–±–ª–µ–º–æ–π. [cite_start]–Ø –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ—Å—Ç–∞–≤–∏–ª —à—Ä–∏—Ñ—Ç, –∫–æ—Ç–æ—Ä–æ–≥–æ —É —Ç–µ–±—è –Ω–∞ Windows –Ω–µ –±—ã–ª–æ[cite: 87, 88]. –ú—ã —Ä–µ—à–∏–ª–∏ —ç—Ç–æ, –∏—Å–ø–æ–ª—å–∑—É—è `'Consolas'` –∫–∞–∫ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç. –≠—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç–µ–±–µ –∑–∞–¥–∞—Ç—å –ª—é–±–æ–π —à—Ä–∏—Ñ—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–∏–¥–∏—Ç —Ç–≤–æ—è —Å–∏—Å—Ç–µ–º–∞.
* **`scale_factor`**: **–≠—Ç–æ –Ω–∞—à–∞ –≥–ª–∞–≤–Ω–∞—è –ø–æ–±–µ–¥–∞.** –¢—ã –ø–æ–º–Ω–∏—à—å, –∫–∞–∫ –º—ã –ø—ã—Ç–∞–ª–∏—Å—å –≤—ã—Å—Ç–∞–≤–∏—Ç—å `DPI 300`? –ò —Ç–≤–æ–π —Å–∫—Ä–∏–Ω—à–æ—Ç —Å–≤–æ–π—Å—Ç–≤ —Ñ–∞–π–ª–∞ [from `–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.png` (—Å–≤–æ–π—Å—Ç–≤–∞)] –¥–æ–∫–∞–∑–∞–ª, —á—Ç–æ `Pillow` –∏ `WebP` –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª–∏ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É. –ú—ã –ø–æ–Ω—è–ª–∏, —á—Ç–æ –≥–Ω–∞—Ç—å—Å—è –∑–∞ `DPI` ‚Äî —Ç—É–ø–∏–∫. [cite_start]–ú—ã ¬´—É–∫—Ä–∞–ª–∏¬ª –∏–¥–µ—é —É `Playwright` —Å –µ–≥–æ `device scale factor`[cite: 46]. –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã *–≥–æ–≤–æ—Ä–∏—Ç—å* —Ñ–∞–π–ª—É, —á—Ç–æ –æ–Ω ¬´–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π¬ª, –º—ã *—Ñ–∏–∑–∏—á–µ—Å–∫–∏* –¥–µ–ª–∞–µ–º –µ–≥–æ –≤ 3 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ. –≠—Ç–æ—Ç `scale_factor` (–º—ã –ø–æ—Å—Ç–∞–≤–∏–ª–∏ `3`) —É–º–Ω–æ–∂–∞–µ—Ç—Å—è –Ω–∞ `font_size`, –Ω–∞ `pad` –∏ –Ω–∞ `line_pad`. –ú—ã –ø—Ä–æ—Å—Ç–æ —Ä–∏—Å—É–µ–º –æ–≥—Ä–æ–º–Ω—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É, –∏ –∑–∞ —Å—á–µ—Ç —ç—Ç–æ–≥–æ –ø–æ–ª—É—á–∞–µ–º —Ç—É —Å–∞–º—É—é –∫—Ä–∏—Å—Ç–∞–ª—å–Ω—É—é —á–µ—Ç–∫–æ—Å—Ç—å.
* **`line_numbers`**: –ü—Ä–æ—Å—Ç–æ–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å ¬´–≤–∫–ª/–≤—ã–∫–ª¬ª.
* **`line_pad`**: –≠—Ç–æ —Ç–≤–æ–π –∑–∞–ø—Ä–æ—Å. –¢—ã —Å–∫–∞–∑–∞–ª, —á—Ç–æ –æ—Ç—Å—Ç—É–ø —É –Ω—É–º–µ—Ä–∞—Ü–∏–∏ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –≠—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç –µ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å.
* **`line_number_fg` –∏ `line_number_bg`**: –≠—Ç–æ –±—ã–ª –Ω–∞—à ¬´—Ñ–∏–Ω–∞–ª—å–Ω—ã–π –±–æ—Å—Å¬ª ‚Äî —Ç–æ—Ç —É—Ä–æ–¥–ª–∏–≤—ã–π –±–µ–ª—ã–π –±–ª–æ–∫ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ [from `–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.png` (–∫–æ–¥)]. –ö–ª—é—á–µ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –º—ã –ø—Ä–∏–Ω—è–ª–∏: `line number bg` (—Ñ–æ–Ω –Ω–æ–º–µ—Ä–æ–≤) –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –±–µ—Ä–µ—Ç—Å—è –∏–∑ `style inst background color` (–æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–æ–Ω–∞ —Å—Ç–∏–ª—è). –ê `line number fg` (—Ü–≤–µ—Ç —Ü–∏—Ñ—Ä) —Ç—ã –º–æ–∂–µ—à—å –∑–∞–¥–∞—Ç—å –≤—Ä—É—á–Ω—É—é, –ø–æ–¥–æ–±—Ä–∞–≤ –µ–≥–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–¥ —Ü–≤–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –¢–∞–∫ –º—ã ¬´—Å–ª–∏–ª–∏¬ª –Ω—É–º–µ—Ä–∞—Ü–∏—é —Å —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º.

### –®–∞–≥ 3: ¬´–•—É–¥–æ–∂–Ω–∏–∫¬ª (`ImageFormatter`)

[cite_start]–ó–¥–µ—Å—å –º—ã –ø—Ä–æ—Å—Ç–æ –±–µ—Ä–µ–º –≤—Å–µ —ç—Ç–∏ –æ–ø—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º—ã *—É–∂–µ* –æ–±—Ä–∞–±–æ—Ç–∞–ª–∏ (—É–º–Ω–æ–∂–∏–≤ –Ω–∞ `scale_factor`!)[cite: 120], –∏ –ø–µ—Ä–µ–¥–∞–µ–º –∏—Ö –≤ `ImageFormatter`. –ú—ã, –ø–æ —Å—É—Ç–∏, –¥–∞–µ–º `Pygments` —Ç–æ—á–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: ¬´–†–∏—Å—É–π –≤–æ—Ç —ç—Ç–∏–º —à—Ä–∏—Ñ—Ç–æ–º 54-–≥–æ —Ä–∞–∑–º–µ—Ä–∞, —Å –æ—Ç—Å—Ç—É–ø–æ–º –≤ 75 –ø–∏–∫—Å–µ–ª–µ–π, –∞ —Ñ–æ–Ω –Ω–æ–º–µ—Ä–æ–≤ —Å–¥–µ–ª–∞–π —Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–º¬ª.

### –®–∞–≥ 4: –ì–ª–∞–≤–Ω—ã–π –¢—Ä—é–∫ (–ü–µ—Ä–µ—Ö–≤–∞—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É `Pillow`)

–ê –≤–æ—Ç —ç—Ç–æ ‚Äî —Å–∞–º–æ–µ —ç–ª–µ–≥–∞–Ω—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≤–æ –≤—Å–µ–º —Å–∫—Ä–∏–ø—Ç–µ.

–ò–∑–Ω–∞—á–∞–ª—å–Ω–æ `Pygments` —Å–∞–º —Å–æ—Ö—Ä–∞–Ω—è–ª —Ñ–∞–π–ª. –ù–æ –º—ã –≤—ã—è—Å–Ω–∏–ª–∏, —á—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –ø–∞—Ä—à–∏–≤–æ: –Ω–µ —É–º–µ–µ—Ç –≤ `WebP`, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç `DPI`.

–ü–æ—ç—Ç–æ–º—É –º—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–º–µ–Ω—è–ª–∏ –ª–æ–≥–∏–∫—É. –ú—ã –≥–æ–≤–æ—Ä–∏–º `Pygments` `highlight`, –Ω–æ **–Ω–µ** –≤ —Ñ–∞–π–ª, –∞ `outfile=None`. –≠—Ç–æ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –µ–≥–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å `PNG` —Å–æ –≤—Å–µ–º–∏ –Ω–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏ –≤–µ—Ä–Ω—É—Ç—å –µ–≥–æ –≤ –≤–∏–¥–µ *–±–∞–π—Ç–æ–≤* (—Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö) –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é.

–ó–∞—Ç–µ–º –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `io.BytesIO`, —á—Ç–æ–±—ã ¬´–æ–±–µ—Ä–Ω—É—Ç—å¬ª —ç—Ç–∏ –±–∞–π—Ç—ã –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –≤ –ø–∞–º—è—Ç–∏.

–ò —Ç–æ–ª—å–∫–æ *–ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ* –º—ã –æ—Ç–¥–∞–µ–º —ç—Ç–æ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª `Pillow` (`Image.open`). –¢–µ–ø–µ—Ä—å `Pygments` –≤–Ω–µ –∏–≥—Ä—ã. –ú—ã –∫–æ–º–∞–Ω–¥—É–µ–º `Pillow` –Ω–∞–ø—Ä—è–º—É—é: ¬´–í–æ–∑—å–º–∏ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –°–æ—Ö—Ä–∞–Ω–∏ –µ–≥–æ –≤ `WebP`, —Å –∫–∞—á–µ—Å—Ç–≤–æ–º `95`¬ª.

---

## üèÅ –ß—Ç–æ –ú—ã –ü–æ–ª—É—á–∏–ª–∏: ¬´–û—Ç –∏ –î–æ¬ª

–ú—ã –Ω–∞—á–∞–ª–∏ —Å –ø—Ä–æ—Å—Ç–æ–≥–æ –≤—ã–∑–æ–≤–∞ `Pygments`, –∫–æ—Ç–æ—Ä—ã–π –¥–∞–≤–∞–ª –Ω–∞–º ¬´–ø—Ä–∏–µ–º–ª–µ–º—ã–π¬ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ê –≤ –∏—Ç–æ–≥–µ –º—ã –ø–æ—Å—Ç—Ä–æ–∏–ª–∏ –Ω–∞—Å—Ç–æ—è—â–∏–π –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∫–æ–Ω–≤–µ–π–µ—Ä.

–ú—ã –≤–∑—è–ª–∏ ¬´–º–æ–∑–≥¬ª `Pygments` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞, –Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–±—Ä–∞–ª–∏ —É –Ω–µ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –æ—Ç—Ä–∏—Å–æ–≤–∫–æ–π, –æ—Ç–¥–∞–≤ –µ–≥–æ `Pillow`. –ú—ã —Ä–µ—à–∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—É –∫–∞—á–µ—Å—Ç–≤–∞ –Ω–µ ¬´—Ñ–ª–∞–≥–æ–º `DPI`¬ª, –∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º. –ú—ã —Ä–µ—à–∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—É –¥–∏–∑–∞–π–Ω–∞, –Ω–∞–π–¥—è —Å–∫—Ä—ã—Ç—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–º–µ—Ä–æ–≤ —Å—Ç—Ä–æ–∫.

–í –∏—Ç–æ–≥–µ —É –Ω–∞—Å –≤ —Ä—É–∫–∞—Ö –æ–∫–∞–∑–∞–ª—Å—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—á—Ç–∏ —Ç–∞–∫ –∂–µ –ø—Ä–æ—Å—Ç –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏, –∫–∞–∫ –∏ –Ω–∞—á–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç, –Ω–æ –¥–∞–µ—Ç –Ω–∞–º –≥–∏–±–∫–æ—Å—Ç—å –∏ –∫–∞—á–µ—Å—Ç–≤–æ, –∫–æ—Ç–æ—Ä—ã–µ, –∫–∞–∑–∞–ª–æ—Å—å, –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤ —Ç—è–∂–µ–ª–æ–º `Playwright`.

```

## `doc/developers/architecture.md`

```md
# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ Code to Image MCP

> **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 30 –Ω–æ—è–±—Ä—è 2025 ‚Äî Phase 4 (AST Code Extractor)  
> **–í–µ—Ä—Å–∏—è:** 1.4.0  
> **–¢–µ—Å—Ç—ã:** 122 passed (19 AST + 15 Integration + 88 Unit)

## –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä—ë—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–¥—Å–∏—Å—Ç–µ–º:

1. **Code Screenshot Engine** ‚Äî –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞ —á–µ—Ä–µ–∑ Pygments + Pillow
2. **Code Extractor** ‚Äî AST-based –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π/–∫–ª–∞—Å—Å–æ–≤/–º–µ—Ç–æ–¥–æ–≤ (Phase 4)
3. **PlantUML Diagram Renderer** ‚Äî –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ UML –¥–∏–∞–≥—Ä–∞–º–º —á–µ—Ä–µ–∑ Java + PlantUML JAR

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–∞

```
src/
‚îú‚îÄ‚îÄ code_to_image.py      # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞
‚îú‚îÄ‚îÄ code_extractor.py     # AST-based –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–¥–∞ (Phase 4)
‚îú‚îÄ‚îÄ diagram_renderer.py   # PlantUML —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
‚îú‚îÄ‚îÄ font_manager.py       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ TTF —à—Ä–∏—Ñ—Ç–∞–º–∏
‚îú‚îÄ‚îÄ font_initializer.py   # –ò–Ω—ä–µ–∫—Ü–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ –≤ JRE
‚îú‚îÄ‚îÄ image_utils.py        # –£—Ç–∏–ª–∏—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îî‚îÄ‚îÄ guide_manager.py      # –ú–µ–Ω–µ–¥–∂–µ—Ä PlantUML –≥–∞–π–¥–æ–≤
```

---

## 1. Code Screenshot Engine

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Pygments** ‚Äî –õ–µ–∫—Å–µ—Ä –∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
- **Pillow (PIL)** ‚Äî –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PNG –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- **ImageMagick-like flow** ‚Äî –†–µ–Ω–¥–µ—Ä ‚Üí PIL Image ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω

```
User Request
    ‚Üì
code_to_image.create_code_image()
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. Pygments Lexer              ‚îÇ ‚Üí –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–¥–∞ –ø–æ —è–∑—ã–∫—É
‚îÇ 2. Pygments Style              ‚îÇ ‚Üí –í—ã–±–æ—Ä —Ü–≤–µ—Ç–æ–≤–æ–π —Å—Ö–µ–º—ã
‚îÇ 3. ImageFormatter              ‚îÇ ‚Üí –†–µ–Ω–¥–µ—Ä –≤ –±–∞–π—Ç—ã PNG
‚îÇ 4. PIL Image.open()            ‚îÇ ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ –≤ –ø–∞–º—è—Ç—å
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
image_utils.save_image()
    ‚Üì
PNG/WEBP/JPEG —Ñ–∞–π–ª
```

---

## 1.5. Code Extractor (Phase 4)

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **ast module** ‚Äî –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–µ—Ä Python –¥–ª—è AST –∞–Ω–∞–ª–∏–∑–∞
- **Zero dependencies** ‚Äî –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —á–∏—Å—Ç–æ–º Python 3.13+

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω

```
User Request: extract "OrderService.create_order"
    ‚Üì
code_extractor.extract_code_entity()
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. ast.parse(source_code)              ‚îÇ ‚Üí –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ AST –¥–µ—Ä–µ–≤–∞
‚îÇ 2. –ü–æ–∏—Å–∫ —Å—É—â–Ω–æ—Å—Ç–∏ –ø–æ –∏–º–µ–Ω–∏             ‚îÇ ‚Üí –û–±—Ö–æ–¥ ast.walk()
‚îÇ 3. ast.get_source_segment()            ‚îÇ ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–¥–∞
‚îÇ 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚îÇ ‚Üí @decorator
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
–ò–∑–≤–ª–µ—á—ë–Ω–Ω—ã–π Python –∫–æ–¥ (str)
```

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

#### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∏–º—ë–Ω

```python
# –§—É–Ω–∫—Ü–∏—è
extract_code_entity("path/to/file.py", "calculate_sum")

# –ö–ª–∞—Å—Å
extract_code_entity("path/to/file.py", "OrderService")

# –ú–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞
extract_code_entity("path/to/file.py", "OrderService.create_order")

# Async –º–µ—Ç–æ–¥
extract_code_entity("path/to/file.py", "PaymentProcessor.process_payment")
```

#### –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã

```python
# –ë–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤
code = extract_code_entity("file.py", "old_function", include_decorators=False)
# def old_function(x: str) -> str:
#     return x.upper()

# –° –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞–º–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
code = extract_code_entity("file.py", "old_function", include_decorators=True)
# @deprecated
# def old_function(x: str) -> str:
#     return x.upper()
```

#### –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π

```python
entities = list_entities("file.py")
# {
#   "functions": ["calculate_sum", "old_function", "fetch_data"],
#   "classes": {
#     "User": ["activate", "deactivate"],
#     "OrderService": ["create_order", "calculate_total", "from_config"]
#   }
# }
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–∞–¥ regex

| –ö—Ä–∏—Ç–µ—Ä–∏–π | Regex | AST |
|----------|-------|-----|
| –¢–æ—á–Ω–æ—Å—Ç—å | 60-70% | 99.9% |
| –í–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã | ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç | ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ |
| –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã | ‚ùå –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç | ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ |
| Async —Ñ—É–Ω–∫—Ü–∏–∏ | ‚ö†Ô∏è –°–ª–æ–∂–Ω–æ | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| Docstrings | ‚ùå –ü—Ä–æ–±–ª–µ–º—ã | ‚úÖ –í–∫–ª—é—á–µ–Ω—ã |
| –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ | ‚úÖ –õ—é–±–æ–π | ‚úÖ –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π |

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Code Screenshot Engine

#### DPI-–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –∏ –æ—Ç—Å—Ç—É–ø—ã —É–º–Ω–æ–∂–∞—é—Ç—Å—è –Ω–∞ scale_factor
scaled_font_size = int(font_size * scale_factor)  # 18 * 3.0 = 54
scaled_pad = int(pad * scale_factor)              # 25 * 3.0 = 75
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 3840√ó2160 –≤–º–µ—Å—Ç–æ 1280√ó720 (4K ready).

#### –ö–∞—Å—Ç–æ–º–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã

```python
font_path = get_font_path("JetBrainsMono")
# ‚Üí "C:/PY/code_to_image_mcp/asset/fonts/JetBrainsMono-Regular.ttf"

formatter = ImageFormatter(
    font_name=font_path,  # –ü—É—Ç—å –∫ TTF, –ù–ï –∏–º—è —à—Ä–∏—Ñ—Ç–∞!
    ...
)
```

**–í–∞–∂–Ω–æ:** Pygments —Ç—Ä–µ–±—É–µ—Ç **–∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å** –∫ TTF —Ñ–∞–π–ª—É, –∞ –Ω–µ –∏–º—è —à—Ä–∏—Ñ—Ç–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã.

---

## 2. PlantUML Diagram Renderer

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Java JRE** ‚Äî –û–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ PlantUML
- **PlantUML JAR** ‚Äî –î–≤–∏–∂–æ–∫ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ (`asset/bins/plantuml.jar`)
- **Subprocess** ‚Äî –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ Python ‚Üî Java —á–µ—Ä–µ–∑ stdin/stdout
- **Pillow** ‚Äî –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (PNG –∏–∑ –±–∞–π—Ç–æ–≤)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω

```
User Request
    ‚Üì
diagram_renderer.render_diagram_to_image()
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ (–æ–¥–∏–Ω —Ä–∞–∑)    ‚îÇ
‚îÇ    font_initializer.ensure_fonts_initialized()
‚îÇ                                         ‚îÇ
‚îÇ 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–¥–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã           ‚îÇ
‚îÇ    _prepare_diagram_code()             ‚îÇ
‚îÇ    ‚Üí –í—Å—Ç–∞–≤–∫–∞ !include —Ç–µ–º—ã             ‚îÇ
‚îÇ    ‚Üí –î–æ–±–∞–≤–ª–µ–Ω–∏–µ !pragma layout smetana ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ 3. –ó–∞–ø—É—Å–∫ Java –ø—Ä–æ—Ü–µ—Å—Å–∞                ‚îÇ
‚îÇ    subprocess.run([                    ‚îÇ
‚îÇ      "java", "-jar", "plantuml.jar",   ‚îÇ
‚îÇ      "-pipe", "-tpng", ...             ‚îÇ
‚îÇ    ], input=diagram_code)              ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞                ‚îÇ
‚îÇ    - Stderr ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫          ‚îÇ
‚îÇ    - Stdout ‚Üí PNG –±–∞–π—Ç—ã                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
image_utils.load_image_from_bytes()
    ‚Üì
PIL Image –æ–±—ä–µ–∫—Ç
```

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏—á–∞: –ò–Ω—ä–µ–∫—Ü–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ –≤ JRE

PlantUML –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Java –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Ç–µ–∫—Å—Ç–∞. –ß—Ç–æ–±—ã **–∫–∞—Å—Ç–æ–º–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã** (JetBrains Mono, Fira Code) —Ä–∞–±–æ—Ç–∞–ª–∏, –∏—Ö –Ω—É–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —à—Ä–∏—Ñ—Ç–æ–≤ JRE.

#### –ü—Ä–æ—Ü–µ—Å—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

```
font_initializer.ensure_fonts_initialized()
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä–∫–µ—Ä–∞                   ‚îÇ
‚îÇ    –§–∞–π–ª: .fonts_installed.json        ‚îÇ
‚îÇ    –°–æ–¥–µ—Ä–∂–∏—Ç: –ø—É—Ç—å –∫ JRE, —Å–ø–∏—Å–æ–∫ —à—Ä–∏—Ñ—Ç–æ–≤‚îÇ
‚îÇ                                        ‚îÇ
‚îÇ 2. –ï—Å–ª–∏ –º–∞—Ä–∫–µ—Ä–∞ –Ω–µ—Ç:                  ‚îÇ
‚îÇ    –∞) –ù–∞–π—Ç–∏ Java Home                 ‚îÇ
‚îÇ       java -XshowSettings:properties  ‚îÇ
‚îÇ    –±) –ù–∞–π—Ç–∏ lib/fonts –≤ JRE           ‚îÇ
‚îÇ    –≤) –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å *.ttf –∏–∑ asset/fonts‚îÇ
‚îÇ    –≥) –°–æ–∑–¥–∞—Ç—å –º–∞—Ä–∫–µ—Ä                  ‚îÇ
‚îÇ                                        ‚îÇ
‚îÇ 3. –ï—Å–ª–∏ –º–∞—Ä–∫–µ—Ä –µ—Å—Ç—å:                  ‚îÇ
‚îÇ    ‚Üí –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### –ü—Ä–∏–º–µ—Ä –º–∞—Ä–∫–µ—Ä–∞

```json
{
  "java_home": "C:\\Program Files\\Java\\jdk-17",
  "fonts_installed": [
    "JetBrainsMono-Regular.ttf",
    "FiraCode-Regular.ttf"
  ],
  "platform": "Windows",
  "timestamp": "1701350400.0"
}
```

**–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?**

- PlantUML **–Ω–µ –≤–∏–¥–∏—Ç** —à—Ä–∏—Ñ—Ç—ã –∏–∑ `asset/fonts/` –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ JRE
- Windows API `AddFontResourceExW` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞, –Ω–æ –Ω–µ –¥–ª—è –¥–æ—á–µ—Ä–Ω–µ–≥–æ Java –ø—Ä–æ—Ü–µ—Å—Å–∞
- –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ JRE ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∫—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–±

---

## 3. –°–∏—Å—Ç–µ–º–∞ —Ç–µ–º PlantUML

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
User: theme="dark_gold"
    ‚Üì
diagram_renderer._prepare_diagram_code()
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–µ–º—ã        ‚îÇ
‚îÇ    Path("asset/themes/dark_gold.puml") ‚îÇ
‚îÇ                                        ‚îÇ
‚îÇ 2. –í—Å—Ç–∞–≤–∫–∞ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã –≤–∫–ª—é—á–µ–Ω–∏—è        ‚îÇ
‚îÇ    !include asset/themes/dark_gold.puml‚îÇ
‚îÇ    ‚Üí –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ü–ï–†–ï–î @startuml       ‚îÇ
‚îÇ                                        ‚îÇ
‚îÇ 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Smetana (–Ω–æ–≤—ã–π –¥–≤–∏–∂–æ–∫)  ‚îÇ
‚îÇ    !pragma layout smetana              ‚îÇ
‚îÇ    ‚Üí –£–ª—É—á—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∞–≤—Ç–æ–ª–µ–π–∞—É—Ç–∞    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–∏–º–µ—Ä –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞

**–í—Ö–æ–¥–Ω–æ–π –∫–æ–¥:**

```plantuml
@startuml
component "API" <<Adapter>>
@enduml
```

**–ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ `_prepare_diagram_code()`:**

```plantuml
@startuml
!pragma layout smetana
!include asset/themes/dark_gold.puml

component "API" <<Adapter>>
@enduml
```

**–ö–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ:** PlantUML —Å–Ω–∞—á–∞–ª–∞ —á–∏—Ç–∞–µ—Ç —Å—Ç–∏–ª–∏ –∏–∑ —Ç–µ–º—ã, **–ø–æ—Ç–æ–º** –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏—Ö –∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º —Å —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–∞–º–∏.

---

## 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (image_utils)

### –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π Pipeline

```python
# 1. –ò—Å—Ç–æ—á–Ω–∏–∫: Pillow Image (–∏–∑ Pygments –∏–ª–∏ PlantUML)
image: PIL.Image.Image

# 2. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
if scale_factor != 1.0:
    image = resize_image(image, scale_factor)

# 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
save_image(
    image,
    output_path="result.webp",
    format="webp",
    quality=90  # –ë–∞–ª–∞–Ω—Å –∫–∞—á–µ—Å—Ç–≤–æ/—Ä–∞–∑–º–µ—Ä
)
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### WebP (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

- **–ú–µ—Ç–æ–¥:** `lossless=False` + –∫–∞—á–µ—Å—Ç–≤–æ 90
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–∞ 30% –º–µ–Ω—å—à–µ PNG –ø—Ä–∏ —Ç–æ–º –∂–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–º –∫–∞—á–µ—Å—Ç–≤–µ

#### PNG

- **–ú–µ—Ç–æ–¥:** `optimize=True` + `compress_level=9`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–∞—á–µ—Å—Ç–≤–∞

#### JPEG

- **–ê–≤—Ç–æ–∫–æ–Ω–≤–µ—Ä—Å–∏—è RGBA ‚Üí RGB** (JPEG –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–ª—å—Ñ–∞-–∫–∞–Ω–∞–ª)
- **–ö–∞—á–µ—Å—Ç–≤–æ:** 92 (–±–∞–ª–∞–Ω—Å –¥–ª—è –∫–æ–¥–∞ —Å –º–µ–ª–∫–∏–º —Ç–µ–∫—Å—Ç–æ–º)

---

## 5. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–∞–π–¥–∞–º–∏ (guide_manager)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **AI-–∞–≥–µ–Ω—Ç–∞–º** –∫—Ä–∞—Ç–∫–∏–µ/–ø–æ–ª–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ PlantUML —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É –ø—Ä—è–º–æ —á–µ—Ä–µ–∑ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
doc/plantuml_guides/
‚îú‚îÄ‚îÄ index.json           # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤—Å–µ—Ö –≥–∞–π–¥–æ–≤
‚îú‚îÄ‚îÄ class_diagram.md     # Markdown —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏
‚îú‚îÄ‚îÄ sequence_diagram.md
‚îî‚îÄ‚îÄ themes.md

Markdown —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
<!-- BRIEF_START -->
–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (500 —Å–∏–º–≤–æ–ª–æ–≤)
<!-- BRIEF_END -->

<!-- DETAILED_START -->
–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ (–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)
<!-- DETAILED_END -->
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ MCP

```python
# –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è AI-–∞–≥–µ–Ω—Ç–∞
@mcp.tool()
def get_plantuml_guide(diagram_type: str, detail_level: str = "brief"):
    content = get_guide(diagram_type, full=(detail_level == "full"))
    return {"guide": content}
```

**–ü–æ–ª—å–∑–∞:** –ê–≥–µ–Ω—Ç –º–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø—Ä—è–º–æ –≤–æ –≤—Ä–µ–º—è –¥–∏–∞–ª–æ–≥–∞, –Ω–µ –∑–∞–≥—Ä—É–∂–∞—è –≤–µ—Å—å –≥–∞–π–¥ –≤ –ø—Ä–æ–º–ø—Ç.

---

## 6. –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –∫–æ–¥–∞ (High-level)

```mermaid
graph LR
    A[MCP Tool Call] --> B[server.py]
    B --> C[code_to_image.py]
    C --> D[Pygments Render]
    D --> E[PIL Image]
    E --> F[image_utils.save]
    F --> G[WEBP —Ñ–∞–π–ª]
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã (High-level)

```mermaid
graph TD
    A[MCP Tool Call] --> B[server.py]
    B --> C[diagram_renderer.py]
    C --> D{–®—Ä–∏—Ñ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã?}
    D -- –ù–µ—Ç --> E[font_initializer]
    E --> F[–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ TTF –≤ JRE]
    F --> G[Java PlantUML Process]
    D -- –î–∞ --> G
    G --> H[PNG bytes]
    H --> I[PIL Image]
    I --> J[image_utils.save]
    J --> K[PNG/SVG —Ñ–∞–π–ª]
```

---

## 7. –ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å

### Windows

- ‚úÖ Font injection —á–µ—Ä–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ JRE (—Ä–∞–±–æ—Ç–∞–µ—Ç)
- ‚úÖ Subprocess —Å UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è Java 11+ –≤ PATH

### macOS

- ‚úÖ Font injection —á–µ—Ä–µ–∑ JRE
- ‚úÖ Homebrew Java –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
- ‚ö†Ô∏è –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `doc/macos_compatibility.md`

### Linux

- ‚úÖ Font injection —á–µ—Ä–µ–∑ JRE
- ‚úÖ OpenJDK –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- ‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ `/usr/lib/jvm/.../lib/fonts`

---

## 8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –£–∑–∫–∏–µ –º–µ—Å—Ç–∞

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è |
|----------|-------|-------------|
| PlantUML —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ | 1-3 —Å–µ–∫ | –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| –ò–Ω—ä–µ–∫—Ü–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ | 500 –º—Å | –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è 1 —Ä–∞–∑, –∑–∞—Ç–µ–º –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è |
| Pygments —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ | 100-300 –º—Å | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏–Ω—ã –∫–æ–¥–∞ |
| –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ WEBP | 50-200 –º—Å | –ë—ã—Å—Ç—Ä–µ–µ PNG –Ω–∞ 40% |

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–î–ª—è –º–∞—Å—Å–æ–≤–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–µ—à PlantUML —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (—Ö–µ—à –∫–æ–¥–∞ ‚Üí —Ñ–∞–π–ª)
2. **–î–ª—è API:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (Celery)
3. **–î–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π:** –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ 4K –æ–¥–∏–Ω —Ä–∞–∑, –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

---

## 9. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### PlantUML Code Injection

PlantUML –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `!include` –¥–∏—Ä–µ–∫—Ç–∏–≤—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã:

```plantuml
@startuml
!include /etc/passwd
@enduml
```

**–ó–∞—â–∏—Ç–∞:** –í `_prepare_diagram_code()` –º—ã **–∑–∞–º–µ–Ω—è–µ–º** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–¥, –≤—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã. PlantUML –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å `-failfast2`, –∫–æ—Ç–æ—Ä—ã–π –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ–ø–∞—Å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.

### Java Sandbox

PlantUML JAR –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–±–µ–∑** —Å–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (`-Dplantuml.security.mode=sandbox` –≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö).

---

## 10. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ test_code_extractor.py    # AST –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–¥–∞ (Phase 4)
‚îú‚îÄ‚îÄ test_diagram_renderer.py  # PlantUML —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
‚îú‚îÄ‚îÄ test_font_*.py            # –ò–Ω—ä–µ–∫—Ü–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ (3 —Ñ–∞–π–ª–∞)
‚îú‚îÄ‚îÄ test_guide_manager.py     # –ì–∞–π–¥—ã PlantUML
‚îú‚îÄ‚îÄ test_image_utils.py       # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îú‚îÄ‚îÄ test_integration.py       # –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ E2E —Ç–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ assets/                   # –¢–µ—Å—Ç–æ–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã
    ‚îú‚îÄ‚îÄ sample_code.py        # Python –∫–æ–¥ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
    ‚îú‚îÄ‚îÄ sequence_diagram.puml # –¢–µ—Å—Ç–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞
    ‚îú‚îÄ‚îÄ class_diagram.puml    # –¢–µ—Å—Ç–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞
    ‚îú‚îÄ‚îÄ activity_diagram.puml # –¢–µ—Å—Ç–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞
    ‚îî‚îÄ‚îÄ component_diagram.puml # –¢–µ—Å—Ç–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

- **122 —Ç–µ—Å—Ç–∞** –≤ 8 —Ñ–∞–π–ª–∞—Ö
- **19 —Ç–µ—Å—Ç–æ–≤** –¥–ª—è AST —ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä–∞ (100% –ø–æ–∫—Ä—ã—Ç–∏–µ)
- **15 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤** (E2E —Å—Ü–µ–Ω–∞—Ä–∏–∏)
- **–§–æ—Ä–º–∞—Ç—ã:** PNG, SVG, WebP
- **–¢–µ–º—ã:** dark_gold, light_fresh, default

### –ó–∞–ø—É—Å–∫

```bash
pytest tests/ -v                    # –í—Å–µ —Ç–µ—Å—Ç—ã (122 —à—Ç)
pytest tests/test_integration.py -v # –¢–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ
pytest tests/test_code_extractor.py -v # AST —ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä
pytest -k "font" -v                 # –¢–æ–ª—å–∫–æ font-—Ç–µ—Å—Ç—ã
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

**test_integration.py** –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–µ workflow:

1. **TestCodeScreenshotsWorkflow** ‚Äî –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∫–æ–¥–∞
   - –ü–æ–ª–Ω—ã–π —Ñ–∞–π–ª
   - –û—Ç–¥–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (—á–µ—Ä–µ–∑ AST)
   - –ö–ª–∞—Å—Å —Ü–µ–ª–∏–∫–æ–º
   - –ú–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞

2. **TestPlantUMLDiagramsWorkflow** ‚Äî –î–∏–∞–≥—Ä–∞–º–º—ã
   - PNG —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏ (4 –¥–∏–∞–≥—Ä–∞–º–º—ã √ó 3 —Ç–µ–º—ã)
   - SVG —Ñ–æ—Ä–º–∞—Ç (4 –¥–∏–∞–≥—Ä–∞–º–º—ã)
   - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PNG ‚Üí WebP

3. **TestEndToEndScenarios** ‚Äî –°–∫–≤–æ–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (–∫–æ–¥ + –¥–∏–∞–≥—Ä–∞–º–º—ã + WebP)
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π (—Ñ—É–Ω–∫—Ü–∏—è, –∫–ª–∞—Å—Å, –º–µ—Ç–æ–¥)

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [PlantUML –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://plantuml.com/ru/)
- [Pygments –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://pygments.org/docs/)
- [Pillow —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ](https://pillow.readthedocs.io/)
- [FastMCP –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://github.com/jlowin/fastmcp)

---

**–í–æ–ø—Ä–æ—Å—ã –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ?** –ò–∑—É—á–∏—Ç–µ –∫–æ–¥ –º–æ–¥—É–ª–µ–π –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

```

## `doc/developers/logging.md`

```md
# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–µ–∫—Ç–µ Code to Image MCP

## –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–æ–¥—É–ª—å `logging` Python —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ –∏ —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º —ç–º–æ–¥–∑–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –≤–∏–∑—É–∞–ª—å–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤

–õ–æ–≥–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ —Ñ–∞–π–ª–∞–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è –≤–∞–∂–Ω–æ—Å—Ç–∏:

- **`logs/app.log`** ‚Äî –æ–±—â–∏–π –ª–æ–≥ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (INFO, WARNING, DEBUG)
- **`logs/error.log`** ‚Äî –ª–æ–≥ —Ç–æ–ª—å–∫–æ –æ—à–∏–±–æ–∫ –∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π (ERROR, CRITICAL)
- **`logs/debug.log`** ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–π –ª–æ–≥ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (DEBUG –∏ –≤—ã—à–µ)

## –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤

–ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å –≤ –ª–æ–≥–µ —Å–æ–¥–µ—Ä–∂–∏—Ç:

```
2024-11-29 14:30:45 | INFO | module_name.function_name | üöÄ MCP —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3000
```

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:

- **–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è** –≤ —Ñ–æ—Ä–º–∞—Ç–µ `YYYY-MM-DD HH:MM:SS`
- **–£—Ä–æ–≤–µ–Ω—å** (DEBUG/INFO/WARNING/ERROR/CRITICAL)
- **–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ** –≤ —Ñ–æ—Ä–º–∞—Ç–µ `module.function` –∏–ª–∏ `module.ClassName.method`
- **–°–æ–æ–±—â–µ–Ω–∏–µ** —Å —ç–º–æ–¥–∑–∏ –ø—Ä–µ—Ñ–∏–∫—Å–æ–º

## –°–∏—Å—Ç–µ–º–∞ —ç–º–æ–¥–∑–∏

### üéØ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

| –≠–º–æ–¥–∑–∏ | –£—Ä–æ–≤–µ–Ω—å | –°–æ–±—ã—Ç–∏–µ | –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
|--------|---------|---------|---------------------|
| üöÄ | INFO | –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è/—Å–µ—Ä–≤–∏—Å–∞ | `üöÄ MCP —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω` |
| ‚è∏Ô∏è | INFO | –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–±–æ—Ç—ã | `‚è∏Ô∏è –°–µ—Ä–≤–µ—Ä –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è` |
| ‚úÖ | INFO | –£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ | `‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ` |
| üõë | INFO | –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | `üõë MCP —Å–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω` |

### üìÅ –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏ –∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏

| –≠–º–æ–¥–∑–∏ | –£—Ä–æ–≤–µ–Ω—å | –°–æ–±—ã—Ç–∏–µ | –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
|--------|---------|---------|---------------------|
| üìÇ | INFO | –û—Ç–∫—Ä—ã—Ç–∏–µ/—á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ | `üìÇ –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞: /path/to/file.py` |
| üíæ | INFO | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ | `üíæ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: /path/to/image.webp` |
| üóÇÔ∏è | INFO | –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ | `üóÇÔ∏è –°–æ–∑–¥–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: /path/to/output` |
| üîç | DEBUG | –ü–æ–∏—Å–∫ —Ñ–∞–π–ª–∞/—Ä–µ—Å—É—Ä—Å–∞ | `üîç –ü–æ–∏—Å–∫ —à—Ä–∏—Ñ—Ç–∞: JetBrainsMono` |
| üì¶ | INFO | –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–∞ | `üì¶ –ó–∞–≥—Ä—É–∂–µ–Ω —à—Ä–∏—Ñ—Ç: /path/to/font.ttf` |
| üé® | INFO | –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–º—ã | `üé® –ó–∞–≥—Ä—É–∂–µ–Ω–∞ —Ç–µ–º–∞ PlantUML: dark.puml` |
| üìö | INFO | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ | `üìö –ó–∞–≥—Ä—É–∂–µ–Ω JAR: plantuml.jar (v1.2024.7)` |

### üé® –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

| –≠–º–æ–¥–∑–∏ | –£—Ä–æ–≤–µ–Ω—å | –°–æ–±—ã—Ç–∏–µ | –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
|--------|---------|---------|---------------------|
| üé® | INFO | –ù–∞—á–∞–ª–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è | `üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –∫–æ–¥–∞ –¥–ª—è —è–∑—ã–∫–∞: python` |
| üñºÔ∏è | INFO | –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è | `üñºÔ∏è –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: 3x` |
| üé≠ | INFO | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª—è | `üé≠ –ü—Ä–∏–º–µ–Ω–µ–Ω —Å—Ç–∏–ª—å –ø–æ–¥—Å–≤–µ—Ç–∫–∏: monokai` |
| ‚úèÔ∏è | DEBUG | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ | `‚úèÔ∏è –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞: 54px` |
| üîß | DEBUG | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ | `üîß –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä–∞: line_numbers=True, pad=75` |
| üìê | INFO | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º | `üìê –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ PlantUML –¥–∏–∞–≥—Ä–∞–º–º—ã: sequence` |

### üîå MCP –∏ API

| –≠–º–æ–¥–∑–∏ | –£—Ä–æ–≤–µ–Ω—å | –°–æ–±—ã—Ç–∏–µ | –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
|--------|---------|---------|---------------------|
| üì• | INFO | –í—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å | `üì• –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å generate_code_screenshot` |
| üì§ | INFO | –ò—Å—Ö–æ–¥—è—â–∏–π –æ—Ç–≤–µ—Ç | `üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç: success=True, size=1024KB` |
| üîó | INFO | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è | `üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MCP –∫–ª–∏–µ–Ω—Ç—É` |
| üîå | INFO | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ | `üîå –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: generate_file_screenshot` |
| ‚öôÔ∏è | INFO | –í—ã–∑–æ–≤ –≤–Ω–µ—à–Ω–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ | `‚öôÔ∏è –ó–∞–ø—É—Å–∫ Java –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–ª—è PlantUML` |

### ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

| –≠–º–æ–¥–∑–∏ | –£—Ä–æ–≤–µ–Ω—å | –°–æ–±—ã—Ç–∏–µ | –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
|--------|---------|---------|---------------------|
| ‚ö†Ô∏è | WARNING | –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ | `‚ö†Ô∏è –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç 250 —Å—Ç—Ä–æ–∫, –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç 200` |
| üîí | WARNING | –ü—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç—É–ø–æ–º | `üîí –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é: /protected/path` |
| üìè | WARNING | –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ | `üìè –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π: 5MB > 2MB` |
| üéØ | WARNING | Fallback –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | `üéØ –®—Ä–∏—Ñ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Consolas` |
| üîÑ | INFO | –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ | `üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏` |
| ‚òï | WARNING | –ü—Ä–æ–±–ª–µ–º—ã —Å Java/–æ–∫—Ä—É–∂–µ–Ω–∏–µ–º | `‚òï Java –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ, —Ç—Ä–µ–±—É–µ—Ç—Å—è JRE 8+` |
| üåê | WARNING | –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π | `üåê –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è UTF-8` | 200` |
| üîí | WARNING | –ü—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç—É–ø–æ–º | `üîí –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é: /protected/path` |
| üìè | WARNING | –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ | `üìè –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π: 5MB > 2MB` |
| üéØ | WARNING | Fallback –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | `üéØ –®—Ä–∏—Ñ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Consolas` |
| üîÑ | INFO | –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ | `üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏` |

### ‚ùå –û—à–∏–±–∫–∏

| –≠–º–æ–¥–∑–∏ | –£—Ä–æ–≤–µ–Ω—å | –°–æ–±—ã—Ç–∏–µ | –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
|--------|---------|---------|---------------------|
| ‚ùå | ERROR | –û–±—â–∞—è –æ—à–∏–±–∫–∞ | `‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ` |
| üö´ | ERROR | –û—Ç–∫–∞–∑ –≤ –æ–ø–µ—Ä–∞—Ü–∏–∏ | `üö´ –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤` |
| üí• | ERROR | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ | `üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä–∞` |
| üî• | CRITICAL | –§–∞—Ç–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞ | `üî• –§–∞—Ç–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞: –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä` |
| üêõ | ERROR | –û—à–∏–±–∫–∞ –≤ –ª–æ–≥–∏–∫–µ | `üêõ –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: font_path is None` |

### üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –≠–º–æ–¥–∑–∏ | –£—Ä–æ–≤–µ–Ω—å | –°–æ–±—ã—Ç–∏–µ | –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
|--------|---------|---------|---------------------|
| üìä | INFO | –í—ã–≤–æ–¥ –º–µ—Ç—Ä–∏–∫ | `üìä –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞–ø—Ä–æ—Å–æ–≤: 42, —É—Å–ø–µ—à–Ω—ã—Ö: 40` |
| ‚è±Ô∏è | DEBUG | –ó–∞–º–µ—Ä –≤—Ä–µ–º–µ–Ω–∏ | `‚è±Ô∏è –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: 1.23s` |
| üíæ | INFO | –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö | `üíæ –†–∞–∑–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: 1024KB` |
| üéØ | INFO | –ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è | `üéØ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 75/100 (75%)` |

### üîç –û—Ç–ª–∞–¥–∫–∞ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

| –≠–º–æ–¥–∑–∏ | –£—Ä–æ–≤–µ–Ω—å | –°–æ–±—ã—Ç–∏–µ | –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
|--------|---------|---------|---------------------|
| üêû | DEBUG | –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è | `üêû –ó–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π code_length: 1523` |
| üî¨ | DEBUG | –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ | `üî¨ –ê–Ω–∞–ª–∏–∑ –ª–µ–∫—Å–µ—Ä–∞: tokens=42, lines=15` |
| üß™ | DEBUG | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | `üß™ –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—É—Ç–∏: passed` |
| üìù | DEBUG | –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è | `üìù –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞: language=python, style=monokai` |

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –£—Å–ø–µ—à–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```python
logger.info("üì• –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å generate_code_screenshot")
logger.debug(f"üìù –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: language={language}, style={style}, font={font_name}")
logger.info(f"üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –¥–ª—è —è–∑—ã–∫–∞: {language}")
logger.debug(f"üîß –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä–∞: font_size={font_size}, scale={scale_factor}")
logger.info(f"üíæ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: {output_path} ({file_size}KB)")
logger.info(f"‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞ {elapsed:.2f}s")
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏

```python
try:
    font_path = get_font_path(font_name)
    logger.info(f"üì¶ –ó–∞–≥—Ä—É–∂–µ–Ω —à—Ä–∏—Ñ—Ç: {font_path}")
except ValueError as e:
    logger.warning(f"üéØ {e}, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback: Consolas")
except FileNotFoundError as e:
    logger.error(f"‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à—Ä–∏—Ñ—Ç–∞: {e}")
    raise
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º

```python
if len(lines) > MAX_FILE_LINES:
    logger.warning(
        f"‚ö†Ô∏è –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç {len(lines)} —Å—Ç—Ä–æ–∫, "
        f"–ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç {MAX_FILE_LINES}"
    )
    return error_response
    
if not os.path.isabs(file_path):
    logger.error(f"üö´ –ü—É—Ç—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–º: {file_path}")
    return error_response
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ß—Ç–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å

‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –Ω—É–∂–Ω–æ:**

- –ó–∞–ø—É—Å–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫—É —Å–µ—Ä–≤–∏—Å–æ–≤
- –í—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –∏—Å—Ö–æ–¥—è—â–∏–µ –æ—Ç–≤–µ—Ç—ã
- –û–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
- –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –í—Å–µ –æ—à–∏–±–∫–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- –í–∞–∂–Ω—ã–µ –±–∏–∑–Ω–µ—Å-—Å–æ–±—ã—Ç–∏—è
- –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –∏ –ø–æ—Ä–æ–≥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

‚ùå **–ù–µ —Å—Ç–æ–∏—Ç –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å:**

- –ü–∞—Ä–æ–ª–∏ –∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Å–æ–±—ã—Ç–∏—è
- –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã—á–∏—Å–ª–µ–Ω–∏–π (—Ç–æ–ª—å–∫–æ –≤ DEBUG)

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

- **DEBUG** ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- **INFO** ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- **WARNING** ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è, fallback –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –Ω–µ—à—Ç–∞—Ç–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏
- **ERROR** ‚Äî –æ—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- **CRITICAL** ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è

### –ü—Ä–∞–≤–∏–ª–∞ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

1. **–ù–∞—á–∏–Ω–∞–π—Ç–µ —Å —ç–º–æ–¥–∑–∏** ‚Äî –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –≤–∏–∑—É–∞–ª—å–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
2. **–ë—É–¥—å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã** ‚Äî —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤, –∑–Ω–∞—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
3. **–î–æ–±–∞–≤–ª—è–π—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç** ‚Äî —á—Ç–æ –¥–µ–ª–∞–ª–∏, –∫–∞–∫–æ–π –±—ã–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å** ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–π –∑–∞–ª–æ–≥, –∫—Ä–∞—Ç–∫–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏
5. **–î–ª—è –æ—à–∏–±–æ–∫** ‚Äî –≤–∫–ª—é—á–∞–π—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–±—É–¥—É—â–∞—è)

–í –¥–∞–ª—å–Ω–µ–π—à–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±—É–¥–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å `utils/logger.py` —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º:

- –ò–º–µ–Ω–∏ –º–æ–¥—É–ª—è
- –ò–º–µ–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏/–º–µ—Ç–æ–¥–∞
- –ù–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫–∏
- –°—Ç–µ–∫–∞ –≤—ã–∑–æ–≤–æ–≤ –¥–ª—è –æ—à–∏–±–æ–∫

–≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç —É–ø—Ä–æ—Å—Ç–∏—Ç—å –æ—Ç–ª–∞–¥–∫—É –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É —Å–æ–±—ã—Ç–∏–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

## –°–ø–µ—Ü–∏—Ñ–∏–∫–∞ –¥–ª—è –º–æ–¥—É–ª–µ–π

### diagram_renderer.py (PlantUML –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)

–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å PlantUML –æ—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ —É–¥–µ–ª—è–µ—Ç—Å—è:

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

```python
logger.info("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Java –æ–∫—Ä—É–∂–µ–Ω–∏—è")
logger.debug("üñ•Ô∏è –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã: java -version")
logger.info("‚òï Java –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞: OpenJDK 17.0.2")
# –∏–ª–∏
logger.error("‚ùå Java –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ PATH")
```

**–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤:**

```python
logger.info("üìö –ó–∞–≥—Ä—É–∑–∫–∞ PlantUML JAR –∏–∑ asset/bins/")
logger.debug(f"üì¶ –ü—É—Ç—å –∫ JAR: {jar_path}")
logger.info("üé® –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º—ã: dark.puml")
```

**–ü—Ä–æ—Ü–µ—Å—Å —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞:**

```python
logger.info("üìê –ù–∞—á–∞–ª–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ PlantUML –¥–∏–∞–≥—Ä–∞–º–º—ã")
logger.debug("üñ•Ô∏è –ö–æ–º–∞–Ω–¥–∞: java -Dplantuml.smetana=true -charset UTF-8 -jar plantuml.jar")
logger.debug("üìù –ü–µ—Ä–µ–¥–∞—á–∞ –∫–æ–¥–∞ —á–µ—Ä–µ–∑ stdin")
logger.info("‚úÖ –î–∏–∞–≥—Ä–∞–º–º–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞: /path/to/diagram.png")
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**

```python
logger.error("‚ùå PlantUML –≤–µ—Ä–Ω—É–ª –∫–æ–¥ –æ—à–∏–±–∫–∏: 1")
logger.warning("üåê –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π –∫–∏—Ä–∏–ª–ª–∏—Ü—ã")
logger.error("üí• –û—à–∏–±–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ PlantUML –≤ —Å—Ç—Ä–æ–∫–µ 15")
```

```

## `doc/developers/macos_compatibility.md`

```md
# –ü–æ–¥–¥–µ—Ä–∂–∫–∞ macOS –≤ font_initializer

## ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å macOS

–ú–æ–¥—É–ª—å `font_initializer.py` **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º —Å macOS**. –í–æ—Ç –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∞:

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Java –Ω–∞ macOS

```python
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ which –≤–º–µ—Å—Ç–æ where –Ω–∞ Unix —Å–∏—Å—Ç–µ–º–∞—Ö
where_cmd = "where" if platform.system() == "Windows" else "which"
```

### –ü—É—Ç–∏ –∫ Java –Ω–∞ macOS

–ú–æ–¥—É–ª—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—É—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Java:

1. **–ß–µ—Ä–µ–∑ `java -XshowSettings:properties`** - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö –û–°
2. **–ß–µ—Ä–µ–∑ `which java`** - Unix-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞
3. **Fallback –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—É—Ç–∏** (–¥–ª—è macOS –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π JRE –Ω–∞ macOS

–ù–∞ macOS –≤–æ–∑–º–æ–∂–Ω—ã —Ç–∞–∫–∏–µ –ø—É—Ç–∏ –∫ —à—Ä–∏—Ñ—Ç–∞–º JRE:

- `/Library/Java/JavaVirtualMachines/jdk-XX.jdk/Contents/Home/lib/fonts`
- `/Library/Java/JavaVirtualMachines/jre-XX.jdk/Contents/Home/lib/fonts`
- `~/Library/Java/Extensions` (–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π)

–ú–æ–¥—É–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:

```python
possible_paths = [
    java_home / "lib" / "fonts",
    java_home / "jre" / "lib" / "fonts",
    java_home / "lib" / "fonts" / "fallback",
    java_home / "jre" / "lib" / "fonts" / "fallback",
]
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Java –Ω–∞ macOS

–ï—Å–ª–∏ Java –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –º–æ–¥—É–ª—å –¥–∞—ë—Ç –ø–æ–Ω—è—Ç–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é:

```
‚Ä¢ macOS: brew install openjdk
```

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ macOS

–ù–∞ macOS –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è sudo –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é Java:

```bash
# –ï—Å–ª–∏ –ø—Ä–∞–≤–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã
sudo python -m pytest tests/test_font_initializer.py
```

–ò–ª–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Java —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—É—é —á–µ—Ä–µ–∑ Homebrew, –∫–æ—Ç–æ—Ä–∞—è –æ–±—ã—á–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ macOS

–í—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏ —É—Å–ø–µ—à–Ω–æ:

```bash
pytest tests/test_font_initializer.py -v
pytest tests/test_font_integration.py -v
pytest tests/test_font_diagnostic.py -v
```

## üîß –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–∑–Ω—ã—Ö –û–°

| –§–∏—á–∞ | Windows | macOS | Linux |
|------|---------|-------|-------|
| –ü–æ–∏—Å–∫ Java | ‚úÖ where | ‚úÖ which | ‚úÖ which |
| –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ java.home | ‚úÖ | ‚úÖ | ‚úÖ |
| –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ TTF –≤ JRE | ‚úÖ | ‚úÖ | ‚úÖ |
| –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –º–∞—Ä–∫–µ—Ä | ‚úÖ | ‚úÖ | ‚úÖ |
| –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ | –ò–Ω–æ–≥–¥–∞ | –ò–Ω–æ–≥–¥–∞ | –ò–Ω–æ–≥–¥–∞ |

## üìù –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### macOS + System Integrity Protection (SIP)

–ù–∞ macOS —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º SIP —Å–∏—Å—Ç–µ–º–Ω–∞—è Java –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω–∞ –æ—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Homebrew Java: `brew install openjdk`
2. –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Oracle JDK –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é

### –†–µ—à–µ–Ω–∏–µ –¥–ª—è macOS —Å SIP

–î–æ–±–∞–≤–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Homebrew Java:

```python
# –í _find_java_home() –¥–ª—è macOS
if platform.system() == "Darwin":  # macOS
    homebrew_java_paths = [
        Path("/opt/homebrew/opt/openjdk"),  # Apple Silicon
        Path("/usr/local/opt/openjdk"),      # Intel Mac
    ]
    for path in homebrew_java_paths:
        if path.exists():
            return path
```

–≠—Ç–∞ –ª–æ–≥–∏–∫–∞ —É–∂–µ –∑–∞–ª–æ–∂–µ–Ω–∞ –≤ fallback –º–µ—Ö–∞–Ω–∏–∑–º –º–æ–¥—É–ª—è.

## üéØ –í—ã–≤–æ–¥

**–ú–æ–¥—É–ª—å `font_initializer.py` –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ –Ω–∞ macOS –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π!**

–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ - –º–æ–≥—É—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –ø—Ä–∞–≤–∞ sudo –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–π Java, –Ω–æ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Homebrew –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∞–≤.

```

## `doc/developers/README.md`

```md
# üë®‚Äçüíª –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

–≠—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Å –∫–æ–¥–æ–≤–æ–π –±–∞–∑–æ–π –ø—Ä–æ–µ–∫—Ç–∞ **Code to Image MCP**.

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

### üèóÔ∏è [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](architecture.md)

–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø—Ä–æ–µ–∫—Ç–∞:

- **Code Screenshot Engine** ‚Äî Pygments + Pillow pipeline
- **PlantUML Diagram Renderer** ‚Äî Java + PlantUML JAR –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- **Font Injection System** ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —à—Ä–∏—Ñ—Ç–æ–≤ –≤ JRE
- –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- –ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å (Windows/macOS/Linux)
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞

**–ß–∏—Ç–∞—Ç—å, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ:**

- –ü–æ–Ω—è—Ç—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¥–∏–∞–≥—Ä–∞–º–º
- –†–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ –º–µ—Ö–∞–Ω–∏–∑–º–µ –∏–Ω—ä–µ–∫—Ü–∏–∏ —à—Ä–∏—Ñ—Ç–æ–≤
- –ò–∑—É—á–∏—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ Python ‚Üî Java subprocess
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

---

### üé® [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Ç–µ–º PlantUML](themes_dev_guide.md)

–ü–æ–ª–Ω—ã–π –≥–∞–π–¥ –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Ç–µ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –¥–ª—è PlantUML –¥–∏–∞–≥—Ä–∞–º–º:

- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤** (`<<Adapter>>`, `<<Core>>`, `<<Infrastructure>>`)
- –®–∞–±–ª–æ–Ω —Ç–µ–º—ã —Å —Ä–∞–±–æ—á–∏–º –∫–æ–¥–æ–º
- –ü–∞–ª–∏—Ç—Ä—ã —Ü–≤–µ—Ç–æ–≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ–º
- –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ troubleshooting
- –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Ç–µ–º—ã
- –ü—Ä–∏–º–µ—Ä—ã –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –¥–∏–∞–≥—Ä–∞–º–º

**–ß–∏—Ç–∞—Ç—å, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ:**

- –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ç–µ–º—É –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
- –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–µ–º—É
- –ü–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º

---

### üìù [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é](logging.md)

–°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è):

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –º–æ–¥—É–ª—è `logging`
- –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (DEBUG, INFO, WARNING, ERROR, CRITICAL)
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–≥–µ—Ä–æ–≤ –≤ –º–æ–¥—É–ª—è—Ö

**–ß–∏—Ç–∞—Ç—å, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ:**

- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å
- –î–µ–±–∞–∂–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –≤ production
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

---

### üçé [–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å macOS](macos_compatibility.md)

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ macOS:

- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Java —á–µ—Ä–µ–∑ Homebrew
- –ü—É—Ç–∏ –∫ JRE –Ω–∞ macOS
- –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å `JAVA_HOME`
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ macOS

**–ß–∏—Ç–∞—Ç—å, –µ—Å–ª–∏:**

- –†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—à—å –Ω–∞ macOS
- –ù—É–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å macOS –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –í–æ–∑–Ω–∏–∫–∞—é—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ Java

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### –î–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤

[doc/plantuml_guides/](../plantuml_guides/) ‚Äî –∫—Ä–∞—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ PlantUML —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∏–∞–≥—Ä–∞–º–º.

### –ò–¥–µ–∏ –∏ –ø–ª–∞–Ω—ã

[doc/ideas/](../ideas/) ‚Äî –∞—Ä—Ö–∏–≤ –∏–¥–µ–π, –∞–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π, –æ—Ç—á–µ—Ç—ã –ø–æ —Ñ–∞–∑–∞–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

### –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

[README.md](../../README.md) ‚Äî –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

---

## üìå –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é?

1. –°–æ–∑–¥–∞–π—Ç–µ Markdown —Ñ–∞–π–ª –≤ —ç—Ç–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (`doc/developers/`)
2. –î–æ–±–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –∏ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤ —ç—Ç–æ—Ç `README.md`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:
   - –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å —ç–º–æ–¥–∑–∏
   - –ö—Ä–∞—Ç–∫–æ–µ –≤–≤–µ–¥–µ–Ω–∏–µ (—á—Ç–æ –∏ –∑–∞—á–µ–º)
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
   - –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞/–∫–æ–º–∞–Ω–¥ –≥–¥–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ
   - –°—Å—ã–ª–∫–∏ –Ω–∞ —Å–≤—è–∑–∞–Ω–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–≤–µ—á–∞–µ—Ç —ç—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** "–ö–∞–∫ PlantUML —Ä–µ–Ω–¥–µ—Ä–∏—Ç –¥–∏–∞–≥—Ä–∞–º–º—ã —á–µ—Ä–µ–∑ Java?"
- **–¢–µ–º—ã:** "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å —Ç–µ–º—É —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–º —Ñ–æ–Ω–æ–º?"
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** "–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å DEBUG –ª–æ–≥–∏ –≤ –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å?"
- **macOS:** "–ü–æ—á–µ–º—É –Ω–∞ Mac –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è PlantUML JAR?"

---

**–í–æ–ø—Ä–æ—Å—ã –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏?** –û—Ç–∫—Ä–æ–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç —á–µ—Ä–µ–∑ Pull Request.

```

## `doc/developers/themes_dev_guide.md`

```md
# üé® –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø–æ —Ç–µ–º–∞–º PlantUML

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º?

–ö–æ–≥–¥–∞ –ø–æ—Å—Ç—É–ø–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–∏–∞–≥—Ä–∞–º–º—ã —Å —Ç–µ–º–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `theme="dark_gold"`):

1. **Python-—Å–∫—Ä–∏–ø—Ç –Ω–∞—Ö–æ–¥–∏—Ç —Ñ–∞–π–ª** `asset/themes/dark_gold.puml`
2. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –¥–∏—Ä–µ–∫—Ç–∏–≤—É** `!include asset/themes/dark_gold.puml` –≤ —Å–∞–º–æ–µ –Ω–∞—á–∞–ª–æ –∫–æ–¥–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã
3. **PlantUML –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ç–∏–ª–∏** –∏–∑ —Ç–µ–º—ã, –∞ –ø–æ—Ç–æ–º —Ä–µ–Ω–¥–µ—Ä–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–¥
4. **–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è DPI-–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `scale_factor` –¥–ª—è 4K/–ø–µ—á–∞—Ç–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ü–µ–ø–æ—á–∫–∞

```
User Request (theme="dark_gold")
    ‚Üì
diagram_renderer.py: _prepare_diagram_code()
    ‚Üì
–í—Å—Ç–∞–≤–∫–∞: !include asset/themes/dark_gold.puml
    ‚Üì
PlantUML JAR –ø—Ä–æ—Ü–µ—Å—Å (Java)
    ‚Üì
PNG/SVG —Å –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–º–∏ —Å—Ç–∏–ª—è–º–∏
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã (–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç)

–ù–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ **—Ç—Ä—ë—Ö—Å–ª–æ–π–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ** (Clean Architecture / Hexagonal). –ö–∞–∂–¥–∞—è —Ç–µ–º–∞ **–û–ë–Ø–ó–ê–ù–ê** —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —Å—Ç–∏–ª–∏ –¥–ª—è —Ç—Ä—ë—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤:

| –°—Ç–µ—Ä–µ–æ—Ç–∏–ø | –†–æ–ª—å –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ | –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ |
|-----------|-------------------|---------------------|
| `<<Adapter>>` | –í—Ö–æ–¥–Ω—ã–µ/–≤—ã—Ö–æ–¥–Ω—ã–µ —Ç–æ—á–∫–∏ (–ü–æ—Ä—Ç—ã) | REST API, Django Views, GraphQL, CLI |
| `<<Core>>` | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–Ø–¥—Ä–æ) | Services, Use Cases, Domain Models |
| `<<Infrastructure>>` | –í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | PostgreSQL, Redis, S3, Payment Gateway |

### –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?

–ï—Å–ª–∏ —Ç–µ–º–∞ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç–∏–ª–∏ –¥–ª—è —ç—Ç–∏—Ö —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤, –¥–∏–∞–≥—Ä–∞–º–º—ã –±—É–¥—É—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å **–æ–¥–∏–Ω–∞–∫–æ–≤–æ —Å–µ—Ä—ã–º–∏**, –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–ª–æ–º–∞–µ—Ç—Å—è.

---

## –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ç–µ–º—É?

### –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª —Ç–µ–º—ã

–°–æ–∑–¥–∞–π—Ç–µ `.puml` —Ñ–∞–π–ª –≤ `asset/themes/` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `blueprint.puml`).

### –®–∞–≥ 2: –†–µ–∞–ª–∏–∑—É–π—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç

–í–æ—Ç **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω** –Ω–æ–≤–æ–π —Ç–µ–º—ã:

```plantuml
' ====================================
' –¢–µ–º–∞: Blueprint (–ß–µ—Ä—Ç—ë–∂–Ω—ã–π —Å—Ç–∏–ª—å)
' –ê–≤—Ç–æ—Ä: Your Name
' –û–ø–∏—Å–∞–Ω–∏–µ: –ò–º–∏—Ç–∞—Ü–∏—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ —á–µ—Ä—Ç–µ–∂–∞ –Ω–∞ —Å–∏–Ω–µ–π –±—É–º–∞–≥–µ
' ====================================

' --- –û–°–ù–û–í–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò ---
skinparam defaultFontName "JetBrains Mono"
skinparam defaultFontSize 14
skinparam backgroundColor #001F3F

' --- –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –°–¢–ï–†–ï–û–¢–ò–ü–´ (Clean Architecture) ---

' –ê–¥–∞–ø—Ç–µ—Ä—ã (–í—Ö–æ–¥–Ω—ã–µ —Ç–æ—á–∫–∏: API, UI)
skinparam class<<Adapter>> {
    BackgroundColor #FFFFFF
    BorderColor #39CCCC
    BorderThickness 2
    FontColor #001F3F
}

skinparam component<<Adapter>> {
    BackgroundColor #FFFFFF
    BorderColor #39CCCC
    BorderThickness 2
    FontColor #001F3F
}

' –Ø–¥—Ä–æ (–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
skinparam class<<Core>> {
    BackgroundColor #FFDC00
    BorderColor #FF851B
    BorderThickness 3
    FontColor #001F3F
}

skinparam component<<Core>> {
    BackgroundColor #FFDC00
    BorderColor #FF851B
    BorderThickness 3
    FontColor #001F3F
}

' –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –≤–Ω–µ—à–Ω–∏–µ API)
skinparam class<<Infrastructure>> {
    BackgroundColor #7FDBFF
    BorderColor #0074D9
    BorderThickness 2
    FontColor #001F3F
}

skinparam component<<Infrastructure>> {
    BackgroundColor #7FDBFF
    BorderColor #0074D9
    BorderThickness 2
    FontColor #001F3F
}

' --- –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ---

' –°—Ç—Ä–µ–ª–∫–∏ –∏ —Å–≤—è–∑–∏
skinparam ArrowColor #39CCCC
skinparam ArrowThickness 2

' –ó–∞–º–µ—Ç–∫–∏
skinparam note {
    BackgroundColor #DDDDDD
    BorderColor #39CCCC
    FontColor #001F3F
}

' –£—á–∞—Å—Ç–Ω–∏–∫–∏ sequence –¥–∏–∞–≥—Ä–∞–º–º
skinparam participant {
    BackgroundColor #FFFFFF
    BorderColor #39CCCC
}

' Activity –¥–∏–∞–≥—Ä–∞–º–º—ã
skinparam activity {
    BackgroundColor #FFFFFF
    BorderColor #39CCCC
    StartColor #FFDC00
    EndColor #FF4136
}
```

### –®–∞–≥ 3: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ç–µ–º—É

–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –¥–∏–∞–≥—Ä–∞–º–º—É:

```python
from src.diagram_renderer import render_diagram_from_string

test_code = """
@startuml
component "REST API" <<Adapter>>
component "Order Service" <<Core>>
component "PostgreSQL" <<Infrastructure>>

"REST API" --> "Order Service"
"Order Service" --> "PostgreSQL"
@enduml
"""

render_diagram_from_string(
    diagram_code=test_code,
    output_path="test_blueprint.png",
    theme_name="blueprint",  # <-- –í–∞—à–∞ –Ω–æ–≤–∞—è —Ç–µ–º–∞
    scale_factor=2.0
)
```

### –®–∞–≥ 4: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

**–ù–∏—á–µ–≥–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –¥–µ–ª–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ!** –¢–µ–º–∞ –ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

```python
from src.guide_manager import list_themes

themes = list_themes()
# [{"name": "blueprint", "description": "..."}, ...]
```

–°–∏—Å—Ç–µ–º–∞ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –ø–∞–ø–∫—É `asset/themes/` –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ.

---

## –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤

```plantuml
skinparam class<<Core>> {
    BackgroundColor #FFDC00-#FF851B  ' –ì—Ä–∞–¥–∏–µ–Ω—Ç –æ—Ç –∂—ë–ª—Ç–æ–≥–æ –∫ –æ—Ä–∞–Ω–∂–µ–≤–æ–º—É
}
```

### 2. –¢–µ–Ω–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã

```plantuml
skinparam shadowing true
skinparam classShadowing true
```

### 3. –ö–∞—Å—Ç–æ–º–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —à—Ä–∏—Ñ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ –∏–ª–∏ –ª–µ–∂–∏—Ç –≤ `asset/fonts/`:

```plantuml
skinparam defaultFontName "Fira Code"
skinparam classFontName "JetBrains Mono"
```

### 4. –£—Å–ª–æ–≤–Ω–∞—è —Ä–∞—Å–∫—Ä–∞—Å–∫–∞ (PlantUML 1.2023+)

```plantuml
' –†–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–≤—è–∑–µ–π
skinparam ArrowColor<<sync>> #FF4136
skinparam ArrowColor<<async>> #2ECC40
```

---

## –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å—Ç–∏–ª–µ–π

### Dark Gold (–°—Ç—Ä–æ–≥–∞—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è)

```
Background: #1E1E1E (—Ç—ë–º–Ω–æ-—Å–µ—Ä—ã–π)
Adapter:    #2D2D2D + #4EC9B0 (–º—è—Ç–Ω–∞—è –æ–±–≤–æ–¥–∫–∞)
Core:       #3C3C3C + #D4AF37 (–∑–æ–ª–æ—Ç–∞—è –æ–±–≤–æ–¥–∫–∞)
Infrastructure: #2D2D2D + #569CD6 (—Å–∏–Ω—è—è –æ–±–≤–æ–¥–∫–∞)
```

### Light Fresh (–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

```
Background: #F8F9FA (—Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π)
Adapter:    #E8F5E9 + #4CAF50 (–∑–µ–ª—ë–Ω—ã–π)
Core:       #FFF9C4 + #FBC02D (–∂—ë–ª—Ç—ã–π)
Infrastructure: #E3F2FD + #42A5F5 (–≥–æ–ª—É–±–æ–π)
```

### Blueprint (–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —á–µ—Ä—Ç—ë–∂)

```
Background: #001F3F (—Ç—ë–º–Ω–æ-—Å–∏–Ω–∏–π)
Adapter:    #FFFFFF + #39CCCC (–±–µ–ª—ã–π —Å —Ü–∏–∞–Ω–æ–≤–æ–π –æ–±–≤–æ–¥–∫–æ–π)
Core:       #FFDC00 + #FF851B (–∂—ë–ª—Ç—ã–π —Å –æ—Ä–∞–Ω–∂–µ–≤–æ–π –æ–±–≤–æ–¥–∫–æ–π)
Infrastructure: #7FDBFF + #0074D9 (–≥–æ–ª—É–±–æ–π)
```

---

## –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –Ω–æ–≤–æ–π —Ç–µ–º—ã

- [ ] –§–∞–π–ª —Å–æ–∑–¥–∞–Ω –≤ `asset/themes/[–Ω–∞–∑–≤–∞–Ω–∏–µ].puml`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã `<<Adapter>>`, `<<Core>>`, `<<Infrastructure>>`
- [ ] –°—Ç–∏–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è `class` –∏ `component` –¥–∏–∞–≥—Ä–∞–º–º
- [ ] –¢–µ–º–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ —Å 3 —Å–ª–æ—è–º–∏
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞
- [ ] –¶–≤–µ—Ç–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã –∏ —á–∏—Ç–∞–µ–º—ã (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –ø—Ä–æ–µ–∫—Ç–æ—Ä–µ –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π)

---

## –û—Ç–ª–∞–¥–∫–∞ –∏ —Ç—Ä–∞–±–ª—à—É—Ç–∏–Ω–≥

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–µ–º–∞ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω—ã:**

1. –û–ø–µ—á–∞—Ç–∫–∞ –≤ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ (—Å–∏—Å—Ç–µ–º–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –∫ —Ä–µ–≥–∏—Å—Ç—Ä—É –Ω–∞ Linux)
2. PlantUML –∫–µ—à–∏—Ä—É–µ—Ç —Å—Ç–∏–ª–∏ ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Python –ø—Ä–æ—Ü–µ—Å—Å
3. –î–∏—Ä–µ–∫—Ç–∏–≤–∞ `!include` –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `theme_name` –Ω–µ `None`

**–†–µ—à–µ–Ω–∏–µ:**

```python
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–µ–º–∞ –Ω–∞–π–¥–µ–Ω–∞
from pathlib import Path
theme_path = Path("asset/themes/blueprint.puml")
assert theme_path.exists(), "–§–∞–π–ª —Ç–µ–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω!"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** PlantUML —Ä–∞–∑–ª–∏—á–∞–µ—Ç `class` –∏ `component`. –ù—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç–∏–ª–∏ –¥–ª—è –æ–±–æ–∏—Ö:

```plantuml
' –ù–ï –†–ê–ë–û–¢–ê–ï–¢ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∫–ª–∞—Å—Å–æ–≤)
skinparam class<<Core>> { ... }

' –†–ê–ë–û–¢–ê–ï–¢ (–¥–ª—è –æ–±–æ–∏—Ö —Ç–∏–ø–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º)
skinparam class<<Core>> { ... }
skinparam component<<Core>> { ... }
```

### –ü—Ä–æ–±–ª–µ–º–∞: –®—Ä–∏—Ñ—Ç—ã –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –®—Ä–∏—Ñ—Ç –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ JRE.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —à—Ä–∏—Ñ—Ç—ã –∏–∑ `asset/fonts/` –∏–ª–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã (Arial, Courier New).

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [PlantUML skinparam –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://plantuml.com/ru/skinparam)
- [PlantUML —Ü–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞](https://plantuml.com/ru/color)
- [–ù–∞—à –≥–∞–π–¥ –ø–æ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–∞–º](../plantuml_guides/component_diagram.md)
- [–ü—Ä–∏–º–µ—Ä—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ–º](../../asset/themes/)

---

**–í–æ–ø—Ä–æ—Å—ã?** –û—Ç–∫—Ä–æ–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏–ª–∏ –∏–∑—É—á–∏—Ç–µ –∫–æ–¥ –≤ `src/diagram_renderer.py` (—Ñ—É–Ω–∫—Ü–∏—è `_prepare_diagram_code`).

```

## `doc/ideas/MCP code to image - –∞–Ω–∞–ª–∏–∑ –∏–¥–µ–π.md`

```md
# –ê–Ω–∞–ª–∏–∑ –∞—É–¥–∏–æ-–∏–¥–µ–π: MCP code to image

## –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **–§–∞–π–ª:** MCP code to image.m4a (–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ MP3)
- **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 7 –º–∏–Ω—É—Ç 51 —Å–µ–∫—É–Ω–¥–∞
- **–î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏:** 29 –Ω–æ—è–±—Ä—è 2025 –≥–æ–¥–∞

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –§–∏–ª–æ—Å–æ—Ñ–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- **–ú–∏–Ω–∏–º–∞–ª–∏–∑–º:** –ú–∏–Ω–∏–º—É–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –º–∞–∫—Å–∏–º—É–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, –º–∏–Ω–∏–º—É–º –∫–æ–¥–∞
- **–õ–µ–≥–∫–æ–≤–µ—Å–Ω–æ—Å—Ç—å:** –ü—Ä–æ—Å—Ç–æ–π –∏ –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π MCP —Å–µ—Ä–≤–µ—Ä
- **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å:** –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

### 2. –ö–ª—é—á–µ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞** (–±–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º PlantUML** (–Ω–æ–≤—ã–π –≤–∞–∂–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç)
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** Java –¥–ª—è —Ä–∞–±–æ—Ç—ã PlantUML

### 3. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **–ë–∏–Ω–∞—Ä–Ω–∏–∫–∏ PlantUML:** 12-13 –ú–ë, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç
- **–ê—Å—Å–µ—Ç—ã —Ç–µ–º:** –°–æ–∑–¥–∞–Ω—ã —Ç–µ–º–Ω—ã–µ —Ç–µ–º—ã –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º
- **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥:** –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –Ω–∞ –ø–∞–∫–µ—Ç—ã:
  - –£—Ç–∏–ª–∏—Ç—ã (utilities)
  - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (documents)
  - –°–µ—Ä–≤–µ—Ä (server)

## –ö–ª—é—á–µ–≤—ã–µ –∏–¥–µ–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –°–∏—Å—Ç–µ–º–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- **–î–≤–æ–π–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–∞ –∏ –ª—é–¥—è–º, –∏ AI-–∞–≥–µ–Ω—Ç–∞–º
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** –ß–µ—Ç–∫–∞—è, –ª–∞–∫–æ–Ω–∏—á–Ω–∞—è, –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ:** –û—Ç–¥–µ–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –¥–∏–∞–≥—Ä–∞–º–º–∞–º

### 2. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–∏–∞–≥—Ä–∞–º–º PlantUML
- **–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å –∫–æ–¥–æ–º –¥–∏–∞–≥—Ä–∞–º–º—ã
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
  - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä—É–¥–∞: –¥–æ—Ä–æ–≥–∞—è –º–æ–¥–µ–ª—å –ø–∏—à–µ—Ç, –¥–µ—à–µ–≤–∞—è —Ä–µ–Ω–¥–µ—Ä–∏—Ç
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
  - –õ–µ–≥–∫–∞—è –æ—Ç–ª–∞–¥–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### 3. –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –∏ –æ—à–∏–±–æ–∫
- **–ö—Ä–∞—Ç–∫–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏:** –§–ª–∞–≥–∏ –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
- **–£–º–Ω—ã–µ –æ—à–∏–±–∫–∏:** –ü—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ - –ø–æ–¥—Å–∫–∞–∑–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≥–∞–π–¥–æ–≤
- **–î–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:** –û—Ç–¥–µ–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –≥–∞–π–¥–æ–≤

### 4. –ì–∞–π–¥—ã –ø–æ —Ç–∏–ø–∞–º –¥–∏–∞–≥—Ä–∞–º–º
- **–¢–∏–ø—ã –¥–∏–∞–≥—Ä–∞–º–º:**
  - –î–∏–∞–≥—Ä–∞–º–º—ã –∫–ª–∞—Å—Å–æ–≤
  - –î–∏–∞–≥—Ä–∞–º–º—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  - –î–∏–∞–≥—Ä–∞–º–º—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **–§–æ—Ä–º–∞—Ç:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Å–∂–∞—Ç—ã–µ, –ª–∞–∫–æ–Ω–∏—á–Ω—ã–µ, –Ω–æ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- **–ü—Ä–æ–±–ª–µ–º–∞:** AI-–º–æ–¥–µ–ª–∏ —á–∞—Å—Ç–æ –¥–µ–ª–∞—é—Ç –¥–∏–∞–≥—Ä–∞–º–º—ã –∫—Ä–∏–≤—ã–º–∏

## –î–µ–π—Å—Ç–≤–∏—è –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –í—ã—Å–æ–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏
1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è PlantUML:** –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∏–∞–≥—Ä–∞–º–º
2. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:** –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –ø–∞–∫–µ—Ç—ã —É—Ç–∏–ª–∏—Ç –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
3. **–°–∏—Å—Ç–µ–º–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è –ª—é–¥–µ–π –∏ –∞–≥–µ–Ω—Ç–æ–≤
4. **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≥–∞–π–¥–æ–≤:** –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ø–æ–¥—Å–∫–∞–∑–æ–∫ –ø–æ —Ç–∏–ø–∞–º –¥–∏–∞–≥—Ä–∞–º–º
5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–º–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- **–§–æ—Ä–º–∞—Ç –≤–≤–æ–¥–∞:** –ê–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º –¥–∏–∞–≥—Ä–∞–º–º
- **–¢–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è:** –£–ª—É—á—à–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ–º
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –ò–º–ø–æ—Ä—Ç –≥–æ—Ç–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ —Å–µ—Ä–≤–µ—Ä

## –•—ç—à—Ç–µ–≥–∏ –∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
- #MCP Server
- #Code Screenshot  
- #PlantUML
- #Diagram Generation
- #Java
- #Refactoring
- #Documentation
- #Agent Instructions
- #Code Quality
- #File Paths
- #Error Handling

## –ü–æ–ª–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∞—É–¥–∏–æ

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã –∏–∑ –ø–æ–ª–Ω–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏:

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:**
- –û—Ç–¥–µ–ª—å–Ω–æ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –û—Ç–¥–µ–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—é –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –¥–∏–∞–≥—Ä–∞–º–º
- –ö—Ä–∞—Ç–∫–æ, —Å–∂–∞—Ç–æ, –Ω–æ —ë–º–∫–æ –∏ –æ—á–µ–Ω—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ
- –ì–∞–π–¥—ã –ø–æ –¥–∏–∞–≥—Ä–∞–º–º–∞–º, –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞, –≥–∞–π–¥—ã –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- –í—Å—ë –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –ø–∞–∫–µ—Ç–∞–º

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Å–∫–∞–∑–æ–∫:**
- –û—á–µ–Ω—å –∫—Ä–∞—Ç–∫–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞: "–≤–æ—Ç —ç—Ç–æ—Ç —Ñ–ª–∞–≥ –æ—Ç–¥–∞—ë—Ç —ç—Ç–æ, —ç—Ç–æ—Ç —Ñ–ª–∞–≥ –æ—Ç–¥–∞—ë—Ç —ç—Ç–æ"
- –ü—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π –ø–æ–ø—ã—Ç–∫–µ –∞–≥–µ–Ω—Ç–∞: "–¥—Ä—É–∂–∏—â–µ, –≤–æ—Å–ø–æ–ª—å–∑—É–π—Å—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫"
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ñ–ª–∞–≥–∞–º–∏
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏–∞–≥—Ä–∞–º–º –ø—Ä–∏ –æ—à–∏–±–∫–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≥–∞–π–¥–æ–≤

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**
- –û—Ç–¥–µ–ª—å–Ω–æ –ø–∞–∫–µ—Ç —Å —É—Ç–∏–ª–∏—Ç–∞–º–∏
- –û—Ç–¥–µ–ª—å–Ω–æ –ø–∞–∫–µ—Ç —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ–¥—Å–∫–∞–∑–∫–æ–π –¥–ª—è –∞–≥–µ–Ω—Ç–∞-–∫–ª–∏–µ–Ω—Ç–∞

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è –æ—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞ –∫ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ —Å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏ PlantUML. –ö–ª—é—á–µ–≤–æ–π —Ñ–æ–∫—É—Å - —Å–æ–∑–¥–∞–Ω–∏–µ —É–¥–æ–±–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –ø–æ–¥—Å–∫–∞–∑–æ–∫, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ –ø–æ–ª–µ–∑–Ω–∞ –∫–∞–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º, —Ç–∞–∫ –∏ AI-–∞–≥–µ–Ω—Ç–∞–º, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.

**–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏:**
```
–ò —Ç–∞–∫, —Ç–∞–∫–∞—è –∏–¥–µ—è, –∑–Ω–∞—á–∏—Ç, –≤–æ—Ç —ç—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –º—ã –ø–∏—à–µ–º, –º–æ–¥—É–ª—å –∫–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å –∫–æ–¥ –≤ –∫–∞—Ä—Ç–∏–Ω–∫–µ. –û–Ω —Ç–∞–∫–æ–π –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—ã–ª –ø—Ä–æ—Å—Ç–æ–π –∏ –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π. –ò–¥–µ—è –±—ã–ª–∞ –º–∏–Ω–∏–º—É–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –º–∞–∫—Å–∏–º—É–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏ –º–∏–Ω–∏–º—É–º –∫–æ–¥–∞. –°–µ–π—á–∞—Å —Ç—É–¥–∞ –¥–æ–±–∞–≤–∏–ª—Å—è –µ—â–µ –æ–¥–∏–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫—Ä–∞–π–Ω–µ –≤–∞–∂–Ω—ã–π - —ç—Ç–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä –¥–∏–∞–≥—Ä–∞–º–º PlantUML. –î–ª—è –Ω–µ–≥–æ –Ω—É–∂–µ–Ω Java, –¥–∞, –∫–æ—Ç–æ—Ä—ã–π —è –ø–æ—Å—Ç–∞–≤–∏–ª. –¢—É–¥–∞ —Å–∫–∞—á–∞–ª–∏—Å—å –≤ –ø—Ä–æ–µ–∫—Ç –±–∏–Ω–∞—Ä–Ω–∏–∫–∏ —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞, 12 –º–µ–≥–∞–±–∞–π—Ç –∏–ª–∏ 13. –¢–∞–º –∫–∞–∫–∏—Ö-—Ç–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–∂–∏–º–æ–≤ —Ä–µ–Ω–¥–µ—Ä–∞, –Ω–æ–≤—ã–π, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–º–µ—Ç–∞–Ω–∞, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫—Ä—É—Ç–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å—Ä–∞–∑—É –≤ —ç—Ç–∏ –±–∏–Ω–∞—Ä–Ω–∏–∫–∏. –°—Ä–∞–∑—É –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –∞—Å–µ—Ç—ã, –¥–∞, —Ç–æ –µ—Å—Ç—å —ç—Ç–æ, –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –∞—Å–µ—Ç—ã —Ç–µ–º –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º. –ù—É, –ø–æ —Å—É—Ç–∏, –æ–¥–Ω–∞ —Ç–∞–º —Ç–æ–ª—å–∫–æ —Ç–µ–º–∞ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞, —Ç—ë–º–Ω–∞—è. –í—ã–≥–ª—è–¥–∏—Ç —Å—Ç—Ä—ë–º–Ω–æ, –µ—ë –ø–∏—Å–∞–ª —Ä–æ–±–æ—Ç, –Ω–æ –≤—Å—ë —ç—Ç–æ –ø–æ–ø—Ä–∞–≤–∏–º–æ, –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –≤—Å—ë —ç—Ç–æ —É–ª—É—á—à–∏—Ç—å. –ò –∫–∞–∫–æ–π –º–æ–º–µ–Ω—Ç? –ö–æ–Ω–µ—á–Ω–æ, –ø—Ä–∏—à–ª–æ—Å—å –≤—Å—ë —ç—Ç–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å –≤ –ø–ª–∞–Ω–µ —Ç–æ–≥–æ, —á—Ç–æ —Ä–∞–∑–Ω–æ—Å–∏—Ç—å –≤—Å—é –ª–æ–≥–∏–∫—É –Ω–∞—Ñ–∏–≥, –æ—Ç–¥–µ–ª—å–Ω–æ –¥–µ–ª–∞—Ç—å –ø–∞–∫–µ—Ç —Å —É—Ç–∏–ª–∏—Ç–∞–º–∏, –æ—Ç–¥–µ–ª—å–Ω–æ –¥–µ–ª–∞—Ç—å –ø–∞–∫–µ—Ç —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç–∞–º –º–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ–¥—Å–∫–∞–∑–∫–æ–π –¥–ª—è –∞–≥–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç —É–∂–µ —ç—Ç—É —à—Ç—É–∫—É. –ò —è –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç —É—Å–ª–æ–∂–Ω—è–µ—Ç—Å—è, –∏, –Ω–∞–≤–µ—Ä–Ω–æ–µ, –∫–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Å–¥–µ–ª–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, –¥–∞, —Ç–æ –µ—Å—Ç—å —ç—Ç–æ –∏—Å—Ç–æ—Ä–∏—è –æ —Ç–æ–º, —á—Ç–æ —ç—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ –¥–æ–ª–∂–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∏ —á–µ–ª–æ–≤–µ–∫–∏, –∏–∑—É—á–∞—é—â–∏–µ –ø—Ä–æ–µ–∫—Ç, –∏ –∞–≥–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ç–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –¢–∞–∫–∂–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏ –ø–æ –∫–∞—á–µ—Å—Ç–≤—É –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Å–∂–∞—Ç–∞—è –ª–∞–∫–æ–Ω–∏—á–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞, —á—Ç–æ –∏ –∫–∞–∫ –ø–∏—à–µ—Ç—Å—è, –¥–æ–ø—É—Å—Ç–∏–º, –≤ –¥–∏–∞–≥—Ä–∞–º–º–µ –∫–ª–∞—Å—Å–æ–≤, –≤ –¥–∏–∞–≥—Ä–∞–º–º–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –≤ –¥–∏–∞–≥—Ä–∞–º–º–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –æ–Ω–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ª–æ–∂–∞—é—Ç –∏ –¥–µ–ª–∞—é—Ç –∏—Ö –∫—Ä–∏–≤—ã–º–∏. –¢–æ –µ—Å—Ç—å, –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –¥–µ—Ç–∞–ª—å–Ω—ã–π, —Å–∂–∞—Ç—ã–π –≥–∞–π–¥ –ø–æ –∫–∞–∂–¥–æ–º—É —Ç–∏–ø—É –¥–∏–∞–≥—Ä–∞–º–º—ã, –æ—Ç–¥–µ–ª—å–Ω–æ, –æ—Ç–¥–µ–ª—å–Ω–æ –ø–æ –∫–∞–∂–¥–æ–º—É —Ç–∏–ø—É –¥–∏–∞–≥—Ä–∞–º–º—ã, –ø–æ—Ç–æ–º —Å —Ñ–ª–∞–≥–æ–º –¥–∞ –∏ –≤—Å—ë, –≥–¥–µ –≤–æ–æ–±—â–µ –≤—Å—ë –æ—Ç–¥–∞—Å—Ç—Å—è. –ù—É –∏ –µ—â—ë –∫–∞–∫–∏–µ-—Ç–æ –≥–∞–π–¥—ã, –¥–∞, –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ. –£ —ç—Ç–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –±—É–¥–µ—Ç –æ—á–µ–Ω—å –∫—Ä–æ—Ç–∫–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞, –¥–∞, —Ç–∏–ø–∞ –≤–æ—Ç —ç—Ç–æ—Ç —Ñ–ª–∞–≥ –æ—Ç–¥–∞—ë—Ç —ç—Ç–æ, —ç—Ç–æ—Ç —Ñ–ª–∞–≥ –æ—Ç–¥–∞—ë—Ç —ç—Ç–æ. –ï—Å–ª–∏ –∞–≥–µ–Ω—Ç –≤—Å—ë-—Ç–∞–∫–∏ –ø—ã—Ç–∞–µ—Ç—Å—è —á—Ç–æ-—Ç–æ –Ω–∞–ø–∏—Å–∞—Ç—å, —É –Ω–µ–≥–æ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –µ–º—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è "–¥—Ä—É–∂–∏—â–µ, –≤–æ—Å–ø–æ–ª—å–∑—É–π—Å—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫", –¥–∞, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ñ–ª–∞–≥–∞–º–∏. –ü–æ–ª—É—á–∞–µ—Ç—Å—è, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å —á—ë—Ç–∫—É—é, –ª–∞–∫–æ–Ω–∏—á–Ω—É—é, –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –≥–¥–µ –±—É–¥–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ, –∫—Ä–∞—Ç–∫–∞—è, –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –≥–¥–µ –±—É–¥–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—é –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã, –∫—Ä–∞—Ç–∫–æ, —Å–∂–∞—Ç–æ, –Ω–æ —ë–º–∫–æ –∏ –æ—á–µ–Ω—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–æ, –≥–¥–µ –±—É–¥–µ—Ç, –¥–∞, –≥–∞–π–¥—ã, –ø–æ –¥–∏–∞–≥—Ä–∞–º–º–∞–º, –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞, –≥–∞–π–¥—ã –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –í –æ–±—â–µ–º, –≤—Å—ë —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –ø–∞–∫–µ—Ç–∞–º. –î–∞–≤–∞–π, –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –≥–∞–π–¥—ã, –¥–∞, –ø–æ –¥–∏–∞–≥—Ä–∞–º–º–∞–º, –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞, –≥–∞–π–¥—ã –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –í –æ–±—â–µ–º, –≤—Å—ë —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –ø–∞–∫–µ—Ç–∞–º.
```

```

## `doc/ideas/MCP to image p2 - –∞–Ω–∞–ª–∏–∑ –∏–¥–µ–π.md`

```md
# –ê–Ω–∞–ª–∏–∑ –∞—É–¥–∏–æ-–∏–¥–µ–π: MCP to image p2

## –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **–§–∞–π–ª:** MCP to image p2.m4a (–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ MP3)
- **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 3 –º–∏–Ω—É—Ç—ã 49 —Å–µ–∫—É–Ω–¥
- **–î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏:** 29 –Ω–æ—è–±—Ä—è 2025 –≥–æ–¥–∞
- **–°—Ç–∞—Ç—É—Å:** –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –∏–¥–µ–π –ø–æ –ø—Ä–æ–µ–∫—Ç—É MCP —Å–µ—Ä–≤–µ—Ä–∞

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –≤—Ç–æ—Ä–æ–π —á–∞—Å—Ç–∏

### 1. –õ–æ–≥–∏–∫–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –°–µ—Ä–≤–µ—Ä—ã –≤—ã–¥–∞—é—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∏–∑–∫–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –î–ª—è Full HD –∏ –æ—Å–æ–±–µ–Ω–Ω–æ 4K (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è YouTube –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π) - —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—É—á–∞—é—Ç—Å—è –º—É—Ç–Ω—ã–º–∏, –º—ã–ª—å–Ω—ã–º–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—ã—Å–æ–∫–∏—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (2K, 4K)

### 2. –§–æ—Ä–º–∞—Ç—ã —Å–∂–∞—Ç–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞ —Å PNG:**
- PNG –ø—Ä–µ–∫—Ä–∞—Å–µ–Ω, –Ω–æ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ø–æ 2-3 –ú–ë - –Ω–µ–ø—Ä–∏–µ–º–ª–µ–º–æ
- –î–ª—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π 2K/4K —Ä–∞–∑–º–µ—Ä—ã –±—É–¥—É—Ç –µ—â–µ –±–æ–ª—å—à–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WebP —Å –ø—Ä–∏–µ–º–ª–µ–º—ã–º —Å–∂–∞—Ç–∏–µ–º
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É —Å–∂–∞—Ç–∏—è –¥–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞
- –í—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

**–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å–∂–∞—Ç–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
- –†–∞–∑–º–µ—Å—Ç–∏—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –º–æ–¥—É–ª–µ/–ø–∞–∫–µ—Ç–µ —É—Ç–∏–ª–∏—Ç
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç—è—Ö –ø—Ä–æ–µ–∫—Ç–∞

### 4. –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º PlantUML

**–ò–¥–µ—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Ä–∞–±–æ—Ç–∫–∏
- –ù–∞–π—Ç–∏ –ø—Ä–æ–µ–∫—Ç—ã —Å –ª–µ–∫—Ü–∏—è–º–∏ –ø–æ PlantUML –¥–ª—è –¥–µ—Ç–µ–π
- –í–∑—è—Ç—å –Ω–∞ –≤–æ–æ—Ä—É–∂–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—É—é —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—é
- –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å—Ç–∏–ª–µ–π:
  - –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç–µ–π —Å—Ç—Ä–µ–ª–æ–∫
  - –°—Ç–∏–ª–µ–≤–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–ª—è –∫—É—Å–æ—á–∫–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º
  - –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–ª–∞—Å—Å–æ–≤
  - "–ú–∞—Ç—ë—Ä—ã–π CSS" –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è

**–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:**
- –°–¥–µ–ª–∞—Ç—å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é –∞–≥–µ–Ω—Ç–∞
- –ù–∞–π—Ç–∏ –≤—Å–µ "–Ω–∏—à—Ç—è–∫–∏" –∏–∑ —Å—Ç–∞—Ä—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
- –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å–Ω—ã–µ –∞—Å—Å–µ—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ

### 5. –¢–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –¥–∏–∞–≥—Ä–∞–º–º

**–¢—Ä–µ–±—É–µ–º—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–º:**
- –¢—ë–º–Ω–∞—è —Ç–µ–º–∞
- –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞  
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–æ–≤—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:
  - –ó–µ–ª–µ–Ω–æ–≤–∞—Ç–∞—è
  - –§–∏–æ–ª–µ—Ç–æ–≤–∞—è
- –í—Å–µ–≥–æ: 3-4 –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ç–µ–º –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –î–∏–∞–≥—Ä–∞–º–º—ã –±—É–¥—É—Ç –æ—á–µ–Ω—å –∫—Ä–∞—Å–∏–≤—ã–º–∏
- –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ —Å—Ç–∏–ª–µ–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ü–µ–ª–µ–π

### 6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —à—Ä–∏—Ñ—Ç–æ–≤

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∞—Å—Å–µ—Ç—ã —à—Ä–∏—Ñ—Ç–æ–≤
- –®—Ä–∏—Ñ—Ç—ã —É–∂–µ –ª–µ–∂–∞—Ç –≤ –∞—Å—Å–µ—Ç–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞
- –ó–∞–º–µ–Ω–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ "–≥—É–∞–Ω–æ" —à—Ä–∏—Ñ—Ç—ã –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ
- –û–ø—Ü–∏—è —É–∫–∞–∑–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —à—Ä–∏—Ñ—Ç–æ–≤ –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏

1. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—ã—Å–æ–∫–∏—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (2K, 4K)
   - –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π

2. **–°–∂–∞—Ç–∏–µ:**
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è WebP —Ñ–æ—Ä–º–∞—Ç–∞
   - –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞
   - –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

3. **–°—Ç–∏–ª–∏–∑–∞—Ü–∏—è:**
   - –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ —Å PlantUML
   - –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∞—Å—Å–µ—Ç–æ–≤ —Ç–µ–º
   - –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ 3-4 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ç–µ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è

4. **–®—Ä–∏—Ñ—Ç—ã:**
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —à—Ä–∏—Ñ—Ç–æ–≤ –∏–∑ –∞—Å—Å–µ—Ç–æ–≤
   - –û–ø—Ü–∏—è –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —à—Ä–∏—Ñ—Ç–æ–≤
   - –£–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –¥–∏–∞–≥—Ä–∞–º–º

## –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏

```
–ß–∞—Å—Ç—å –≤—Ç–æ—Ä–∞—è, –∏–¥–µ–∏ –ø–æ —Å–µ—Ä–≤–µ—Ä—É Model Context Protocol –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ –∫–æ–¥–∞. –ó–Ω–∞—á–∏—Ç, —è –∑–∞–±—ã–ª –≤ –ø–µ—Ä–≤–æ–π —á–∞—Å—Ç–∏ —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ª–æ–≥–∏–∫—É, –≤–æ-–ø–µ—Ä–≤—ã—Ö, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç–æ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä—ã –≤—ã–¥–∞—é—Ç —Å–µ–π—á–∞—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –æ–Ω–æ —è–≤–ª—è–µ—Ç—Å—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∏–∑–∫–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è. –ö–æ–Ω–µ—á–Ω–æ –∂–µ, –¥–ª—è –º–µ–Ω—è, –¥–∞–∂–µ –¥–ª—è —ç–∫—Ä–∞–Ω–∞ Full HD, –∞ —É–∂ —è –º–æ–ª—á—É –ø—Ä–æ 4K, —è, –¥–æ–ø—É—Å—Ç–∏–º, —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é –≤–∏–¥–µ–æ 4K –Ω–∞ YouTube —á–∞—Å—Ç–µ–Ω—å–∫–æ –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏. –≠—Ç–æ –æ—á–µ–Ω—å –º–∞–ª–æ, –æ–Ω–∏ –±—É–¥—É—Ç –æ—á–µ–Ω—å –º—É—Ç–Ω—ã–µ, –º—ã–ª—å–Ω—ã–µ. –ù—É–∂–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ª–æ–≥–∏–∫–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è. –ê –µ—â—ë –Ω–µ–ø–ª–æ—Ö–æ –±—ã–ª–æ –±—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–¥–∞–≤–∞—Ç—å –≤ –∫–∞–∫–æ–º-—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ —Å –ø—Ä–∏–µ–º–ª–µ–º—ã–º —Å–∂–∞—Ç–∏–µ–º, –Ω—É, —Ç–∏–ø–∞ WebP. –ü—Ä–∏—á—ë–º, –ø–æ-–º–æ–µ–º—É, —É –Ω–∞—Å –µ—Å—Ç—å —ç—Ç–∞ –ª–æ–≥–∏–∫–∞, –µ—Å–ª–∏ —è –Ω–µ –æ—à–∏–±–∞—é—Å—å, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ —Å–¥–µ–ª–∞–Ω–∞ –∫–∞–∫ —Ä–∞–∑-—Ç–∞–∫–∏ –¥–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞, —Ö–æ—Ç—è —è –º–æ–≥—É –æ—à–∏–±–∞—Ç—å—Å—è, –Ω—É–∂–Ω–æ —ç—Ç–æ –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∏—Ç—å. –ò –≤–æ—Ç, –µ—Å–ª–∏ —ç—Ç–æ –µ—Å—Ç—å, —ç—Ç–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫—É–¥–∞-—Ç–æ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å, —è –∏–º–µ—é –≤ –≤–∏–¥—É, –¥–∞, –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å, –≤ –ø–∞–∫–µ—Ç, –∫—É–¥–∞-—Ç–æ –≤ —É—Ç–∏–ª—Å, —Ç–∞–º, –≥–¥–µ –∂–∏–≤—ë—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç—è—Ö –ø—Ä–æ–µ–∫—Ç–∞. –ï—Å–ª–∏ —ç—Ç–æ –µ—Å—Ç—å. –ï—Å–ª–∏ —ç—Ç–æ–≥–æ –Ω–µ—Ç, –Ω–æ —ç—Ç–æ –Ω–µ–ø–ª–æ—Ö–æ –±—ã–ª–æ –±—ã –Ω–∞–ø–∏—Å–∞—Ç—å, –ø–æ—Ç–æ–º—É —á—Ç–æ PNG, –æ–Ω, –∫–æ–Ω–µ—á–Ω–æ, –ø—Ä–µ–∫—Ä–∞—Å–µ–Ω, –Ω–æ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ø–æ –¥–≤–∞-—Ç—Ä–∏ –º–µ–≥–∞–±–∞–π—Ç–∞, –Ω—É, —ç—Ç–æ –∫–∞–∫–∞—è-—Ç–æ —Ñ–∏–≥–Ω—è. –õ–∞–¥–Ω–æ, –µ—Å–ª–∏ –±—ã –Ω–µ 16k –±—ã–ª–∏ –±—ã, –¥–∞, –Ω–æ, –±–ª–∏–Ω, –æ–Ω–∏ –æ—á–µ–Ω—å –Ω–∏–∑–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞. –ï—Å–ª–∏ –¥–µ–ª–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞, 4K, –¥–æ–ø—É—Å—Ç–∏–º, 2K, –æ–Ω–∏ –±—É–¥—É—Ç –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ–≥–∞–±–∞–π—Ç, –∞ —ç—Ç–æ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –Ω–µ–ø—Ä–∏–µ–º–ª–µ–º–æ. –ê —Ç–∞–∫–∂–µ –µ—â—ë –º–Ω–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑—ã—Å–∫–∞—Ç—å –º–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã, –≥–¥–µ —è –¥–µ—Ç—è–º —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–ª –ø—Ä–æ PlantUML. –¢–∞–º –æ—á–µ–Ω—å –Ω–µ–ø–ª–æ—Ö–∞—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—É—á–∏–ª–∞—Å—å, –∏ –≤–∑—è—Ç—å –∏—Ö –Ω–∞ –≤–æ–æ—Ä—É–∂–µ–Ω–∏–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç–∞–º –µ—Å—Ç—å —Ç–∞–∫–∏–µ –≤–µ—â–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥–µ–ª–∏ –Ω–µ —É–º–µ—é—Ç –ø–∏—Å–∞—Ç—å. –¢–æ –µ—Å—Ç—å —è –ø—Ä—è–º–æ —ç—Ç–æ –∏–∑—É—á–∞–ª, –∏—Å–∫–∞–ª. –¢–∞–º –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∫ —Ä–∞–∑–Ω—ã–º —á–∞—Å—Ç–µ–π —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–µ–ª–æ–∫, –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–∞–∫–∞—è-—Ç–æ —Å—Ç–∏–ª–µ–≤–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–ª—è –∫–∞–∫–∏—Ö-—Ç–æ –∫—É—Å–æ—á–∫–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º, –∫–ª–∞—Å—Å–æ–≤. –¢–æ –µ—Å—Ç—å —Ç–∞–º —Ç–∞–∫–æ–π –º–∞—Ç—ë—Ä—ã–π CSS, –ø–æ—Ö–æ–∂–µ. –î–∞, —è —Ö–æ—á—É —Å–¥–µ–ª–∞—Ç—å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ, —Å–µ–π—á–∞—Å –∑–∞–ø—É—Å—Ç–∏—Ç—å, —á—Ç–æ–±—ã –º–Ω–µ –∞–≥–µ–Ω—Ç –Ω–∞—à—ë–ª –≤—Å–µ —ç—Ç–∏ –Ω–∏—à—Ç—è–∫–∏, –Ω–æ —è –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ –≤–µ—Ä–æ—è—Ç–Ω–æ, –æ–Ω –Ω–µ –Ω–∞–π–¥—ë—Ç –≤—Å–µ. –ò —ç—Ç–æ –±—ã–ª–æ –±—ã –Ω–µ–ø–ª–æ—Ö–æ –≤–∑—è—Ç—å —ç—Ç–æ –µ—â—ë –æ—Ç—Ç—É–¥–∞ –∏ –Ω–∞–ø–∏—Å–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∫–ª–∞—Å—Å–Ω—ã–µ –∞—Å—Å–µ—Ç—ã. –ü–∞—Ä–æ—á–∫—É —Ç–µ–º, –¥–≤–∞-—Ç—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ. –¢—ë–º–Ω–∞—è, —Å–≤–µ—Ç–ª–∞—è –∏ –µ—â—ë –∫–∞–∫–∞—è-–Ω–∏–±—É–¥—å, –Ω–µ –∑–Ω–∞—é, –∑–µ–ª–µ–Ω–æ–≤–∞—Ç–∞—è –∏ —Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è, –∫ –ø—Ä–∏–º–µ—Ä—É. –¢—Ä–∏-—á–µ—Ç—ã—Ä–µ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ç–µ–º –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º. –≠—Ç–æ –±—ã–ª–æ –±—ã –≤–æ–æ–±—â–µ –≤–æ–ª—à–µ–±–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –¥–∏–∞–≥—Ä–∞–º–º—ã –±—É–¥—É—Ç –æ—á–µ–Ω—å –∫—Ä–∞—Å–∏–≤—ã–µ —Ç–æ–≥–¥–∞. –ê —è –Ω–µ –∑–Ω–∞—é, –º–æ–∂–Ω–æ –ª–∏ —Ç–∞–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞—à–∏ –∞—Å—Å–µ—Ç—ã —à—Ä–∏—Ñ—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞ Python. –î–∞, –Ω–æ –±—ã–ª–æ –±—ã —Ç–æ–∂–µ –ø—Ä–∏–∫–æ–ª—å–Ω–æ, –µ—Å–ª–∏ –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã —É–∫–∞–∑–∞—Ç—å –∫–∞–∫–∏–µ-—Ç–æ —Å–≤–æ–∏ —Ö–æ—Ä–æ—à–∏–µ —à—Ä–∏—Ñ—Ç—ã, –∞ –Ω–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –≥—É–∞–Ω–æ, –∫–æ—Ç–æ—Ä–æ–µ —Ç–∞–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ–π—á–∞—Å. –¢–µ–º –±–æ–ª–µ–µ, —á—Ç–æ —É –Ω–∞—Å —à—Ä–∏—Ñ—Ç—ã –≤ –∞—Å—Å–µ—Ç–∞—Ö —É–∂–µ –ª–µ–∂–∞—Ç. –î–∞, –µ—Å–ª–∏ –µ—Å—Ç—å —Ç–∞–∫–∞—è –æ–ø—Ü–∏—è, –±—ã–ª–æ –±—ã –∑–¥–æ—Ä–æ–≤–æ.
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å –∏–¥–µ–π —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —É–ª—É—á—à–µ–Ω–∏—è—Ö –∫–∞—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è. –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Å–∂–∞—Ç–∏—è
- –°–æ–∑–¥–∞–Ω–∏–µ –∫—Ä–∞—Å–∏–≤—ã—Ö —Ç–µ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –Ω–∞—Ä–∞–±–æ—Ç–æ–∫
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤ –∏–∑ –∞—Å—Å–µ—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞
- –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

```

## `doc/ideas/phases/phase_0_completion.md`

```md
# –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –§–∞–∑—ã 0

## 1. ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å macOS

**–î–∞, —Ä–µ—à–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å macOS!**

### –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Java —á–µ—Ä–µ–∑ `which java` (Unix –∫–æ–º–∞–Ω–¥–∞)
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ `java -XshowSettings:properties` (–∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø—É—Ç–µ–π JRE –¥–ª—è –≤—Å–µ—Ö –û–°
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `lib/fonts` –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Java –¥–ª—è macOS: `brew install openjdk`

### –ü—É—Ç–∏ –∫ Java –Ω–∞ macOS

```
/Library/Java/JavaVirtualMachines/jdk-XX.jdk/Contents/Home
/opt/homebrew/opt/openjdk  (Apple Silicon)
/usr/local/opt/openjdk     (Intel Mac)
```

### –í–æ–∑–º–æ–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã –Ω–∞ macOS

- **System Integrity Protection (SIP)**: –°–∏—Å—Ç–µ–º–Ω–∞—è Java –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω–∞
- **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Homebrew Java (`brew install openjdk`)
- **–ü—Ä–∞–≤–∞**: –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è sudo –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–π Java, –Ω–æ Homebrew Java –æ–±—ã—á–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ –∑–∞–ø–∏—Å—å

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ macOS

–í—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

```bash
pytest tests/test_font_initializer.py -v
pytest tests/test_font_integration.py -v
pytest tests/test_font_diagnostic.py -v
```

**–î–µ—Ç–∞–ª–∏:** –°–º. `doc/macos_compatibility.md`

---

## 2. ‚úÖ –ü—Ä–∞–≤–∏–ª–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ!** –í—Å–µ —Ç–µ—Å—Ç—ã —Ç–µ–ø–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç `docstring_guide.instructions.md`:

### –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ docstring –¥–ª—è —Ç–µ—Å—Ç–æ–≤

```python
def test_ensure_fonts_initialized_success(self):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —à—Ä–∏—Ñ—Ç–æ–≤."""
    # –¢–µ–ª–æ —Ç–µ—Å—Ç–∞...
```

### –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

- ‚úÖ –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –≥–ª–∞–≥–æ–ª–∞
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫
- ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –ù–ï–¢ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤ (–æ–Ω–∏ –≤ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ)

### –§–∞–π–ª—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π

- `tests/test_font_initializer.py` - –≤—Å–µ 4 —Ç–µ—Å—Ç–∞
- `tests/test_font_diagnostic.py` - –≤—Å–µ 5 —Ç–µ—Å—Ç–æ–≤  
- `tests/test_font_integration.py` - –≤—Å–µ 7 —Ç–µ—Å—Ç–æ–≤

---

## 3. ‚úÖ –ü—Ä–∞–≤–∏–ª–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ!** –í—Å–µ –ª–æ–≥–∏ —Ç–µ–ø–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç `doc/logging.md`:

### –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ `diagram_renderer.py`

```python
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑, –∑–∞—Ç–µ–º –∫–µ—à–∏—Ä—É–µ—Ç—Å—è)
logger.debug("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤")
font_init_result = ensure_fonts_initialized()

if not font_init_result["success"]:
    logger.error(f"‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —à—Ä–∏—Ñ—Ç–æ–≤: {font_init_result['error']}")
    raise JavaNotFoundError(font_init_result["error"])

if font_init_result["already_installed"]:
    logger.debug(f"‚úÖ –®—Ä–∏—Ñ—Ç—ã —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: {len(font_init_result['fonts'])} —Ñ–∞–π–ª–æ–≤")
else:
    logger.info(
        f"üíâ –®—Ä–∏—Ñ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ JRE: {len(font_init_result['fonts'])} —Ñ–∞–π–ª–æ–≤ "
        f"({font_init_result['java_home']})"
    )
```

### –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

| –≠–º–æ–¥–∑–∏ | –£—Ä–æ–≤–µ–Ω—å | –°–æ–±—ã—Ç–∏–µ | –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
|--------|---------|---------|------------------|
| üîç | DEBUG | –ü–æ–∏—Å–∫/–ø—Ä–æ–≤–µ—Ä–∫–∞ | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —à—Ä–∏—Ñ—Ç–æ–≤ |
| ‚úÖ | INFO | –£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ | –®—Ä–∏—Ñ—Ç—ã —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã |
| üíâ | INFO | –ò–Ω—ä–µ–∫—Ü–∏—è —Ä–µ—Å—É—Ä—Å–∞ | –®—Ä–∏—Ñ—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ JRE |
| ‚ùå | ERROR | –û—à–∏–±–∫–∞ | –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ |
| üîß | INFO | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | –ù–∞—á–∞–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ —à—Ä–∏—Ñ—Ç–æ–≤ |
| üìÅ | DEBUG | –†–∞–±–æ—Ç–∞ —Å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–µ–π | –ù–∞–π–¥–µ–Ω–∞ –ø–∞–ø–∫–∞ fonts –≤ JRE |
| ‚òï | INFO | Java –æ–∫—Ä—É–∂–µ–Ω–∏–µ | –ù–∞–π–¥–µ–Ω–∞ Java —É—Å—Ç–∞–Ω–æ–≤–∫–∞ |

### –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

–ó–∞–ø—É—Å—Ç–∏—Ç–µ `python tests/demo_logging.py` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –ª–æ–≥–æ–≤ –≤ –¥–µ–π—Å—Ç–≤–∏–∏:

```
21:33:35 | INFO     | diagram_renderer | üìê –ù–∞—á–∞–ª–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ PlantUML –¥–∏–∞–≥—Ä–∞–º–º—ã
21:33:35 | DEBUG    | diagram_renderer | üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤
21:33:35 | INFO     | font_initializer | üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —à—Ä–∏—Ñ—Ç–æ–≤...
21:33:35 | DEBUG    | font_initializer | ‚úÖ –ù–∞–π–¥–µ–Ω –º–∞—Ä–∫–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —à—Ä–∏—Ñ—Ç–æ–≤
21:33:35 | INFO     | font_initializer | ‚úÖ –®—Ä–∏—Ñ—Ç—ã —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ JRE
21:33:35 | DEBUG    | diagram_renderer | ‚úÖ –®—Ä–∏—Ñ—Ç—ã —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: 3 —Ñ–∞–π–ª–æ–≤
```

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –§–∞–∑—ã 0

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. ‚úÖ `font_initializer.py` (337 —Å—Ç—Ä–æ–∫) - —É–º–Ω—ã–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä —à—Ä–∏—Ñ—Ç–æ–≤
2. ‚úÖ `tests/test_font_initializer.py` (92 —Å—Ç—Ä–æ–∫–∏) - 4 —Ç–µ—Å—Ç–∞
3. ‚úÖ `tests/test_font_diagnostic.py` (121 —Å—Ç—Ä–æ–∫–∞) - 5 –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
4. ‚úÖ `tests/test_font_integration.py` (138 —Å—Ç—Ä–æ–∫) - 7 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
5. ‚úÖ `tests/demo_logging.py` (51 —Å—Ç—Ä–æ–∫–∞) - –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
6. ‚úÖ `doc/macos_compatibility.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å macOS
7. ‚úÖ `.gitignore` - –¥–æ–±–∞–≤–ª–µ–Ω `.fonts_installed.json`

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. ‚úÖ `diagram_renderer.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è font_initializer + —É–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
2. ‚úÖ `font_manager.py` - —É–∂–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è PlantUML (—Ç–æ–ª—å–∫–æ –¥–ª—è code screenshots)

### –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

```bash
pytest tests/ -v
# 16 —Ç–µ—Å—Ç–æ–≤: ‚úÖ 16 passed
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ—à–µ–Ω–∏—è

1. üöÄ **–û–¥–Ω–æ–∫—Ä–∞—Ç–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞** - —à—Ä–∏—Ñ—Ç—ã –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
2. üíæ **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –º–∞—Ä–∫–µ—Ä-—Ñ–∞–π–ª `.fonts_installed.json`
3. ‚ö° **–ë—ã—Å—Ç—Ä—ã–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏** - 0.02s –≤–º–µ—Å—Ç–æ —Å–µ–∫—É–Ω–¥
4. üåç **–ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å** - Windows + macOS + Linux
5. üìù **–ü–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏** - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ Java
6. üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
7. üìä **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - —ç–º–æ–¥–∑–∏ + —É—Ä–æ–≤–Ω–∏

---

## üéØ –ß—Ç–æ –¥–∞–ª—å—à–µ?

–§–∞–∑–∞ 0 –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –ø–ª–∞–Ω—É:

1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1**: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (DPI, WebP)
2. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2**: –°–æ–∑–¥–∞–Ω–∏–µ 4 —Ç–µ–º PlantUML (dark, light, green, purple)
3. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3**: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≥–∞–π–¥–æ–≤ PlantUML –¥–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤

**–ì–æ—Ç–æ–≤—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å? üöÄ**

```

## `doc/ideas/phases/phase_1_completion_report.md`

```md
# Phase 1: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ - –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 30 –Ω–æ—è–±—Ä—è 2024  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–û**  
**–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ**: 63/63 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ (100%)

---

## üìä –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞

**–¶–µ–ª—å —Ñ–∞–∑—ã**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –æ—Ç –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏, —É–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ –≤—ã—Å–æ–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é —Ñ–æ—Ä–º–∞—Ç–æ–≤.

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

| –ú–µ—Ç—Ä–∏–∫–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---------|-----------|
| **–ù–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π** | 1 (image_utils.py, 279 —Å—Ç—Ä–æ–∫) |
| **–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π** | 3 (diagram_renderer, code_to_image, server) |
| **–ù–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤** | 33 (25 –¥–ª—è image_utils, 8 –¥–ª—è diagram_renderer) |
| **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤** | 63 (100% —É—Å–ø–µ—à–Ω–æ) |
| **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤** | WebP, PNG, JPEG (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ) |
| **–£—Ä–æ–≤–Ω–∏ –∫–∞—á–µ—Å—Ç–≤–∞** | Low (1.0x, 96 DPI) / High (3.0x, 288 DPI) |
| **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production** | ‚úÖ **100%** |

---

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (Steps 1-6)

### ‚úÖ Step 1: –°–æ–∑–¥–∞–Ω–∏–µ image_utils.py (263 —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:

```python
save_image(image, output_path, format, quality) -> dict
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å —Ñ–æ—Ä–º–∞—Ç–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
    # WebP: quality=85, method=6
    # PNG: optimize=True, compress_level=6
    # JPEG: quality=90

resize_image(image, scale_factor) -> Image
    # –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Lanczos —Ñ–∏–ª—å—Ç—Ä–æ–º
    # scale_factor: 0.5 = –ø–æ–ª–æ–≤–∏–Ω–∞, 2.0 = —É–¥–≤–æ–µ–Ω–∏–µ

convert_to_webp(image, quality=90) -> bytes
    # –ö–æ–Ω–≤–µ—Ä—Å–∏—è –≤ WebP —Å —Å–∂–∞—Ç–∏–µ–º

load_image_from_bytes(bytes, source_format) -> Image
    # –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –±–∞–π—Ç–æ–≤
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è RGBA‚ÜíRGB –¥–ª—è JPEG
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è PNG (compress_level=6)
- ‚úÖ WebP —Å–∂–∞—Ç–∏–µ —Å method=6 (–ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ/—Ä–∞–∑–º–µ—Ä)
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: WebP 85%, PNG 95%, JPEG 90%
- ‚úÖ Google-style docstrings + emoji-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–¢–µ—Å—Ç—ã**: 25 —Ç–µ—Å—Ç–æ–≤

- ‚úÖ 6 —Ç–µ—Å—Ç–æ–≤ save_image (WebP/PNG/JPEG, –∫–∞—á–µ—Å—Ç–≤–æ, RGBA‚ÜíRGB)
- ‚úÖ 5 —Ç–µ—Å—Ç–æ–≤ resize_image (0.5x, 2.0x, –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏, —Ä–µ–∂–∏–º—ã)
- ‚úÖ 3 —Ç–µ—Å—Ç–∞ convert_to_webp (RGB, RGBA, –∫–∞—á–µ—Å—Ç–≤–æ)
- ‚úÖ 5 —Ç–µ—Å—Ç–æ–≤ load_image_from_bytes (PNG/JPEG/WebP, –æ—à–∏–±–∫–∏)
- ‚úÖ 3 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞
- ‚úÖ 3 —Ç–µ—Å—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

---

### ‚úÖ Step 2: –ú–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏—è diagram_renderer.py

**–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è**:

```python
render_diagram_to_image(diagram_code, format, theme_name, scale_factor) -> Image
    # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç PIL Image –≤–º–µ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª
    # scale_factor ‚Üí PlantUML -Sdpi=X –ø–∞—Ä–∞–º–µ—Ç—Ä
    # –¢–æ–ª—å–∫–æ –¥–ª—è PNG (SVG/EPS/PDF –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è PIL)
```

**–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è**:

- ‚úÖ `scale_factor` –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ DPI: `dpi = int(96 * scale_factor)`
- ‚úÖ PlantUML –ø–∞—Ä–∞–º–µ—Ç—Ä: `-Sdpi=288` –¥–ª—è 3x (–Ω–µ `-scale`, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Ä–∞–±–æ—Ç–∞–ª!)
- ‚úÖ `render_diagram_from_string()` - legacy –æ–±—ë—Ä—Ç–∫–∞:
  - PNG: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `render_diagram_to_image()` + `image_utils`
  - SVG/EPS/PDF: –ø—Ä—è–º–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–∞–π—Ç–æ–≤ (–æ–±—Ö–æ–¥ PIL)

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:

```
1x (96 DPI):   274√ó159 px,  6.8 KB  ‚Üê Low detail
3x (288 DPI):  824√ó479 px, 29.6 KB  ‚Üê High detail (–¥–ª—è 4K/print)
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ**:

```bash
# ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢:
java -jar plantuml.jar -scale 3.0 -pipe

# ‚úÖ –†–ê–ë–û–¢–ê–ï–¢:
java -jar plantuml.jar -Sdpi=288 -pipe
```

**–¢–µ—Å—Ç—ã**: +8 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

- ‚úÖ 6 —Ç–µ—Å—Ç–æ–≤ `render_diagram_to_image()` (PIL Image, 1x/3x, WebP, –∫–∏—Ä–∏–ª–ª–∏—Ü–∞)
- ‚úÖ 2 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞ `scale_factor` (legacy —Ñ—É–Ω–∫—Ü–∏—è, —Ä–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤)

---

### ‚úÖ Step 3: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ code_to_image.py

**–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è**:

```python
create_code_image(code_string, language, scale_factor, **options) -> Image
    # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç PIL Image
    # scale_factor –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ font_size, pad, line_pad
```

**Legacy —Ñ—É–Ω–∫—Ü–∏—è**:

```python
create_code_screenshot(code_string, language, output_file, **options) -> None
    # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç create_code_image() + image_utils.save_image()
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:

```
TypeScript 3x WebP:  2152√ó770 px, 59.5 KB  ‚Üê High detail
SQL 2x PNG:          1110√ó844 px, 47.9 KB  ‚Üê Medium detail
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ PNG –ø—Ä–∏ `transparent=True` –∏ `format=JPEG`
- ‚úÖ `scale_factor` –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç `font_size`, `pad`, `line_pad` **–ø–µ—Ä–µ–¥** –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
- ‚úÖ Pygments –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ PNG ‚Üí –∫–æ–Ω–≤–µ—Ä—Å–∏—è —á–µ—Ä–µ–∑ `image_utils`

---

### ‚úÖ Step 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ MCP tools (server.py)

**–ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –≤—Å–µ—Ö 3 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤**:

```python
detail_level: str = "High"  # "Low" (1.0x) / "High" (3.0x)
image_format: str = "webp"  # "webp" / "png" / "jpeg"
```

**–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**:

1. **generate_code_screenshot()**
   - –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∫–æ–¥–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏
   - `detail_level` ‚Üí `scale_factor` –∫–æ–Ω–≤–µ—Ä—Å–∏—è

2. **generate_file_screenshot()**
   - –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∫–æ–¥–∞ –∏–∑ —Ñ–∞–π–ª–∞ (–º–∞–∫—Å. 200 —Å—Ç—Ä–æ–∫)
   - –ê–≤—Ç–æ-–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é

3. **generate_architecture_diagram()**
   - PlantUML –¥–∏–∞–≥—Ä–∞–º–º—ã
   - `scale_factor` —Ç–æ–ª—å–∫–æ –¥–ª—è PNG —Ñ–æ—Ä–º–∞—Ç–∞

**–õ–æ–≥–∏–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏**:

```python
scale_factor = 3.0 if detail_level.lower() == "high" else 1.0
```

**Breaking changes**:

- ‚ö†Ô∏è `scale_factor` ‚Üí `detail_level` (–±–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω–æ–µ –∏–º—è)
- ‚ö†Ô∏è `format` ‚Üí `image_format` (–∏–∑–±–µ–≥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)

---

### ‚úÖ Step 5: –¢–µ—Å—Ç—ã –¥–ª—è image_utils.py

**–°–æ–∑–¥–∞–Ω–æ**: `tests/test_image_utils.py` (325 —Å—Ç—Ä–æ–∫)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤**:

- **TestSaveImage**: 6 —Ç–µ—Å—Ç–æ–≤ (WebP/PNG/JPEG, –∫–∞—á–µ—Å—Ç–≤–æ, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, RGBA‚ÜíRGB)
- **TestResizeImage**: 5 —Ç–µ—Å—Ç–æ–≤ (0.5x, 2.0x, –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏, —Ä–µ–∂–∏–º—ã, same_size)
- **TestConvertToWebP**: 3 —Ç–µ—Å—Ç–∞ (RGB, RGBA, –∫–∞—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–ª–æ–∂–Ω–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏)
- **TestLoadImageFromBytes**: 5 —Ç–µ—Å—Ç–æ–≤ (PNG/JPEG/WebP, invalid, empty)
- **TestIntegration**: 3 —Ç–µ—Å—Ç–∞ (save‚Üíresize‚Üíload, —Ñ–æ—Ä–º–∞—Ç—ã, bytes‚Üífile)
- **TestErrorHandling**: 3 —Ç–µ—Å—Ç–∞ (invalid format, zero/negative scale)

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ 25/25 passed (100%)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞ –∫–∞—á–µ—Å—Ç–≤–∞**:

```python
# –°–æ–∑–¥–∞—ë–º —Å–ª–æ–∂–Ω–æ–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 500√ó500
# –ù–∞ –ø—Ä–æ—Å—Ç–æ–º –∫—Ä–∞—Å–Ω–æ–º 100√ó100 WebP quality=50 > quality=95 (–ø–∞—Ä–∞–¥–æ–∫—Å —Å–∂–∞—Ç–∏—è!)
complex_img = Image.new("RGB", (500, 500))
for i in range(500):
    for j in range(500):
        pixels[i, j] = (i % 256, j % 256, (i + j) % 256)
```

---

### ‚úÖ Step 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

**–û–±–Ω–æ–≤–ª–µ–Ω–æ**: `tests/test_diagram_renderer.py`

**–î–æ–±–∞–≤–ª–µ–Ω–æ 2 –Ω–æ–≤—ã—Ö –∫–ª–∞—Å—Å–∞ —Ç–µ—Å—Ç–æ–≤**:

#### TestRenderToImage (6 —Ç–µ—Å—Ç–æ–≤)

```python
test_render_to_image_returns_pil_image()      # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç PIL Image
test_render_to_image_scale_factor_1x()        # 96 DPI –±–∞–∑–æ–≤—ã–π
test_render_to_image_scale_factor_3x()        # 288 DPI –¥–ª—è 4K
test_render_to_image_with_webp_conversion()   # PIL ‚Üí WebP —á–µ—Ä–µ–∑ image_utils
test_render_to_image_without_theme()          # –ë–µ–∑ —Ç–µ–º—ã
test_render_to_image_cyrillic()               # –ö–∏—Ä–∏–ª–ª–∏—Ü–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

#### TestScaleFactorIntegration (2 —Ç–µ—Å—Ç–∞)

```python
test_legacy_function_with_scale_factor()      # render_diagram_from_string() + scale
test_scale_factor_1x_vs_3x_file_sizes()       # 3x —Ç—è–∂–µ–ª–µ–µ 1x
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –±–∞–≥–∞**:

```python
# –ü—Ä–æ–±–ª–µ–º–∞: SVG/EPS/PDF –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ PIL Image.open()
# PIL.UnidentifiedImageError: cannot identify image file

# –†–µ—à–µ–Ω–∏–µ: render_diagram_from_string() —Ä–∞–∑–¥–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
if format == "png":
    image = render_diagram_to_image(...)
    save_image(image, output_path, format="png")
else:
    # SVG/EPS/PDF: –ø—Ä—è–º–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–∞–π—Ç–æ–≤ PlantUML
    with open(output_path, "wb") as f:
        f.write(plantuml_stdout_bytes)
```

**–§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ 22/22 diagram_renderer —Ç–µ—Å—Ç–æ–≤, 63/63 –≤—Å–µ–≥–æ

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ diagram_renderer.py ‚îÇ‚îÄ‚îÄ‚Üí PlantUML ‚îÄ‚îÄ‚Üí [File I/O]
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ code_to_image.py‚îÇ‚îÄ‚îÄ‚Üí Pygments ‚îÄ‚îÄ‚Üí [File I/O]
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ diagram_renderer.py ‚îÇ‚îÄ‚îÄ‚Üí PlantUML ‚îÄ‚îÄ‚Üí PIL Image ‚îÄ‚îÄ‚îê
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                             ‚îÇ
                                                     ‚îú‚îÄ‚îÄ‚Üí image_utils.save_image()
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                 ‚îÇ         ‚Üì
‚îÇ code_to_image.py‚îÇ‚îÄ‚îÄ‚Üí Pygments ‚îÄ‚îÄ‚Üí PIL Image ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    [–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ —Ñ–æ—Ä–º–∞—Ç—É]
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                            ‚Üì
                                                          [WebP/PNG/JPEG]
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (SRP)**
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ‚â† –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
   - –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –¥–µ–ª–∞–µ—Ç –æ–¥–Ω–æ –¥–µ–ª–æ

2. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞**
   - `image_utils` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å–µ–º–∏ –º–æ–¥—É–ª—è–º–∏
   - –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤

3. **–ì–∏–±–∫–æ—Å—Ç—å**
   - –ú–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å PIL Image –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
   - –ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ª—é–±–æ–π —Ñ–æ—Ä–º–∞—Ç —Å –ª—é–±—ã–º –∫–∞—á–µ—Å—Ç–≤–æ–º

4. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**
   - –§—É–Ω–∫—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–±—ä–µ–∫—Ç—ã (PIL Image)
   - –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

---

## üìà –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤

| –§–æ—Ä–º–∞—Ç | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã | –¢–∏–ø–∏—á–Ω—ã–π —Ä–∞–∑–º–µ—Ä (100√ó100) | –ö–∞—á–µ—Å—Ç–≤–æ |
|--------|-----------|---------------------------|----------|
| **WebP** | quality=85, method=6 | **–°–∞–º—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π** (40-50% –º–µ–Ω—å—à–µ PNG) | –û—Ç–ª–∏—á–Ω–æ–µ |
| **PNG** | optimize=True, compress_level=6 | –°—Ä–µ–¥–Ω–∏–π | –ë–µ–∑ –ø–æ—Ç–µ—Ä—å |
| **JPEG** | quality=90 | –ö—Ä—É–ø–Ω—ã–π | –•–æ—Ä–æ—à–µ–µ (–Ω–µ—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏) |

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ PlantUML

| scale_factor | DPI | –ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------------|-----|------------------|------------|
| **1.0** | 96 | 274√ó159 | Web, –¥–æ–∫—É–º–µ–Ω—Ç—ã |
| **2.0** | 192 | ~548√ó318 | Retina –¥–∏—Å–ø–ª–µ–∏ |
| **3.0** | 288 | 824√ó479 | 4K –º–æ–Ω–∏—Ç–æ—Ä—ã, print |

### –ö–æ–º–∞–Ω–¥—ã PlantUML

```bash
# ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢ (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ -pipe —Ä–µ–∂–∏–º–µ):
-scale 3.0

# ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ (skinparam dpi):
-Sdpi=288

# ‚úÖ –ü–û–õ–ù–ê–Ø –ö–û–ú–ê–ù–î–ê:
java -Dfile.encoding=UTF-8 \
     -Dplantuml.smetana=true \
     -Dplantuml.graphviz.use=false \
     -DPLANTUML_LIMIT_SIZE=16384 \
     -jar plantuml.jar \
     -pipe \
     -tpng \
     -charset UTF-8 \
     -Sdpi=288
```

---

## üß™ –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

### –°–≤–æ–¥–∫–∞ –ø–æ –º–æ–¥—É–ª—è–º

| –ú–æ–¥—É–ª—å | –§–∞–π–ª —Ç–µ—Å—Ç–æ–≤ | –ö–æ–ª-–≤–æ —Ç–µ—Å—Ç–æ–≤ | –°—Ç–∞—Ç—É—Å |
|--------|-------------|---------------|--------|
| **image_utils.py** | test_image_utils.py | 25 | ‚úÖ 100% |
| **diagram_renderer.py** | test_diagram_renderer.py | 22 | ‚úÖ 100% |
| **font_initializer.py** | test_font_initializer.py | 4 | ‚úÖ 100% |
| **font_manager.py** | test_font_integration.py | 7 | ‚úÖ 100% |
| **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** | test_font_diagnostic.py | 5 | ‚úÖ 100% |
| **–ò–¢–û–ì–û** | ‚Äî | **63** | ‚úÖ **100%** |

### –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è image_utils —Ç–µ—Å—Ç–æ–≤

```
TestSaveImage:
  ‚úÖ test_save_image_webp
  ‚úÖ test_save_image_png
  ‚úÖ test_save_image_jpeg
  ‚úÖ test_save_image_custom_quality
  ‚úÖ test_save_image_creates_directory
  ‚úÖ test_save_image_rgba_to_jpeg

TestResizeImage:
  ‚úÖ test_resize_image_downscale (0.5x)
  ‚úÖ test_resize_image_upscale (2.0x)
  ‚úÖ test_resize_image_aspect_ratio
  ‚úÖ test_resize_image_same_size (scale=1.0)
  ‚úÖ test_resize_image_preserve_mode (RGBA)

TestConvertToWebP:
  ‚úÖ test_convert_to_webp_rgb
  ‚úÖ test_convert_to_webp_rgba
  ‚úÖ test_convert_to_webp_custom_quality

TestLoadImageFromBytes:
  ‚úÖ test_load_image_from_bytes_png
  ‚úÖ test_load_image_from_bytes_jpeg
  ‚úÖ test_load_image_from_bytes_webp
  ‚úÖ test_load_image_from_bytes_invalid
  ‚úÖ test_load_image_from_bytes_empty

TestIntegration:
  ‚úÖ test_save_resize_load_cycle
  ‚úÖ test_convert_multiple_formats
  ‚úÖ test_bytes_to_file_workflow

TestErrorHandling:
  ‚úÖ test_save_image_invalid_format
  ‚úÖ test_resize_image_zero_width
  ‚úÖ test_resize_image_negative_width
```

---

## üîç –û—Ç–∫—Ä—ã—Ç–∏—è –∏ —É—Ä–æ–∫–∏

### 1. PlantUML -scale –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ CLI

```bash
# –û–∂–∏–¥–∞–Ω–∏–µ:
java -jar plantuml.jar -pipe -scale 3.0

# –†–µ–∞–ª—å–Ω–æ—Å—Ç—å: –ø–∞—Ä–∞–º–µ—Ç—Ä –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è!
# –†–µ—à–µ–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å -Sdpi
java -jar plantuml.jar -pipe -Sdpi=288
```

### 2. WebP –¥–∞—ë—Ç –ª—É—á—à–µ–µ —Å–∂–∞—Ç–∏–µ –Ω–∞ —Å–ª–æ–∂–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö

```
–ü—Ä–æ—Å—Ç–æ–µ 100√ó100 –∫—Ä–∞—Å–Ω–æ–µ:
  quality=50: 118 bytes
  quality=95: 108 bytes  ‚Üê –ü–∞—Ä–∞–¥–æ–∫—Å!

–°–ª–æ–∂–Ω–æ–µ 500√ó500 –≥—Ä–∞–¥–∏–µ–Ω—Ç:
  quality=50: ~8 KB
  quality=95: ~15 KB  ‚Üê –û–∂–∏–¥–∞–µ–º–æ
```

### 3. Pillow –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç PNG –∏–∑ Pygments

```python
# Pygments ImageFormatter –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ PNG
formatter = ImageFormatter(image_format="PNG")

# –ö–æ–Ω–≤–µ—Ä—Å–∏—é –¥–µ–ª–∞–µ–º –ø–æ—Å–ª–µ:
img.save(output_file, format="WEBP", quality=85)
```

### 4. SVG –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å PIL Image

```python
# ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢:
svg_bytes = plantuml_generate_svg(...)
image = Image.open(BytesIO(svg_bytes))  # UnidentifiedImageError!

# ‚úÖ –†–ï–®–ï–ù–ò–ï:
if format == "png":
    image = Image.open(BytesIO(png_bytes))
else:
    # –ü—Ä—è–º–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–∞–π—Ç–æ–≤ –¥–ª—è SVG/EPS/PDF
    with open(path, "wb") as f:
        f.write(svg_bytes)
```

---

## üì¶ –§–∞–π–ª—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### –ù–æ–≤—ã–µ/–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
code_to_image_mcp/
‚îú‚îÄ‚îÄ image_utils.py                    ‚Üê –ù–û–í–´–ô (279 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ diagram_renderer.py               ‚Üê –û–ë–ù–û–í–õ–Å–ù (432 —Å—Ç—Ä–æ–∫–∏)
‚îú‚îÄ‚îÄ code_to_image.py                  ‚Üê –û–ë–ù–û–í–õ–Å–ù (282 —Å—Ç—Ä–æ–∫–∏)
‚îú‚îÄ‚îÄ server.py                         ‚Üê –û–ë–ù–û–í–õ–Å–ù (382 —Å—Ç—Ä–æ–∫–∏)
‚îÇ
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ test_image_utils.py           ‚Üê –ù–û–í–´–ô (325 —Å—Ç—Ä–æ–∫, 25 —Ç–µ—Å—Ç–æ–≤)
‚îÇ   ‚îî‚îÄ‚îÄ test_diagram_renderer.py      ‚Üê –û–ë–ù–û–í–õ–Å–ù (+8 —Ç–µ—Å—Ç–æ–≤)
‚îÇ
‚îî‚îÄ‚îÄ doc/
    ‚îî‚îÄ‚îÄ phase_1_completion_report.md  ‚Üê –≠–¢–û–¢ –î–û–ö–£–ú–ï–ù–¢
```

### –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏

```
diagram_renderer.py.backup    (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è, 345 —Å—Ç—Ä–æ–∫)
code_to_image.py.backup       (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è, 187 —Å—Ç—Ä–æ–∫)
server.py.backup              (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è, 382 —Å—Ç—Ä–æ–∫–∏)
```

---

## üéØ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### Legacy —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

‚úÖ **render_diagram_from_string()** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

```python
# –°—Ç–∞—Ä—ã–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:
result = render_diagram_from_string(
    diagram_code=code,
    output_path="output.png",
    format="png",
)
```

‚úÖ **create_code_screenshot()** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

```python
# –°—Ç–∞—Ä—ã–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:
create_code_screenshot(
    code_string=code,
    language="python",
    output_file="screenshot.webp",
)
```

### Breaking changes –¥–ª—è MCP –∫–ª–∏–µ–Ω—Ç–æ–≤

‚ö†Ô∏è **–ò–∑–º–µ–Ω–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã MCP tools**:

```python
# –ë–´–õ–û:
scale_factor: int = 3
format: str = "WEBP"

# –°–¢–ê–õ–û:
detail_level: str = "High"  # "Low" / "High"
image_format: str = "webp"  # "webp" / "png" / "jpeg"
```

**–ü—Ä–∏—á–∏–Ω–∞**: –ë–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ –¥–ª—è –∫–æ–Ω–µ—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –°—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ |
|-----------|------------|
| –ù–æ–≤—ã–π –∫–æ–¥ | ~800 —Å—Ç—Ä–æ–∫ (image_utils + —Ç–µ—Å—Ç—ã) |
| –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–π –∫–æ–¥ | ~600 —Å—Ç—Ä–æ–∫ (diagram/code/server —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥) |
| –£–¥–∞–ª—ë–Ω–Ω—ã–π –∫–æ–¥ | ~150 —Å—Ç—Ä–æ–∫ (–¥—É–±–ª–∏–∫–∞—Ç—ã –ª–æ–≥–∏–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è) |
| **–ò—Ç–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π** | **~1350 —Å—Ç—Ä–æ–∫** |

### –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ Phase 1 | –ü–æ—Å–ª–µ Phase 1 |
|---------|------------|---------------|
| –í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤ | 38 | **63** (+25) |
| –ú–æ–¥—É–ª–µ–π —Å —Ç–µ—Å—Ç–∞–º–∏ | 3 | **4** (+1) |
| –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö | 100% | **100%** |

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ production

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω—ã
- ‚úÖ –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `render_diagram_to_image()` —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ MCP tools –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ WebP/PNG/JPEG
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ 1x-5x —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

- ‚úÖ Google-style docstrings –≤–µ–∑–¥–µ
- ‚úÖ Emoji-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É `doc/logging.md`
- ‚úÖ Type hints –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- ‚úÖ 63/63 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏ (100%)
- ‚úÖ Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- ‚úÖ Error handling —Ç–µ—Å—Ç—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- ‚úÖ Docstrings –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ –≠—Ç–æ—Ç –æ—Ç—á—ë—Ç —Å–æ–∑–¥–∞–Ω
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ç–µ—Å—Ç–∞—Ö

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ WebP —Å–∂–∞—Ç–∏–µ –¥–∞—ë—Ç 40-50% —ç–∫–æ–Ω–æ–º–∏—é
- ‚úÖ PlantUML -Sdpi –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ä–∞–∑—É –Ω—É–∂–Ω—ã–π —Ä–∞–∑–º–µ—Ä
- ‚úÖ –ù–µ—Ç –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–æ–∫

---

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production: 100% ‚úÖ

**Phase 1 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production!**

### –ß—Ç–æ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å

1. ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã (3x –¥–ª—è 4K)
2. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ WebP —Å 40-50% —ç–∫–æ–Ω–æ–º–∏–µ–π –º–µ—Å—Ç–∞
3. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PIL Image –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
4. ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–∞—á–µ—Å—Ç–≤–∞
5. ‚úÖ –†–∞–±–æ—Ç–∞—Ç—å —Å SVG/EPS/PDF –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –≥—Ä–∞—Ñ–∏–∫–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —Ñ–∞–∑

**Phase 2** (–±—É–¥—É—â–µ–µ):

- –î–æ–±–∞–≤–∏—Ç—å –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏
- Batch processing –¥–∏–∞–≥—Ä–∞–º–º
- –ê–≤—Ç–æ-–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
- –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ WebP –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π

**Phase 3** (–±—É–¥—É—â–µ–µ):

- GPU-—É—Å–∫–æ—Ä–µ–Ω–∏–µ –¥–ª—è resize_image()
- AVIF —Ñ–æ—Ä–º–∞—Ç (—Å–ª–µ–¥—É—é—â–µ–µ –ø–æ–∫–æ–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ WebP)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ HDR –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

---

## üìù –§–∏–Ω–∞–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ

- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: —á–∏—Å—Ç–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: 100% –ø–æ–∫—Ä—ã—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: PlantUML -Sdpi –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ä–∞–∑—É –Ω—É–∂–Ω—ã–π —Ä–∞–∑–º–µ—Ä
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: WebP –¥–∞—ë—Ç –æ—Ç–ª–∏—á–Ω–æ–µ —Å–∂–∞—Ç–∏–µ

### –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- ‚ö†Ô∏è `render_diagram_to_image()` —Ç–æ–ª—å–∫–æ –¥–ª—è PNG (SVG/EPS/PDF –Ω–µ PIL Image)
- ‚ö†Ô∏è `scale_factor` > 5.0 –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ–≥—Ä–æ–º–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚ö†Ô∏è WebP –∫–∞—á–µ—Å—Ç–≤–æ –Ω–∞ –ø—Ä–æ—Å—Ç—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ (–ø–∞—Ä–∞–¥–æ–∫—Å —Å–∂–∞—Ç–∏—è)

### Breaking changes

- ‚ö†Ô∏è MCP tools: `scale_factor` ‚Üí `detail_level`, `format` ‚Üí `image_format`
- ‚ÑπÔ∏è Legacy —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

---

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**: Phase 1 –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –Ω–∞ 100%. –í—Å–µ —Ü–µ–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã, —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç, –∫–æ–¥ –≥–æ—Ç–æ–≤ –∫ production. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å—Ç–∞–ª–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —á–∏—â–µ –∏ –≥–∏–±—á–µ, –∞ –∫–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —É–ª—É—á—à–∏–ª–æ—Å—å –±–ª–∞–≥–æ–¥–∞—Ä—è –≤—ã—Å–æ–∫–æ–º—É DPI –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤.

**–ê–≤—Ç–æ—Ä**: GitHub Copilot (Claude Sonnet 4.5)  
**–î–∞—Ç–∞**: 30 –Ω–æ—è–±—Ä—è 2024  
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞**: code_to_image_mcp v1.1.0 (–ø–æ—Å–ª–µ Phase 1)

```

## `doc/ideas/phases/phase_2_themes_report.md`

```md
# Phase 2: –°–∏—Å—Ç–µ–º–∞ —Ç–µ–º PlantUML - –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 30 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–û**  
**–°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤**: 3 (2 —Ç–µ–º—ã + –¥–µ–º–æ-—Å–∫—Ä–∏–ø—Ç)  
**–î–µ–º–æ-–¥–∏–∞–≥—Ä–∞–º–º**: 8 (4 —Ç–∏–ø–∞ √ó 2 —Ç–µ–º—ã)

---

## üìä –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞

**–¶–µ–ª—å —Ñ–∞–∑—ã**: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Ç–µ–º PlantUML —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Å–ª–æ—ë–≤.

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

| –ú–µ—Ç—Ä–∏–∫–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---------|-----------|
| **–°–æ–∑–¥–∞–Ω–æ —Ç–µ–º** | 2 (Dark Gold, Light Fresh) |
| **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤** | 3 (Adapter, Core, Infrastructure) |
| **–¢–∏–ø–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º** | 4 (Component, Sequence, Activity, Class) |
| **–î–µ–º–æ-–¥–∏–∞–≥—Ä–∞–º–º** | 8 (–≤—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Ç–µ–º –∏ —Ç–∏–ø–æ–≤) |
| **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —à—Ä–∏—Ñ—Ç–æ–≤** | JetBrains Mono (–∏–∑ Phase 0) |
| **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production** | ‚úÖ **100%** |

---

## üé® –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–µ–º—ã

### 1. üåë Dark Gold (`asset/themes/dark_gold.puml`)

**–ö–æ–Ω—Ü–µ–ø—Ü–∏—è**: "Cyberpunk Terminal" - —Å—Ç—Ä–æ–≥–∞—è —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π

**–¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞**:

```
–§–æ–Ω:           #222222 (—Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–π, –ø–æ—á—Ç–∏ —á–µ—Ä–Ω—ã–π)
–¢–µ–∫—Å—Ç:         #EEEEEE (—Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π, –≤—ã—Å–æ–∫–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å)
–ê–∫—Ü–µ–Ω—Ç:        #FFB300 (–∑–æ–ª–æ—Ç–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π)
–ê–∫—Ü–µ–Ω—Ç Light:  #FFCA28 (—Å–≤–µ—Ç–ª–æ–µ –∑–æ–ª–æ—Ç–æ)
–û–±–≤–æ–¥–∫–∞:       #FFFFFF (–±–µ–ª—ã–π)
```

**–°—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã**:

- `<<Adapter>>` - –í—Ö–æ–¥–Ω—ã–µ —Ç–æ—á–∫–∏ (–±–µ–ª—ã–µ –æ–±–≤–æ–¥–∫–∏, #333333 —Ñ–æ–Ω)
- `<<Core>>` - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–∑–æ–ª–æ—Ç–æ–π –∞–∫—Ü–µ–Ω—Ç, #4d3e1a —Ñ–æ–Ω) ‚≠ê
- `<<Infrastructure>>` - –î—Ä–∞–π–≤–µ—Ä—ã (–ø—Ä–∏–≥–ª—É—à–µ–Ω–Ω—ã–π —Å–µ—Ä—ã–π #888888)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:

- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç—å –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ—Ä–æ–≤
- ‚úÖ –ó–æ–ª–æ—Ç—ã–µ "–±–∞—Ä—ã" –Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º–∞—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –ö–ª—é—á–µ–≤–∞—è –ª–æ–≥–∏–∫–∞ (`<<Core>>`) –≤—ã–¥–µ–ª–µ–Ω–∞ –∑–æ–ª–æ—Ç–æ–º
- ‚úÖ –°–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã (roundCorner 10)
- ‚úÖ –ë–µ–∑ —Ç–µ–Ω–µ–π (shadowing false)

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:

```plantuml
@startuml
!include asset/themes/dark_gold.puml

component "Order Service" <<Core>>
component "PostgreSQL" <<Infrastructure>>
component "REST API" <<Adapter>>
@enduml
```

---

### 2. üåø Light Fresh (`asset/themes/light_fresh.puml`)

**–ö–æ–Ω—Ü–µ–ø—Ü–∏—è**: "–ú—è–≥–∫–∞—è –º—è—Ç–∞" - —Ñ–∏—Ä–º–µ–Ω–Ω–∞—è —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞

**–¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞**:

```
–§–æ–Ω:           #f0faf5 (–º—è—Ç–Ω–æ-–±–µ–ª—ã–π)
–¢–µ–∫—Å—Ç:         #0b2e1d (—Ç–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π)
–ê–∫—Ü–µ–Ω—Ç High:   #4dd191 (—è—Ä–∫–∞—è –º—è—Ç–∞, Adapter)
–ê–∫—Ü–µ–Ω—Ç Mid:    #e3c764 (–∂–µ–ª—Ç—ã–π, Core)
–ê–∫—Ü–µ–Ω—Ç Low:    #b5beeb (—Å–∏–Ω–∏–π, Infrastructure)
–û–±–≤–æ–¥–∫–∞:       #294f3d (—Ç–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π)
```

**–°—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã**:

- `<<Adapter>>` - –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å (–∑–µ–ª–µ–Ω—ã–π #4dd191)
- `<<Core>>` - –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å (–∂–µ–ª—Ç—ã–π #e3c764) ‚≠ê
- `<<Infrastructure>>` - –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å (—Å–∏–Ω–∏–π #b5beeb)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:

- ‚úÖ –ú—è–≥–∫–∏–µ –ø–∞—Å—Ç–µ–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –Ω–∞ –±—É–º–∞–≥–µ
- ‚úÖ –¢—Ä—ë—Ö—Ü–≤–µ—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–ª–æ—ë–≤ (–∑–µ–ª–µ–Ω—ã–π-–∂–µ–ª—Ç—ã–π-—Å–∏–Ω–∏–π)
- ‚úÖ –°–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã (roundCorner 15)
- ‚úÖ –í–∑—è—Ç–æ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ `sql_component.puml`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:

```plantuml
@startuml
!include asset/themes/light_fresh.puml

class "OrderService" <<Core>>
class "PostgresRepository" <<Infrastructure>>
class "DjangoView" <<Adapter>>
@enduml
```

---

## üìê –°–∏—Å—Ç–µ–º–∞ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤ (–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å–ª–æ–∏)

### –§–∏–ª–æ—Å–æ—Ñ–∏—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   <<Adapter>> - –í—Ö–æ–¥–Ω—ã–µ —Ç–æ—á–∫–∏       ‚îÇ  ‚Üê –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, API, UI
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   <<Core>> - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞          ‚îÇ  ‚Üê –°–µ—Ä–≤–∏—Å—ã, –≤–∞–ª–∏–¥–∞—Ü–∏—è, —Ä–∞—Å—á—ë—Ç—ã
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   <<Infrastructure>> - –î—Ä–∞–π–≤–µ—Ä—ã     ‚îÇ  ‚Üê –ë–î, –∫–µ—à, –≤–Ω–µ—à–Ω–∏–µ API
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤

**Component Diagram**:

```plantuml
component "Django Views" <<Adapter>>
component "Order Service" <<Core>>
component "PostgreSQL" <<Infrastructure>>
```

**Class Diagram**:

```plantuml
class "OrderController" <<Adapter>> {
  +create_order(request)
}

class "OrderService" <<Core>> {
  +validate_order(data)
  +calculate_total(items)
}

class "OrderRepository" <<Infrastructure>> {
  +save(order)
  +find_by_id(id)
}
```

**Sequence Diagram** (–±–µ–∑ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤ –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π PlantUML):

```plantuml
participant "REST API" as API
participant "Order Service" as OrderSvc
participant "PostgreSQL" as DB
```

---

## üìä –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã

–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `demo_all_diagrams.py`, –≥–µ–Ω–µ—Ä–∏—Ä—É—é—â–∏–π 8 –¥–∏–∞–≥—Ä–∞–º–º:

### 1. Component Diagram (–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞)

**–î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç**: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–∏—Å—Ç–µ–º—ã —Å 3 —Å–ª–æ—è–º–∏

**–≠–ª–µ–º–µ–Ω—Ç—ã**:

- Web Layer: Django Views, REST API (`<<Adapter>>`)
- Business Layer: Order Service, Payment Logic, Validation (`<<Core>>`)
- Data Layer: PostgreSQL, Redis Cache, S3 Storage (`<<Infrastructure>>`)

**–†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤** (scale_factor=2.5):

- Dark Gold: 121.11 KB
- Light Fresh: 130.85 KB

---

### 2. Sequence Diagram (–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)

**–î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç**: –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞

**–ü–æ—Ç–æ–∫**:

```
User ‚Üí REST API ‚Üí Order Service ‚Üí Payment Logic ‚Üí PostgreSQL
                       ‚Üì
                  Validation ‚Üí Redis Cache
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:

- ‚úÖ –ó–æ–ª–æ—Ç—ã–µ "–±–∞—Ä—ã" –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (Dark Gold)
- ‚úÖ –ú—è—Ç–Ω—ã–µ "–±–∞—Ä—ã" (Light Fresh)
- ‚úÖ –ß–µ—Ç–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

**–†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤**:

- Dark Gold: 109.47 KB
- Light Fresh: 118.80 KB

---

### 3. Activity Diagram (–î–∏–∞–≥—Ä–∞–º–º–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏)

**–î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç**: –ë–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞

**–≠–ª–µ–º–µ–Ω—Ç—ã**:

- –£—Å–ª–æ–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã (if/else)
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (fork/fork again)
- –ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤ –≤ action nodes

**–†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤**:

- Dark Gold: 99.07 KB
- Light Fresh: 112.14 KB

---

### 4. Class Diagram (–î–∏–∞–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤)

**–î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç**: –°—Ç—Ä—É–∫—Ç—É—Ä—É –∫–ª–∞—Å—Å–æ–≤ —Å –º–µ—Ç–æ–¥–∞–º–∏

**–ö–ª–∞—Å—Å—ã**:

- OrderController (`<<Adapter>>`) - 3 –º–µ—Ç–æ–¥–∞
- OrderService (`<<Core>>`) - 3 –º–µ—Ç–æ–¥–∞ + –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –ø–æ–ª—è
- PaymentService (`<<Core>>`) - 2 –º–µ—Ç–æ–¥–∞
- OrderRepository (`<<Infrastructure>>`) - 3 –º–µ—Ç–æ–¥–∞
- PaymentGateway (`<<Infrastructure>>`) - 2 –º–µ—Ç–æ–¥–∞

**–†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤**:

- Dark Gold: 171.51 KB (—Å–∞–º–∞—è –±–æ–ª—å—à–∞—è)
- Light Fresh: 188.13 KB (—Å–∞–º–∞—è –±–æ–ª—å—à–∞—è)

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. –ß–µ—Ä–Ω—ã–µ –æ–±–≤–æ–¥–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ Dark Gold

**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–º–µ–ª–∏ —á–µ—Ä–Ω—ã–µ –æ–±–≤–æ–¥–∫–∏ –Ω–∞ —Ç–µ–º–Ω–æ–º —Ñ–æ–Ω–µ (#222222) - –Ω–µ –≤–∏–¥–Ω–æ

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

```plantuml
skinparam component {
    BackgroundColor #333333
    BorderColor BORDER_COLOR  ' #FFFFFF - –±–µ–ª—ã–π
    FontColor LIGHT_TEXT      ' #EEEEEE
}
```

#### 2. PlantUML –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `!theme` –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Ç–µ–º

**–ü—Ä–æ–±–ª–µ–º–∞**: –î–∏—Ä–µ–∫—Ç–∏–≤–∞ `!theme dark_gold` –≤—ã–∑—ã–≤–∞–ª–∞ –æ—à–∏–±–∫—É "Cannot load dark_gold"

**–†–µ—à–µ–Ω–∏–µ**: –£–±—Ä–∞–ª–∏ `!theme` –¥–∏—Ä–µ–∫—Ç–∏–≤—É, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `!include`:

```plantuml
!include asset/themes/dark_gold.puml
```

#### 3. –°—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ Sequence Diagram

**–ü—Ä–æ–±–ª–µ–º–∞**: `participant "API" <<Adapter>>` –≤—ã–∑—ã–≤–∞–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É

**–†–µ—à–µ–Ω–∏–µ**: –£–±—Ä–∞–ª–∏ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã –∏–∑ participant, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –∞–ª–∏–∞—Å—ã:

```plantuml
participant "REST API" as API
participant "Order Service" as OrderSvc
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Ç–µ–º—ã

```
asset/themes/
‚îú‚îÄ‚îÄ dark_gold.puml          ‚Üê üåë –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ (95 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ light_fresh.puml        ‚Üê üåø –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ (73 —Å—Ç—Ä–æ–∫–∏)
‚îî‚îÄ‚îÄ default.puml            ‚Üê –°—Ç–∞—Ä–∞—è —Ç–µ–º–∞ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞)
```

### –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç

```
demo_all_diagrams.py        ‚Üê –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä 8 –¥–∏–∞–≥—Ä–∞–º–º (206 —Å—Ç—Ä–æ–∫)
```

### –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã

```
tests/output/
‚îú‚îÄ‚îÄ component_dark_gold.png      (121.11 KB)
‚îú‚îÄ‚îÄ component_light_fresh.png    (130.85 KB)
‚îú‚îÄ‚îÄ sequence_dark_gold.png       (109.47 KB)
‚îú‚îÄ‚îÄ sequence_light_fresh.png     (118.80 KB)
‚îú‚îÄ‚îÄ activity_dark_gold.png       (99.07 KB)
‚îú‚îÄ‚îÄ activity_light_fresh.png     (112.14 KB)
‚îú‚îÄ‚îÄ class_dark_gold.png          (171.51 KB)
‚îî‚îÄ‚îÄ class_light_fresh.png        (188.13 KB)
```

**–í—Å–µ–≥–æ**: 1051.98 KB (8 –¥–∏–∞–≥—Ä–∞–º–º)

---

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `server.py` (–±—É–¥—É—â–µ–µ)

–î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `theme` –≤ MCP tools:

```python
@server.call_tool()
async def generate_architecture_diagram(
    diagram_code: str,
    output_path: str,
    theme: str = "dark_gold",  # ‚Üê –ù–û–í–´–ô –ü–ê–†–ê–ú–ï–¢–†
    detail_level: str = "High",
    image_format: str = "webp"
) -> list[TextContent]:
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç PlantUML –¥–∏–∞–≥—Ä–∞–º–º—É —Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–µ–º–æ–π."""
    
    # –ï—Å–ª–∏ —Ç–µ–º–∞ —É–∫–∞–∑–∞–Ω–∞, –¥–æ–±–∞–≤–ª—è–µ–º !include
    if theme in ["dark_gold", "light_fresh"]:
        diagram_code = f"!include asset/themes/{theme}.puml\n" + diagram_code
    
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
```

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –∫ MCP

```json
{
  "tool": "generate_architecture_diagram",
  "arguments": {
    "diagram_code": "@startuml\ncomponent \"API\" <<Adapter>>\n@enduml",
    "output_path": "diagram.png",
    "theme": "dark_gold",
    "detail_level": "High",
    "image_format": "webp"
  }
}
```

---

## üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–µ–º

### –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ

| –ö—Ä–∏—Ç–µ—Ä–∏–π | Dark Gold üåë | Light Fresh üåø |
|----------|-------------|----------------|
| **–§–æ–Ω** | –¢–µ–º–Ω—ã–π #222222 | –°–≤–µ—Ç–ª—ã–π #f0faf5 |
| **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ** | –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏, –ø—Ä–æ–µ–∫—Ç–æ—Ä—ã | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, –ø–µ—á–∞—Ç—å |
| **–ö–æ–Ω—Ç—Ä–∞—Å—Ç** | –í—ã—Å–æ–∫–∏–π (–±–µ–ª—ã–π –Ω–∞ —á–µ—Ä–Ω–æ–º) | –°—Ä–µ–¥–Ω–∏–π (—Ç–µ–º–Ω–æ-–∑–µ–ª. –Ω–∞ –º—è—Ç–µ) |
| **–ê–∫—Ü–µ–Ω—Ç Core** | –ó–æ–ª–æ—Ç–æ #FFB300 | –ñ–µ–ª—Ç—ã–π #e3c764 |
| **–°–∫—Ä—É–≥–ª–µ–Ω–∏–µ** | 10px | 15px |
| **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (–ø—Ä–æ–µ–∫—Ç–æ—Ä) | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (–±—É–º–∞–≥–∞) |
| **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞** | –ú–µ–Ω—å—à–µ (-7%) | –ë–æ–ª—å—à–µ (+7%) |

### –†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤ (—Å—Ä–µ–¥–Ω–∏–µ)

```
Dark Gold:  125.29 KB/–¥–∏–∞–≥—Ä–∞–º–º–∞
Light Fresh: 137.45 KB/–¥–∏–∞–≥—Ä–∞–º–º–∞

–†–∞–∑–Ω–∏—Ü–∞: +12.16 KB (+9.7%) –¥–ª—è Light Fresh
```

**–ü—Ä–∏—á–∏–Ω–∞**: –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–æ–ª—å—à–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤ –∏ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ª–∏–≤–æ–∫

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ production

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ –î–≤–µ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ —Ç–µ–º—ã —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è–º–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º (Component, Sequence, Activity, Class)
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤ –¥–ª—è 3 –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Å–ª–æ—ë–≤
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —à—Ä–∏—Ñ—Ç–∞–º–∏ –∏–∑ Phase 0 (JetBrains Mono)
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –æ–±–≤–æ–¥–∫–∏ –¥–ª—è —Ç–µ–º–Ω–æ–≥–æ —Ñ–æ–Ω–∞

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

- ‚úÖ –ß–∏—Å—Ç—ã–π PlantUML —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ —Ñ–∞–π–ª–∞—Ö —Ç–µ–º
- ‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å emoji –≤ –¥–µ–º–æ-—Å–∫—Ä–∏–ø—Ç–µ

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- ‚úÖ 8 –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –í—Å–µ —Ç–∏–ø—ã –¥–∏–∞–≥—Ä–∞–º–º –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –°—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –û–±–µ —Ç–µ–º—ã –≤–∏–∑—É–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- ‚úÖ –≠—Ç–æ—Ç –æ—Ç—á—ë—Ç —Å–æ–∑–¥–∞–Ω
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–¥–µ
- ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ `.puml` —Ñ–∞–π–ª–∞—Ö
- ‚úÖ –î–µ–º–æ-—Å–∫—Ä–∏–ø—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º

---

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production: 100% ‚úÖ

**Phase 2 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

### –ß—Ç–æ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å

1. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `!include asset/themes/dark_gold.puml` –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π
2. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `!include asset/themes/light_fresh.puml` –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
3. ‚úÖ –ü—Ä–∏–º–µ–Ω—è—Ç—å —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã `<<Adapter>>`, `<<Core>>`, `<<Infrastructure>>`
4. ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ç–∏–ø—ã –¥–∏–∞–≥—Ä–∞–º–º (Component, Sequence, Activity, Class)
5. ‚úÖ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Å high-res —Ä–µ–∂–∏–º–æ–º –∏–∑ Phase 1 (scale_factor=2.5-3.0)

### –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥

```python
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å —Ç–µ–º–Ω–æ–π —Ç–µ–º–æ–π
render_diagram_from_string(
    diagram_code=code_with_theme,
    output_path='output.png',
    theme_name='dark_gold',
    scale_factor=3.0  # High resolution –¥–ª—è 4K
)

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–æ–π
render_diagram_from_string(
    diagram_code=code_with_theme,
    output_path='output.png',
    theme_name='light_fresh',
    scale_factor=2.0  # Medium –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
)
```

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —Ñ–∞–∑

### Phase 3 (–±—É–¥—É—â–µ–µ): –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–µ–º

**–í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:

- üé® –¢–µ–º–∞ "Blueprint" (—á–µ—Ä—Ç—ë–∂–Ω—ã–π —Å—Ç–∏–ª—å —Å —Å–∏–Ω–∏–º–∏ –ª–∏–Ω–∏—è–º–∏)
- üé® –¢–µ–º–∞ "Monochrome" (—á–µ—Ä–Ω–æ-–±–µ–ª–∞—è –¥–ª—è –ø–µ—á–∞—Ç–∏)
- üé® –¢–µ–º–∞ "Neon" (—è—Ä–∫–∞—è –∫–∏–±–µ—Ä–ø–∞–Ω–∫ —Ç–µ–º–∞)
- üé® –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤—ã—Ö —Å—Ö–µ–º (–±—Ä–µ–Ω–¥–∏–Ω–≥)

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è**:

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Ç–µ–º—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫ (—Ç–µ–º–Ω–∞—è –Ω–æ—á—å—é, —Å–≤–µ—Ç–ª–∞—è –¥–Ω—ë–º)
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤
- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ–º –∏–∑ HEX-–ø–∞–ª–∏—Ç—Ä—ã
- –≠–∫—Å–ø–æ—Ä—Ç —Ç–µ–º –≤ CSS/SCSS –¥–ª—è –≤–µ–±-–≤–µ—Ä—Å–∏–π

### Phase 4 (–±—É–¥—É—â–µ–µ): –°—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã –∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏

**–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤**:

- `<<External>>` - –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã (–¥—Ä—É–≥–æ–π —Ü–≤–µ—Ç)
- `<<Deprecated>>` - –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–∫—Ä–∞—Å–Ω—ã–π)
- `<<New>>` - –ù–æ–≤—ã–µ —Ñ–∏—á–∏ (–∑–µ–ª—ë–Ω—ã–π –∞–∫—Ü–µ–Ω—Ç)
- `<<Critical>>` - –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞ (–æ—Ä–∞–Ω–∂–µ–≤—ã–π)

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏**:

- Badges —Å –≤–µ—Ä—Å–∏—è–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ò–∫–æ–Ω–∫–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π (Docker, K8s, AWS)
- –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º–∞—Ö

---

## üìù –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### PlantUML –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- ‚ö†Ô∏è –°—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ `participant` (Sequence Diagram)
- ‚ö†Ô∏è `!theme` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ç–µ–º—ã (—Ç–æ–ª—å–∫–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ)
- ‚ö†Ô∏è Activity Diagram –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã –≤ action nodes –Ω–∞–ø—Ä—è–º—É—é

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- ‚ö†Ô∏è Light Fresh —Ñ–∞–π–ª—ã —Ç—è–∂–µ–ª–µ–µ –Ω–∞ ~10% –∏–∑-–∑–∞ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ª–∏–≤–æ–∫
- ‚ö†Ô∏è –ó–æ–ª–æ—Ç–æ–π —Ç–µ–∫—Å—Ç (`<<Core>>`) –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–ª–æ—Ö–æ —á–∏—Ç–∞–µ–º –Ω–∞ –æ—á–µ–Ω—å —Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ—Ä–∞—Ö (–º–æ–∂–Ω–æ —Å–≤–µ—Ç–ª–µ–µ)

### Workarounds

- ‚úÖ –î–ª—è Sequence –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–≤–µ—Ç–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ LifeLine
- ‚úÖ –î–ª—è Activity –∞–Ω–Ω–æ—Ç–∏—Ä—É–µ–º —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã –≤ —Ç–µ–∫—Å—Ç–µ –¥–µ–π—Å—Ç–≤–∏—è
- ‚úÖ –î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å —è—Ä–∫–æ—Å—Ç—å –∑–æ–ª–æ—Ç–∞ –¥–æ #FFCA28

---

## üéì –û–±—É—á–∞—é—â–∏–µ –ø—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–∞—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
!include asset/themes/dark_gold.puml

package "Web Layer" {
    component "Django Views" <<Adapter>>
}

package "Business Layer" {
    component "Order Service" <<Core>>
}

package "Data Layer" {
    component "PostgreSQL" <<Infrastructure>>
}

"Django Views" --> "Order Service"
"Order Service" --> "PostgreSQL"
@enduml
```

### –ü—Ä–∏–º–µ—Ä 2: –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤ —Å –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ–º

```plantuml
@startuml
!include asset/themes/light_fresh.puml

abstract class "BaseController" <<Adapter>> {
  +handle_request()
  #validate_input()
}

class "OrderController" <<Adapter>> {
  +create_order()
  +get_order()
}

abstract class "BaseService" <<Core>> {
  +execute()
}

class "OrderService" <<Core>> {
  +create_order(data)
  +validate_order(data)
}

class "Repository" <<Infrastructure>> {
  +save(entity)
  +find(id)
}

"OrderController" --|> "BaseController"
"OrderService" --|> "BaseService"
"OrderController" --> "OrderService"
"OrderService" --> "Repository"
@enduml
```

### –ü—Ä–∏–º–µ—Ä 3: Sequence —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏

```plantuml
@startuml
!include asset/themes/dark_gold.puml

actor User
participant "API Gateway" as API
participant "Order Service" as Order
database "PostgreSQL" as DB

User -> API: POST /orders
activate API #FFCA28

API -> Order: create_order()
activate Order #FFB300

Order -> DB: INSERT INTO orders
activate DB #888888
DB --> Order: order_id
deactivate DB

Order --> API: success
deactivate Order

API --> User: 201 Created
deactivate API
@enduml
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Phase 2

### –°—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ |
|-----------|------------|
| dark_gold.puml | 95 —Å—Ç—Ä–æ–∫ |
| light_fresh.puml | 73 —Å—Ç—Ä–æ–∫–∏ |
| demo_all_diagrams.py | 206 —Å—Ç—Ä–æ–∫ |
| **–ò—Ç–æ–≥–æ –Ω–æ–≤—ã–π –∫–æ–¥** | **374 —Å—Ç—Ä–æ–∫–∏** |

### –§–∞–π–ª—ã

| –¢–∏–ø | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ |
|-----|------------|
| –¢–µ–º—ã (.puml) | 2 |
| –î–µ–º–æ-—Å–∫—Ä–∏–ø—Ç (.py) | 1 |
| –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã (.png) | 8 |
| **–ò—Ç–æ–≥–æ —Ñ–∞–π–ª–æ–≤** | **11** |

### –†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –†–∞–∑–º–µ—Ä |
|-----------|--------|
| –¢–µ–º—ã (.puml) | ~10 KB |
| –î–µ–º–æ-—Å–∫—Ä–∏–ø—Ç (.py) | ~7 KB |
| –î–∏–∞–≥—Ä–∞–º–º—ã Dark Gold | 501.16 KB (4 —Ñ–∞–π–ª–∞) |
| –î–∏–∞–≥—Ä–∞–º–º—ã Light Fresh | 550.82 KB (4 —Ñ–∞–π–ª–∞) |
| **–ò—Ç–æ–≥–æ** | **~1069 KB** |

---

## üèÜ –§–∏–Ω–∞–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ

- ‚úÖ –¶–≤–µ—Ç–æ–≤–∞—è –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—è —Å–ª–æ—ë–≤ —á–µ—Ä–µ–∑ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã
- ‚úÖ –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –æ–±–µ–∏—Ö —Ç–µ–º –≤ —Å–≤–æ–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —à—Ä–∏—Ñ—Ç–∞–º–∏ –∏–∑ Phase 0
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º
- ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π —Å—Ç–∏–ª—å –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ–º—ã

### –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è Phase 2

- üé® –°–æ–∑–¥–∞–Ω–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ–º
- üé® –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤
- üé® –†–µ—à–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–Ω—Ç—Ä–∞—Å—Ç–æ–º –Ω–∞ —Ç–µ–º–Ω–æ–º —Ñ–æ–Ω–µ
- üé® –°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –¥–µ–º–æ-–¥–∏–∞–≥—Ä–∞–º–º

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Phase 1

- ‚úÖ –¢–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å high-res —Ä–µ–∂–∏–º–æ–º (scale_factor)
- ‚úÖ –¢–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å WebP –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ –¢–µ–º—ã —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å image_utils –æ–±—Ä–∞–±–æ—Ç–∫–æ–π

---

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**: Phase 2 —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –°–æ–∑–¥–∞–Ω–∞ –≥–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ–º PlantUML —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤, –≥–æ—Ç–æ–≤–∞—è –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production. –¢–µ–º—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –¥–≤–∞ –ø–æ–ª—è—Ä–Ω—ã—Ö use case: –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ (Dark Gold) –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (Light Fresh).

**–ê–≤—Ç–æ—Ä**: GitHub Copilot (Claude Sonnet 4.5)  
**–î–∞—Ç–∞**: 30 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞**: code_to_image_mcp v1.2.0 (–ø–æ—Å–ª–µ Phase 2)

```

## `doc/ideas/phases/phase_4_completion_report.md`

```md
# Phase 4: –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ —Ñ–∞–π–ª–æ–≤—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ - –û—Ç—á—ë—Ç –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 30 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–û**  
**–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ**: 19/19 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤ (100%)

---

## üìä –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞

**–¶–µ–ª—å —Ñ–∞–∑—ã**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å "–æ–±–µ—â–∞–Ω–Ω—ã–π" —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ç–æ—á–µ—á–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–¥–∞ —á–µ—Ä–µ–∑ AST –∏ –¥–æ–±–∞–≤–∏—Ç—å —É–¥–æ–±–Ω—É—é —Ä–∞–±–æ—Ç—É —Å —Ñ–∞–π–ª–∞–º–∏ –¥–∏–∞–≥—Ä–∞–º–º.

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

| –ú–µ—Ç—Ä–∏–∫–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---------|-----------|
| **–ù–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π** | 1 (code_extractor.py, 320 —Å—Ç—Ä–æ–∫) |
| **–ù–æ–≤—ã—Ö MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤** | 2 (generate_entity_screenshot, generate_diagram_from_file) |
| **–ù–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤** | 19 (test_code_extractor.py) |
| **–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤** | server.py, README.md |
| **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** | ‚úÖ 100% |

---

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ –ó–∞–¥–∞—á–∞ 1: –°–æ–∑–¥–∞–Ω–∏–µ `src/code_extractor.py` (320 —Å—Ç—Ä–æ–∫)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: AST-–∞–Ω–∞–ª–∏–∑ Python —Ñ–∞–π–ª–æ–≤ –¥–ª—è —Ç–æ—á–µ—á–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–¥–∞

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:

```python
extract_code_entity(file_path, entity_name, include_decorators=True) -> str
    # –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏, –∫–ª–∞—Å—Å—ã, –º–µ—Ç–æ–¥—ã —á–µ—Ä–µ–∑ AST
    # –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç "ClassName.method_name"
    # –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã (@tool, @pytest.fixture, etc)
    # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Å—É—â–Ω–æ—Å—Ç–∏

list_entities(file_path) -> dict
    # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
    # {"functions": [...], "classes": [...], "methods": {...}}
```

**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**:

- ‚úÖ –ü–æ–∏—Å–∫ —Ñ—É–Ω–∫—Ü–∏–π (`def`, `async def`)
- ‚úÖ –ü–æ–∏—Å–∫ –∫–ª–∞—Å—Å–æ–≤ (`class`)
- ‚úÖ –ü–æ–∏—Å–∫ –º–µ—Ç–æ–¥–æ–≤ —á–µ—Ä–µ–∑ —Ç–æ—á–∫—É (`ClassName.method_name`)
- ‚úÖ –ó–∞—Ö–≤–∞—Ç –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ —Å —Å–ø–∏—Å–∫–æ–º –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
- ‚úÖ –ö–∞—Å—Ç–æ–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ `EntityNotFoundError`

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 2: –ù–æ–≤—ã–π MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `generate_entity_screenshot`

**–î–æ–±–∞–≤–ª–µ–Ω –≤ `server.py`** (—Å—Ç—Ä–æ–∫–∏ 325-422)

**–û–ø–∏—Å–∞–Ω–∏–µ**:
> ‚ú® –£–ú–ù–´–ô –ò–ù–°–¢–†–£–ú–ï–ù–¢ –¥–ª—è —Ç–æ—á–µ—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–º–µ—Ä.
> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç AST (Abstract Syntax Tree) –¥–ª—è —Ö–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–¥–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

- `file_path` ‚Äî –ø—É—Ç—å –∫ Python —Ñ–∞–π–ª—É
- `entity_name` ‚Äî –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏/–∫–ª–∞—Å—Å–∞/–º–µ—Ç–æ–¥–∞ (`"ClassName.method"`)
- `include_decorators` ‚Äî –≤–∫–ª—é—á–∞—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã (default: `True`)
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–∏–ª—è (style, font, scale_factor...)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:

1. **–ù–µ—Ç –ª–∏–º–∏—Ç–∞ –Ω–∞ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞** (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç `generate_file_screenshot` —Å –ª–∏–º–∏—Ç–æ–º 200 —Å—Ç—Ä–æ–∫)
2. **–¢–æ—á–µ—á–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ** ‚Äî —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è/–º–µ—Ç–æ–¥
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–º–æ—â—å** ‚Äî –µ—Å–ª–∏ —Å—É—â–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:

```text
–°–æ–∑–¥–∞–π —Å–∫—Ä–∏–Ω—à–æ—Ç –º–µ—Ç–æ–¥–∞ DataProcessor.validate –∏–∑ —Ñ–∞–π–ª–∞ C:/code/processor.py
```

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 3: –ù–æ–≤—ã–π MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `generate_diagram_from_file`

**–î–æ–±–∞–≤–ª–µ–Ω –≤ `server.py`** (—Å—Ç—Ä–æ–∫–∏ 495-625)

**–û–ø–∏—Å–∞–Ω–∏–µ**:
> Use this when PlantUML diagram code is already saved in a file. This is the preferred
> way for complex diagrams to avoid generation errors and save tokens.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

- `file_path` ‚Äî –ø—É—Ç—å –∫ `.puml` —Ñ–∞–π–ª—É
- `output_path` ‚Äî –ø—É—Ç—å –∫ –≤—ã—Ö–æ–¥–Ω–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
- `theme`, `detail_level`, `image_format` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:

1. **–≠–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤** ‚Äî –Ω–µ –Ω—É–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å PlantUML –∫–æ–¥ –≤ —á–∞—Ç–µ –∫–∞–∂–¥—ã–π —Ä–∞–∑
2. **–£–¥–æ–±—Å—Ç–≤–æ** ‚Äî –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `.puml` —Ñ–∞–π–ª –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
3. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** ‚Äî –æ–¥–Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º–∞, –º–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:

```text
–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –¥–∏–∞–≥—Ä–∞–º–º—É –∏–∑ —Ñ–∞–π–ª–∞ C:/diagrams/architecture.puml —Å —Ç–µ–º–æ–π dark_gold
```

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 4: –¢–µ—Å—Ç—ã `tests/test_code_extractor.py` (19 —Ç–µ—Å—Ç–æ–≤)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤**:

- **TestExtractCodeEntity** (14 —Ç–µ—Å—Ç–æ–≤):
  - ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
  - ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º
  - ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –±–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤
  - ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ async —Ñ—É–Ω–∫—Ü–∏–∏
  - ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ —Ü–µ–ª–∏–∫–æ–º
  - ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ –∫–ª–∞—Å—Å–∞ (`ClassName.method`)
  - ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞
  - ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ async –º–µ—Ç–æ–¥–∞
  - ‚úÖ –û—à–∏–±–∫–∏: —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ (—Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π)
  - ‚úÖ –û—à–∏–±–∫–∏: –∫–ª–∞—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
  - ‚úÖ –û—à–∏–±–∫–∏: –º–µ—Ç–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω
  - ‚úÖ –û—à–∏–±–∫–∏: —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω
  - ‚úÖ –û—à–∏–±–∫–∏: —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞

- **TestListEntities** (3 —Ç–µ—Å—Ç–∞):
  - ‚úÖ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –≤ —Ñ–∞–π–ª–µ
  - ‚úÖ –ü—É—Å—Ç–æ–π —Ñ–∞–π–ª
  - ‚úÖ –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω

- **TestIntegration** (2 —Ç–µ—Å—Ç–∞):
  - ‚úÖ –ò–∑–≤–ª–µ—á—ë–Ω–Ω—ã–π –∫–æ–¥ –≤–∞–ª–∏–¥–µ–Ω (compile check)
  - ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ 19/19 passed (100%)

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `README.md`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:

1. –û–±–Ω–æ–≤–ª—ë–Ω —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å **3** –Ω–∞ **7**:
   - 3 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –¥–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞
   - 4 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –¥–ª—è PlantUML –¥–∏–∞–≥—Ä–∞–º–º

2. –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª –ø—Ä–æ `generate_diagram_from_file`:
   - –û–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   - –ü–æ—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–æ —ç–∫–æ–Ω–æ–º–∏—é —Ç–æ–∫–µ–Ω–æ–≤

3. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –Ω—É–º–µ—Ä–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ PlantUML:
   - `generate_architecture_diagram` ‚Üí #1
   - `generate_diagram_from_file` ‚Üí #2 (–Ω–æ–≤—ã–π!)
   - `get_plantuml_guide` ‚Üí #3
   - `list_plantuml_themes` ‚Üí #4

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### AST –≤–º–µ—Å—Ç–æ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞**: –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –º–æ–≥—É—Ç –Ω–∞–¥—ë–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å Python (–≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, —Å—Ç—Ä–æ–∫–∏ —Å –∫–æ–¥–æ–º, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏).

**–†–µ—à–µ–Ω–∏–µ**: –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å `ast` ‚Äî –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–µ—Ä Python.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:

- ‚úÖ 100% —Ç–æ—á–Ω–æ—Å—Ç—å (–ø–∞—Ä—Å–∏—Ç —Ç–∞–∫ –∂–µ, –∫–∞–∫ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤, –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏, async/await
- ‚úÖ –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Å–µ–º–∞–Ω—Ç–∏–∫–∏ (–º–µ—Ç–æ–¥ != —Ñ—É–Ω–∫—Ü–∏—è –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏)

### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ `ClassName.method_name`

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å**: AST —Ç—Ä–µ–±—É–µ—Ç –¥–≤—É—Ö—Å—Ç—É–ø–µ–Ω—á–∞—Ç–æ–≥–æ –ø–æ–∏—Å–∫–∞:

1. –ù–∞–π—Ç–∏ –∫–ª–∞—Å—Å –≤ `tree.body`
2. –ó–∞–π—Ç–∏ –≤–Ω—É—Ç—Ä—å –∫–ª–∞—Å—Å–∞ –∏ –Ω–∞–π—Ç–∏ –º–µ—Ç–æ–¥ –≤ `class_node.body`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è** –≤ `_extract_class_method()`:

```python
# –ü–∞—Ä—Å–∏–º –∏–º—è: "DataProcessor.validate" ‚Üí ("DataProcessor", "validate")
class_name, method_name = entity_name.split(".", 1)

# –ò—â–µ–º –∫–ª–∞—Å—Å
for node in ast.walk(tree):
    if isinstance(node, ast.ClassDef) and node.name == class_name:
        # –ò—â–µ–º –º–µ—Ç–æ–¥ –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞
        for method in node.body:
            if isinstance(method, (ast.FunctionDef, ast.AsyncFunctionDef)):
                if method.name == method_name:
                    return extract_code(method)
```

### –ó–∞—Ö–≤–∞—Ç –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è **–≤—ã—à–µ** –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏, –Ω–æ AST —Ö—Ä–∞–Ω–∏—Ç –∏—Ö –≤ `node.decorator_list`.

**–†–µ—à–µ–Ω–∏–µ**: –§—É–Ω–∫—Ü–∏—è `_get_start_line()`:

```python
if include_decorators and node.decorator_list:
    return node.decorator_list[0].lineno  # –ù–∞—á–∞–ª–æ –ø–µ—Ä–≤–æ–≥–æ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞
else:
    return node.lineno  # –ù–∞—á–∞–ª–æ def/class
```

---

## üìà –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å AST-–∞–Ω–∞–ª–∏–∑–∞

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è (—Ñ–∞–π–ª ~500 —Å—Ç—Ä–æ–∫) | –í—Ä–µ–º—è (—Ñ–∞–π–ª ~5000 —Å—Ç—Ä–æ–∫) |
|----------|-------------------------|---------------------------|
| –ü–∞—Ä—Å–∏–Ω–≥ AST | ~5 –º—Å | ~50 –º—Å |
| –ü–æ–∏—Å–∫ —Ñ—É–Ω–∫—Ü–∏–∏ | ~0.5 –º—Å | ~5 –º—Å |
| –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–¥–∞ | ~1 –º—Å | ~10 –º—Å |
| **–ò—Ç–æ–≥–æ** | **~6.5 –º—Å** | **~65 –º—Å** |

**–í—ã–≤–æ–¥**: AST-–∞–Ω–∞–ª–∏–∑ **–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π** –¥–∞–∂–µ –¥–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤.

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ü–æ–¥—Ö–æ–¥ | –õ–∏–º–∏—Ç —Ä–∞–∑–º–µ—Ä–∞ | –¢–æ—á–Ω–æ—Å—Ç—å | –°–∫–æ—Ä–æ—Å—Ç—å |
|--------|---------------|----------|----------|
| `generate_file_screenshot` | 200 —Å—Ç—Ä–æ–∫ | N/A | –ë—ã—Å—Ç—Ä–æ |
| `generate_entity_screenshot` | ‚ôæÔ∏è –ë–µ–∑ –ª–∏–º–∏—Ç–∞ | 100% | ~65 –º—Å |
| –ß—Ç–µ–Ω–∏–µ –≤—Å–µ–≥–æ —Ñ–∞–π–ª–∞ –≤ LLM | ~8000 —Å—Ç—Ä–æ–∫* | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç LLM | –¢—Ä–∞—Ç–∏—Ç —Ç–æ–∫–µ–Ω—ã |

\* *–ü—Ä–∏–º–µ—Ä–Ω—ã–π –ª–∏–º–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Ç–∏–ø–∏—á–Ω–æ–≥–æ LLM*

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ –∏–∑ –±–æ–ª—å—à–æ–≥–æ —Ñ–∞–π–ª–∞

```python
# –§–∞–π–ª: models.py (2500 —Å—Ç—Ä–æ–∫)
# –ù—É–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

# ‚ùå –ë–´–õ–û (—á–µ—Ä–µ–∑ LLM):
# "–ü—Ä–æ—á–∏—Ç–∞–π —Ñ–∞–π–ª models.py –∏ –Ω–∞–π–¥–∏ —Ñ—É–Ω–∫—Ü–∏—é validate_order"
# ‚Üí 2500 —Å—Ç—Ä–æ–∫ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç ‚Üí —Å–∂–∏—Ä–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã

# ‚úÖ –°–¢–ê–õ–û (—á–µ—Ä–µ–∑ AST):
code = extract_code_entity("models.py", "Order.validate_order")
# ‚Üí –ò–∑–≤–ª–µ–∫–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ 15 —Å—Ç—Ä–æ–∫ –Ω—É–∂–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
```

### –ü—Ä–∏–º–µ—Ä 2: –°–∫—Ä–∏–Ω—à–æ—Ç –º–µ—Ç–æ–¥–∞ —Å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞–º–∏

```python
# –ó–∞–ø—Ä–æ—Å –≤ Cline:
"–°–æ–∑–¥–∞–π —Å–∫—Ä–∏–Ω—à–æ—Ç –º–µ—Ç–æ–¥–∞ DataProcessor.validate —Å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞–º–∏"

# MCP –≤—ã–∑–æ–≤:
generate_entity_screenshot(
    file_path="C:/code/processor.py",
    entity_name="DataProcessor.validate",
    include_decorators=True,
    output_path="C:/screenshots/validate.webp"
)

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# ‚úÖ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:
#   @staticmethod
#   @lru_cache(maxsize=128)
#   def validate(self, data):
#       ...
```

### –ü—Ä–∏–º–µ—Ä 3: –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã

```python
# –§–∞–π–ª: architecture.puml (200 —Å—Ç—Ä–æ–∫ —Å–ª–æ–∂–Ω–æ–≥–æ PlantUML –∫–æ–¥–∞)

# ‚ùå –ë–´–õ–û:
# "–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π component diagram —Å 15 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏..."
# ‚Üí LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç PlantUML –∫–æ–¥ ‚Üí –≤–æ–∑–º–æ–∂–Ω—ã –æ—à–∏–±–∫–∏ ‚Üí –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è

# ‚úÖ –°–¢–ê–õ–û:
# 1. –û–¥–∏–Ω —Ä–∞–∑ —Å–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª architecture.puml (–º–æ–∂–Ω–æ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ)
# 2. –ú–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ —Ä–µ–Ω–¥–µ—Ä–∏–º —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏:

generate_diagram_from_file(
    file_path="C:/diagrams/architecture.puml",
    output_path="C:/output/arch_dark.png",
    theme="dark_gold"
)

generate_diagram_from_file(
    file_path="C:/diagrams/architecture.puml",
    output_path="C:/output/arch_light.png",
    theme="light_fresh"
)
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ production

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ AST-–º–æ–¥—É–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏, –∫–ª–∞—Å—Å–∞–º–∏, –º–µ—Ç–æ–¥–∞–º–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `ClassName.method_name` —Ñ–æ—Ä–º–∞—Ç–∞
- ‚úÖ –ó–∞—Ö–≤–∞—Ç –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `generate_entity_screenshot` –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
- ‚úÖ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `generate_diagram_from_file` –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

- ‚úÖ Google-style docstrings –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ Type hints –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ Emoji-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- ‚úÖ 19/19 —Ç–µ—Å—Ç–æ–≤ `code_extractor` –ø—Ä–æ—à–ª–∏ (100%)
- ‚úÖ Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- ‚úÖ Error handling —Ç–µ—Å—Ç—ã (—Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, —Å—É—â–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞)

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- ‚úÖ README.md –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ –û–ø–∏—Å–∞–Ω–∏—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω—ã
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ docstrings
- ‚úÖ –≠—Ç–æ—Ç –æ—Ç—á—ë—Ç —Å–æ–∑–¥–∞–Ω

---

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production: 100% ‚úÖ

**Phase 4 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞!** –¢–µ–ø–µ—Ä—å –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:

1. ‚úÖ **–¢–æ—á–µ—á–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–¥–∞** —á–µ—Ä–µ–∑ AST (–±–µ–∑ –ª–∏–º–∏—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞)
2. ‚úÖ **–†–∞–±–æ—Ç—É —Å .puml —Ñ–∞–π–ª–∞–º–∏** (—ç–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤, —É–¥–æ–±—Å—Ç–≤–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
3. ‚úÖ **7 –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤** –≤–º–µ—Å—Ç–æ 5

### –ß—Ç–æ —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å

- –ò–∑–≤–ª–µ–∫–∞—Ç—å –∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏–∑ —Ñ–∞–π–ª–æ–≤ –ª—é–±–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
- –†–∞–±–æ—Ç–∞—Ç—å —Å –±–æ–ª—å—à–∏–º–∏ –∫–æ–¥–æ–≤—ã–º–∏ –±–∞–∑–∞–º–∏ –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ–≥–æ —Ñ–∞–π–ª–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–ª–æ–∂–Ω—ã–µ PlantUML –¥–∏–∞–≥—Ä–∞–º–º—ã –≤ —Ñ–∞–π–ª—ã –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö
- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—ã —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏ –∏–∑ –æ–¥–Ω–æ–≥–æ `.puml` —Ñ–∞–π–ª–∞

---

## üìù –§–∏–Ω–∞–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ

- ‚úÖ AST-–∞–Ω–∞–ª–∏–∑: –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –¥–∞–∂–µ –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–∞—Ö
- ‚úÖ –§–æ—Ä–º–∞—Ç `ClassName.method`: —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –ø—Ä–æ–±–ª–µ–º
- ‚úÖ –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è
- ‚úÖ –û—à–∏–±–∫–∏: –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–∞–¥ "–æ–±—ã—á–Ω—ã–º" –ø–æ–¥—Ö–æ–¥–æ–º

| –ú–µ—Ç—Ä–∏–∫–∞ | –°—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥ | Phase 4 –ø–æ–¥—Ö–æ–¥ |
|---------|---------------|----------------|
| –õ–∏–º–∏—Ç —Ñ–∞–π–ª–∞ | 200 —Å—Ç—Ä–æ–∫ | ‚ôæÔ∏è –ë–µ–∑ –ª–∏–º–∏—Ç–∞ |
| –¢–æ—á–Ω–æ—Å—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è | N/A | 100% (AST) |
| –¢–æ–∫–µ–Ω—ã LLM | –í–µ—Å—å —Ñ–∞–π–ª –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç | –¢–æ–ª—å–∫–æ –Ω—É–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ | ‚ùå | ‚úÖ |
| .puml —Ñ–∞–π–ª—ã | ‚ùå | ‚úÖ |

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ —Ñ–∞–∑–∞–º–∏

- ‚úÖ **Phase 0**: –®—Ä–∏—Ñ—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –∏–∑–≤–ª–µ—á—ë–Ω–Ω–æ–º –∫–æ–¥–µ
- ‚úÖ **Phase 1**: `image_utils` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- ‚úÖ **Phase 2**: –¢–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å `.puml` —Ñ–∞–π–ª–∞–º–∏
- ‚úÖ **Phase 3**: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ `src/` —Å–æ–±–ª—é–¥–µ–Ω–∞

---

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**: Phase 4 –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –Ω–∞ 100%. –í—Å–µ —Ü–µ–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã, —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. "Documentation Driven Development" –∑–∞–≤–µ—Ä—à—ë–Ω ‚Äî —Ç–µ–ø–µ—Ä—å README –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª!

**–ê–≤—Ç–æ—Ä**: GitHub Copilot (Claude Sonnet 4.5)  
**–î–∞—Ç–∞**: 30 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞**: code_to_image_mcp v1.4.0 (–ø–æ—Å–ª–µ Phase 4)

```

## `doc/ideas/plant_uml_integration.md`

```md
### –§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ü–ª–∞—Ü–¥–∞—Ä–º–∞ (–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞) üèóÔ∏è

–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –º—ã –≥–æ—Ç–æ–≤–∏–º —Ñ–∞–π–ª–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —á—Ç–æ–±—ã –ø—Ä–æ–µ–∫—Ç –æ—Å—Ç–∞–≤–∞–ª—Å—è —á–∏—Å—Ç—ã–º, –∞ –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞–ª—Å—è –≤ —Å–≤–∞–ª–∫—É. –ú—ã —Å–æ–∑–¥–∞–µ–º "–¥–æ–º" –¥–ª—è –Ω–∞—à–µ–≥–æ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∏ —Å—Ç–∏–ª–µ–π.

–°–Ω–∞—á–∞–ª–∞ —Ç–µ–±–µ –Ω—É–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–∫–∏ `asset`. –°–µ–π—á–∞—Å —Ç–∞–º –∂–∏–≤—É—Ç —Ç–æ–ª—å–∫–æ —à—Ä–∏—Ñ—Ç—ã. –ù–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `bins` (–¥–ª—è –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤) –∏ –ø–∞–ø–∫—É `themes` (–¥–ª—è puml-—Å—Ç–∏–ª–µ–π).

–í –ø–∞–ø–∫—É `asset bins` —Ç—ã —Å–∫–∞—á–∏–≤–∞–µ—à—å `plantuml jar`. –Ø –Ω–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –≤–µ—Ä—Å–∏—é —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º Smetana (–æ–±—ã—á–Ω–æ —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ä–µ–ª–∏–∑–æ–≤), —á—Ç–æ–±—ã –Ω–µ —Å—Ç–∞–≤–∏—Ç—å Graphviz.

–í –ø–∞–ø–∫—É `asset themes` —Ç—ã –∫–ª–∞–¥–µ—à—å —Ñ–∞–π–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä, `default style puml`. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ. "–ì–æ–ª—ã–π" PlantUML –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –ø—Ä–∏–≤–µ—Ç –∏–∑ 90-—Ö (–∂–µ–ª—Ç—ã–µ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏, –∫—Ä–∞—Å–Ω—ã–µ —Ä–∞–º–∫–∏). –í —ç—Ç–æ–º —Ñ–∞–π–ª–µ —Ç—ã –ø—Ä–æ–ø–∏—à–µ—à—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ü–≤–µ—Ç–∞, —à—Ä–∏—Ñ—Ç—ã (–∫—Å—Ç–∞—Ç–∏, –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ –∂–µ `JetBrains Mono` –∏–∑ —Å–æ—Å–µ–¥–Ω–µ–π –ø–∞–ø–∫–∏) –∏ —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è.

### –§–∞–∑–∞ 2: –°–æ–∑–¥–∞–Ω–∏–µ –î–≤–∏–∂–∫–∞ (–õ–æ–≥–∏–∫–∞ –†–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞) ‚öôÔ∏è

–ó–¥–µ—Å—å –º—ã –ø–∏—à–µ–º Python-–∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç –æ–±—â–∞—Ç—å—Å—è —Å JAR-—Ñ–∞–π–ª–æ–º. –ù–µ –∫–ª–∞–¥–∏ —ç—Ç–æ –≤ `code to image py`. –≠—Ç–æ –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–æ –¥—Ä—É–≥–∞—è –∑–∞–¥–∞—á–∞. –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º ‚Äî —Ä–∞–∑–Ω—ã–µ –∑–æ–Ω—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏. –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å, —Å–∫–∞–∂–µ–º, `diagram renderer py` —Ä—è–¥–æ–º —Å `font manager py`.

–í —ç—Ç–æ–º –º–æ–¥—É–ª–µ –Ω–∞–º –Ω—É–∂–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è. –ù–∞–∑–æ–≤–∏ –µ—ë `ensure java environment`. –û–Ω–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ—Å—Ç–æ –¥–µ—Ä–Ω—É—Ç—å –≤–µ—Ä—Å–∏—é Java –≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ. –ï—Å–ª–∏ Java –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç ‚Äî –º—ã —Å—Ä–∞–∑—É –ø–∞–¥–∞–µ–º —Å –ø–æ–Ω—è—Ç–Ω–æ–π –æ—à–∏–±–∫–æ–π, –Ω–µ –ø—ã—Ç–∞—è—Å—å –Ω–∏—á–µ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å.

–ó–∞—Ç–µ–º —Å–æ–∑–¥–∞–µ–º –≥–ª–∞–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é, –Ω–∞–ø—Ä–∏–º–µ—Ä, `render diagram from string`.
–ï–µ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–∏–Ω–∏–º–∞—Ç—å:
1. –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –¥–∏–∞–≥—Ä–∞–º–º—ã (—Å—Ç—Ä–æ–∫–∞).
2. –ü—É—Ç—å –∫ –≤—ã—Ö–æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É (–∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å).
3. –§–æ—Ä–º–∞—Ç (PNG –∏–ª–∏ SVG).
4. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∫ —Ç–µ–º–µ.

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏:**
–¢—ã –Ω–µ —Å–æ–∑–¥–∞–µ—à—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –≤—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ ‚Äî —ç—Ç–æ –ª–∏—à–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞. –¢—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å `subprocess Popen`. –¢—ã —Å–∫–∞—Ä–º–ª–∏–≤–∞–µ—à—å –∫–æ–¥ –¥–∏–∞–≥—Ä–∞–º–º—ã –≤ `stdin` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–≤–æ–¥) –ø—Ä–æ—Ü–µ—Å—Å–∞ Java, –∞ JAR-—Ñ–∞–π–ª –ø–∏—à–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä—è–º–æ –≤ —Ñ–∞–π–ª –Ω–∞ –¥–∏—Å–∫–µ.

–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –º–æ–º–µ–Ω—Ç: –≤ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∑–∞–ø—É—Å–∫–∞ Java –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤—å —Ñ–ª–∞–≥ `-Dplantuml.smetana=true`. –≠—Ç–æ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫ –≥—Ä–∞—Ñ–æ–≤, —á—Ç–æ–±—ã –Ω–µ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Graphviz –≤ —Å–∏—Å—Ç–µ–º—É.

–¢–∞–∫–∂–µ —Ä–µ–∞–ª–∏–∑—É–π –ª–æ–≥–∏–∫—É "—Å–ª–∏—è–Ω–∏—è": –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω–∞ —Ç–µ–º–∞, —Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ –ø—Ä–∏–∫–ª–µ–∏–≤–∞–µ—à—å —Å—Ç—Ä–æ–∫—É `!include path/to/theme` –∫ –Ω–∞—á–∞–ª—É –∫–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ JAR.

### –§–∞–∑–∞ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –°–µ—Ä–≤–µ—Ä (API –°–ª–æ—è) üîå

–¢–µ–ø–µ—Ä—å —É—á–∏–º —Ç–≤–æ–π MCP —Å–µ—Ä–≤–µ—Ä (`server py`) –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–æ–≤—ã–º –¥–≤–∏–∂–∫–æ–º.

–ú—ã –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –Ω–∞–∑–æ–≤–µ–º –µ–≥–æ `generate architecture diagram`.
–í –µ–≥–æ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ –±—É–¥—É—Ç:
- –ö–æ–¥ –¥–∏–∞–≥—Ä–∞–º–º—ã.
- –ü—É—Ç—å –≤—ã—Ö–æ–¥–∞.
- –§–æ—Ä–º–∞—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é PNG).
- –ò–º—è —Ç–µ–º—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `default`).

–í–Ω—É—Ç—Ä–∏ —ç—Ç–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è:
1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—É—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–π (–∫–∞–∫ –º—ã –¥–µ–ª–∞–ª–∏ —Ä–∞–Ω—å—à–µ).
2. –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–æ–≤–µ—Ä–∫–∏ Java (–µ—Å–ª–∏ –µ—ë –Ω–µ—Ç ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫—Ä–∞—Å–∏–≤—É—é –æ—à–∏–±–∫—É —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ JRE").
3. –ù–∞—Ö–æ–¥–∏–º –ø—É—Ç—å –∫ —Ç–µ–º–µ –≤ `asset themes`.
4. –í—ã–∑—ã–≤–∞–µ–º –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∏–∑ –≤—Ç–æ—Ä–æ–π —Ñ–∞–∑—ã.
5. –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–ª–∏ –æ—à–∏–±–∫—É —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ (PlantUML –æ–±—ã—á–Ω–æ –ø–∏—à–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –ø—Ä—è–º–æ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ, –Ω–æ –µ—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å —É–ø–∞–ª, –Ω–∞–º –Ω—É–∂–Ω–æ —ç—Ç–æ –ø–æ–π–º–∞—Ç—å).

### –§–∞–∑–∞ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ "–ó–∞—â–∏—Ç–∞ –æ—Ç –î—É—Ä–∞–∫–∞" üõ°Ô∏è

–≠—Ç–æ —ç—Ç–∞–ø –ø–æ–ª–∏—Ä–æ–≤–∫–∏.

–í–æ-–ø–µ—Ä–≤—ã—Ö, –ø—Ä–æ–≤–µ—Ä—å –∫–∏—Ä–∏–ª–ª–∏—Ü—É. Java –∏ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ Windows –∏–Ω–æ–≥–¥–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ —á–µ—Ä–µ–∑ `stdin` —Ç—ã —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ—à—å –∫–æ–¥–∏—Ä–æ–≤–∫—É UTF-8, –∏ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –∑–∞–ø—É—Å–∫–∞ JAR —Ç–æ–∂–µ —Å—Ç–æ–∏—Ç `-charset UTF-8`. –ò–Ω–∞—á–µ –¥–∏–∞–≥—Ä–∞–º–º—ã —Å —Ä—É—Å—Å–∫–∏–º —Ç–µ–∫—Å—Ç–æ–º –ø—Ä–µ–≤—Ä–∞—Ç—è—Ç—Å—è –≤ –∫—Ä–∞–∫–æ–∑—è–±—Ä—ã.

–í–æ-–≤—Ç–æ—Ä—ã—Ö, –ø–æ–¥—É–º–∞–π –æ —à—Ä–∏—Ñ—Ç–∞—Ö. PlantUML –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã. –ï—Å–ª–∏ —Ç—ã –≤ —Ç–µ–º–µ –ø—Ä–æ–ø–∏—à–µ—à—å `JetBrains Mono`, –∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ) –µ–≥–æ –Ω–µ—Ç, Java –ø–æ–¥—Å—Ç–∞–≤–∏—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —à—Ä–∏—Ñ—Ç. –í–æ–∑–º–æ–∂–Ω–æ, —Å—Ç–æ–∏—Ç –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —à—Ä–∏—Ñ—Ç, –Ω–æ –¥–ª—è –Ω–∞—á–∞–ª–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Å–µ–º–µ–π—Å—Ç–≤–∞ –∏–ª–∏ —Ç–µ, —á—Ç–æ —Ç–æ—á–Ω–æ –µ—Å—Ç—å.

### –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–æ–≤ –∏ –º–æ–¥—É–ª–µ–π

–í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —É —Ç–µ–±—è –ø–æ—è–≤–∏—Ç—Å—è –Ω–æ–≤—ã–π —Ñ–∞–π–ª `diagram renderer py`.
–ü–∞–ø–∫–∞ `asset` —Å—Ç–∞–Ω–µ—Ç –±–æ–≥–∞—á–µ:
- `asset / fonts /` (—Ç–≤–æ–∏ TTF)
- `asset / bins / plantuml.jar` (–¥–≤–∏–∂–æ–∫)
- `asset / themes / dark.puml` (—Ç–≤–æ—è —Ç–µ–º–∞)

–ú–æ–¥—É–ª—å `server py` –ø—Ä–æ—Å—Ç–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ `diagram renderer py`, —Å–æ—Ö—Ä–∞–Ω—è—è —á–∏—Å—Ç–æ—Ç—É –∫–æ–¥–∞.
```

## `doc/ideas/–°–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –∏–¥–µ—è–º –ø—Ä–æ–µ–∫—Ç–∞.md`

```md
# –ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è –ø—Ä–æ–µ–∫—Ç–∞ Code to Image MCP

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ (29 –Ω–æ—è–±—Ä—è 2025)

**Code to Image MCP** - –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π MCP —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞ –∏ –¥–∏–∞–≥—Ä–∞–º–º.

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞ (Pygments + Pillow)
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PlantUML –¥–∏–∞–≥—Ä–∞–º–º (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Smetana, –±–µ–∑ Graphviz)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤: WEBP, PNG, JPEG –¥–ª—è –∫–æ–¥–∞
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤: PNG, SVG, EPS, PDF –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º
- ‚úÖ –ë–∞–∑–æ–≤–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `scale_factor` (3x –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- ‚úÖ –ú–µ–Ω–µ–¥–∂–µ—Ä —à—Ä–∏—Ñ—Ç–æ–≤ (JetBrainsMono, FiraCode, CascadiaCode)
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å —ç–º–æ–¥–∑–∏-–ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏
- ‚úÖ –û–¥–Ω–∞ —Ç–µ–º–∞ PlantUML (`default.puml`)

### ‚ùå –¢—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è

- ‚ùå –¢–µ–∫—É—â–∞—è —Ç–µ–º–∞ –≤—ã–≥–ª—è–¥–∏—Ç "—Ä–æ–±–æ—Ç—Å–∫–æ–π" –∏ –Ω–µ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π
- ‚ùå AI-–º–æ–¥–µ–ª–∏ –¥–µ–ª–∞—é—Ç –∫—Ä–∏–≤—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã (–Ω–µ—Ç –≥–∞–π–¥–æ–≤)
- ‚ùå –ù–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤
- ‚ùå –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è 2K/4K (–º—É—Ç–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
- ‚ùå –£–º–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç

---

## üéØ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π üî¥

**–¶–µ–ª—å:** –û–±–µ—Å–ø–µ—á–∏—Ç—å –∫—Ä–∏—Å—Ç–∞–ª—å–Ω—É—é —á–µ—Ç–∫–æ—Å—Ç—å –¥–ª—è Full HD, 2K –∏ 4K –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π (YouTube –≤ 4K).

#### –ó–∞–¥–∞—á–∏

1. **–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏–∫—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º**
   - **–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ–∫—É—â–∏–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –º—É—Ç–Ω—ã–µ –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö
   - **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `scale_factor` –¥–ª—è PlantUML –¥–∏–∞–≥—Ä–∞–º–º
   - **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
     - –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ PlantUML JAR (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã `-dpi`, `-scale`)
     - –î–æ–±–∞–≤–∏—Ç—å –≤ `render_diagram_from_string()` –ø–∞—Ä–∞–º–µ—Ç—Ä `dpi` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 300)
     - –û–±–Ω–æ–≤–∏—Ç—å MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `generate_architecture_diagram`

2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è WebP —Å–∂–∞—Ç–∏—è –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º**
   - **–ü—Ä–æ–±–ª–µ–º–∞:** PNG –¥–∏–∞–≥—Ä–∞–º–º—ã –ø–æ 2-3 –ú–ë
   - **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É WebP –¥–ª—è PlantUML
   - **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
     - PlantUML —Ä–µ–Ω–¥–µ—Ä–∏—Ç PNG ‚Üí –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ WebP —á–µ—Ä–µ–∑ Pillow
     - –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `quality` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 95)
     - –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ —É—Ç–∏–ª–∏—Ç—É

3. **–°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å `image_utils.py`**
   - **–¶–µ–ª—å:** –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è/—Å–∂–∞—Ç–∏—è
   - **–§—É–Ω–∫—Ü–∏–∏:**
     - `convert_to_webp(png_path, quality=95) -> str` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PNG ‚Üí WebP
     - `scale_image(image_path, scale_factor) -> Image` - –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
   - **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ò –¥–ª—è –∫–æ–¥–∞, –∏ –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º

#### –†–µ–∑—É–ª—å—Ç–∞—Ç

- üìê –î–∏–∞–≥—Ä–∞–º–º—ã –≤—ã—Å–æ–∫–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π
- üíæ –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤ –≤ 3-5 —Ä–∞–∑ –º–µ–Ω—å—à–µ (WebP –≤–º–µ—Å—Ç–æ PNG)
- üîß –ú–æ–¥—É–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–µ–º—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è üü°

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–µ —Ç–µ–º—ã PlantUML –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤.

#### –ó–∞–¥–∞—á–∏

1. **–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ–µ–∫—Ç—ã —Å PlantUML —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–µ–π**
   - **–ò—Å—Ç–æ—á–Ω–∏–∫:** –ü—Ä–æ–µ–∫—Ç—ã —Å –ª–µ–∫—Ü–∏—è–º–∏ –¥–ª—è –¥–µ—Ç–µ–π ("–º–∞—Ç—ë—Ä—ã–π CSS")
   - **–ß—Ç–æ –∏–∑–≤–ª–µ—á—å:**
     - –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç–µ–π —Å—Ç—Ä–µ–ª–æ–∫
     - –°—Ç–∏–ª–µ–≤–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –±–ª–æ–∫–æ–≤, –∫–ª–∞—Å—Å–æ–≤
     - –¶–≤–µ—Ç–æ–≤—ã–µ —Å—Ö–µ–º—ã –∏ —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è
   - **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AI-–∞–≥–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –∞—Ä—Ö–∏–≤–∞—Ö

2. **–°–æ–∑–¥–∞—Ç—å 3-4 –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–µ–º—ã PlantUML**
   - **–§–∞–π–ª—ã –≤ `asset/themes/`:**
     - `dark.puml` - —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ (–æ—Å–Ω–æ–≤–Ω–∞—è)
     - `light.puml` - —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞
     - `green.puml` - –∑–µ–ª—ë–Ω–∞—è –∞–∫—Ü–µ–Ω—Ç–Ω–∞—è —Ç–µ–º–∞
     - `purple.puml` - —Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è –∞–∫—Ü–µ–Ω—Ç–Ω–∞—è —Ç–µ–º–∞
   - **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
     - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à—Ä–∏—Ñ—Ç—ã JetBrainsMono/FiraCode –∏–∑ `asset/fonts/`
     - –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è, –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã
     - –ß—ë—Ç–∫–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è —Ü–≤–µ—Ç–æ–≤ (–∑–∞–≥–æ–ª–æ–≤–∫–∏, —Ç–µ–ª–æ, —Å–≤—è–∑–∏)
     - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö —Ç–∏–ø–∞—Ö –¥–∏–∞–≥—Ä–∞–º–º (class, sequence, component)

3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤**
   - **–°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `doc/plantuml_guides/`:**

     ```
     doc/plantuml_guides/
     ‚îú‚îÄ‚îÄ class_diagram.md        # –î–∏–∞–≥—Ä–∞–º–º—ã –∫–ª–∞—Å—Å–æ–≤
     ‚îú‚îÄ‚îÄ sequence_diagram.md     # –î–∏–∞–≥—Ä–∞–º–º—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
     ‚îú‚îÄ‚îÄ component_diagram.md    # –î–∏–∞–≥—Ä–∞–º–º—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
     ‚îú‚îÄ‚îÄ activity_diagram.md     # –î–∏–∞–≥—Ä–∞–º–º—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
     ‚îî‚îÄ‚îÄ themes_overview.md      # –û–±–∑–æ—Ä —Ç–µ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
     ```

   - **–§–æ—Ä–º–∞—Ç –∫–∞–∂–¥–æ–≥–æ –≥–∞–π–¥–∞:**
     - **Brief —Å–µ–∫—Ü–∏—è:** –°–∂–∞—Ç–∞—è —Å–ø—Ä–∞–≤–∫–∞ (3-5 —Å—Ç—Ä–æ–∫), —Ñ–ª–∞–≥–∏ –∏ –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è
     - **Detailed —Å–µ–∫—Ü–∏—è:** –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞
     - **Common Mistakes:** –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ AI-–º–æ–¥–µ–ª–µ–π
     - **Best Practices:** –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å—Ç–∏–ª—é

4. **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—å–Ω–æ—Å—Ç–∏**
   - **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**

     ```
     code_to_image_mcp/
     ‚îú‚îÄ‚îÄ server.py                    # MCP —Å–µ—Ä–≤–µ—Ä (—Ç–æ–ª—å–∫–æ –∑–∞–ø—É—Å–∫)
     ‚îú‚îÄ‚îÄ src/
     ‚îÇ   ‚îú‚îÄ‚îÄ tools/                   # MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (—Ç–æ–Ω–∫–∏–π —Å–ª–æ–π)
     ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ code_screenshot.py
     ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ diagram_generator.py
     ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ plantuml_guide.py    # –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≥–∞–π–¥–æ–≤
     ‚îÇ   ‚îú‚îÄ‚îÄ utils/                   # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
     ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ code_renderer.py
     ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ diagram_renderer.py
     ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ image_utils.py       # –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ/—Å–∂–∞—Ç–∏–µ
     ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ font_manager.py
     ‚îÇ   ‚îî‚îÄ‚îÄ constants.py
     ‚îú‚îÄ‚îÄ asset/
     ‚îÇ   ‚îú‚îÄ‚îÄ fonts/
     ‚îÇ   ‚îú‚îÄ‚îÄ bins/
     ‚îÇ   ‚îî‚îÄ‚îÄ themes/                  # 4 —Ç–µ–º—ã
     ‚îî‚îÄ‚îÄ doc/
         ‚îî‚îÄ‚îÄ plantuml_guides/         # –ì–∞–π–¥—ã –¥–ª—è AI
     ```

#### –†–µ–∑—É–ª—å—Ç–∞—Ç

- üé® 4 –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ–º—ã PlantUML
- üìö –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤
- üèóÔ∏è –°–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ –º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∑–∂–µ)

---

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≥–∞–π–¥–æ–≤ PlantUML üü¢

**–¶–µ–ª—å:** MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≥–∞–π–¥–æ–≤ –ø–æ —Ç–∏–ø–∞–º –¥–∏–∞–≥—Ä–∞–º–º (—Ç–µ–ø–µ—Ä—å –µ—Å—Ç—å —á—Ç–æ —Ä–∞–∑–¥–∞–≤–∞—Ç—å!).

#### –ó–∞–¥–∞—á–∏

1. **–°–æ–∑–¥–∞—Ç—å MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `get_plantuml_guide`**
   - **–§–∞–π–ª:** `src/tools/plantuml_guide.py` (–±—É–¥—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞) –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ `server.py`
   - **–°–∏–≥–Ω–∞—Ç—É—Ä–∞:**

     ```python
     @mcp.tool()
     def get_plantuml_guide(
         diagram_type: Literal["class", "sequence", "component", "activity"],
         detail_level: Literal["brief", "detailed"] = "brief"
     ) -> str:
         """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–∞–π–¥ –ø–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—é PlantUML –¥–∏–∞–≥—Ä–∞–º–º.
         
         Args:
             diagram_type: –¢–∏–ø –¥–∏–∞–≥—Ä–∞–º–º—ã
             detail_level: –£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ (brief - —Å–∂–∞—Ç–∞—è —Å–ø—Ä–∞–≤–∫–∞, detailed - —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏)
         
         Returns:
             –¢–µ–∫—Å—Ç –≥–∞–π–¥–∞ –∏–∑ doc/plantuml_guides/
         """
     ```

   - **–õ–æ–≥–∏–∫–∞:**
     - –ß–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª `doc/plantuml_guides/{diagram_type}_diagram.md`
     - –ü–∞—Ä—Å–∏—Ç —Å–µ–∫—Ü–∏–∏ `# Brief` –∏–ª–∏ `# Detailed` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç `detail_level`
     - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –≥–∞–π–¥–∞

2. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ `generate_architecture_diagram`**
   - **–ü—Ä–∏ PlantUMLSyntaxError:**

     ```python
     return {
         "success": False,
         "error": str(e),
         "suggestion": (
             "–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ PlantUML –∫–æ–¥–µ. "
             "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç get_plantuml_guide –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø—Ä–∞–≤–∫–∏. "
             f"–ù–∞–ø—Ä–∏–º–µ—Ä: get_plantuml_guide(diagram_type='class', detail_level='detailed')"
         )
     }
     ```

   - **–ü—Ä–∏ PlantUMLRenderError:**

     ```python
     return {
         "success": False,
         "error": str(e),
         "suggestion": "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Java –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å PlantUML –∫–æ–¥–∞."
     }
     ```

3. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `list_plantuml_themes`**
   - **–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
   - **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

     ```python
     @mcp.tool()
     def list_plantuml_themes() -> dict:
         """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ–º PlantUML —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏."""
         return {
             "themes": [
                 {"name": "dark", "description": "–¢—ë–º–Ω–∞—è —Ç–µ–º–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)"},
                 {"name": "light", "description": "–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞"},
                 {"name": "green", "description": "–ó–µ–ª—ë–Ω–∞—è –∞–∫—Ü–µ–Ω—Ç–Ω–∞—è —Ç–µ–º–∞"},
                 {"name": "purple", "description": "–§–∏–æ–ª–µ—Ç–æ–≤–∞—è –∞–∫—Ü–µ–Ω—Ç–Ω–∞—è —Ç–µ–º–∞"}
             ]
         }
     ```

#### –†–µ–∑—É–ª—å—Ç–∞—Ç

- ü§ñ AI-–∞–≥–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≥–∞–π–¥—ã –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é
- üí° –£–º–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
- üé® –£–¥–æ–±–Ω—ã–π –≤—ã–±–æ—Ä —Ç–µ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è

---

## üìã –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–∞–±–æ—Ç

### –≠—Ç–∞–ø 1: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (1-2 –¥–Ω—è)

1. ‚úÖ –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å PlantUML –ø–∞—Ä–∞–º–µ—Ç—Ä—ã DPI/scale
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å `src/utils/image_utils.py`
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å `scale_factor`/`dpi` –≤ `diagram_renderer.py`
4. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å WebP –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º
5. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å `generate_architecture_diagram` —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
6. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 2K/4K

### –≠—Ç–∞–ø 2: –¢–µ–º—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (3-5 –¥–Ω–µ–π)

1. ‚úÖ –ü–æ–∏—Å–∫ —Å—Ç–∞—Ä—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ —Å PlantUML —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–µ–π
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å `dark.puml`, `light.puml`, `green.puml`, `purple.puml`
3. ‚úÖ –ù–∞–ø–∏—Å–∞—Ç—å –≥–∞–π–¥—ã:
   - `class_diagram.md`
   - `sequence_diagram.md`
   - `component_diagram.md`
   - `activity_diagram.md`
   - `themes_overview.md`
4. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–º –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–∞—Ö –¥–∏–∞–≥—Ä–∞–º–º
5. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å README —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–µ–º

### –≠—Ç–∞–ø 3: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≥–∞–π–¥–æ–≤ (1-2 –¥–Ω—è)

1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `get_plantuml_guide()`
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `list_plantuml_themes()`
3. ‚úÖ –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏
4. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ README
5. ‚úÖ –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

---

## üöÄ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (–ø–æ—Å–ª–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–ª–∞–Ω–∞)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥

- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ `src/tools/` –∏ `src/utils/`
- –ß–∏—Å—Ç—ã–π –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
- –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∏–∞–≥—Ä–∞–º–º
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `.puml` —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
- CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–º–∏–º–æ MCP
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Mermaid –¥–∏–∞–≥—Ä–∞–º–º?

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

- –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ ‚â•80%
- Pre-commit hooks (black, ruff, pytest)
- GitHub Actions CI/CD
- Type hints + mypy –ø—Ä–æ–≤–µ—Ä–∫–∞

---

## üéØ –§–∏–ª–æ—Å–æ—Ñ–∏—è –ø—Ä–æ–µ–∫—Ç–∞

- **–ú–∏–Ω–∏–º–∞–ª–∏–∑–º:** –ú–∏–Ω–∏–º—É–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –º–∞–∫—Å–∏–º—É–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- **–ö–∞—á–µ—Å—Ç–≤–æ:** –ö—Ä–∏—Å—Ç–∞–ª—å–Ω–æ —á—ë—Ç–∫–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π
- **–£–¥–æ–±—Å—Ç–≤–æ:** –î–ª—è –ª—é–¥–µ–π –ò AI-–∞–≥–µ–Ω—Ç–æ–≤
- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å:** –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 29 –Ω–æ—è–±—Ä—è 2025 –≥–æ–¥–∞  
**–ò—Å—Ç–æ—á–Ω–∏–∫–∏:** –ê–Ω–∞–ª–∏–∑ –∞—É–¥–∏–æ-–∑–∞–ø–∏—Å–µ–π "MCP code to image.m4a" –∏ "MCP to image p2.m4a"  
**–°—Ç–∞—Ç—É—Å:** –ü–ª–∞–Ω —É—Ç–≤–µ—Ä–∂–¥—ë–Ω, –≥–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

```

## `doc/mcp-tools-guide.md`

```md
# –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

<div align="center">

# üõ†Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –æ—Ç –ê –¥–æ –Ø

**–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –ª–æ–∫–∞–ª—å–Ω—ã—Ö MCP —Å–µ—Ä–≤–µ—Ä–æ–≤**

[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![MCP](https://img.shields.io/badge/MCP-1.0+-green.svg)](https://modelcontextprotocol.io)

</div>

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ MCP —Å–µ—Ä–≤–µ—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-mcp-—Å–µ—Ä–≤–µ—Ä–∞)
- [–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤](#—Å–æ–∑–¥–∞–Ω–∏–µ-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ-–æ—Ç–≤–µ—Ç—ã)
- [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∫–ª—é—á–∏ API](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-–∏-–∫–ª—é—á–∏-api)
- [–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏](#–ª—É—á—à–∏–µ-–ø—Ä–∞–∫—Ç–∏–∫–∏)
- [–ü—Ä–∏–º–µ—Ä—ã](#–ø—Ä–∏–º–µ—Ä—ã)

---

## üéØ –í–≤–µ–¥–µ–Ω–∏–µ

### üìö ID –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤ Context7

**`/modelcontextprotocol/python-sdk`** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç ID –¥–ª—è –ø–æ–∏—Å–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ MCP Python SDK –≤ Context7

### –ß—Ç–æ —Ç–∞–∫–æ–µ MCP?

**Model Context Protocol (MCP)** - —ç—Ç–æ –æ—Ç–∫—Ä—ã—Ç—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è AI-–∞–≥–µ–Ω—Ç–∞–º–∏. MCP —Å–µ—Ä–≤–µ—Ä—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ —Ä–µ—Å—É—Ä—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –∞–≥–µ–Ω—Ç—ã –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á.

### –ó–∞—á–µ–º —Å–æ–∑–¥–∞–≤–∞—Ç—å MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã?

- **–õ–æ–∫–∞–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –≤–∞—à–µ–π –º–∞—à–∏–Ω–µ
- **–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å** - –¥–∞–Ω–Ω—ã–µ –Ω–µ —É—Ö–æ–¥—è—Ç –≤ –æ–±–ª–∞–∫–æ
- **–ì–∏–±–∫–æ—Å—Ç—å** - –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ª—é–±—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã
- **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è** - –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

- **–°–µ—Ä–≤–µ—Ä** - –ø—Ä–æ–≥—Ä–∞–º–º–∞, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∞—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç** - —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å AI-–∞–≥–µ–Ω—Ç
- **–†–µ—Å—É—Ä—Å** - –¥–∞–Ω–Ω—ã–µ, –∫ –∫–æ—Ç–æ—Ä—ã–º –º–æ–∂–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è —Å–µ—Ä–≤–µ—Ä
- **–ü—Ä–æ–º–ø—Ç** - —à–∞–±–ª–æ–Ω—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π MCP —Å–µ—Ä–≤–µ—Ä

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `simple_server.py`:

```python
"""–ü—Ä–æ—Å—Ç–æ–π MCP —Å–µ—Ä–≤–µ—Ä —Å –æ–¥–Ω–∏–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º."""

from mcp.server.fastmcp import FastMCP

# –°–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–µ—Ä —Å –∏–º–µ–Ω–µ–º
mcp = FastMCP("Simple Server")

@mcp.tool()
def add_numbers(a: int, b: int) -> int:
    """–°–ª–æ–∂–∏—Ç—å –¥–≤–∞ —á–∏—Å–ª–∞ –∏ –≤–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
    
    Args:
        a: –ü–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ –¥–ª—è —Å–ª–æ–∂–µ–Ω–∏—è
        b: –í—Ç–æ—Ä–æ–µ —á–∏—Å–ª–æ –¥–ª—è —Å–ª–æ–∂–µ–Ω–∏—è
        
    Returns:
        –°—É–º–º–∞ –¥–≤—É—Ö —á–∏—Å–µ–ª
    """
    return a + b

if __name__ == "__main__":
    mcp.run()
```

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
python simple_server.py
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Cline

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞, Cline —Å–º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `add_numbers`:

```
"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–ª–æ–∂–∏ 5 –∏ 7 –∏—Å–ø–æ–ª—å–∑—É—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç add_numbers"
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ MCP —Å–µ—Ä–≤–µ—Ä–∞

### –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
my-mcp-server/
‚îú‚îÄ‚îÄ server.py              # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ config.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ requirements.txt       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ tools/                 # –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ calculator.py      # –ü—Ä–∏–º–µ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
‚îú‚îÄ‚îÄ models/                # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ responses.py       # –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
‚îî‚îÄ‚îÄ utils/                 # –£—Ç–∏–ª–∏—Ç—ã
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îî‚îÄ‚îÄ api_client.py      # –ö–ª–∏–µ–Ω—Ç—ã API
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **server.py** - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
2. **tools/** - –º–æ–¥—É–ª–∏ —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏
3. **models/** - Pydantic –º–æ–¥–µ–ª–∏ –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
4. **utils/** - –æ–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã –∏ –∫–ª–∏–µ–Ω—Ç—ã API

---

## üõ†Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

### –ë–∞–∑–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç

```python
from mcp.server.fastmcp import FastMCP

mcp = FastMCP("Example Server")

@mcp.tool()
def greet_user(name: str, style: str = "friendly") -> str:
    """–ü–æ–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º —Å—Ç–∏–ª–µ.
    
    Args:
        name: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
        style: –°—Ç–∏–ª—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è (friendly, formal, casual)
        
    Returns:
        –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    """
    styles = {
        "friendly": f"–ü—Ä–∏–≤–µ—Ç, {name}! –ö–∞–∫ –¥–µ–ª–∞?",
        "formal": f"–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {name}.",
        "casual": f"–ô–æ, {name}! –ß—Ç–æ –Ω–æ–≤–æ–≥–æ?"
    }
    return styles.get(style, f"–ü—Ä–∏–≤–µ—Ç, {name}!")
```

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:

- **–î–æ–∫—Å—Ç—Ä–∏–Ω–≥** —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ–¥—Å–∫–∞–∑–∫–æ–π –¥–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤
- **–¢–∏–ø—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç —Å—Ö–µ–º—É
- **–ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** –¥–µ–ª–∞—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Pydantic –º–æ–¥–µ–ª–µ–π

```python
from pydantic import BaseModel, Field
from typing import Optional

class WeatherInfo(BaseModel):
    """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–≥–æ–¥–µ."""
    
    temperature: float = Field(..., description="–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ –≥—Ä–∞–¥—É—Å–∞—Ö –¶–µ–ª—å—Å–∏—è")
    condition: str = Field(..., description="–ü–æ–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è")
    humidity: Optional[float] = Field(None, description="–í–ª–∞–∂–Ω–æ—Å—Ç—å –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö")
    wind_speed: Optional[float] = Field(None, description="–°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞ –≤ –º/—Å")

@mcp.tool()
def get_weather(city: str) -> WeatherInfo:
    """–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–≥–æ–¥–µ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –≥–æ—Ä–æ–¥–µ.
    
    Args:
        city: –ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã
        
    Returns:
        –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–≥–æ–¥–µ
    """
    # –ó–¥–µ—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–æ–≤ API –ø–æ–≥–æ–¥—ã
    return WeatherInfo(
        temperature=22.5,
        condition="—Å–æ–ª–Ω–µ—á–Ω–æ",
        humidity=45.0,
        wind_speed=3.2
    )
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** –¥–∞–Ω–Ω—ã—Ö
- **–ß–µ—Ç–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** –ø–æ–ª–µ–π —á–µ—Ä–µ–∑ Field(description=...)
- **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å** —Ñ–æ—Ä–º–∞—Ç–∞ –æ—Ç–≤–µ—Ç–æ–≤
- **–õ–µ–≥–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** —Å –¥—Ä—É–≥–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

---

## ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

```python
from pydantic import BaseModel, Field

class ErrorResponse(BaseModel):
    """–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –æ–± –æ—à–∏–±–∫–µ."""
    
    error: str = Field(..., description="–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏")
    details: Optional[str] = Field(None, description="–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏")
    suggestion: Optional[str] = Field(None, description="–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é")

@mcp.tool()
def divide_numbers(a: float, b: float) -> float | ErrorResponse:
    """–†–∞–∑–¥–µ–ª–∏—Ç—å –¥–≤–∞ —á–∏—Å–ª–∞.
    
    Args:
        a: –î–µ–ª–∏–º–æ–µ
        b: –î–µ–ª–∏—Ç–µ–ª—å
        
    Returns:
        –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ–ª–µ–Ω–∏—è –∏–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ
    """
    try:
        if b == 0:
            return ErrorResponse(
                error="–î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å",
                details="–ü–∞—Ä–∞–º–µ—Ç—Ä b –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–≤–µ–Ω 0",
                suggestion="–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–µ–Ω—É–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è b"
            )
        return a / b
    except Exception as e:
        return ErrorResponse(
            error="–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–µ–ª–µ–Ω–∏–∏",
            details=str(e)
        )
```

### –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫:

- **–í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏**
- **–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–π—Ç–µ –ø–æ–ª–µ–∑–Ω—ã–µ –¥–µ—Ç–∞–ª–∏** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- **–í–∫–ª—é—á–∞–π—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è** –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é
- **–õ–æ–≥–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫–∏** –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

---

## üîë –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∫–ª—é—á–∏ API

### –ì–∏–±–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ API –∫–ª—é—á–µ–π

```python
"""config.py - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∏ API –∫–ª—é—á–∞–º–∏"""

import os
from typing import Optional

def get_api_key(api_name: str) -> str:
    """–ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.
    
    Args:
        api_name: –ù–∞–∑–≤–∞–Ω–∏–µ API (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'OPENAI', 'GEMINI')
        
    Returns:
        API –∫–ª—é—á
        
    Raises:
        ValueError: –ï—Å–ª–∏ –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω
    """
    env_var_name = f"{api_name}_API_KEY"
    api_key = os.getenv(env_var_name)
    
    if not api_key:
        raise ValueError(
            f"–ö–ª—é—á {env_var_name} –Ω–µ –Ω–∞–π–¥–µ–Ω. "
            f"–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ –∫–∞–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ "
            f"–ø–µ—Ä–µ–¥–∞–π—Ç–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–ª–∏–µ–Ω—Ç–∞ MCP."
        )
    
    return api_key

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–µ
@mcp.tool()
def analyze_with_openai(text: str) -> str:
    """–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç —Å –ø–æ–º–æ—â—å—é OpenAI API.
    
    Args:
        text: –¢–µ–∫—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
        
    Returns:
        –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞
    """
    try:
        api_key = get_api_key("OPENAI")
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º api_key –¥–ª—è –≤—ã–∑–æ–≤–∞ OpenAI API
        return f"–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω –¥–ª—è —Ç–µ–∫—Å—Ç–∞: {text}"
    except ValueError as e:
        return f"–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: {e}"
```

### –ü–µ—Ä–µ–¥–∞—á–∞ –∫–ª—é—á–µ–π —á–µ—Ä–µ–∑ –∫–ª–∏–µ–Ω—Ç

–ö–ª—é—á–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞:

```json
{
  "mcpServers": {
    "my-server": {
      "command": "python",
      "args": ["/path/to/server.py"],
      "env": {
        "OPENAI_API_KEY": "your-openai-key-here",
        "GEMINI_API_KEY": "your-gemini-key-here"
      }
    }
  }
}
```

---

## üìù –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

**–•–æ—Ä–æ—à–∏–π –¥–æ–∫—Å—Ç—Ä–∏–Ω–≥:**
```python
@mcp.tool()
def calculate_bmi(weight: float, height: float) -> dict:
    """–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏–Ω–¥–µ–∫—Å –º–∞—Å—Å—ã —Ç–µ–ª–∞ (BMI).
    
    BMI —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –≤–µ—Å –≤ –∫–∏–ª–æ–≥—Ä–∞–º–º–∞—Ö, –¥–µ–ª–µ–Ω–Ω—ã–π –Ω–∞ 
    –∫–≤–∞–¥—Ä–∞—Ç —Ä–æ—Å—Ç–∞ –≤ –º–µ—Ç—Ä–∞—Ö.
    
    Args:
        weight: –í–µ—Å –≤ –∫–∏–ª–æ–≥—Ä–∞–º–º–∞—Ö (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 0)
        height: –†–æ—Å—Ç –≤ –º–µ—Ç—Ä–∞—Ö (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 0)
        
    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏:
        - bmi: –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å –º–∞—Å—Å—ã —Ç–µ–ª–∞
        - category: –ö–∞—Ç–µ–≥–æ—Ä–∏—è BMI (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π, –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π, –∏–∑–±—ã—Ç–æ—á–Ω—ã–π)
        - description: –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        
    Raises:
        ValueError: –ï—Å–ª–∏ –≤–µ—Å –∏–ª–∏ —Ä–æ—Å—Ç –Ω–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞
    """
    if weight <= 0 or height <= 0:
        raise ValueError("–í–µ—Å –∏ —Ä–æ—Å—Ç –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏")
    
    bmi = weight / (height ** 2)
    
    if bmi < 18.5:
        category = "–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –≤–µ—Å"
    elif bmi < 25:
        category = "–Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –≤–µ—Å"
    elif bmi < 30:
        category = "–∏–∑–±—ã—Ç–æ—á–Ω—ã–π –≤–µ—Å"
    else:
        category = "–æ–∂–∏—Ä–µ–Ω–∏–µ"
    
    return {
        "bmi": round(bmi, 2),
        "category": category,
        "description": f"–í–∞—à BMI {bmi:.1f} —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ '{category}'"
    }
```

### –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ö–æ—Ä–æ—à–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

1. **–ß–µ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ** —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
2. **–ü–æ–¥—Ä–æ–±–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** —Å —Ç–∏–ø–∞–º–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
3. **–ü—Ä–∏–º–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
4. **–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏** –∏ –∏—Ö –ø—Ä–∏—á–∏–Ω—ã
5. **–§–æ—Ä–º—É–ª—ã –∏–ª–∏ –∞–ª–≥–æ—Ä–∏—Ç–º—ã** –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ

---

## üéØ –ü—Ä–∏–º–µ—Ä: –ü–æ–ª–Ω—ã–π MCP —Å–µ—Ä–≤–µ—Ä

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
weather-mcp/
‚îú‚îÄ‚îÄ server.py
‚îú‚îÄ‚îÄ config.py
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ tools/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ weather_tools.py
‚îî‚îÄ‚îÄ models/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îî‚îÄ‚îÄ weather_models.py
```

### server.py
```python
"""MCP —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–≥–æ–¥–æ–π."""

from mcp.server.fastmcp import FastMCP
from tools.weather_tools import get_current_weather, get_weather_forecast

mcp = FastMCP("Weather Server")

# –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
mcp.tool()(get_current_weather)
mcp.tool()(get_weather_forecast)

if __name__ == "__main__":
    mcp.run()
```

### models/weather_models.py
```python
"""–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–≥–æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞."""

from pydantic import BaseModel, Field
from typing import List, Optional
from datetime import datetime

class CurrentWeather(BaseModel):
    """–¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞."""
    
    temperature: float = Field(..., description="–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ ¬∞C")
    condition: str = Field(..., description="–ü–æ–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è")
    humidity: float = Field(..., description="–í–ª–∞–∂–Ω–æ—Å—Ç—å –≤ %")
    wind_speed: float = Field(..., description="–°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞ –≤ –º/—Å")
    feels_like: float = Field(..., description="–û—â—É—â–∞–µ–º–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞")

class ForecastDay(BaseModel):
    """–ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã –Ω–∞ –¥–µ–Ω—å."""
    
    date: str = Field(..., description="–î–∞—Ç–∞ –ø—Ä–æ–≥–Ω–æ–∑–∞")
    max_temp: float = Field(..., description="–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞")
    min_temp: float = Field(..., description="–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞")
    condition: str = Field(..., description="–ü–æ–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è")

class WeatherForecast(BaseModel):
    """–ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π."""
    
    location: str = Field(..., description="–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ")
    current: CurrentWeather = Field(..., description="–¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞")
    forecast: List[ForecastDay] = Field(..., description="–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –¥–Ω–∏")
```

### tools/weather_tools.py
```python
"""–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–≥–æ–¥–æ–π."""

from models.weather_models import CurrentWeather, WeatherForecast, ForecastDay

def get_current_weather(city: str) -> CurrentWeather:
    """–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –ø–æ–≥–æ–¥—É –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞.
    
    Args:
        city: –ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, "London", "New York")
        
    Returns:
        –¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞ –≤ –≥–æ—Ä–æ–¥–µ
        
    Example:
        get_current_weather("London") -> CurrentWeather with London weather
    """
    # –ó–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ —Ä–µ–∞–ª—å–Ω–æ–≥–æ API –ø–æ–≥–æ–¥—ã
    # –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–∏–∫—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    return CurrentWeather(
        temperature=15.5,
        condition="–æ–±–ª–∞—á–Ω–æ",
        humidity=65.0,
        wind_speed=4.2,
        feels_like=14.0
    )

def get_weather_forecast(city: str, days: int = 3) -> WeatherForecast:
    """–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π.
    
    Args:
        city: –ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞
        days: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞ (1-7)
        
    Returns:
        –ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π
    """
    if days < 1 or days > 7:
        raise ValueError("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 7")
    
    current = get_current_weather(city)
    forecast_days = []
    
    for i in range(days):
        forecast_days.append(ForecastDay(
            date=f"2024-01-{10 + i}",
            max_temp=current.temperature + i,
            min_temp=current.temperature - 2 - i,
            condition="–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å"
        ))
    
    return WeatherForecast(
        location=city,
        current=current,
        forecast=forecast_days
    )
```

### requirements.txt
```
mcp>=1.0.0
pydantic>=2.0.0
python-dotenv>=1.0.0
```

---

## üîß –†–µ–∞–ª—å–Ω—ã–π Workflow –∞–≥–µ–Ω—Ç–∞ —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ê–≥–µ–Ω—Ç ‚Üí –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ‚Üí –ê–≥–µ–Ω—Ç ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: "–Ø –¥—É–º–∞—é —á—Ç–æ —è —Ö–æ—á—É –≤ –õ–æ–Ω–¥–æ–Ω. –£–∑–Ω–∞–π –∫–∞–∫–∞—è —Ç–∞–º –±—É–¥–µ—Ç –ø–æ–≥–æ–¥–∞?"
2. **–ê–≥–µ–Ω—Ç**: 
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –í–∏–¥–∏—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `get_weather`
   - –ß–∏—Ç–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞: —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä `city`
   - –§–æ—Ä–º–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É: `get_weather("London")`
3. **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ
4. **–ê–≥–µ–Ω—Ç**: 
   - –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
   - –§–æ—Ä–º–∏—Ä—É–µ—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –û—Ç–≤–µ—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: "–í –õ–æ–Ω–¥–æ–Ω–µ —Å–µ–π—á–∞—Å 15¬∞C, –æ–±–ª–∞—á–Ω–æ, –≤–ª–∞–∂–Ω–æ—Å—Ç—å 65%"

### –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª—å–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ú–Ω–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –∫–æ—à–∫–æ–π"

–ê–≥–µ–Ω—Ç: "–Ø –≤–∏–∂—É —É –≤–∞—Å –µ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –ò—Å–ø–æ–ª—å–∑—É—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç analyze_image –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞."

[–ê–≥–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç analyze_image —Å –∞–±—Å–æ–ª—é—Ç–Ω—ã–º –ø—É—Ç–µ–º –∫ —Ñ–∞–π–ª—É]

–ê–≥–µ–Ω—Ç: "–ù–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —è –≤–∏–∂—É —Ä—ã–∂—É—é –∫–æ—à–∫—É –ø–æ—Ä–æ–¥—ã –º–µ–π–Ω-–∫—É–Ω, 
        —Å–∏–¥—è—â—É—é –Ω–∞ –ø–æ–¥–æ–∫–æ–Ω–Ω–∏–∫–µ. –û–Ω–∞ —Å–º–æ—Ç—Ä–∏—Ç –≤ –æ–∫–Ω–æ, 
        –∑–∞ –∫–æ—Ç–æ—Ä—ã–º –≤–∏–¥–Ω—ã –¥–µ—Ä–µ–≤—å—è –∏ –≥–æ–ª—É–±–æ–µ –Ω–µ–±–æ. 
        –®–µ—Ä—Å—Ç—å –∫–æ—à–∫–∏ –ø—É—à–∏—Å—Ç–∞—è, –≥–ª–∞–∑–∞ –∑–µ–ª–µ–Ω—ã–µ..."
```

---

## ‚öôÔ∏è –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Cline –¥–ª—è MCP —Å–µ—Ä–≤–µ—Ä–æ–≤

### –†–µ–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

```json
{
  "mcpServers": {
    "gemini-media-mcp": {
      "autoApprove": [
        "analyze_image",
        "analyze_audio"
      ],
      "disabled": false,
      "timeout": 300,
      "type": "stdio",
      "command": "C:/PY/gemini-media-mcp/.venv/Scripts/python.exe",
      "args": [
        "C:/PY/gemini-media-mcp/server.py"
      ],
      "env": {
        "GEMINI_API_KEY": "your-gemini-api-key-here",
        "PYTHONIOENCODING": "utf-8",
        "PYTHONUTF8": "1"
      }
    }
  }
}
```

### –ü—Ä–∏–º–µ—Ä –¥–ª—è –ø–æ–≥–æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ —Å API –∫–ª—é—á–æ–º

```json
{
  "mcpServers": {
    "weather-server": {
      "autoApprove": [
        "get_current_weather",
        "get_weather_forecast"
      ],
      "disabled": false,
      "timeout": 60,
      "type": "stdio",
      "command": "C:/projects/weather-mcp/.venv/Scripts/python.exe",
      "args": [
        "C:/projects/weather-mcp/server.py"
      ],
      "env": {
        "WEATHER_API_KEY": "your-weather-api-key-here",
        "OPENWEATHER_API_KEY": "your-openweather-key-here"
      }
    }
  }
}
```

### –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

- **`command`**: –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª (python, node, docker –∏ —Ç.–¥.)
- **`args`**: –ê—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
- **`env`**: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–∞—Ä—Å—è—Ç—Å—è –≤ MCP —Å–µ—Ä–≤–µ—Ä–µ —á–µ—Ä–µ–∑ `os.getenv()`
- **`autoApprove`**: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **`timeout`**: –¢–∞–π–º–∞—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
- **`type`**: –í—Å–µ–≥–¥–∞ `"stdio"` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤

---

## üîë –ö–∞–∫ MCP —Å–µ—Ä–≤–µ—Ä –ø–∞—Ä—Å–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

### –†–µ–∞–ª—å–Ω—ã–π –∫–æ–¥ –∏–∑ –Ω–∞—à–µ–≥–æ config.py

```python
import os

def get_api_key() -> str:
    """
    –ü–æ–ª—É—á–∞–µ—Ç API-–∫–ª—é—á Gemini –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ —Ñ–∞–π–ª–∞ .env.

    –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
    1. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `GEMINI_API_KEY` (–∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Cline)
    2. –§–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ–≤–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ –ø—Ä–æ–µ–∫—Ç–∞ (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

    Returns:
        str: –ù–∞–π–¥–µ–Ω–Ω—ã–π API-–∫–ª—é—á.

    Raises:
        ValueError: –ï—Å–ª–∏ API-–∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∏ –≤ –æ–¥–Ω–æ–º –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.
    """
    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
    api_key = os.getenv("GEMINI_API_KEY")
    if api_key:
        return api_key

    # 2. –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ .env (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
    try:
        from dotenv import load_dotenv
        load_dotenv()
        api_key = os.getenv("GEMINI_API_KEY")
        if api_key:
            return api_key
    except ImportError:
        pass

    # 3. –ï—Å–ª–∏ –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω, –≤—ã–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
    raise ValueError(
        "–ö–ª—é—á GEMINI_API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω. "
        "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ –∫–∞–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ "
        "–ø–µ—Ä–µ–¥–∞–π—Ç–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–ª–∏–µ–Ω—Ç–∞ MCP."
    )

# API –∫–ª—é—á –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –º–æ–¥—É–ª—è
GEMINI_API_KEY = get_api_key()
```

### –ü—Ä–∏–º–µ—Ä –¥–ª—è –ø–æ–≥–æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

```python
"""config.py –¥–ª—è –ø–æ–≥–æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞"""

import os

def get_weather_api_key() -> str:
    """–ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á –¥–ª—è –ø–æ–≥–æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞."""
    api_key = os.getenv("WEATHER_API_KEY")
    if not api_key:
        raise ValueError(
            "–ö–ª—é—á WEATHER_API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω. "
            "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Cline –≤ —Ä–∞–∑–¥–µ–ª–µ env."
        )
    return api_key

def get_openweather_key() -> str:
    """–ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á –¥–ª—è OpenWeather."""
    api_key = os.getenv("OPENWEATHER_API_KEY")
    if not api_key:
        raise ValueError(
            "–ö–ª—é—á OPENWEATHER_API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω. "
            "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Cline."
        )
    return api_key

# –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–ª—é—á–∏ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ
WEATHER_API_KEY = get_weather_api_key()
OPENWEATHER_API_KEY = get_openweather_key()
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö

```python
@mcp.tool()
def get_current_weather(city: str) -> CurrentWeather:
    """–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –ø–æ–≥–æ–¥—É –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞.
    
    Args:
        city: –ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
        
    Returns:
        –¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞ –≤ –≥–æ—Ä–æ–¥–µ
    """
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º API –∫–ª—é—á –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    api_key = WEATHER_API_KEY
    
    # –ó–¥–µ—Å—å —Ä–µ–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ –ø–æ–≥–æ–¥–Ω–æ–≥–æ API
    response = requests.get(
        f"https://api.weather.com/v1/current?city={city}&key={api_key}"
    )
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    return CurrentWeather(
        temperature=response.json()["temp"],
        condition=response.json()["condition"],
        humidity=response.json()["humidity"],
        wind_speed=response.json()["wind_speed"]
    )
```

---

## üîç –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –Ω–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

### –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (tools/image_analyzer.py)

```python
def analyze_image(
    image_path: str,
    user_prompt: str = "",
    model_name: str | None = None,
    system_instruction_name: str = "default",
    system_instruction_override: str | None = None,
    system_instruction_file_path: str | None = None,
) -> ImageAnalysisResponse | ErrorResponse:
    """Analyze images using Google Gemini API.

    Returns structured result with alt-text and detailed analysis.
    Supported formats: JPEG, PNG, GIF, WEBP, HEIC, HEIF

    Args:
        image_path: Absolute path to the image file on local machine.
        user_prompt: Custom analysis request (optional).
        model_name: The Gemini model to use (e.g., "gemini-1.5-flash").
                    Defaults to the one specified in config.py.
        system_instruction_name: Name of predefined system instruction.
        system_instruction_override: Custom system instruction (overrides system_instruction_name).
        system_instruction_file_path: Path to file with system instruction (highest priority).

    Returns:
        Structured analysis response with alt-text and detailed analysis.
        
    Raises:
        ValueError: If image is invalid or system instruction not found.
        FileNotFoundError: If image file or system instruction file not found.
        IOError: If error reading files.
    """
```

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–∞—à–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:

1. **–ê–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏** - –≤—Å–µ –ø—É—Ç–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–º–∏
2. **–ì–∏–±–∫–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∞–π–ª–æ–≤, –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –∏ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–æ–∫
3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏** - –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º ErrorResponse –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
4. **–í–∞–ª–∏–¥–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –º–æ–¥–µ–ª–µ–π Gemini

---

## üö´ –í–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ê–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã

```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å
image_path = "images/photo.jpg"

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å
image_path = "C:/Users/user/Documents/images/photo.jpg"
```

### –ü–µ—Ä–µ–¥–∞—á–∞ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ stdin/stdout

–ù–∞—à —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ **stdio transport**, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:

- **–ù–µ—Ç HTTP —Å–µ—Ä–≤–µ—Ä–∞** - –≤—Å–µ —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞
- **–õ–æ–∫–∞–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–∞ –≤–∞—à–µ–π –º–∞—à–∏–Ω–µ
- **–ë—ã—Å—Ç—Ä–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è** - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```python
# config.py - –Ω–∞—à –ø–æ–¥—Ö–æ–¥ –∫ –∑–∞–≥—Ä—É–∑–∫–µ API –∫–ª—é—á–µ–π
def get_api_key() -> str:
    """–ü–æ–ª—É—á–∞–µ—Ç API-–∫–ª—é—á Gemini –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ —Ñ–∞–π–ª–∞ .env."""
    
    # 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
    api_key = os.getenv("GEMINI_API_KEY")
    if api_key:
        return api_key

    # 2. –§–∞–π–ª .env (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
    try:
        from dotenv import load_dotenv
        load_dotenv()
        api_key = os.getenv("GEMINI_API_KEY")
        if api_key:
            return api_key
    except ImportError:
        pass

    # 3. –û—à–∏–±–∫–∞ –µ—Å–ª–∏ –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω
    raise ValueError("–ö–ª—é—á GEMINI_API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω")
```

---

## üéØ –®–∞–±–ª–æ–Ω –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–±–æ—á–∏–π —Å–µ—Ä–≤–µ—Ä

```python
"""minimal_mcp_server.py - –®–∞–±–ª–æ–Ω –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è MCP —Å–µ—Ä–≤–µ—Ä–∞"""

from mcp.server.fastmcp import FastMCP
from pydantic import BaseModel, Field
from typing import Optional

# –°–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–µ—Ä
mcp = FastMCP("My Tools Server")

# –ú–æ–¥–µ–ª—å –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
class ToolResult(BaseModel):
    """–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞."""
    success: bool = Field(..., description="–£—Å–ø–µ—à–Ω–æ –ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è")
    result: str = Field(..., description="–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏")
    details: Optional[str] = Field(None, description="–î–µ—Ç–∞–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è")

@mcp.tool()
def process_data(input_data: str, method: str = "default") -> ToolResult:
    """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —É–∫–∞–∑–∞–Ω–Ω—ã–º –º–µ—Ç–æ–¥–æ–º.
    
    Args:
        input_data: –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
        method: –ú–µ—Ç–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (default, advanced, simple)
        
    Returns:
        –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    """
    try:
        if method == "default":
            result = f"–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: {input_data}"
        elif method == "advanced":
            result = f"–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞: {input_data.upper()}"
        elif method == "simple":
            result = f"–ü—Ä–æ—Å—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞: {input_data.lower()}"
        else:
            return ToolResult(
                success=False,
                result="",
                details=f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –º–µ—Ç–æ–¥: {method}"
            )
            
        return ToolResult(
            success=True,
            result=result,
            details=f"–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –º–µ—Ç–æ–¥–æ–º '{method}'"
        )
        
    except Exception as e:
        return ToolResult(
            success=False,
            result="",
            details=f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: {str(e)}"
        )

if __name__ == "__main__":
    mcp.run()
```

### requirements.txt –¥–ª—è —à–∞–±–ª–æ–Ω–∞
```
mcp>=1.0.0
pydantic>=2.0.0
```

---

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å Python –ø—Ä–æ–µ–∫—Ç, –¥–æ–±–∞–≤–∏—Ç—å MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ:

```python
# existing_project.py
from mcp.server.fastmcp import FastMCP

# –í–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
def existing_function(data: str) -> dict:
    """–°—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è."""
    return {"processed": data.upper(), "length": len(data)}

# –°–æ–∑–¥–∞–µ–º MCP —Å–µ—Ä–≤–µ—Ä
mcp = FastMCP("Existing Project Tools")

# –û–±–µ—Ä—Ç—ã–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
@mcp.tool()
def process_with_existing(data: str) -> dict:
    """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–µ–π.
    
    Args:
        data: –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
        
    Returns:
        –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏
    """
    return existing_function(data)

if __name__ == "__main__":
    mcp.run()
```

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –¥–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤

1. **MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø—Ä–æ—Å—Ç—ã –≤ —Å–æ–∑–¥–∞–Ω–∏–∏** - –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ `@mcp.tool()`
2. **–î–æ–∫—Å—Ç—Ä–∏–Ω–≥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–µ–Ω** - —ç—Ç–æ –ø–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤
3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã** —É–ª—É—á—à–∞—é—Ç –∫–∞—á–µ—Å—Ç–≤–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
4. **–ê–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏
5. **–õ–æ–∫–∞–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å
6. **–ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ?

1. **–ù–∞—á–Ω–∏—Ç–µ —Å –ø—Ä–æ—Å—Ç–æ–≥–æ** - —Å–æ–∑–¥–∞–π—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —Å 1-2 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã** - Pydantic –º–æ–¥–µ–ª–∏ –≤–∞—à –¥—Ä—É–≥
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å Cline** - —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. **–†–∞—Å—à–∏—Ä—è–π—Ç–µ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ** - –¥–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### –ü–æ–º–Ω–∏—Ç–µ!

> "–õ—É—á—à–∏–π MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç - —ç—Ç–æ —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ—à–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∑–∞–¥–∞—á—É –ø—Ä–æ—Å—Ç–æ –∏ –Ω–∞–¥–µ–∂–Ω–æ. –ù–µ —É—Å–ª–æ–∂–Ω—è–π—Ç–µ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏."

---

<div align="center">

## üöÄ –ì–æ—Ç–æ–≤—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã?

**–ù–∞—á–Ω–∏—Ç–µ —Å –Ω–∞—à–µ–≥–æ —à–∞–±–ª–æ–Ω–∞ –∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∑–∞ 5 –º–∏–Ω—É—Ç!**

[üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è MCP](https://modelcontextprotocol.io) ‚Ä¢ 
[üêç Python SDK](https://github.com/modelcontextprotocol/python-sdk) ‚Ä¢ 
[üí° –ü—Ä–∏–º–µ—Ä—ã](https://github.com/modelcontextprotocol/servers)

</div>

```

## `doc/plantuml_guides/activity_diagram.md`

```md
# Activity Diagram Guide

<!-- BRIEF_START -->
**–°–∏–Ω—Ç–∞–∫—Å–∏—Å –±–∞–∑–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤:**

```plantuml
start
:–î–µ–π—Å—Ç–≤–∏–µ;
stop
```

**–£—Å–ª–æ–≤–∏—è:**

```plantuml
if (—É—Å–ª–æ–≤–∏–µ?) then (–¥–∞)
    :–î–µ–π—Å—Ç–≤–∏–µ A;
else (–Ω–µ—Ç)
    :–î–µ–π—Å—Ç–≤–∏–µ B;
endif
```

**–¶–∏–∫–ª—ã:**

```plantuml
while (—É—Å–ª–æ–≤–∏–µ?) is (–¥–∞)
    :–ü–æ–≤—Ç–æ—Ä—è—é—â–µ–µ—Å—è –¥–µ–π—Å—Ç–≤–∏–µ;
endwhile (–Ω–µ—Ç)
```

**–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å:**

```plantuml
fork
    :–î–µ–π—Å—Ç–≤–∏–µ A;
fork again
    :–î–µ–π—Å—Ç–≤–∏–µ B;
end fork
```
<!-- BRIEF_END -->

<!-- DETAILED_START -->
## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–æ—Ü–µ—Å—Å

```plantuml
@startuml
start
:–ü–æ–ª—É—á–∏—Ç—å –∑–∞–ø—Ä–æ—Å;
:–í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ;
:–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–ø—Ä–æ—Å;
:–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç;
stop
@enduml
```

### –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞

```plantuml
@startuml
start
:–ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑;

if (–¢–æ–≤–∞—Ä –≤ –Ω–∞–ª–∏—á–∏–∏?) then (–¥–∞)
    :–ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä;
    :–°–æ–∑–¥–∞—Ç—å –Ω–∞–∫–ª–∞–¥–Ω—É—é;
else (–Ω–µ—Ç)
    :–£–≤–µ–¥–æ–º–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞;
    :–î–æ–±–∞–≤–∏—Ç—å –≤ –ª–∏—Å—Ç –æ–∂–∏–¥–∞–Ω–∏—è;
endif

:–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ;
stop
@enduml
```

### –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä

```plantuml
@startuml
start
:–ü–æ–ª—É—á–∏—Ç—å –ø–ª–∞—Ç—ë–∂;

switch (–¢–∏–ø –ø–ª–∞—Ç–µ–∂–∞?)
case (–ö–∞—Ä—Ç–∞)
    :–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ –±–∞–Ω–∫;
case (PayPal)
    :–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ PayPal API;
case (–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞)
    :–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ –±–ª–æ–∫—á–µ–π–Ω;
endswitch

:–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–ª–∞—Ç—ë–∂;
stop
@enduml
```

### –¶–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏

```plantuml
@startuml
start
:–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á;

while (–ï—Å—Ç—å –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏?) is (–¥–∞)
    :–í–∑—è—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∑–∞–¥–∞—á—É;
    :–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–¥–∞—á—É;
    :–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å;
endwhile (–Ω–µ—Ç)

:–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç;
stop
@enduml
```

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

```plantuml
@startuml
start
:–ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑;

fork
    :–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É;
fork again
    :–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–∞;
fork again
    :–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏;
end fork

if (–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã?) then (–¥–∞)
    :–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑;
else (–Ω–µ—Ç)
    :–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑;
endif

stop
@enduml
```

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –∑–æ–Ω—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (swimlanes)

```plantuml
@startuml
|–ö–ª–∏–µ–Ω—Ç|
start
:–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑;

|–°–∏—Å—Ç–µ–º–∞|
:–í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑;
:–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å;

|–°–∫–ª–∞–¥|
:–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ;
:–ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä;

|–°–∏—Å—Ç–µ–º–∞|
:–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å—á—ë—Ç;

|–ö–ª–∏–µ–Ω—Ç|
:–û–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑;

|–°–∏—Å—Ç–µ–º–∞|
:–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É;
stop
@enduml
```

## –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

1. **–ó–∞–±—ã–ª–∏ start/stop:**
   - –î–∏–∞–≥—Ä–∞–º–º–∞ –¥–æ–ª–∂–Ω–∞ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `start`
   - –ò –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è `stop` –∏–ª–∏ `end`

2. **–ó–∞–±—ã–ª–∏ —Ç–æ—á–∫—É —Å –∑–∞–ø—è—Ç–æ–π:**
   - ‚ùå `:–î–µ–π—Å—Ç–≤–∏–µ`
   - ‚úÖ `:–î–µ–π—Å—Ç–≤–∏–µ;`

3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å if:**
   - ‚ùå `if —É—Å–ª–æ–≤–∏–µ`
   - ‚úÖ `if (—É—Å–ª–æ–≤–∏–µ?) then (–¥–∞)`

4. **–ù–µ–∑–∞–∫—Ä—ã—Ç—ã–µ –±–ª–æ–∫–∏:**
   - `if` —Ç—Ä–µ–±—É–µ—Ç `endif`
   - `while` —Ç—Ä–µ–±—É–µ—Ç `endwhile`
   - `fork` —Ç—Ä–µ–±—É–µ—Ç `end fork`

## –≠–ª–µ–º–µ–Ω—Ç—ã –¥–∏–∞–≥—Ä–∞–º–º—ã

| –≠–ª–µ–º–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `start` | –ù–∞—á–∞–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ (—á—ë—Ä–Ω—ã–π –∫—Ä—É–∂–æ–∫) |
| `stop` | –ö–æ–Ω–µ—Ü –ø—Ä–æ—Ü–µ—Å—Å–∞ (—á—ë—Ä–Ω—ã–π –∫—Ä—É–∂–æ–∫ –≤ –∫–æ–ª—å—Ü–µ) |
| `end` | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∫–æ–Ω–µ—Ü |
| `:–¢–µ–∫—Å—Ç;` | –î–µ–π—Å—Ç–≤–∏–µ (–ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ —Å–æ —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–º–∏ –∫—Ä–∞—è–º–∏) |
| `if/else/endif` | –£—Å–ª–æ–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ (—Ä–æ–º–±) |
| `switch/case` | –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä |
| `while/endwhile` | –¶–∏–∫–ª —Å —É—Å–ª–æ–≤–∏–µ–º |
| `repeat/repeatwhile` | –¶–∏–∫–ª do-while |
| `fork/end fork` | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ |
| `|Swimlane|` | –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∑–æ–Ω–∞–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ |

## Styling & Themes

‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –î–õ–Ø AI –ú–û–î–ï–õ–ï–ô:**

**–ó–ê–ü–†–ï–©–ï–ù–û:**

- ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `!theme` –∏–ª–∏ `!include` –¥–∏—Ä–µ–∫—Ç–∏–≤—ã
- ‚ùå –ñ—ë—Å—Ç–∫–æ –ø—Ä–æ–ø–∏—Å—ã–≤–∞—Ç—å —Ü–≤–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `skinparam activityBackgroundColor green`)
- ‚ùå –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Å—Ç–∏–ª–∏ —á–µ—Ä–µ–∑ `skinparam` –≤ diagram_code

**–ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–û–î–•–û–î:**

- ‚úÖ –í–°–ï–ì–î–ê –≤—ã–∑—ã–≤–∞–π—Ç–µ `list_plantuml_themes` –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –¥–∏–∞–≥—Ä–∞–º–º—ã
- ‚úÖ –ü–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –≤—ã–±—Ä–∞–Ω–Ω—É—é —Ç–µ–º—É —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `theme_name`
- ‚úÖ –î–æ–≤–µ—Ä—å—Ç–µ —Ü–≤–µ—Ç–∞ –∏ —Å—Ç–∏–ª–∏ —Ç–µ–º–µ ‚Äî –≤–∞—à–∞ –∑–∞–¥–∞—á–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ swimlanes –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

**–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```plantuml
@startuml
start
:–ü–æ–ª—É—á–∏—Ç—å –∑–∞–ø—Ä–æ—Å;
if (–í–∞–ª–∏–¥–∞—Ü–∏—è?) then (—É—Å–ø–µ—Ö)
    :–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ;
    :–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î;
else (–æ—à–∏–±–∫–∞)
    :–í–µ—Ä–Ω—É—Ç—å 400 Bad Request;
endif
stop
@enduml
```
<!-- DETAILED_END -->

```

## `doc/plantuml_guides/class_diagram.md`

```md
# Class Diagram Guide

<!-- BRIEF_START -->
**–°–∏–Ω—Ç–∞–∫—Å–∏—Å:**

```plantuml
class "ClassName" <<Stereotype>> {
    + publicField: Type
    - privateField: Type
    # protectedField: Type
    + publicMethod(): ReturnType
    - privateMethod(): ReturnType
}
```

**–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å):**

* `<<Adapter>>` ‚Äî –í—Ö–æ–¥–Ω—ã–µ —Ç–æ—á–∫–∏: API, UI, Controllers, Views. –¶–≤–µ—Ç: –ó–µ–ª—ë–Ω—ã–π/–ë–µ–ª—ã–π.
* `<<Core>>` ‚Äî –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞: Services, UseCases, Domain. –¶–≤–µ—Ç: –ñ—ë–ª—Ç—ã–π/–ó–æ–ª–æ—Ç–æ–π.
* `<<Infrastructure>>` ‚Äî –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞: –ë–î, –ö–µ—à, –í–Ω–µ—à–Ω–∏–µ API, Repositories. –¶–≤–µ—Ç: –°–∏–Ω–∏–π/–°–µ—Ä—ã–π.

**–û—Ç–Ω–æ—à–µ–Ω–∏—è:**

* `A --|> B` ‚Äî –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (A extends B)
* `A ..|> B` ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (A implements B)
* `A --> B` ‚Äî –∞—Å—Å–æ—Ü–∏–∞—Ü–∏—è/–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
* `A --o B` ‚Äî –∞–≥—Ä–µ–≥–∞—Ü–∏—è (A —Å–æ–¥–µ—Ä–∂–∏—Ç B, –Ω–æ B –º–æ–∂–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ)
* `A --* B` ‚Äî –∫–æ–º–ø–æ–∑–∏—Ü–∏—è (A –≤–ª–∞–¥–µ–µ—Ç B, B –Ω–µ –º–æ–∂–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –±–µ–∑ A)
<!-- BRIEF_END -->

<!-- DETAILED_START -->
## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ—Å—Ç–æ–π –∫–ª–∞—Å—Å

```plantuml
@startuml
class User {
    + id: int
    + name: String
    + email: String
    + register(): void
    + login(): bool
}
@enduml
```

### –ö–ª–∞—Å—Å —Å–æ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–º

```plantuml
@startuml
class "UserService" <<Core>> {
    - repository: UserRepository
    + createUser(dto: CreateUserDTO): User
    + findById(id: int): User
}

class "UserController" <<Adapter>> {
    - service: UserService
    + handleCreate(request: Request): Response
}

class "UserRepository" <<Infrastructure>> {
    - connection: Connection
    + save(user: User): void
    + findById(id: int): User
}

UserController --> UserService
UserService --> UserRepository
@enduml
```

### –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ

```plantuml
@startuml
interface IRepository<T> {
    + findById(id: int): T
    + save(entity: T): void
    + delete(id: int): void
}

class "UserRepository" <<Infrastructure>> {
    + findById(id: int): User
    + save(entity: User): void
    + delete(id: int): void
}

UserRepository ..|> IRepository
@enduml
```

## –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

1. **–ó–∞–±—ã—Ç—ã–µ –∫–∞–≤—ã—á–∫–∏ –≤ –∏–º–µ–Ω–∞—Ö —Å –ø—Ä–æ–±–µ–ª–∞–º–∏:**
   * ‚ùå `class User Service`
   * ‚úÖ `class "User Service"`

2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–∞:**
   * ‚ùå `class UserService <Core>`
   * ‚úÖ `class "UserService" <<Core>>`

3. **–ó–∞–±—ã—Ç—ã–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –¥–æ—Å—Ç—É–ø–∞:**
   * ‚ùå `name: String`
   * ‚úÖ `+ name: String` (public)

## –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –¥–æ—Å—Ç—É–ø–∞

| –°–∏–º–≤–æ–ª | –ó–Ω–∞—á–µ–Ω–∏–µ |
|--------|----------|
| `+` | public |
| `-` | private |
| `#` | protected |
| `~` | package |

## Styling & Themes

‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –î–õ–Ø AI –ú–û–î–ï–õ–ï–ô:**

**–ó–ê–ü–†–ï–©–ï–ù–û:**
* ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `!theme` –∏–ª–∏ `!include` –¥–∏—Ä–µ–∫—Ç–∏–≤—ã
* ‚ùå –ñ—ë—Å—Ç–∫–æ –ø—Ä–æ–ø–∏—Å—ã–≤–∞—Ç—å —Ü–≤–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `#backgroundColor yellow`)
* ‚ùå –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Å—Ç–∏–ª–∏ —á–µ—Ä–µ–∑ `skinparam` –≤ diagram_code

**–ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–û–î–•–û–î:**
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¢–û–õ–¨–ö–û —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã: `<<Adapter>>`, `<<Core>>`, `<<Infrastructure>>`
* ‚úÖ –í–°–ï–ì–î–ê –≤—ã–∑—ã–≤–∞–π—Ç–µ `list_plantuml_themes` –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –¥–∏–∞–≥—Ä–∞–º–º—ã
* ‚úÖ –ü–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –≤—ã–±—Ä–∞–Ω–Ω—É—é —Ç–µ–º—É —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `theme_name`
* ‚úÖ –î–æ–≤–µ—Ä—å—Ç–µ —Ü–≤–µ—Ç–∞ –∏ —Å—Ç–∏–ª–∏ —Ç–µ–º–µ ‚Äî –≤–∞—à–∞ –∑–∞–¥–∞—á–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–æ–≤ –∏ –∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```plantuml
@startuml
class "UserController" <<Adapter>> {
    + createUser(dto: CreateUserDTO): Response
}

class "UserService" <<Core>> {
    + registerUser(dto: CreateUserDTO): User
}

class "UserRepository" <<Infrastructure>> {
    + save(user: User): void
}

UserController --> UserService
UserService --> UserRepository
@enduml
```
<!-- DETAILED_END -->

```

## `doc/plantuml_guides/component_diagram.md`

```md
# Component Diagram Guide

<!-- BRIEF_START -->
**–°–∏–Ω—Ç–∞–∫—Å–∏—Å:**

```plantuml
component "Name" <<Stereotype>>
[ShortName] <<Stereotype>>
```

**–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º):**

* `<<Adapter>>` ‚Äî –í—Ö–æ–¥–Ω—ã–µ —Ç–æ—á–∫–∏: API, UI, Views, Controllers. –¶–≤–µ—Ç: –ó–µ–ª—ë–Ω—ã–π/–ë–µ–ª—ã–π.
* `<<Core>>` ‚Äî –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞: Services, UseCases, Domain. –¶–≤–µ—Ç: –ñ—ë–ª—Ç—ã–π/–ó–æ–ª–æ—Ç–æ–π.
* `<<Infrastructure>>` ‚Äî –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞: –ë–î, –ö–µ—à, –í–Ω–µ—à–Ω–∏–µ API. –¶–≤–µ—Ç: –°–∏–Ω–∏–π/–°–µ—Ä—ã–π.

**–°–≤—è–∑–∏:**

* `A --> B` ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
* `A ..> B` ‚Äî –ø—É–Ω–∫—Ç–∏—Ä–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
* `A --( B` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

**–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞:**

```plantuml
package "Layer Name" {
    component "A"
    component "B"
}
```
<!-- BRIEF_END -->

<!-- DETAILED_START -->
## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –¢—Ä—ë—Ö—Å–ª–æ–π–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```plantuml
@startuml
package "Presentation Layer" {
    component "Web API" <<Adapter>>
    component "CLI" <<Adapter>>
}

package "Business Layer" {
    component "Order Service" <<Core>>
    component "Payment Service" <<Core>>
    component "Notification Service" <<Core>>
}

package "Data Layer" {
    component "PostgreSQL" <<Infrastructure>>
    component "Redis Cache" <<Infrastructure>>
    component "Email Gateway" <<Infrastructure>>
}

[Web API] --> [Order Service]
[CLI] --> [Order Service]
[Order Service] --> [Payment Service]
[Order Service] --> [Notification Service]
[Order Service] --> [PostgreSQL]
[Order Service] --> [Redis Cache]
[Notification Service] --> [Email Gateway]
@enduml
```

### Hexagonal Architecture

```plantuml
@startuml
package "Adapters (Input)" {
    component "REST API" <<Adapter>>
    component "GraphQL" <<Adapter>>
    component "CLI" <<Adapter>>
}

package "Core (Domain)" {
    component "User Service" <<Core>>
    component "Order Service" <<Core>>
    component "Domain Events" <<Core>>
}

package "Adapters (Output)" {
    component "PostgreSQL Adapter" <<Infrastructure>>
    component "Redis Adapter" <<Infrastructure>>
    component "Kafka Producer" <<Infrastructure>>
}

[REST API] --> [User Service]
[GraphQL] --> [User Service]
[CLI] --> [Order Service]

[User Service] --> [PostgreSQL Adapter]
[Order Service] --> [Redis Adapter]
[Domain Events] --> [Kafka Producer]
@enduml
```

### –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

```plantuml
@startuml
interface "IUserRepository" as IUR
interface "ICacheService" as ICS

component "User Service" <<Core>> as US
component "PostgreSQL Repository" <<Infrastructure>> as PG
component "Redis Cache" <<Infrastructure>> as RC

US --> IUR
US --> ICS
PG ..|> IUR
RC ..|> ICS
@enduml
```

## –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

1. **–ó–∞–±—ã–ª–∏ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø:**
   * ‚ùå `component "Service"` ‚Äî –Ω–µ –ø–æ–Ω—è—Ç–Ω–∞ —Ä–æ–ª—å
   * ‚úÖ `component "Service" <<Core>>` ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–∞:**
   * ‚ùå `component "API" <Adapter>`
   * ‚úÖ `component "API" <<Adapter>>`

3. **–°–º–µ—à–∏–≤–∞–Ω–∏–µ —Å–ª–æ—ë–≤:**
   * Adapter –Ω–µ –¥–æ–ª–∂–µ–Ω –Ω–∞–ø—Ä—è–º—É—é –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ Infrastructure
   * –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Core!

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å–ª–æ—è–º

### Adapter Layer (–ó–µ–ª—ë–Ω—ã–π/–ë–µ–ª—ã–π)

- REST Controllers
* GraphQL Resolvers
* CLI Commands
* Web Views
* Message Consumers

### Core Layer (–ñ—ë–ª—Ç—ã–π/–ó–æ–ª–æ—Ç–æ–π)

- Domain Services
* Use Cases
* Domain Entities
* Business Rules
* Domain Events

### Infrastructure Layer (–°–∏–Ω–∏–π/–°–µ—Ä—ã–π)

- Database Repositories
* Cache Clients
* External API Clients
* Message Producers
* File Storage

## Styling & Themes

‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –î–õ–Ø AI –ú–û–î–ï–õ–ï–ô:**

**–ó–ê–ü–†–ï–©–ï–ù–û:**
* ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `!theme` –∏–ª–∏ `!include` –¥–∏—Ä–µ–∫—Ç–∏–≤—ã
* ‚ùå –ñ—ë—Å—Ç–∫–æ –ø—Ä–æ–ø–∏—Å—ã–≤–∞—Ç—å —Ü–≤–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `#backgroundColor red`)
* ‚ùå –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Å—Ç–∏–ª–∏ —á–µ—Ä–µ–∑ `skinparam` –≤ diagram_code

**–ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–û–î–•–û–î:**
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¢–û–õ–¨–ö–û —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã: `<<Adapter>>`, `<<Core>>`, `<<Infrastructure>>`
* ‚úÖ –í–°–ï–ì–î–ê –≤—ã–∑—ã–≤–∞–π—Ç–µ `list_plantuml_themes` –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –¥–∏–∞–≥—Ä–∞–º–º—ã
* ‚úÖ –ü–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –≤—ã–±—Ä–∞–Ω–Ω—É—é —Ç–µ–º—É —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `theme_name`
* ‚úÖ –î–æ–≤–µ—Ä—å—Ç–µ —Ü–≤–µ—Ç–∞ –∏ —Å—Ç–∏–ª–∏ —Ç–µ–º–µ ‚Äî –≤–∞—à–∞ –∑–∞–¥–∞—á–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∞ –Ω–µ –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥

**–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```plantuml
@startuml
component "API Gateway" <<Adapter>>
component "User Service" <<Core>>
component "PostgreSQL" <<Infrastructure>>
@enduml
```
<!-- DETAILED_END -->

```

## `doc/plantuml_guides/index.json`

```json
{
  "version": "1.0.0",
  "description": "–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≥–∞–π–¥–æ–≤ –ø–æ PlantUML –¥–ª—è code_to_image_mcp",
  "guides": [
    {
      "type": "class",
      "file": "class_diagram.md",
      "title": "–î–∏–∞–≥—Ä–∞–º–º—ã –∫–ª–∞—Å—Å–æ–≤",
      "description": "–°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º –∫–ª–∞—Å—Å–æ–≤ UML"
    },
    {
      "type": "sequence",
      "file": "sequence_diagram.md",
      "title": "–î–∏–∞–≥—Ä–∞–º–º—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",
      "description": "–°–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è sequence-–¥–∏–∞–≥—Ä–∞–º–º —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏"
    },
    {
      "type": "component",
      "file": "component_diagram.md",
      "title": "–î–∏–∞–≥—Ä–∞–º–º—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤",
      "description": "–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã —Å–æ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–∞–º–∏ Adapter, Core, Infrastructure"
    },
    {
      "type": "activity",
      "file": "activity_diagram.md",
      "title": "–î–∏–∞–≥—Ä–∞–º–º—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",
      "description": "–î–∏–∞–≥—Ä–∞–º–º—ã –ø–æ—Ç–æ–∫–æ–≤ –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Å —É—Å–ª–æ–≤–∏—è–º–∏ –∏ —Ü–∏–∫–ª–∞–º–∏"
    },
    {
      "type": "themes",
      "file": "themes.md",
      "title": "–¢–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è",
      "description": "–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–º—ã –∏ –∏—Ö —Å–µ–º–∞–Ω—Ç–∏–∫–∞ (dark_gold, light_fresh, default)"
    }
  ]
}

```

## `doc/plantuml_guides/sequence_diagram.md`

```md
# Sequence Diagram Guide

<!-- BRIEF_START -->
**–°–∏–Ω—Ç–∞–∫—Å–∏—Å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:**

```plantuml
participant "–ò–º—è" as alias
actor "–ê–∫—Ç–æ—Ä" as actorAlias
database "–ë–î" as db
```

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å —Å–æ–æ–±—â–µ–Ω–∏–π:**

* `A -> B: –°–æ–æ–±—â–µ–Ω–∏–µ` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
* `A --> B: –û—Ç–≤–µ—Ç` ‚Äî –ø—É–Ω–∫—Ç–∏—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç
* `A ->> B: Async` ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
* `A -x B: –û—Ç–º–µ–Ω–∞` ‚Äî –æ—Ç–º–µ–Ω–∞/–æ—à–∏–±–∫–∞

**–ê–∫—Ç–∏–≤–∞—Ü–∏—è (lifeline bars):**

```plantuml
activate A
A -> B: –ó–∞–ø—Ä–æ—Å
deactivate A
```

**–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞:**

```plantuml
alt —É—Å–ª–æ–≤–∏–µ
    A -> B: –µ—Å–ª–∏ true
else –∏–Ω–∞—á–µ
    A -> B: –µ—Å–ª–∏ false
end
```
<!-- BRIEF_END -->

<!-- DETAILED_START -->
## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ—Å—Ç–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å

```plantuml
@startuml
Alice -> Bob: –ü—Ä–∏–≤–µ—Ç!
Bob --> Alice: –ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?
Alice -> Bob: –û—Ç–ª–∏—á–Ω–æ, —Å–ø–∞—Å–∏–±–æ!
@enduml
```

### –£—á–∞—Å—Ç–Ω–∏–∫–∏ —Å —Ç–∏–ø–∞–º–∏

```plantuml
@startuml
actor "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" as User
participant "API Gateway" as API
participant "Auth Service" as Auth
database "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö" as DB

User -> API: POST /login
activate API
API -> Auth: validateCredentials()
activate Auth
Auth -> DB: SELECT user
activate DB
DB --> Auth: userData
deactivate DB
Auth --> API: token
deactivate Auth
API --> User: 200 OK + JWT
deactivate API
@enduml
```

### –£—Å–ª–æ–≤–∏—è –∏ —Ü–∏–∫–ª—ã

```plantuml
@startuml
participant Client
participant Server

alt —É—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
    Client -> Server: login(valid_credentials)
    Server --> Client: 200 OK
else –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å
    Client -> Server: login(invalid_credentials)
    Server --> Client: 401 Unauthorized
end

loop –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
    Client -> Server: heartbeat()
    Server --> Client: pong
end
@enduml
```

### –ó–∞–º–µ—Ç–∫–∏

```plantuml
@startuml
Alice -> Bob: –°–æ–æ–±—â–µ–Ω–∏–µ
note left: –ó–∞–º–µ—Ç–∫–∞ —Å–ª–µ–≤–∞
note right: –ó–∞–º–µ—Ç–∫–∞ —Å–ø—Ä–∞–≤–∞
note over Alice, Bob: –ó–∞–º–µ—Ç–∫–∞ –Ω–∞–¥ –æ–±–æ–∏–º–∏
@enduml
```

## –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

1. **–ó–∞–±—ã–ª–∏ deactivate:**
   * –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `activate`, –Ω–µ –∑–∞–±—É–¥—å—Ç–µ `deactivate`
   * –ò–Ω–∞—á–µ –±–∞—Ä –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —É—Ö–æ–¥–∏—Ç –¥–æ –∫–æ–Ω—Ü–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã

2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å—Ç—Ä–µ–ª–æ–∫:**
   * `->` —Å–ø–ª–æ—à–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ (–∑–∞–ø—Ä–æ—Å)
   * `-->` –ø—É–Ω–∫—Ç–∏—Ä–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ (–æ—Ç–≤–µ—Ç)

3. **–ö–∏—Ä–∏–ª–ª–∏—Ü–∞ –±–µ–∑ –∫–∞–≤—ã—á–µ–∫:**
   * ‚ùå `participant –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å`
   * ‚úÖ `participant "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" as User`

## –¢–∏–ø—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| `participant` | –û–±—ã—á–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ (–ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫) |
| `actor` | –ß–µ–ª–æ–≤–µ–∫-–∞–∫—Ç–æ—Ä (—Ñ–∏–≥—É—Ä–∫–∞) |
| `database` | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—Ü–∏–ª–∏–Ω–¥—Ä) |
| `entity` | –°—É—â–Ω–æ—Å—Ç—å |
| `boundary` | –ì—Ä–∞–Ω–∏—Ü–∞ —Å–∏—Å—Ç–µ–º—ã |
| `control` | –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä |
| `collections` | –ö–æ–ª–ª–µ–∫—Ü–∏—è |
| `queue` | –û—á–µ—Ä–µ–¥—å |

## Styling & Themes

‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –î–õ–Ø AI –ú–û–î–ï–õ–ï–ô:**

**–ó–ê–ü–†–ï–©–ï–ù–û:**
* ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `!theme` –∏–ª–∏ `!include` –¥–∏—Ä–µ–∫—Ç–∏–≤—ã
* ‚ùå –ñ—ë—Å—Ç–∫–æ –ø—Ä–æ–ø–∏—Å—ã–≤–∞—Ç—å —Ü–≤–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `skinparam sequenceMessageAlign center`)
* ‚ùå –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Å—Ç–∏–ª–∏ —á–µ—Ä–µ–∑ `skinparam` –≤ diagram_code

**–ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–û–î–•–û–î:**
* ‚úÖ –í–°–ï–ì–î–ê –≤—ã–∑—ã–≤–∞–π—Ç–µ `list_plantuml_themes` –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –¥–∏–∞–≥—Ä–∞–º–º—ã
* ‚úÖ –ü–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –≤—ã–±—Ä–∞–Ω–Ω—É—é —Ç–µ–º—É —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `theme_name`
* ‚úÖ –î–æ–≤–µ—Ä—å—Ç–µ —Ü–≤–µ—Ç–∞ –∏ —Å—Ç–∏–ª–∏ —Ç–µ–º–µ ‚Äî –≤–∞—à–∞ –∑–∞–¥–∞—á–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
* ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (`actor`, `database`, `participant`) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏

**–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```plantuml
@startuml
actor User
participant "API Gateway" as API
database "PostgreSQL" as DB

User -> API: POST /login
API -> DB: SELECT user
DB --> API: user data
API --> User: JWT token
@enduml
```
<!-- DETAILED_END -->

```

## `doc/plantuml_guides/themes.md`

```md
# Themes Guide

<!-- BRIEF_START -->
**–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–º—ã:**

| –¢–µ–º–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –õ—É—á—à–µ –¥–ª—è |
|------|----------|-----------|
| `default` | –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ VS Code —Å—Ç–∏–ª—è | –û–±—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
| `dark_gold` | –°—Ç—Ä–æ–≥–∞—è —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ —Å –∑–æ–ª–æ—Ç—ã–º –∞–∫—Ü–µ–Ω—Ç–æ–º | –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏, –¥–æ–∫–ª–∞–¥—ã |
| `light_fresh` | –ú—è–≥–∫–∞—è —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ —Å –º—è—Ç–Ω—ã–º–∏ —Ç–æ–Ω–∞–º–∏ | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, –ø–µ—á–∞—Ç—å |

**–°—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã –∏ —Ü–≤–µ—Ç–∞:**

–í–æ –≤—Å–µ—Ö —Ç–µ–º–∞—Ö —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã –∏–º–µ—é—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
* `<<Adapter>>` ‚Äî –í—Ö–æ–¥–Ω—ã–µ —Ç–æ—á–∫–∏ (API, UI). –¶–≤–µ—Ç: –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–π/–≤—ã–¥–µ–ª—è—é—â–∏–π—Å—è
* `<<Core>>` ‚Äî –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞. –¶–≤–µ—Ç: –∞–∫—Ü–µ–Ω—Ç–Ω—ã–π (–∑–æ–ª–æ—Ç–æ–π/–∂—ë–ª—Ç—ã–π)
* `<<Infrastructure>>` ‚Äî –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞. –¶–≤–µ—Ç: –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π (—Å–µ—Ä—ã–π/—Å–∏–Ω–∏–π)

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
generate_architecture_diagram(
    diagram_code=code,
    output_path="/path/to/output.png",
    theme_name="dark_gold"  # –∏–ª–∏ "light_fresh", "default"
)
```
<!-- BRIEF_END -->

<!-- DETAILED_START -->
## –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–º

### default
–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ –≤ —Å—Ç–∏–ª–µ VS Code.

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- –§–æ–Ω: `#1E1E1E` (—Ç—ë–º–Ω–æ-—Å–µ—Ä—ã–π)
- –¢–µ–∫—Å—Ç: `#D4D4D4` (—Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π)
- –ê–∫—Ü–µ–Ω—Ç—ã: `#007ACC` (—Å–∏–Ω–∏–π VS Code)
- –®—Ä–∏—Ñ—Ç: JetBrains Mono

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –û–±—â–∏–µ –¥–∏–∞–≥—Ä–∞–º–º—ã
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- README —Ñ–∞–π–ª—ã

### dark_gold
–°—Ç—Ä–æ–≥–∞—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è —Ç–µ–º–∞ —Å –∑–æ–ª–æ—Ç—ã–º –∞–∫—Ü–µ–Ω—Ç–æ–º.

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- –§–æ–Ω: `#222222` (–ø–æ—á—Ç–∏ —á—ë—Ä–Ω—ã–π)
- –¢–µ–∫—Å—Ç: `#EEEEEE` (–±–µ–ª—ã–π)
- –ê–∫—Ü–µ–Ω—Ç: `#FFB300` (–∑–æ–ª–æ—Ç–æ–π)
- –ì—Ä–∞–Ω–∏—Ü—ã: `#FFFFFF` (–±–µ–ª—ã–µ)
- –®—Ä–∏—Ñ—Ç: JetBrains Mono

**–°—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã:**
- `<<Adapter>>`: –¢—ë–º–Ω—ã–π —Ñ–æ–Ω, –±–µ–ª—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã
- `<<Core>>`: –ó–æ–ª–æ—Ç–∏—Å—Ç—ã–π —Ñ–æ–Ω, –∑–æ–ª–æ—Ç—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã –∏ —Ç–µ–∫—Å—Ç
- `<<Infrastructure>>`: –°–µ—Ä—ã–π —Ñ–æ–Ω, —Å–µ—Ä—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–æ—Ä–µ
- –í–∏–¥–µ–æ –∏ —Å–∫—Ä–∏–Ω–∫–∞—Å—Ç—ã
- –ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω —Å–∏–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç

### light_fresh
–ú—è—Ç–Ω–∞—è —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- –§–æ–Ω: `#f0faf5` (—Å–≤–µ—Ç–ª–æ-–º—è—Ç–Ω—ã–π)
- –¢–µ–∫—Å—Ç: `#0b2e1d` (—Ç—ë–º–Ω–æ-–∑–µ–ª—ë–Ω—ã–π)
- –ê–∫—Ü–µ–Ω—Ç: `#4dd191` (–º—è—Ç–Ω—ã–π)
- –®—Ä–∏—Ñ—Ç: JetBrains Mono

**–°—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã:**
- `<<Adapter>>`: –°–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω, –º—è—Ç–Ω–∞—è –≥—Ä–∞–Ω–∏—Ü–∞
- `<<Core>>`: –ö—Ä–µ–º–æ–≤—ã–π —Ñ–æ–Ω, –∂—ë–ª—Ç–∞—è –≥—Ä–∞–Ω–∏—Ü–∞
- `<<Infrastructure>>`: –°–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω, —Å–∏–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü–µ—á–∞—Ç–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –°–≤–µ—Ç–ª—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ "–º—è–≥–∫–æ—Å—Ç—å"

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤

### Component Diagram —Å —Ç–µ–º–æ–π dark_gold
```plantuml
@startuml
package "API Layer" {
    component "REST Controller" <<Adapter>>
    component "GraphQL Endpoint" <<Adapter>>
}

package "Business Logic" {
    component "Order Service" <<Core>>
    component "Payment Service" <<Core>>
}

package "Infrastructure" {
    component "PostgreSQL" <<Infrastructure>>
    component "Redis" <<Infrastructure>>
}

[REST Controller] --> [Order Service]
[GraphQL Endpoint] --> [Order Service]
[Order Service] --> [Payment Service]
[Order Service] --> [PostgreSQL]
[Order Service] --> [Redis]
@enduml
```

### Class Diagram —Å —Ç–µ–º–æ–π light_fresh
```plantuml
@startuml
class "UserController" <<Adapter>> {
    + handleRequest()
}

class "UserService" <<Core>> {
    + createUser()
    + findUser()
}

class "UserRepository" <<Infrastructure>> {
    + save()
    + findById()
}

UserController --> UserService
UserService --> UserRepository
@enduml
```

## –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Ç–µ–º—ã

–¢–µ–º—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `asset/themes/` –∫–∞–∫ `.puml` —Ñ–∞–π–ª—ã.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ–º—ã:**
```plantuml
' 1. –®—Ä–∏—Ñ—Ç—ã
skinparam defaultFontName "JetBrains Mono"
skinparam defaultFontSize 14

' 2. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞
skinparam backgroundColor #XXXXXX

' 3. –°—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã –¥–ª—è class
skinparam class<<Adapter>> {
    BackgroundColor #XXXXXX
    BorderColor #XXXXXX
    FontColor #XXXXXX
}

' 4. –°—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã –¥–ª—è component
skinparam component<<Adapter>> {
    BackgroundColor #XXXXXX
    BorderColor #XXXXXX
    FontColor #XXXXXX
}

' 5. –î—Ä—É–≥–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã...
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã** –¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º
2. **–í—ã–±–∏—Ä–∞–π—Ç–µ —Ç–µ–º—É –ø–æ–¥ –∫–æ–Ω—Ç–µ–∫—Å—Ç** ‚Äî —Å–≤–µ—Ç–ª–∞—è –¥–ª—è –ø–µ—á–∞—Ç–∏, —Ç—ë–º–Ω–∞—è –¥–ª—è —ç–∫—Ä–∞–Ω–∞
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ High detail_level** –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π (3x –º–∞—Å—à—Ç–∞–±)
4. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ü–µ–ª–µ–≤–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ** ‚Äî —Ü–≤–µ—Ç–∞ –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è
<!-- DETAILED_END -->

```

## `doc/theme_creation_guide.md`

```md
# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é PlantUML —Ç–µ–º—ã –¥–ª—è code_to_image_mcp

## –í–≤–µ–¥–µ–Ω–∏–µ

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º—É—é PlantUML —Ç–µ–º—É –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ `code_to_image_mcp`, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å —á–∏—Ç–∞–µ–º–æ—Å—Ç—å—é —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (—á–µ—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ —Ç–µ–º–Ω–æ–º —Ñ–æ–Ω–µ, –Ω–µ–≤–∏–¥–∏–º—ã–µ –æ–±–≤–æ–¥–∫–∏ –∏ —Ç.–¥.).

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã PlantUML

PlantUML –∏–º–µ–µ—Ç **–º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤**, –∫–æ—Ç–æ—Ä—ã–µ **–∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç** –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (`defaultFontColor`, `backgroundColor`) –∏ —Ç—Ä–µ–±—É—é—Ç **—è–≤–Ω–æ–≥–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è**.

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–º—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —è–≤–Ω–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è **–í–°–ï–•** —Å–ª–µ–¥—É—é—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤:

#### 1. –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –ª–µ–≥–µ–Ω–¥–∞

```plantuml
' Title (–∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–∏–∞–≥—Ä–∞–º–º—ã)
skinparam titleFontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
skinparam titleFontSize 18
skinparam titleBorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
skinparam titleBorderThickness 2
skinparam titleBackgroundColor #–¶–í–ï–¢_–§–û–ù–ê

' Legend (–ª–µ–≥–µ–Ω–¥–∞/–æ–ø–∏—Å–∞–Ω–∏–µ)
skinparam legendFontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
skinparam legendBackgroundColor #–¶–í–ï–¢_–§–û–ù–ê
skinparam legendBorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
skinparam legendBorderThickness 2
```

**–ß–∞—Å—Ç–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –ß–µ—Ä–Ω–∞—è –æ–±–≤–æ–¥–∫–∞ –ª–µ–≥–µ–Ω–¥—ã –Ω–∞ —Ç–µ–º–Ω–æ–º —Ñ–æ–Ω–µ ‚Äî –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –¥–≤–æ–π–Ω–∞—è —Ä–∞–º–∫–∞.

#### 2. –ó–∞–º–µ—Ç–∫–∏ (Notes)

```plantuml
skinparam note {
    BackgroundColor #–¶–í–ï–¢_–§–û–ù–ê
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
    BorderThickness 2
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}
```

#### 3. –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ Sequence –¥–∏–∞–≥—Ä–∞–º–º

```plantuml
' Database (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
skinparam database {
    BackgroundColor #–¶–í–ï–¢_–§–û–ù–ê
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
    BorderThickness 2
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}

' Collections (–∫–æ–ª–ª–µ–∫—Ü–∏–∏)
skinparam collections {
    BackgroundColor #–¶–í–ï–¢_–§–û–ù–ê
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
    BorderThickness 2
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}

' Queue (–æ—á–µ—Ä–µ–¥—å)
skinparam queue {
    BackgroundColor #–¶–í–ï–¢_–§–û–ù–ê
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
    BorderThickness 2
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}

' Entity (—Å—É—â–Ω–æ—Å—Ç—å)
skinparam entity {
    BackgroundColor #–¶–í–ï–¢_–§–û–ù–ê
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
    BorderThickness 2
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}

' Boundary (–≥—Ä–∞–Ω–∏—Ü–∞ —Å–∏—Å—Ç–µ–º—ã)
skinparam boundary {
    BackgroundColor #–¶–í–ï–¢_–§–û–ù–ê
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
    BorderThickness 2
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}

' Control (–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä)
skinparam control {
    BackgroundColor #–¶–í–ï–¢_–§–û–ù–ê
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
    BorderThickness 2
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}

' Actor (–∞–∫—Ç–æ—Ä)
skinparam actor {
    BackgroundColor #–¶–í–ï–¢_–§–û–ù–ê
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
    BorderThickness 2
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}
```

**–ß–∞—Å—Ç–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** Database/Queue/Entity –ø–æ–ª—É—á–∞—é—Ç —á–µ—Ä–Ω—ã–µ –æ–±–≤–æ–¥–∫–∏ –Ω–∞ —Ç–µ–º–Ω–æ–º —Ñ–æ–Ω–µ.

#### 4. Activity –¥–∏–∞–≥—Ä–∞–º–º—ã

```plantuml
' –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã activity
skinparam activity {
    BackgroundColor #–¶–í–ï–¢_–§–û–ù–ê
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
    BorderThickness 2
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
    DiamondBackgroundColor #–¶–í–ï–¢_–†–û–ú–ë–ê
    DiamondBorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò_–†–û–ú–ë–ê
    DiamondFontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê_–†–û–ú–ë–ê
    StartColor #–¶–í–ï–¢_–°–¢–ê–†–¢–ê
    EndColor #–¶–í–ï–¢_–§–ò–ù–ò–®–ê
    BarColor #–¶–í–ï–¢_–ü–û–õ–û–°
}

' –ö—Ä—É–∂–∫–∏ –Ω–∞—á–∞–ª–∞/–∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
skinparam activityStart {
    Color #–¶–í–ï–¢_–°–¢–ê–†–¢–ê
}

skinparam activityEnd {
    Color #–¶–í–ï–¢_–§–ò–ù–ò–®–ê
}

' CRITICAL! PlantUML –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç activityEnd –¥–ª—è stop —ç–ª–µ–º–µ–Ω—Ç–æ–≤
' –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
skinparam ActivityEndColor #–¶–í–ï–¢_–§–ò–ù–ò–®–ê
skinparam ActivityStopColor #–¶–í–ï–¢_–§–ò–ù–ò–®–ê

' Partition (–±–ª–æ–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è/–æ–±—Ä–∞–±–æ—Ç–∫–∞)
skinparam partition {
    BackgroundColor #–¶–í–ï–¢_–§–û–ù–ê
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
    BorderThickness 2
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}

' Swimlane (–¥–æ—Ä–æ–∂–∫–∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏)
skinparam swimlane {
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
    BorderThickness 2
    TitleFontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}
```

**–ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**

- –ß–µ—Ä–Ω—ã–π –∫—Ä—É–∂–æ–∫ `stop` –Ω–∞ —Ç–µ–º–Ω–æ–º —Ñ–æ–Ω–µ
- –ß–µ—Ä–Ω–∞—è –æ–±–≤–æ–¥–∫–∞ `partition` ‚Äî –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ —Å–ø–ª–æ—à–Ω–æ–π —á–µ—Ä–Ω—ã–π –±–ª–æ–∫

#### 5. Deployment —ç–ª–µ–º–µ–Ω—Ç—ã

```plantuml
' Node (—É–∑–µ–ª)
skinparam node {
    BackgroundColor #–¶–í–ï–¢_–§–û–ù–ê
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
    BorderThickness 2
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}

' Cloud (–æ–±–ª–∞–∫–æ)
skinparam cloud {
    BackgroundColor #–¶–í–ï–¢_–§–û–ù–ê
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
    BorderThickness 2
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}

' Folder (–ø–∞–ø–∫–∞)
skinparam folder {
    BackgroundColor #–¶–í–ï–¢_–§–û–ù–ê
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
    BorderThickness 2
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}

' Artifact (–∞—Ä—Ç–µ—Ñ–∞–∫—Ç)
skinparam artifact {
    BackgroundColor #–¶–í–ï–¢_–§–û–ù–ê
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
    BorderThickness 2
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}
```

#### 6. –î—Ä—É–≥–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã

```plantuml
' Frame (—Ñ—Ä–µ–π–º –≤ sequence)
skinparam frame {
    BackgroundColor #–¶–í–ï–¢_–§–û–ù–ê
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
    BorderThickness 2
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}

' State (—Å–æ—Å—Ç–æ—è–Ω–∏—è)
skinparam state {
    BackgroundColor #–¶–í–ï–¢_–§–û–ù–ê
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
    BorderThickness 2
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}

' Package (–ø–∞–∫–µ—Ç—ã)
skinparam package {
    BackgroundColor #–¶–í–ï–¢_–§–û–ù–ê
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
    BorderThickness 2
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ü–≤–µ—Ç–∞–º

### –î–ª—è —Ç–µ–º–Ω—ã—Ö —Ç–µ–º (—Ç–µ–º–Ω—ã–π —Ñ–æ–Ω)

- **–û–±–≤–æ–¥–∫–∏:** —è—Ä–∫–∏–µ —Ü–≤–µ—Ç–∞ (#569CD6, #4EC9B0, #007ACC)
- **–¢–µ–∫—Å—Ç:** —Å–≤–µ—Ç–ª—ã–π (#D4D4D4, #FFFFFF, #E8E8E8)
- **–§–æ–Ω —ç–ª–µ–º–µ–Ω—Ç–æ–≤:** —á—É—Ç—å —Å–≤–µ—Ç–ª–µ–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–æ–Ω–∞ (#2D2D30 –Ω–∞ #1E1E1E)
- **–ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:** —á–µ—Ä–Ω—ã–µ –æ–±–≤–æ–¥–∫–∏ (#000000) –∏–ª–∏ —Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–µ (#222222)

### –î–ª—è —Å–≤–µ—Ç–ª—ã—Ö —Ç–µ–º (—Å–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω)

- **–û–±–≤–æ–¥–∫–∏:** –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–µ —Ç–µ–º–Ω—ã–µ —Ü–≤–µ—Ç–∞ (#294f3d, #2E7D32)
- **–¢–µ–∫—Å—Ç:** —Ç–µ–º–Ω—ã–π (#0b2e1d, #1a1a1a, #000000)
- **–§–æ–Ω —ç–ª–µ–º–µ–Ω—Ç–æ–≤:** —á—É—Ç—å —Ç–µ–º–Ω–µ–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–æ–Ω–∞ (#F0FFF0 –Ω–∞ #FFFFFF)

## –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–º—ã

### 1. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑–æ–≤—ã–π —Ñ–∞–π–ª

```plantuml
' === THEME: YOUR_THEME_NAME ===
' –û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–º—ã

' 1. –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò
skinparam backgroundColor #–í–ê–®_–û–°–ù–û–í–ù–û–ô_–§–û–ù
skinparam defaultFontName "JetBrains Mono"
skinparam defaultFontSize 14
skinparam defaultFontColor #–í–ê–®_–û–°–ù–û–í–ù–û–ô_–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
skinparam roundCorner 8
skinparam shadowing false

' 2. –ë–ê–ó–û–í–´–ï –≠–õ–ï–ú–ï–ù–¢–´ (class, component, usecase)
' ... –≤–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ...

' 3. SEQUENCE –î–ò–ê–ì–†–ê–ú–ú–´
skinparam sequence {
    ArrowColor #–¶–í–ï–¢_–°–¢–†–ï–õ–û–ö
    ParticipantBackgroundColor #–¶–í–ï–¢_–§–û–ù–ê
    ParticipantBorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò
    ParticipantFontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}

' 4. –°–¢–ï–†–ï–û–¢–ò–ü–´ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
skinparam class<<Adapter>> {
    BackgroundColor #–¶–í–ï–¢_–ê–î–ê–ü–¢–ï–†–ê
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò_–ê–î–ê–ü–¢–ï–†–ê
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}

skinparam class<<Core>> {
    BackgroundColor #–¶–í–ï–¢_–Ø–î–†–ê
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò_–Ø–î–†–ê
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}

skinparam class<<Infrastructure>> {
    BackgroundColor #–¶–í–ï–¢_–ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–´
    BorderColor #–¶–í–ï–¢_–û–ë–í–û–î–ö–ò_–ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–´
    FontColor #–¶–í–ï–¢_–¢–ï–ö–°–¢–ê
}

' –î—É–±–ª–∏—Ä—É–µ–º –¥–ª—è component
skinparam component<<Adapter>> { ... }
skinparam component<<Core>> { ... }
skinparam component<<Infrastructure>> { ... }
```

### 2. –î–æ–±–∞–≤—å—Ç–µ UNIVERSAL ELEMENT OVERRIDES

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –±–ª–æ–∫ "UNIVERSAL ELEMENT OVERRIDES" –∏–∑ `default.puml` –∏–ª–∏ `dark_gold.puml` –∏ –∞–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ —Ü–≤–µ—Ç–∞ –ø–æ–¥ –≤–∞—à—É –ø–∞–ª–∏—Ç—Ä—É.

### 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ç–µ–º—É

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã:

```bash
pytest tests/test_theme_visual_check.py -k "your_theme_name" -v
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –¥–∏–∞–≥—Ä–∞–º–º—ã:

- ‚úÖ Component diagram ‚Äî legend, notes, database, queue
- ‚úÖ Sequence diagram ‚Äî –≤—Å–µ —Ç–∏–ø—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (actor, database, entity, boundary, control)
- ‚úÖ Class diagram ‚Äî legend, notes, —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã
- ‚úÖ Activity diagram ‚Äî partition, swimlane, start/stop –∫—Ä—É–∂–∫–∏

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç—å

–û—Ç–∫—Ä–æ–π—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ PNG —Ñ–∞–π–ª—ã –≤ `tests/output/theme_visual_check/` –∏ —É–±–µ–¥–∏—Ç–µ—Å—å:

- ‚ùå –ù–ï–¢ —á–µ—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —Ç–µ–º–Ω–æ–º —Ñ–æ–Ω–µ
- ‚ùå –ù–ï–¢ —á–µ—Ä–Ω—ã—Ö –æ–±–≤–æ–¥–æ–∫ –Ω–∞ —Ç–µ–º–Ω–æ–º —Ñ–æ–Ω–µ
- ‚úÖ –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —á–∏—Ç–∞–µ–º—ã
- ‚úÖ Legend –Ω–µ –∏–º–µ–µ—Ç –¥–≤–æ–π–Ω–æ–π –æ–±–≤–æ–¥–∫–∏
- ‚úÖ Partition –±–ª–æ–∫–∏ –≤–∏–¥–Ω—ã
- ‚úÖ Start/stop –∫—Ä—É–∂–∫–∏ –≤–∏–¥–Ω—ã

## –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

### ‚ùå –û—à–∏–±–∫–∞ 1: –ó–∞–±—ã–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å legend

**–°–∏–º–ø—Ç–æ–º:** –ß–µ—Ä–Ω–∞—è –¥–≤–æ–π–Ω–∞—è –æ–±–≤–æ–¥–∫–∞ –ª–µ–≥–µ–Ω–¥—ã –Ω–∞ —Ç–µ–º–Ω–æ–º —Ñ–æ–Ω–µ.  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ `skinparam legend { BorderColor #–°–í–ï–¢–õ–´–ô_–¶–í–ï–¢ }`

### ‚ùå –û—à–∏–±–∫–∞ 2: –ó–∞–±—ã–ª–∏ activityEnd

**–°–∏–º–ø—Ç–æ–º:** –ß–µ—Ä–Ω—ã–π –∫—Ä—É–∂–æ–∫ `stop` –Ω–∞ —Ç–µ–º–Ω–æ–º —Ñ–æ–Ω–µ.  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ `skinparam activityEnd { Color #–¶–í–ï–¢ }`

### ‚ùå –û—à–∏–±–∫–∞ 3: –ó–∞–±—ã–ª–∏ partition

**–°–∏–º–ø—Ç–æ–º:** –ß–µ—Ä–Ω–∞—è –æ–±–≤–æ–¥–∫–∞ –±–ª–æ–∫–æ–≤ "–í–∞–ª–∏–¥–∞—Ü–∏—è", "–û–±—Ä–∞–±–æ—Ç–∫–∞" –≤ activity.  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ `skinparam partition { BorderColor #–°–í–ï–¢–õ–´–ô_–¶–í–ï–¢ }`

### ‚ùå –û—à–∏–±–∫–∞ 4: –ó–∞–±—ã–ª–∏ database/queue/entity

**–°–∏–º–ø—Ç–æ–º:** –ß–µ—Ä–Ω—ã–µ –æ–±–≤–æ–¥–∫–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ sequence.  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞.

## –ü—Ä–∏–º–µ—Ä—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ–º

### 1. `default.puml` ‚Äî —Ç–µ–º–Ω–∞—è VS Code —Ç–µ–º–∞

- –§–æ–Ω: `#1E1E1E`
- –¢–µ–∫—Å—Ç: `#D4D4D4`
- –ê–∫—Ü–µ–Ω—Ç—ã: —Å–∏–Ω–∏–π `#007ACC`, –≥–æ–ª—É–±–æ–π `#569CD6`, –∑–µ–ª–µ–Ω—ã–π `#4EC9B0`

### 2. `dark_gold.puml` ‚Äî —Ç–µ–º–Ω–∞—è –∑–æ–ª–æ—Ç–∞—è —Ç–µ–º–∞

- –§–æ–Ω: `#1a1a1a`
- –¢–µ–∫—Å—Ç: `#e0e0e0`
- –ê–∫—Ü–µ–Ω—Ç—ã: –∑–æ–ª–æ—Ç–æ–π `#d4af37`, —Å–µ—Ä—ã–π `#888888`

### 3. `light_fresh.puml` ‚Äî —Å–≤–µ—Ç–ª–∞—è –º—è—Ç–Ω–∞—è —Ç–µ–º–∞

- –§–æ–Ω: `#f0faf5`
- –¢–µ–∫—Å—Ç: `#0b2e1d`
- –ê–∫—Ü–µ–Ω—Ç—ã: –∑–µ–ª–µ–Ω—ã–π `#4dd191`, –∂–µ–ª—Ç—ã–π `#e3c764`, —Å–∏–Ω–∏–π `#b5beeb`

## –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º —Ç–µ–º—ã

- [ ] –í—Å–µ 3 —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–∞ (Adapter/Core/Infrastructure) –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è class
- [ ] –í—Å–µ 3 —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è component
- [ ] Title –∏–º–µ–µ—Ç —è–≤–Ω—ã–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –∏ –æ–±–≤–æ–¥–∫–∏
- [ ] Legend –∏–º–µ–µ—Ç —è–≤–Ω—ã–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –∏ –æ–±–≤–æ–¥–∫–∏
- [ ] Note –∏–º–µ–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- [ ] Database, Queue, Collections, Entity, Boundary, Control –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Actor –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Activity –∏–º–µ–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- [ ] ActivityStart –∏ ActivityEnd –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ø–í–ù–û
- [ ] Partition –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Swimlane –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Package –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Node, Cloud, Folder, Artifact –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –ó–∞–ø—É—â–µ–Ω—ã –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
- [ ] –í—Å–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å

## –ì–¥–µ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —Ç–µ–º—É

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª –≤ `asset/themes/your_theme_name.puml`.

–¢–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑:

- MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `list_plantuml_themes`
- –ü–∞—Ä–∞–º–µ—Ç—Ä `theme_name` –≤ `generate_architecture_diagram`

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –≤–æ–ø—Ä–æ—Å—ã –ø–æ PlantUML —ç–ª–µ–º–µ–Ω—Ç–∞–º, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: <https://plantuml.com/>
- –¢–µ—Å—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞: `tests/test_theme_visual_check.py`
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ–º—ã: `asset/themes/`

```

## `FAQ.md`

```md
# ‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã (FAQ)

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [–û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã](#–æ–±—â–∏–µ-–≤–æ–ø—Ä–æ—Å—ã)
- [–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã MCP](#–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã-mcp)
- [–ö–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π](#–∫–∞—á–µ—Å—Ç–≤–æ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
- [PlantUML —Ç–µ–º—ã](#plantuml-—Ç–µ–º—ã)
- [–°—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã](#—Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã)
- [–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å](#–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)

---

## –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã

### ‚ùì –ß—Ç–æ —Ç–∞–∫–æ–µ Code to Image MCP?

MCP (Model Context Protocol) —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö **—Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞** –∏ **UML –¥–∏–∞–≥—Ä–∞–º–º**. –†–∞–±–æ—Ç–∞–µ—Ç —Å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞–º–∏ (Cline, Claude Desktop) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

- –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∫–æ–¥–∞ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ (Python, JS, SQL –∏ –¥—Ä.)
- PlantUML –¥–∏–∞–≥—Ä–∞–º–º—ã —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π/–∫–ª–∞—Å—Å–æ–≤ –∏–∑ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–¥–æ 5x scale_factor)

### ‚ùì –ö–∞–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã?

**–î–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞:**

- Python 3.11+
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ `requirements.txt`

**–î–ª—è PlantUML –¥–∏–∞–≥—Ä–∞–º–º (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ):**

- Java JRE 8+ –≤ PATH

**–î–ª—è MCP —Å–µ—Ä–≤–µ—Ä–∞:**

- Cline –∏–ª–∏ Claude Desktop —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π MCP

### ‚ùì –ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç Carbon/Chalk?

| –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å | Code to Image MCP | Carbon/Chalk |
|-------------|-------------------|--------------|
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI | ‚úÖ –ù–∞—Ç–∏–≤–Ω–∞—è —á–µ—Ä–µ–∑ MCP | ‚ùå –†—É—á–Ω–æ–π –∫–æ–ø–∏–ø–∞—Å—Ç |
| –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π | ‚úÖ AST –ø–∞—Ä—Å–µ—Ä | ‚ùå –ù–µ—Ç |
| PlantUML –¥–∏–∞–≥—Ä–∞–º–º—ã | ‚úÖ –î–∞ | ‚ùå –¢–æ–ª—å–∫–æ –∫–æ–¥ |
| –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ | ‚úÖ –î–∞ | ‚ö†Ô∏è –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–µ—Ä–≤–∏—Å–∞ |
| –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è | ‚úÖ –ß–µ—Ä–µ–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã | ‚ùå –†—É—á–Ω–∞—è |

---

## –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã MCP

### ‚ùì –°–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–µ—Ä–≤–µ—Ä?

**7 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:**

**–°–∫—Ä–∏–Ω—à–æ—Ç—ã –∫–æ–¥–∞ (3):**

1. `generate_code_screenshot` - –∏–∑ —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞
2. `generate_file_screenshot` - –∏–∑ —Ñ–∞–π–ª–∞ (‚â§200 —Å—Ç—Ä–æ–∫)
3. `generate_entity_screenshot` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π/–∫–ª–∞—Å—Å–æ–≤ (–±–µ–∑ –ª–∏–º–∏—Ç–∞)

**PlantUML –¥–∏–∞–≥—Ä–∞–º–º—ã (4):**
4. `generate_architecture_diagram` - –∏–∑ PlantUML –∫–æ–¥–∞
5. `generate_diagram_from_file` - –∏–∑ `.puml` —Ñ–∞–π–ª–∞
6. `get_plantuml_guide` - —Å–ø—Ä–∞–≤–∫–∞ –ø–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É
7. `list_plantuml_themes` - —Å–ø–∏—Å–æ–∫ —Ç–µ–º

### ‚ùì –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `generate_entity_screenshot` –≤–º–µ—Å—Ç–æ `generate_file_screenshot`?

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `generate_entity_screenshot` –∫–æ–≥–¥–∞:**

- –§–∞–π–ª –±–æ–ª—å—à–µ 200 —Å—Ç—Ä–æ–∫
- –ù—É–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è/–∫–ª–∞—Å—Å/–º–µ—Ç–æ–¥
- –í–∞–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω—ã –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ AI
- –ù—É–∂–Ω–æ –∏–∑–≤–ª–µ—á—å –º–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞ (`ClassName.method_name`)

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `generate_file_screenshot` –∫–æ–≥–¥–∞:**

- –§–∞–π–ª –º–µ–Ω—å—à–µ 200 —Å—Ç—Ä–æ–∫
- –ù—É–∂–µ–Ω –≤–µ—Å—å —Ñ–∞–π–ª —Ü–µ–ª–∏–∫–æ–º
- –≠—Ç–æ –∫–æ–Ω—Ñ–∏–≥ –∏–ª–∏ –Ω–µ–±–æ–ª—å—à–æ–π —Å–∫—Ä–∏–ø—Ç

**–ü—Ä–∏–º–µ—Ä:**

```python
# ‚ùå –§–∞–π–ª 500 —Å—Ç—Ä–æ–∫ - –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç
generate_file_screenshot("large_file.py", ...)

# ‚úÖ –ò–∑–≤–ª–µ—á—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
generate_entity_screenshot(
    file_path="large_file.py",
    entity_name="process_data",  # –¢–æ–ª—å–∫–æ —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è
    output_path="output.png"
)
```

### ‚ùì –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `generate_entity_screenshot` –¥–ª—è JavaScript/TypeScript?

**–ù–µ—Ç.** –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **—Ç–æ–ª—å–∫–æ Python** —Ñ–∞–π–ª—ã (`.py`).

**–ü—Ä–∏—á–∏–Ω–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥—É–ª—å `ast` (Abstract Syntax Tree) –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ Python-–∫–æ–¥–∞.

**–î–ª—è –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–æ–≤:**

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `generate_file_screenshot` (‚â§200 —Å—Ç—Ä–æ–∫)
- –ò–ª–∏ –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–¥–∞–π—Ç–µ –∫–æ–¥ –≤ `generate_code_screenshot`

### ‚ùì –ö–∞–∫ –∏–∑–≤–ª–µ—á—å –º–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞?

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç `ClassName.method_name`:

```python
generate_entity_screenshot(
    file_path="C:/code/processor.py",
    entity_name="DataProcessor.validate",  # –ú–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞
    output_path="C:/screenshots/validate.png"
)
```

---

## –ö–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### ‚ùì –ß—Ç–æ —Ç–∞–∫–æ–µ `detail_level` –∏ –∫–∞–∫ –µ–≥–æ –≤—ã–±—Ä–∞—Ç—å?

`detail_level` —É–ø—Ä–∞–≤–ª—è–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π `scale_factor`:

| –£—Ä–æ–≤–µ–Ω—å | scale_factor | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ | –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ |
|---------|-------------|---------------|--------------|
| `Low` | 1.0x | –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–µ–≤—å—é, —á–µ—Ä–Ω–æ–≤–∏–∫–∏ | ~20-50 KB |
| `Medium` | 2.0x | –í–µ–±-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | ~50-150 KB |
| `High` | 3.0x | **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é** - GitHub README | ~100-300 KB |
| `Ultra` | 4.0x | –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏, –ø–µ—á–∞—Ç—å | ~300-800 KB |
| `Extreme` | 5.0x | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ | ~1-5 MB |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

- –î–ª—è –≤–µ–±–∞: `Medium` –∏–ª–∏ `High`
- –î–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π: `Ultra`
- –î–ª—è –ø–µ—á–∞—Ç–∏ –≤ –≤—ã—Å–æ–∫–æ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏: `Extreme`

### ‚ùì –ü–æ—á–µ–º—É —Ç–µ–∫—Å—Ç —Ä–∞–∑–º—ã—Ç—ã–π?

**–ü—Ä–∏—á–∏–Ω–∞ 1:** –ù–∏–∑–∫–∏–π `detail_level`.

**–†–µ—à–µ–Ω–∏–µ:**

```python
detail_level="Ultra"  # –í–º–µ—Å—Ç–æ Low/Medium
```

**–ü—Ä–∏—á–∏–Ω–∞ 2:** –§–æ—Ä–º–∞—Ç JPEG —Å –∫–æ–º–ø—Ä–µ—Å—Å–∏–µ–π.

**–†–µ—à–µ–Ω–∏–µ:**

```python
image_format="png"  # –í–º–µ—Å—Ç–æ jpeg
```

**–ü—Ä–∏—á–∏–Ω–∞ 3:** –ú–µ–ª–∫–∏–π —à—Ä–∏—Ñ—Ç.

**–†–µ—à–µ–Ω–∏–µ:**

```python
font_size=20  # –í–º–µ—Å—Ç–æ 14
```

### ‚ùì –ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã–±—Ä–∞—Ç—å?

| –§–æ—Ä–º–∞—Ç | –ö–∞—á–µ—Å—Ç–≤–æ | –†–∞–∑–º–µ—Ä | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|--------|----------|--------|---------------|
| `webp` | ‚≠ê‚≠ê‚≠ê‚≠ê | üü¢ –ú–∞–ª–µ–Ω—å–∫–∏–π | **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é** - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å |
| `png` | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | üî¥ –ë–æ–ª—å—à–æ–π | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å |
| `jpeg` | ‚≠ê‚≠ê‚≠ê | üü¢ –ú–∞–ª–µ–Ω—å–∫–∏–π | –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ (–ù–ï –¥–ª—è –∫–æ–¥–∞!) |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

- –î–ª—è –≤–µ–±-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏: `webp` (–ª—É—á—à–∏–π –±–∞–ª–∞–Ω—Å)
- –î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞: `png`
- –ò–∑–±–µ–≥–∞–π—Ç–µ `jpeg` –¥–ª—è –∫–æ–¥–∞ (–∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏)

### ‚ùì –ö–∞–∫ —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞?

**–°–ø–æ—Å–æ–± 1:** –ü–æ–Ω–∏–∑–∏—Ç—å `detail_level`

```python
detail_level="Medium"  # –í–º–µ—Å—Ç–æ Ultra/Extreme
```

**–°–ø–æ—Å–æ–± 2:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WebP

```python
image_format="webp"  # –ú–µ–Ω—å—à–µ —á–µ–º PNG
```

**–°–ø–æ—Å–æ–± 3:** –£–º–µ–Ω—å—à–∏—Ç—å `font_size`

```python
font_size=16  # –í–º–µ—Å—Ç–æ 20
```

**–°–ø–æ—Å–æ–± 4:** –û—Ç–∫–ª—é—á–∏—Ç—å –Ω—É–º–µ—Ä–∞—Ü–∏—é —Å—Ç—Ä–æ–∫

```python
line_numbers=False  # –ú–µ–Ω—å—à–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
```

---

## PlantUML —Ç–µ–º—ã

### ‚ùì –ö–∞–∫–∏–µ —Ç–µ–º—ã –¥–æ—Å—Ç—É–ø–Ω—ã?

**3 –≥–æ—Ç–æ–≤—ã–µ —Ç–µ–º—ã:**

1. **`default`** - —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞ –≤ —Å—Ç–∏–ª–µ VS Code (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - –§–æ–Ω: —Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–π
   - –ê–∫—Ü–µ–Ω—Ç—ã: —Å–∏–Ω–∏–π, –≥–æ–ª—É–±–æ–π, –∑–µ–ª–µ–Ω—ã–π
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è

2. **`dark_gold`** - —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞ —Å –∑–æ–ª–æ—Ç—ã–º–∏ –∞–∫—Ü–µ–Ω—Ç–∞–º–∏
   - –§–æ–Ω: —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π
   - –ê–∫—Ü–µ–Ω—Ç—ã: –∑–æ–ª–æ—Ç–æ–π, —Å–∏–Ω–∏–π, –∑–µ–ª–µ–Ω—ã–π
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏, —ç—Ñ—Ñ–µ–∫—Ç–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã

3. **`light_fresh`** - —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ —Å –ø–∞—Å—Ç–µ–ª—å–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏
   - –§–æ–Ω: –±–µ–ª—ã–π
   - –ê–∫—Ü–µ–Ω—Ç—ã: –∑–µ–ª–µ–Ω—ã–π, —Å–∏–Ω–∏–π, –æ—Ä–∞–Ω–∂–µ–≤—ã–π
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –ø–µ—á–∞—Ç—å, —Å–≤–µ—Ç–ª–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫:**

```python
list_plantuml_themes()
```

### ‚ùì –ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å —Ç–µ–º—É –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º—ã?

```python
generate_architecture_diagram(
    diagram_code="@startuml\ncomponent API\n@enduml",
    output_path="C:/diagrams/api.png",
    theme_name='dark_gold'  # –í—ã–±–æ—Ä —Ç–µ–º—ã
)
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

- –¢–µ–º–Ω—ã–µ —Å–ª–∞–π–¥—ã ‚Üí `dark_gold`
- –°–≤–µ—Ç–ª–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Üí `light_fresh`
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è ‚Üí `default`

### ‚ùì –ú–æ–∂–Ω–æ –ª–∏ —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ—é —Ç–µ–º—É?

**–î–∞!** –°–º. [doc/theme_creation_guide.md](doc/theme_creation_guide.md)

**–ö—Ä–∞—Ç–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å:**

1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `asset/themes/default.puml` –≤ –Ω–æ–≤—É—é —Ç–µ–º—É
2. –ò–∑–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç–æ–≤—É—é –ø–∞–ª–∏—Ç—Ä—É (—Ñ–æ–Ω, –∞–∫—Ü–µ–Ω—Ç—ã, —Ç–µ–∫—Å—Ç)
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –≤—Å–µ—Ö —Ç–∏–ø–∞—Ö –¥–∏–∞–≥—Ä–∞–º–º
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (title, legend, partition –∏ –¥—Ä.)

---

## –°—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã

### ‚ùì –ß—Ç–æ —Ç–∞–∫–æ–µ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã –∏ –∑–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–Ω—ã?

**–°—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã** - —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º PlantUML –¥–ª—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞—Å–∫—Ä–∞—Å–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤** –±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥–∏–Ω–≥–∞ —Ü–≤–µ—Ç–æ–≤.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- ‚úÖ –¢–µ–º–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º–∏ —Ü–≤–µ—Ç–∞–º–∏
- ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ
- ‚úÖ –õ–µ–≥–∫–æ –º–µ–Ω—è—Ç—å —Ç–µ–º—ã –±–µ–∑ –ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞

**–ü—Ä–∏–º–µ—Ä –±–µ–∑ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤ (–ø–ª–æ—Ö–æ):**

```plantuml
component "API" #FF0000       ‚ùå –•–∞—Ä–¥–∫–æ–¥ —Ü–≤–µ—Ç–∞
database "PostgreSQL" #00FF00 ‚ùå –ù–µ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ
```

**–ü—Ä–∏–º–µ—Ä —Å–æ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–∞–º–∏ (—Ö–æ—Ä–æ—à–æ):**

```plantuml
component "API" <<Adapter>>              ‚úÖ –ê–≤—Ç–æ—Ü–≤–µ—Ç –æ—Ç —Ç–µ–º—ã
database "PostgreSQL" <<Infrastructure>> ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ
```

### ‚ùì –ö–∞–∫–∏–µ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è?

**–î–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ):**

| –°—Ç–µ—Ä–µ–æ—Ç–∏–ø | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä —Ü–≤–µ—Ç–∞ (dark_gold) |
|-----------|------------|-------------------------|
| `<<Adapter>>` | –í—Ö–æ–¥–Ω—ã–µ —Ç–æ—á–∫–∏ (API, UI, CLI) | üü° –ó–æ–ª–æ—Ç–æ–π (#FFD700) |
| `<<Core>>` | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (Services, Use Cases) | üîµ –°–∏–Ω–∏–π (#4169E1) |
| `<<Infrastructure>>` | –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ë–î, –∫–µ—à, –æ—á–µ—Ä–µ–¥–∏) | üü¢ –ó–µ–ª–µ–Ω—ã–π (#32CD32) |

**–ü—Ä–∏–º–µ—Ä:**

```plantuml
@startuml
component "REST API" <<Adapter>> as api
component "Order Service" <<Core>> as order
database "PostgreSQL" <<Infrastructure>> as db

api --> order
order --> db
@enduml
```

### ‚ùì –ß—Ç–æ –±—É–¥–µ—Ç –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã?

**–í–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã:**

- ‚ùå –≠–ª–µ–º–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å —á–µ—Ä–Ω—ã–π —Ü–≤–µ—Ç –Ω–∞ —Ç–µ–º–Ω–æ–º —Ñ–æ–Ω–µ
- ‚ùå –ù–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ —Ü–≤–µ—Ç–æ–≤ –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
- ‚ùå –¢–µ–º–∞ –Ω–µ –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã –¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤.

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### ‚ùì –ü–æ—á–µ–º—É –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º –¥–æ–ª–≥–∞—è?

**–ü—Ä–∏—á–∏–Ω–∞ 1:** PlantUML –∑–∞–ø—É—Å–∫–∞–µ—Ç Java –ø—Ä–æ—Ü–µ—Å—Å.

**–†–µ—à–µ–Ω–∏–µ:** –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ ~2-5 —Å–µ–∫—É–Ω–¥.

**–ü—Ä–∏—á–∏–Ω–∞ 2:** –í—ã—Å–æ–∫–∏–π `detail_level`.

**–†–µ—à–µ–Ω–∏–µ:**

```python
detail_level="Medium"  # –ë—ã—Å—Ç—Ä–µ–µ —á–µ–º Ultra/Extreme
```

**–ü—Ä–∏—á–∏–Ω–∞ 3:** –°–ª–æ–∂–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —ç–ª–µ–º–µ–Ω—Ç–æ–≤.

**–†–µ—à–µ–Ω–∏–µ:** –£–ø—Ä–æ—Å—Ç–∏—Ç–µ –¥–∏–∞–≥—Ä–∞–º–º—É –∏–ª–∏ —Ä–∞–∑–±–µ–π—Ç–µ –Ω–∞ —á–∞—Å—Ç–∏.

### ‚ùì –ú–æ–∂–Ω–æ –ª–∏ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã?

**–î–ª—è –¥–∏–∞–≥—Ä–∞–º–º:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `generate_diagram_from_file`:

```python
# 1. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ PlantUML –∫–æ–¥ –≤ —Ñ–∞–π–ª –æ–¥–∏–Ω —Ä–∞–∑
# diagram.puml

# 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∏–∑ —Ñ–∞–π–ª–∞ (—ç–∫–æ–Ω–æ–º–∏—Ç —Ç–æ–∫–µ–Ω—ã)
generate_diagram_from_file(
    file_path="C:/diagrams/diagram.puml",
    output_path="C:/output/diagram.png"
)
```

**–î–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤:** –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª - –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ –Ω—É–∂–Ω–∞.

### ‚ùì –°–∫–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω–æ–≤ —Ä–∞—Å—Ö–æ–¥—É–µ—Ç—Å—è –Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã?

**–ë–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

- `generate_architecture_diagram` - –ø–µ—Ä–µ–¥–∞—ë—Ç–µ PlantUML –∫–æ–¥ –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- ~500-2000 —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º—É

**–° –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π:**

- `generate_diagram_from_file` - —Ç–æ–ª—å–∫–æ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
- ~50-100 —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º—É

**–≠–∫–æ–Ω–æ–º–∏—è:** 10-40x –º–µ–Ω—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤!

---

## CRITICAL RULES –¥–ª—è AI –∞–≥–µ–Ω—Ç–æ–≤

### ‚ùì –ü–æ—á–µ–º—É AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã?

**–ü—Ä–æ–±–ª–µ–º–∞:** AI –º–æ–∂–µ—Ç –Ω–µ –∑–Ω–∞—Ç—å –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∞–≤–∏–ª–∞—Ö.

**–†–µ—à–µ–Ω–∏–µ:** –í—Å–µ–≥–¥–∞ —Å–ª–µ–¥—É–π—Ç–µ **5 CRITICAL RULES** (—Å–º. README.md):

1. **–ù–ò–ö–û–ì–î–ê** –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `!theme`/`!include` –≤ –∫–æ–¥–µ –¥–∏–∞–≥—Ä–∞–º–º—ã
2. **–í–°–ï–ì–î–ê** –≤—ã–∑—ã–≤–∞–π—Ç–µ `list_plantuml_themes` –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
3. **–í–°–ï–ì–î–ê** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `get_plantuml_guide` –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º
4. **–ò–°–ü–û–õ–¨–ó–£–ô–¢–ï –¢–û–õ–¨–ö–û** —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
5. **–ü—É—Å—Ç—å —Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç –í–°–ï–ú–ò —Ü–≤–µ—Ç–∞–º–∏**

### ‚ùì –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å PlantUML –∫–æ–¥–∞?

**–®–∞–≥ 1:** –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –≥–∞–π–¥

```python
get_plantuml_guide(
    diagram_type='component',
    detail_level='brief'
)
```

**–®–∞–≥ 2:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–æ—Ç–∏–≤ –≥–∞–π–¥–∞

**–®–∞–≥ 3:** –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–µ—Ç:

- ‚ùå `!theme` –¥–∏—Ä–µ–∫—Ç–∏–≤
- ‚ùå –•–∞—Ä–¥–∫–æ–¥–∏–Ω–≥–∞ —Ü–≤–µ—Ç–æ–≤ (`#FF0000`)
- ‚ùå –≠–ª–µ–º–µ–Ω—Ç–æ–≤ –±–µ–∑ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤

**–®–∞–≥ 4:** –ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º:** [TROUBLESHOOTING.md](TROUBLESHOOTING.md)
- **PlantUML –≥–∞–π–¥—ã:** [doc/plantuml_guides/](doc/plantuml_guides/)
- **–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–º:** [doc/theme_creation_guide.md](doc/theme_creation_guide.md)
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:** [doc/developers/architecture.md](doc/developers/architecture.md)

```

## `README.md`

```md
# üì∏ Code to Image MCP

MCP —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Pygments –∏ Pillow.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
code_to_image_mcp/
‚îú‚îÄ‚îÄ server.py              # MCP —Å–µ—Ä–≤–µ—Ä (—Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞)
‚îú‚îÄ‚îÄ src/                   # –ü–∞–∫–µ—Ç —Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ code_to_image.py   # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ diagram_renderer.py # –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ PlantUML –¥–∏–∞–≥—Ä–∞–º–º
‚îÇ   ‚îú‚îÄ‚îÄ font_manager.py    # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ font_initializer.py # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ –¥–ª—è PlantUML
‚îÇ   ‚îú‚îÄ‚îÄ image_utils.py     # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ guide_manager.py   # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–∞–π–¥–∞–º–∏ –ø–æ PlantUML
‚îú‚îÄ‚îÄ tests/                 # –¢–µ—Å—Ç—ã –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_*.py         # Unit-—Ç–µ—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ demo_all_diagrams.py # –î–µ–º–æ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º
‚îú‚îÄ‚îÄ asset/                 # –†–µ—Å—É—Ä—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ bins/             # PlantUML JAR
‚îÇ   ‚îú‚îÄ‚îÄ fonts/            # TTF —à—Ä–∏—Ñ—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ themes/           # PlantUML —Ç–µ–º—ã
‚îî‚îÄ‚îÄ doc/                   # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
    ‚îú‚îÄ‚îÄ plantuml_guides/  # –ì–∞–π–¥—ã –ø–æ PlantUML
    ‚îî‚îÄ‚îÄ ideas/            # –ò–¥–µ–∏ –∏ –ø–ª–∞–Ω—ã
```

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üé® **–ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Å—Ç–∏–ª–µ–π** - monokai, dracula, github-dark, vim –∏ –¥—Ä—É–≥–∏–µ
- üîç **–í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ** - scale_factor –¥–ª—è –∫—Ä–∏—Å—Ç–∞–ª—å–Ω–æ–π —á–µ—Ç–∫–æ—Å—Ç–∏
- üìù **–ù—É–º–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–∫** - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π —Å—Ç–∏–ª—å –∏ –æ—Ç—Å—Ç—É–ø—ã
- üåà **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —è–∑—ã–∫–æ–≤** - Python, TypeScript, JavaScript, SQL, Go, Rust –∏ –º–Ω–æ–≥–∏–µ –¥—Ä—É–≥–∏–µ
- üíæ **–§–æ—Ä–º–∞—Ç—ã –≤—ã–≤–æ–¥–∞** - WEBP, PNG, JPEG
- ‚öôÔ∏è **–ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** - —à—Ä–∏—Ñ—Ç—ã, —Ä–∞–∑–º–µ—Ä—ã, –æ—Ç—Å—Ç—É–ø—ã

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

```powershell
python -m venv venv
.\venv\Scripts\Activate.ps1
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```powershell
pip install -r requirements.txt
```

## üöÄ –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç

```powershell
python server.py
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ Cline

–î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ MCP —Å–µ—Ä–≤–µ—Ä–æ–≤ Cline (Settings ‚Üí MCP Servers):

```json
{
  "mcpServers": {
    "code-screenshot": {
      "command": "c:\\PY\\code_to_image_mcp\\venv\\Scripts\\python.exe",
      "args": ["c:\\PY\\code_to_image_mcp\\server.py"]
    }
  }
}
```

**–í–∞–∂–Ω–æ:** –ü—É—Ç—å –∫ `python.exe` –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä –∏–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞!

## üí° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

MCP —Å–µ—Ä–≤–µ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **—Å–µ–º—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤**:

### –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∫–æ–¥–∞

1. **`generate_code_screenshot`** - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞
2. **`generate_file_screenshot`** - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –∏–∑ —Ñ–∞–π–ª–∞ (‚ö†Ô∏è –ª–∏–º–∏—Ç 200 —Å—Ç—Ä–æ–∫)
3. **`generate_entity_screenshot`** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏/–∫–ª–∞—Å—Å–∞ –∏–∑ Python-—Ñ–∞–π–ª–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ (‚ú® –±–µ–∑ –ª–∏–º–∏—Ç–∞ —Å—Ç—Ä–æ–∫)

### PlantUML –¥–∏–∞–≥—Ä–∞–º–º—ã

4. **`generate_architecture_diagram`** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã –∏–∑ PlantUML –∫–æ–¥–∞
5. **`generate_diagram_from_file`** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã –∏–∑ .puml —Ñ–∞–π–ª–∞ (—ç–∫–æ–Ω–æ–º–∏—Ç —Ç–æ–∫–µ–Ω—ã)
6. **`get_plantuml_guide`** - —Å–ø—Ä–∞–≤–∫–∞ –ø–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É PlantUML
7. **`list_plantuml_themes`** - —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ–º

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ Cline

**–°–∫—Ä–∏–Ω—à–æ—Ç –∏–∑ —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞:**

```text
–°–æ–∑–¥–∞–π —Å–∫—Ä–∏–Ω—à–æ—Ç —ç—Ç–æ–≥–æ Python –∫–æ–¥–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–∏ –≤ C:/screenshots/example.webp
```

**–°–∫—Ä–∏–Ω—à–æ—Ç –∏–∑ —Ñ–∞–π–ª–∞:**

```text
–°–¥–µ–ª–∞–π —Å–∫—Ä–∏–Ω—à–æ—Ç —Ñ–∞–π–ª–∞ C:/projects/app.py –∏ —Å–æ—Ö—Ä–∞–Ω–∏ –≤ C:/screenshots/app.webp
```

**–°–∫—Ä–∏–Ω—à–æ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –±–æ–ª—å—à–æ–≥–æ —Ñ–∞–π–ª–∞:**

```text
–°–æ–∑–¥–∞–π —Å–∫—Ä–∏–Ω—à–æ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ process_string –∏–∑ —Ñ–∞–π–ª–∞ C:/PY/code_to_image_mcp/test/test_functions.py
```

**–° –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–µ–π:**

```text
–°–¥–µ–ª–∞–π —Å–∫—Ä–∏–Ω—à–æ—Ç –º–µ—Ç–æ–¥–∞ DataProcessor.validate –≤ —Å—Ç–∏–ª–µ dracula, 
—Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ 20, –º–∞—Å—à—Ç–∞–± 4x, –±–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤
```

**–ë–µ–∑ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫:**

```
"–°–æ–∑–¥–∞–π —Å–∫—Ä–∏–Ω—à–æ—Ç SQL –∑–∞–ø—Ä–æ—Å–∞ –±–µ–∑ –Ω–æ–º–µ—Ä–æ–≤ —Å—Ç—Ä–æ–∫, 
—Å—Ç–∏–ª—å github-dark, —Ñ–æ—Ä–º–∞—Ç WEBP"
```

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

#### 1. generate_code_screenshot

–°–æ–∑–¥–∞—ë—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç –∏–∑ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞.

#### 2. generate_file_screenshot

–°–æ–∑–¥–∞—ë—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç –∏–∑ —Ñ–∞–π–ª–∞. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —è–∑—ã–∫ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ–∞–π–ª–∞.

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ - **200 —Å—Ç—Ä–æ–∫**. –î–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `generate_entity_screenshot`.

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:**
`.py`, `.js`, `.ts`, `.jsx`, `.tsx`, `.java`, `.c`, `.cpp`, `.cs`, `.go`, `.rs`, `.rb`, `.php`, `.swift`, `.kt`, `.scala`, `.sql`, `.html`, `.css`, `.json`, `.yaml`, `.yml`, `.xml`, `.sh`, `.bat`, `.ps1`, `.md`

### 3Ô∏è‚É£ `generate_entity_screenshot` - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏/–∫–ª–∞—Å—Å–∞ –∏–∑ Python-—Ñ–∞–π–ª–∞

**–£–º–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π, –∫–ª–∞—Å—Å–æ–≤ –∏–ª–∏ –º–µ—Ç–æ–¥–æ–≤ –∏–∑ –±–æ–ª—å—à–∏—Ö Python-—Ñ–∞–π–ª–æ–≤ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–º–µ—Ä.

**–ü—Ä–∏–º–µ—Ä 1: –ò–∑–≤–ª–µ—á—å —Ñ—É–Ω–∫—Ü–∏—é**

```text
–°–æ–∑–¥–∞–π —Å–∫—Ä–∏–Ω—à–æ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ process_string –∏–∑ —Ñ–∞–π–ª–∞ C:/test/test_functions.py
```

**–ü—Ä–∏–º–µ—Ä 2: –ò–∑–≤–ª–µ—á—å –∫–ª–∞—Å—Å**

```text
–°–æ–∑–¥–∞–π —Å–∫—Ä–∏–Ω—à–æ—Ç –∫–ª–∞—Å—Å–∞ DataProcessor –∏–∑ C:/code/processor.py —Å —à—Ä–∏—Ñ—Ç–æ–º FiraCode
```

**–ü—Ä–∏–º–µ—Ä 3: –ò–∑–≤–ª–µ—á—å –º–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞**

```text
–°–æ–∑–¥–∞–π —Å–∫—Ä–∏–Ω—à–æ—Ç –º–µ—Ç–æ–¥–∞ DataProcessor.validate –∏–∑ C:/code/processor.py –±–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **AST (Abstract Syntax Tree)** –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–¥–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã —Ñ—É–Ω–∫—Ü–∏–∏/–∫–ª–∞—Å—Å–∞
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã (–º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å)
- **–ù–µ—Ç –ª–∏–º–∏—Ç–∞ –Ω–∞ —Ä–∞–∑–º–µ—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞** - –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å

**–í–ê–ñ–ù–û (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ):** `generate_entity_screenshot` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å **Python**-—Ñ–∞–π–ª–∞–º–∏ (`*.py`).
–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥—É–ª—å `ast` –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–æ–¥–∞ ‚Äî –æ–Ω –ø–æ–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ
Python-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å. –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å —Ñ–∞–π–ª –Ω–∞ –¥—Ä—É–≥–æ–º —è–∑—ã–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, JavaScript,
TypeScript, Go –∏ —Ç.–¥.), –ø–∞—Ä—Å–µ—Ä –≤—ã–¥–∞—Å—Ç `SyntaxError` –∏–ª–∏ –∏–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç –¥–ª—è —Ñ–∞–π–ª–æ–≤ –Ω–∞ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ
`generate_file_screenshot` (—Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤—Å–µ–≥–æ —Ñ–∞–π–ª–∞) –∏–ª–∏ —Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ –∫–æ–¥ –≤—Ä—É—á–Ω—É—é
–∏ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –µ–≥–æ —á–µ—Ä–µ–∑ `generate_code_screenshot`.

**–§–æ—Ä–º–∞—Ç entity_name:**

- –§—É–Ω–∫—Ü–∏—è: `function_name`
- –ö–ª–∞—Å—Å: `ClassName`
- –ú–µ—Ç–æ–¥: `ClassName.method_name`

**–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Å–∫—Ä–∏–Ω—à–æ—Ç:**

- –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã (–µ—Å–ª–∏ `include_decorators=True`)
- –°–∏–≥–Ω–∞—Ç—É—Ä–∞ —Ñ—É–Ω–∫—Ü–∏–∏/–∫–ª–∞—Å—Å–∞
- –¢–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏/–∫–ª–∞—Å—Å–∞
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: –∏–º—è —Å—É—â–Ω–æ—Å—Ç–∏, –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª, –¥–∏–∞–ø–∞–∑–æ–Ω —Å—Ç—Ä–æ–∫

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

**–û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|----------|
| `output_path` | str | *–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ* | –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É |
| `language` | str | –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ | –Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è |
| `style` | str | `monokai` | –°—Ç–∏–ª—å –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ |
| `font` | str | `JetBrainsMono` | –®—Ä–∏—Ñ—Ç (JetBrainsMono/FiraCode/CascadiaCode) |
| `font_size` | int | `14-18` | –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ |
| `scale_factor` | float | `2.0-3.0` | –§–∞–∫—Ç–æ—Ä –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è (1.0-5.0) |
| `line_numbers` | bool | `True` | –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω—É–º–µ—Ä–∞—Ü–∏—é —Å—Ç—Ä–æ–∫ |
| `image_format` | str | `webp` | –§–æ—Ä–º–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (webp/png/jpeg) |

**–°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è `generate_entity_screenshot`:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|----------|
| `file_path` | str | *–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ* | –ü—É—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É Python-—Ñ–∞–π–ª—É |
| `entity_name` | str | *–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ* | –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏/–∫–ª–∞—Å—Å–∞/–º–µ—Ç–æ–¥–∞ |
| `include_decorators` | bool | `True` | –í–∫–ª—é—á–∞—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –≤ —Å–∫—Ä–∏–Ω—à–æ—Ç |

### –£—Ä–æ–≤–Ω–∏ –∫–∞—á–µ—Å—Ç–≤–∞ (detail_level)

–ü–∞—Ä–∞–º–µ—Ç—Ä `detail_level` —É–ø—Ä–∞–≤–ª—è–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π `scale_factor`:

| –£—Ä–æ–≤–µ–Ω—å | scale_factor | –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|---------|-------------|-----------|---------------|
| `Low` | 1.0x | –ë–∞–∑–æ–≤–æ–µ | –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–µ–≤—å—é, –Ω–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ |
| `Medium` | 2.0x | 2x | –í–µ–±-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, –±–∞–ª–∞–Ω—Å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ |
| `High` | 3.0x | 3x | **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é** - –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ |
| `Ultra` | 4.0x | 4x | –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏, –ø–µ—á–∞—Ç—å, –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ |
| `Extreme` | 5.0x | 5x | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –±–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

- –î–ª—è –≤–µ–±-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏: `Medium` (2.0x)
- –î–ª—è GitHub README: `High` (3.0x)
- –î–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π: `Ultra` (4.0x)
- –î–ª—è –ø–µ—á–∞—Ç–∏ –≤ –≤—ã—Å–æ–∫–æ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏: `Extreme` (5.0x)

### –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ç–∏–ª–∏

- `monokai` - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞
- `dracula` - –ø–æ–ø—É–ª—è—Ä–Ω–∞—è —Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è —Ç–µ–º–∞
- `github-dark` - —Å—Ç–∏–ª—å GitHub –≤ —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ
- `vim` - —Å—Ç–∏–ª—å —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ Vim
- `one-dark` - —Å—Ç–∏–ª—å Atom One Dark
- `nord` - —Ö–æ–ª–æ–¥–Ω–∞—è —Å–∫–∞–Ω–¥–∏–Ω–∞–≤—Å–∫–∞—è –ø–∞–ª–∏—Ç—Ä–∞

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏

Python, JavaScript, TypeScript, Java, C, C++, C#, Go, Rust, Ruby, PHP, Swift, Kotlin, Scala, SQL, HTML, CSS, Shell, Bash, PowerShell, JSON, YAML, Markdown –∏ –º–Ω–æ–≥–∏–µ –¥—Ä—É–≥–∏–µ.

---

## üìê –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –î–∏–∞–≥—Ä–∞–º–º

–ü–æ–º–∏–º–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞, —Å–µ—Ä–≤–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ **UML-–¥–∏–∞–≥—Ä–∞–º–º** —á–µ—Ä–µ–∑ PlantUML —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è.

### ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê –¥–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤

**–ü–†–ò –ì–ï–ù–ï–†–ê–¶–ò–ò –î–ò–ê–ì–†–ê–ú–ú –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –°–õ–ï–î–£–ô–¢–ï –≠–¢–ò–ú –ü–†–ê–í–ò–õ–ê–ú:**

1. **–ù–ò–ö–û–ì–î–ê** –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã `!theme` –∏–ª–∏ `!include` –≤ –∫–æ–¥–µ –¥–∏–∞–≥—Ä–∞–º–º—ã
   - –¢–µ–º–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `theme_name`
   - –ü—Ä–∏–º–µ—Ä –æ—à–∏–±–∫–∏: ‚ùå `!theme dark_gold` –≤ diagram_code
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ: ‚úÖ –ü–µ—Ä–µ–¥–∞—Ç—å `theme_name='dark_gold'` –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö

2. **–í–°–ï–ì–î–ê** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `list_plantuml_themes` –ü–ï–†–ï–î –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –¥–∏–∞–≥—Ä–∞–º–º—ã
   - –ù–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π—Ç–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ–º—ã (`darkblue`, `ocean`, `corporate`)
   - –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–º—ã: `default`, `dark_gold`, `light_fresh`

3. **–í–°–ï–ì–î–ê** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `get_plantuml_guide` –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º
   - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
   - –ò–∑—É—á–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã –∏ —ç–ª–µ–º–µ–Ω—Ç—ã

4. **–ò–°–ü–û–õ–¨–ó–£–ô–¢–ï –¢–û–õ–¨–ö–û —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã** –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
   - `<<Adapter>>`, `<<Core>>`, `<<Infrastructure>>` –¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
   - –ù–ï —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç–µ —Ü–≤–µ—Ç–∞ –≤—Ä—É—á–Ω—É—é (`#000000`, `#Red`)
   - –¢–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞

5. **–ü—É—Å—Ç—å —Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç –í–°–ï–ú–ò —Ü–≤–µ—Ç–∞–º–∏**
   - –í–∞—à–∞ –∑–∞–¥–∞—á–∞ - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã, –Ω–µ –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥
   - –¢–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä –ü–†–ê–í–ò–õ–¨–ù–û–ì–û –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```text
Cline: –°–æ–∑–¥–∞–π component diagram —Å —Ç–µ–º–æ–π dark_gold

AI Agent:
1. –í—ã–∑–æ–≤ list_plantuml_themes() ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é —á—Ç–æ 'dark_gold' —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
2. –í—ã–∑–æ–≤ get_plantuml_guide(diagram_type='component') ‚Üí –∏–∑—É—á–∞—é —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
3. –ì–µ–Ω–µ—Ä–∏—Ä—É—é PlantUML –∫–æ–¥ –ë–ï–ó !theme –¥–∏—Ä–µ–∫—Ç–∏–≤
4. –í—ã–∑–æ–≤ generate_architecture_diagram(diagram_code=..., theme_name='dark_gold')
```

**–ü—Ä–∏–º–µ—Ä –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û–ì–û –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```plantuml
‚ùå @startuml
‚ùå !theme dark_gold          ‚Üê –û–®–ò–ë–ö–ê: –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ !theme
‚ùå component API #FF0000     ‚Üê –û–®–ò–ë–ö–ê: –ù–ï —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç–µ —Ü–≤–µ—Ç–∞
‚ùå @enduml
```

### üé® –°–∏—Å—Ç–µ–º–∞ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤**, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ü–≤–µ—Ç–æ–≤—É—é —Å—Ö–µ–º—É –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–µ–º—ã:

| –°—Ç–µ—Ä–µ–æ—Ç–∏–ø | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä —Ü–≤–µ—Ç–∞ (Dark Gold) | –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
|-----------|------------|-------------------------|----------------------|
| `<<Adapter>>` | –ê–¥–∞–ø—Ç–µ—Ä—ã (API, UI, CLI) | üü° –ó–æ–ª–æ—Ç–æ–π (#FFD700) | REST API, GraphQL Gateway |
| `<<Core>>` | –Ø–¥—Ä–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ | üîµ –°–∏–Ω–∏–π (#4169E1) | Domain Services, Use Cases |
| `<<Infrastructure>>` | –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ë–î, –∫–µ—à) | üü¢ –ó–µ–ª–µ–Ω—ã–π (#32CD32) | PostgreSQL, Redis, S3 |

**–ü—Ä–∏–º–µ—Ä –¥–∏–∞–≥—Ä–∞–º–º—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**

```plantuml
@startuml
component "REST API" <<Adapter>> as api
component "Order Service" <<Core>> as order
database "PostgreSQL" <<Infrastructure>> as db

api --> order : uses
order --> db : stores
@enduml
```

### üé≠ –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–º—ã

MCP —Å–µ—Ä–≤–µ—Ä –≤–∫–ª—é—á–∞–µ—Ç **3 –≥–æ—Ç–æ–≤—ã–µ —Ç–µ–º—ã**:

1. **`dark_gold`** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) - —Ç–µ–º–Ω—ã–π —Ñ–æ–Ω, –∑–æ–ª–æ—Ç—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã
2. **`light_fresh`** - —Å–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω, —Å–≤–µ–∂–∏–µ –ø–∞—Å—Ç–µ–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞
3. **`default`** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è PlantUML –ø–∞–ª–∏—Ç—Ä–∞

**–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–º:** [doc/plantuml_guides/themes.md](doc/plantuml_guides/themes.md)

### üõ†Ô∏è MCP –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º

–°–µ—Ä–≤–µ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **4 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PlantUML:

#### 1. `generate_architecture_diagram`

–°–æ–∑–¥–∞—ë—Ç –¥–∏–∞–≥—Ä–∞–º–º—É –∏–∑ PlantUML –∫–æ–¥–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º —Ç–µ–º—ã.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –≤ Cline:**

```text
–°–æ–∑–¥–∞–π component diagram –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å —Ç–µ–º–æ–π dark_gold:
- API Gateway (Adapter)
- Auth Service (Core)
- PostgreSQL (Infrastructure)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|----------|
| `diagram_code` | str | *–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ* | PlantUML –∫–æ–¥ –¥–∏–∞–≥—Ä–∞–º–º—ã |
| `output_path` | str | *–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ* | –ü—É—Ç—å –∫ –≤—ã—Ö–æ–¥–Ω–æ–º—É PNG —Ñ–∞–π–ª—É |
| `theme` | str | `dark_gold` | –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã (dark_gold/light_fresh/default) |
| `diagram_type` | str | `component` | –¢–∏–ø –¥–∏–∞–≥—Ä–∞–º–º—ã (component/class/sequence/activity) |

#### 2. `generate_diagram_from_file`

–°–æ–∑–¥–∞—ë—Ç –¥–∏–∞–≥—Ä–∞–º–º—É –∏–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ `.puml` —Ñ–∞–π–ª–∞ ‚Äî —ç–∫–æ–Ω–æ–º–∏—Ç —Ç–æ–∫–µ–Ω—ã –∏ —É–ø—Ä–æ—â–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å–æ —Å–ª–æ–∂–Ω—ã–º–∏ –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –≤ Cline:**

```text
–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –¥–∏–∞–≥—Ä–∞–º–º—É –∏–∑ —Ñ–∞–π–ª–∞ C:/diagrams/architecture.puml —Å —Ç–µ–º–æ–π dark_gold
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|----------|
| `file_path` | str | *–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ* | –ü—É—Ç—å –∫ .puml —Ñ–∞–π–ª—É —Å PlantUML –∫–æ–¥–æ–º |
| `output_path` | str | *–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ* | –ü—É—Ç—å –∫ –≤—ã—Ö–æ–¥–Ω–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é |
| `theme` | str | `dark_gold` | –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã (dark_gold/light_fresh/default) |
| `detail_level` | str | `High` | –£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ (Low/High) |
| `image_format` | str | `png` | –§–æ—Ä–º–∞—Ç (png/svg/eps/pdf) |

#### 3. `get_plantuml_guide`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É –ø–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É PlantUML –¥–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤.

**–ü—Ä–∏–º–µ—Ä:**

```text
–ü–æ–∫–∞–∂–∏ –º–Ω–µ –∫—Ä–∞—Ç–∫–∏–π –≥–∞–π–¥ –ø–æ sequence –¥–∏–∞–≥—Ä–∞–º–º–∞–º
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

- `diagram_type`: `class`, `sequence`, `component`, `activity`, `themes`
- `detail_level`: `brief` (–∫—Ä–∞—Ç–∫–∏–π) –∏–ª–∏ `full` (–ø–æ–ª–Ω—ã–π)

#### 4. `list_plantuml_themes`

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ–º —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º.

**–û—Ç–≤–µ—Ç:**

```json
{
  "themes": [
    {"name": "dark_gold", "description": "–¢–µ–º–Ω—ã–π —Ñ–æ–Ω, –∑–æ–ª–æ—Ç—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã"},
    {"name": "light_fresh", "description": "–°–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω, –ø–∞—Å—Ç–µ–ª—å–Ω—ã–µ —Ç–æ–Ω–∞"},
    {"name": "default", "description": "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è PlantUML –ø–∞–ª–∏—Ç—Ä–∞"}
  ]
}
```

### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ PlantUML

–î–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è —Å–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:

- **[–ì–∞–π–¥—ã –¥–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤](doc/plantuml_guides/)** - –∫—Ä–∞—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É
  - [Class Diagram](doc/plantuml_guides/class_diagram.md)
  - [Sequence Diagram](doc/plantuml_guides/sequence_diagram.md)
  - [Component Diagram](doc/plantuml_guides/component_diagram.md)
  - [Activity Diagram](doc/plantuml_guides/activity_diagram.md)
  - [Themes Guide](doc/plantuml_guides/themes.md)

- **[–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é PlantUML —Ç–µ–º](doc/theme_creation_guide.md)** - ‚≠ê –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —Ç–µ–º—É –±–µ–∑ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
- **[–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø–æ —Ç–µ–º–∞–º](doc/developers/themes_dev_guide.md)** - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ–º–∏–∑–∞—Ü–∏–∏
- **[–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](doc/developers/architecture.md)** - –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç PlantUML —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥

### üéØ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏

**–®–∞–≥ 1:** –ü–æ–ø—Ä–æ—Å–∏—Ç–µ Cline —Å–æ–∑–¥–∞—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—É

```text
–°–æ–∑–¥–∞–π class diagram –¥–ª—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Strategy —Å —Ç–µ–º–æ–π light_fresh
```

**–®–∞–≥ 2:** AI-–∞–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

- –ó–∞–ø—Ä–æ—Å–∏—Ç –≥–∞–π–¥ —á–µ—Ä–µ–∑ `get_plantuml_guide`
- –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç PlantUML –∫–æ–¥ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–∞–º–∏
- –í—ã–∑–æ–≤–µ—Ç `generate_architecture_diagram` —Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–µ–º–æ–π

**–®–∞–≥ 3:** –ü–æ–ª—É—á–∏—Ç–µ –≥–æ—Ç–æ–≤—É—é PNG –¥–∏–∞–≥—Ä–∞–º–º—É —Å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º

### ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

–î–ª—è —Ä–∞–±–æ—Ç—ã PlantUML –¥–∏–∞–≥—Ä–∞–º–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

- **Java JRE 11+** –≤ PATH
- PlantUML JAR (–≤–∫–ª—é—á–µ–Ω –≤ `asset/bins/plantuml.jar`)
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞ Java:**

```powershell
java -version
```

–ï—Å–ª–∏ Java –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:

- Windows: [Adoptium JDK](https://adoptium.net/)
- macOS: `brew install openjdk@17`

---

## üõ†Ô∏è –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑ MCP:

```python
from src.code_to_image import create_code_screenshot

code = """
def hello_world():
    print("Hello, World!")
"""

create_code_screenshot(
    code_string=code,
    language="python",
    output_file="C:/screenshots/hello.webp",
    style="dracula",
    font_size=20,
    scale_factor=4,
    line_numbers=True
)
```

## üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

**–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ:** [TROUBLESHOOTING.md](TROUBLESHOOTING.md)

**–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã:** [FAQ.md](FAQ.md)

### –ë—ã—Å—Ç—Ä—ã–µ —Ä–µ—à–µ–Ω–∏—è

**–û—à–∏–±–∫–∞: "Font not found"**

```python
font_name="Consolas"  # –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è Windows
```

**–û—à–∏–±–∫–∞: "Path must be absolute"**

```python
output_path="C:/screenshots/image.webp"  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
```

**MCP —Å–µ—Ä–≤–µ—Ä –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å –∫ `venv\Scripts\python.exe` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
2. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ Cline: Ctrl+Shift+P ‚Üí "Developer: Reload Window"

## üéØ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç?

| –°–∏—Ç—É–∞—Ü–∏—è | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –ü—Ä–∏—á–∏–Ω–∞ |
|----------|------------|---------|
| –ù–µ–±–æ–ª—å—à–æ–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥–∞ | `generate_code_screenshot` | –ë—ã—Å—Ç—Ä–æ, –Ω–µ –Ω—É–∂–µ–Ω —Ñ–∞–π–ª |
| –§–∞–π–ª —Ü–µ–ª–∏–∫–æ–º (‚â§200 —Å—Ç—Ä–æ–∫) | `generate_file_screenshot` | –£–¥–æ–±–Ω–æ –¥–ª—è –º–∞–ª—ã—Ö —Ñ–∞–π–ª–æ–≤ |
| –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è/–∫–ª–∞—Å—Å | `generate_entity_screenshot` | –¢–æ—á–Ω–∞—è —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏—è –∏–∑ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ |
| –ú–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞ | `generate_entity_screenshot` | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ `ClassName.method_name` |
| –§–∞–π–ª >200 —Å—Ç—Ä–æ–∫ —Ü–µ–ª–∏–∫–æ–º | ‚ùå –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è | –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `generate_entity_screenshot` –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —á–∞—Å—Ç–µ–π |

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞.

---

**–°–æ–≤–µ—Ç:** –î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `scale_factor: 4-5` –∏ —Ñ–æ—Ä–º–∞—Ç `PNG`.

```

## `requirements.txt`

```txt
mcp>=1.0.0
Pygments>=2.15.0
Pillow>=10.0.0
pytest>=7.4.0

```

## `server.py`

```py
#!/usr/bin/env python3
"""MCP —Å–µ—Ä–≤–µ—Ä –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞ –∏ –¥–∏–∞–≥—Ä–∞–º–º.

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è:
- –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏ –∏ —Ñ–∞–π–ª–∞
- –ò–∑–≤–ª–µ—á–µ–Ω–∏—è –∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–∏–Ω–≥–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π/–∫–ª–∞—Å—Å–æ–≤ –∏–∑ —Ñ–∞–π–ª–æ–≤ (AST)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ UML –¥–∏–∞–≥—Ä–∞–º–º —á–µ—Ä–µ–∑ PlantUML (–∏–∑ —Å—Ç—Ä–æ–∫–∏ –∏ —Ñ–∞–π–ª–∞)
- –ü–æ–ª—É—á–µ–Ω–∏—è —Å–ø—Ä–∞–≤–∫–∏ –ø–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É PlantUML
- –ü—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã MCP:
    generate_code_screenshot
        –°–æ–∑–¥–∞—ë—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–¥–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏.
    generate_file_screenshot
        –°–æ–∑–¥–∞—ë—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–¥–∞ –∏–∑ —Ñ–∞–π–ª–∞ (‚ö†Ô∏è –ª–∏–º–∏—Ç 200 —Å—Ç—Ä–æ–∫).
    generate_entity_screenshot
        –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏ —Å–æ–∑–¥–∞—ë—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏/–∫–ª–∞—Å—Å–∞/–º–µ—Ç–æ–¥–∞ (‚ú® –±–µ–∑ –ª–∏–º–∏—Ç–∞).
    generate_architecture_diagram
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç UML –¥–∏–∞–≥—Ä–∞–º–º—É –∏–∑ PlantUML –∫–æ–¥–∞.
    generate_diagram_from_file
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç UML –¥–∏–∞–≥—Ä–∞–º–º—É –∏–∑ .puml —Ñ–∞–π–ª–∞.
    get_plantuml_guide
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É –ø–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É PlantUML.
    list_plantuml_themes
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è.
"""

import logging
import os

from mcp.server.fastmcp import FastMCP

from src.code_to_image import create_code_screenshot
from src.code_extractor import extract_code_entity, list_entities, EntityNotFoundError
from src.diagram_renderer import (
    JavaNotFoundError,
    PlantUMLRenderError,
    PlantUMLSyntaxError,
    ensure_java_environment,
    render_diagram_from_string,
)
from src.font_manager import list_available_fonts
from src.guide_manager import get_guide, list_guides, list_themes

logger = logging.getLogger(__name__)

MAX_FILE_LINES = 200

mcp = FastMCP("Code Screenshot Tool")


def _generate_screenshot_from_code(
    code: str,
    language: str,
    output_path: str,
    style: str,
    font_size: int,
    scale_factor: int,
    line_numbers: bool,
    font_name: str,
    format: str,
) -> dict:
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç –∏–∑ –∫–æ–¥–∞ (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è)."""
    logger.info(f"üì• –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å generate_code_screenshot")
    logger.debug(f"üìù –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: language={language}, style={style}, font={font_name}")

    try:
        if not os.path.isabs(output_path):
            logger.error(f"üö´ –ü—É—Ç—å –Ω–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π: {output_path}")
            return {
                "success": False,
                "error": "–ü—É—Ç—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–º",
                "suggestion": f"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä: /path/to/{output_path}",
            }

        output_dir = os.path.dirname(output_path)
        if output_dir:
            os.makedirs(output_dir, exist_ok=True)
            logger.debug(f"üóÇÔ∏è –°–æ–∑–¥–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: {output_dir}")

        create_code_screenshot(
            code_string=code,
            language=language,
            output_file=output_path,
            style=style,
            font_size=font_size,
            scale_factor=scale_factor,
            line_numbers=line_numbers,
            font_name=font_name,
            format=format,
        )

        file_size = os.path.getsize(output_path)
        file_size_kb = round(file_size / 1024, 2)

        logger.info(f"üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç: success=True, size={file_size_kb}KB")

        return {
            "success": True,
            "output_path": output_path,
            "file_size_kb": file_size_kb,
            "format": format,
            "scale_factor": scale_factor,
            "font_used": font_name,
        }

    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: {e}")
        return {
            "success": False,
            "error": str(e),
            "suggestion": "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —à—Ä–∏—Ñ—Ç–∞",
            "available_fonts": list_available_fonts(),
        }


@mcp.tool()
def generate_code_screenshot(
    code: str,
    language: str,
    output_path: str,
    detail_level: str = "High",
    image_format: str = "webp",
    style: str = "monokai",
    font_size: int = 18,
    line_numbers: bool = True,
    font_name: str = "JetBrainsMono",
) -> dict:
    """–°–æ–∑–¥–∞—ë—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–¥–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏.

    Args:
        code: –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
        language: –Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è (python, typescript, javascript, sql).
        output_path: –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ø—É—Ç—å –∫ –≤—ã—Ö–æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É.
        detail_level: –£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ ('Low', 'Medium', 'High', 'Ultra', 'Extreme').
        image_format: –§–æ—Ä–º–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ('webp', 'png', 'jpeg').
        style: –°—Ç–∏–ª—å –ø–æ–¥—Å–≤–µ—Ç–∫–∏ (monokai, dracula, github-dark, vim).
        font_size: –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ (—É–º–Ω–æ–∂–∞–µ—Ç—Å—è –Ω–∞ detail_level).
        line_numbers: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω—É–º–µ—Ä–∞—Ü–∏—é —Å—Ç—Ä–æ–∫.
        font_name: –ò–º—è —à—Ä–∏—Ñ—Ç–∞ (JetBrainsMono, FiraCode, CascadiaCode, Consolas).

    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–æ–∑–¥–∞–Ω–Ω–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏.
    """
    # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º detail_level –≤ scale_factor —á–µ—Ä–µ–∑ QUALITY_LEVELS
    from src.diagram_renderer import QUALITY_LEVELS

    level_key = detail_level.capitalize()
    scale_factor = QUALITY_LEVELS.get(level_key, 3.0)  # Fallback –Ω–∞ High

    return _generate_screenshot_from_code(
        code=code,
        language=language,
        output_path=output_path,
        style=style,
        font_size=font_size,
        scale_factor=scale_factor,
        line_numbers=line_numbers,
        font_name=font_name,
        format=image_format,
    )


@mcp.tool()
def generate_file_screenshot(
    file_path: str,
    output_path: str,
    language: str | None = None,
    detail_level: str = "High",
    image_format: str = "webp",
    style: str = "monokai",
    font_size: int = 18,
    line_numbers: bool = True,
    font_name: str = "JetBrainsMono",
) -> dict:
    """–°–æ–∑–¥–∞—ë—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–¥–∞ –∏–∑ —Ñ–∞–π–ª–∞.

    ‚ö†Ô∏è –í–ê–ñ–ù–û: –§–∞–π–ª –æ–≥—Ä–∞–Ω–∏—á–µ–Ω 200 —Å—Ç—Ä–æ–∫–∞–º–∏.

    CRITICAL RULES FOR AI MODELS:
    1. NEVER hardcode colors or use !theme/!include directives in diagram_code
    2. ALWAYS use list_plantuml_themes BEFORE generating diagrams to discover available themes
    3. ALWAYS use get_plantuml_guide for complex diagrams to understand proper syntax
    4. Use ONLY stereotypes (<<Adapter>>, <<Core>>, <<Infrastructure>>) for styling
    5. Let the theme handle ALL colors - your job is structure, not appearance

    Args:
        file_path: –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º.
        output_path: –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ø—É—Ç—å –∫ –≤—ã—Ö–æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É.
        language: –Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è (–µ—Å–ª–∏ None - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é).
        detail_level: –£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ ('Low', 'Medium', 'High', 'Ultra', 'Extreme').
        image_format: –§–æ—Ä–º–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ('webp', 'png', 'jpeg').
        style: –°—Ç–∏–ª—å –ø–æ–¥—Å–≤–µ—Ç–∫–∏ (monokai, dracula, github-dark, vim).
        font_size: –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ (—É–º–Ω–æ–∂–∞–µ—Ç—Å—è –Ω–∞ detail_level).
        line_numbers: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω—É–º–µ—Ä–∞—Ü–∏—é —Å—Ç—Ä–æ–∫.
        font_name: –ò–º—è —à—Ä–∏—Ñ—Ç–∞ (JetBrainsMono, FiraCode, CascadiaCode, Consolas).

    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–æ–∑–¥–∞–Ω–Ω–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏.
    """
    logger.info(f"üì• –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å generate_file_screenshot: {file_path}")

    try:
        if not os.path.isabs(file_path):
            logger.error(f"üö´ –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –Ω–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π: {file_path}")
            return {
                "success": False,
                "error": "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–º",
                "suggestion": f"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä: /path/to/{file_path}",
            }

        if not os.path.exists(file_path):
            logger.error(f"‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}")
            return {
                "success": False,
                "error": f"–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}",
                "suggestion": "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É",
            }

        if not os.path.isfile(file_path):
            logger.error(f"‚ùå –ü—É—Ç—å —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ –Ω–∞ —Ñ–∞–π–ª: {file_path}")
            return {
                "success": False,
                "error": f"–ü—É—Ç—å —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ –Ω–∞ —Ñ–∞–π–ª: {file_path}",
                "suggestion": "–£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É, –∞ –Ω–µ –∫ –ø–∞–ø–∫–µ",
            }

        logger.debug(f"üìÇ –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞: {file_path}")
        with open(file_path, "r", encoding="utf-8") as f:
            lines = f.readlines()

        if len(lines) > MAX_FILE_LINES:
            logger.warning(
                f"‚ö†Ô∏è –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç {len(lines)} —Å—Ç—Ä–æ–∫, –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç {MAX_FILE_LINES}"
            )
            return {
                "success": False,
                "error": f"–§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç {len(lines)} —Å—Ç—Ä–æ–∫, —á—Ç–æ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç {MAX_FILE_LINES}",
                "suggestion": "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ generate_code_screenshot –¥–ª—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ –∫–æ–¥–∞ –∏–ª–∏ —Ñ–∞–π–ª –º–µ–Ω—å—à–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞",
                "lines_in_file": len(lines),
                "max_allowed": MAX_FILE_LINES,
            }

        code = "".join(lines)

        if language is None:
            ext_to_lang = {
                ".py": "python",
                ".js": "javascript",
                ".ts": "typescript",
                ".jsx": "jsx",
                ".tsx": "tsx",
                ".java": "java",
                ".c": "c",
                ".cpp": "cpp",
                ".cs": "csharp",
                ".go": "go",
                ".rs": "rust",
                ".rb": "ruby",
                ".php": "php",
                ".swift": "swift",
                ".kt": "kotlin",
                ".scala": "scala",
                ".sql": "sql",
                ".html": "html",
                ".css": "css",
                ".json": "json",
                ".yaml": "yaml",
                ".yml": "yaml",
                ".xml": "xml",
                ".sh": "bash",
                ".bat": "batch",
                ".ps1": "powershell",
                ".md": "markdown",
            }

            _, ext = os.path.splitext(file_path)
            language = ext_to_lang.get(ext.lower(), "text")
            logger.debug(f"üîç –û–ø—Ä–µ–¥–µ–ª—ë–Ω —è–∑—ã–∫ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é: {language}")

        # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º detail_level –≤ scale_factor —á–µ—Ä–µ–∑ QUALITY_LEVELS
        from src.diagram_renderer import QUALITY_LEVELS

        level_key = detail_level.capitalize()
        scale_factor = QUALITY_LEVELS.get(level_key, 3.0)  # Fallback –Ω–∞ High

        result = _generate_screenshot_from_code(
            code=code,
            language=language,
            output_path=output_path,
            style=style,
            font_size=font_size,
            scale_factor=scale_factor,
            line_numbers=line_numbers,
            font_name=font_name,
            format=image_format,
        )

        if result.get("success"):
            result["source_file"] = file_path
            result["lines_processed"] = len(lines)
            result["language_detected"] = language

        return result

    except UnicodeDecodeError:
        logger.error(f"üåê –û—à–∏–±–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ —Ñ–∞–π–ª–∞: {file_path}")
        return {
            "success": False,
            "error": "–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª –∫–∞–∫ —Ç–µ–∫—Å—Ç (–≤–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª)",
            "suggestion": "–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∫–æ–¥",
        }
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞: {e}")
        return {
            "success": False,
            "error": str(e),
            "suggestion": "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–∞ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤",
        }


@mcp.tool()
def generate_entity_screenshot(
    file_path: str,
    entity_name: str,
    output_path: str,
    include_decorators: bool = True,
    detail_level: str = "High",
    image_format: str = "webp",
    style: str = "monokai",
    font_size: int = 18,
    line_numbers: bool = True,
    font_name: str = "JetBrainsMono",
) -> dict:
    """–ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏ —Å–æ–∑–¥–∞—ë—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏/–∫–ª–∞—Å—Å–∞/–º–µ—Ç–æ–¥–∞ –∏–∑ Python —Ñ–∞–π–ª–∞.

    ‚ú® –£–ú–ù–´–ô –ò–ù–°–¢–†–£–ú–ï–ù–¢ –¥–ª—è —Ç–æ—á–µ—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–º–µ—Ä.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç AST (Abstract Syntax Tree) –¥–ª—è —Ö–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–¥–∞.

    Use this to extract specific functions or classes from large files without reading
    the whole file into context. Supports format 'ClassName.method_name' for methods.

    –í–ê–ñ–ù–û (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ): –≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¢–û–õ–¨–ö–û Python-–∏—Å—Ö–æ–¥–Ω–∏–∫–∏
    (—Ñ–∞–π–ª—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º ``.py``). –î–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥—É–ª—å ``ast``,
    –∫–æ—Ç–æ—Ä—ã–π –ø–æ–Ω–∏–º–∞–µ—Ç –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ Python-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å. –ü—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ —Ñ–∞–π–ª–æ–≤ –Ω–∞ –¥—Ä—É–≥–∏—Ö
    —è–∑—ã–∫–∞—Ö (JavaScript/TypeScript/Go/C/C++ –∏ —Ç.–¥.) –ø–∞—Ä—Å–µ—Ä –≤—ã–∑–æ–≤–µ—Ç ``SyntaxError``
    –∏–ª–∏ –∏–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ. –í —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞—è—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ``generate_file_screenshot``
    (—Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤—Å–µ–≥–æ —Ñ–∞–π–ª–∞) –∏–ª–∏ —Å—Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ/–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∏–∑–≤–ª–µ–∫–∏—Ç–µ –Ω—É–∂–Ω—ã–π –∫–æ–¥ –∏
    –ø–µ—Ä–µ–¥–∞–π—Ç–µ –µ–≥–æ –≤ ``generate_code_screenshot``.

    Args:
        file_path: –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ø—É—Ç—å –∫ Python —Ñ–∞–π–ª—É.
        entity_name: –ò–º—è —Å—É—â–Ω–æ—Å—Ç–∏ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è:
            - "function_name" –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏
            - "ClassName" –¥–ª—è –∫–ª–∞—Å—Å–∞ —Ü–µ–ª–∏–∫–æ–º
            - "ClassName.method_name" –¥–ª—è –º–µ—Ç–æ–¥–∞ –∫–ª–∞—Å—Å–∞
        output_path: –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ø—É—Ç—å –∫ –≤—ã—Ö–æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É.
        include_decorators: –í–∫–ª—é—á–∞—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã (@tool, @pytest.fixture, etc) –≤ —Å–∫—Ä–∏–Ω—à–æ—Ç.
        detail_level: –£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ ('Low', 'Medium', 'High', 'Ultra', 'Extreme').
        image_format: –§–æ—Ä–º–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ('webp', 'png', 'jpeg').
        style: –°—Ç–∏–ª—å –ø–æ–¥—Å–≤–µ—Ç–∫–∏ (monokai, dracula, github-dark, vim).
        font_size: –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ (—É–º–Ω–æ–∂–∞–µ—Ç—Å—è –Ω–∞ detail_level).
        line_numbers: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω—É–º–µ—Ä–∞—Ü–∏—é —Å—Ç—Ä–æ–∫.
        font_name: –ò–º—è —à—Ä–∏—Ñ—Ç–∞ (JetBrainsMono, FiraCode, CascadiaCode, Consolas).

    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–æ–∑–¥–∞–Ω–Ω–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –∏ –º–µ—Ç–∞–¥–∞–Ω–∞–º–∏ —Å—É—â–Ω–æ—Å—Ç–∏.
    """

    logger.info(
        f"üì• –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å generate_entity_screenshot: {entity_name} –∏–∑ {file_path}"
    )

    try:
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–¥ —Å—É—â–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ AST
        extracted_code = extract_code_entity(
            file_path=file_path,
            entity_name=entity_name,
            include_decorators=include_decorators,
        )

        logger.debug(f"‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–æ {len(extracted_code)} —Å–∏–º–≤–æ–ª–æ–≤ –∫–æ–¥–∞")

        # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º detail_level –≤ scale_factor —á–µ—Ä–µ–∑ QUALITY_LEVELS
        from src.diagram_renderer import QUALITY_LEVELS

        level_key = detail_level.capitalize()
        scale_factor = QUALITY_LEVELS.get(level_key, 3.0)  # Fallback –Ω–∞ High

        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –∏–∑–≤–ª–µ—á—ë–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
        result = _generate_screenshot_from_code(
            code=extracted_code,
            language="python",  # –í—Å–µ–≥–¥–∞ Python –¥–ª—è —ç—Ç–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
            output_path=output_path,
            style=style,
            font_size=font_size,
            scale_factor=scale_factor,
            line_numbers=line_numbers,
            font_name=font_name,
            format=image_format,
        )

        # –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–± –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏
        if result.get("success"):
            result["entity_extracted"] = entity_name
            result["source_file"] = file_path
            result["decorators_included"] = include_decorators
            result["extraction_method"] = "AST"

        return result

    except EntityNotFoundError as e:
        logger.error(f"üîç –°—É—â–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: {e}")
        # –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –¥–ª—è –ø–æ–º–æ—â–∏
        try:
            entities = list_entities(file_path)
            return {
                "success": False,
                "error": str(e),
                "suggestion": (
                    "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∏–º–µ–Ω–∏ —Å—É—â–Ω–æ—Å—Ç–∏. "
                    "–î–ª—è –º–µ—Ç–æ–¥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç 'ClassName.method_name'"
                ),
                "available_entities": entities,
            }
        except Exception:
            return {
                "success": False,
                "error": str(e),
                "suggestion": "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∏–º–µ–Ω–∏ —Å—É—â–Ω–æ—Å—Ç–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–∞",
            }

    except FileNotFoundError:
        logger.error(f"‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}")
        return {
            "success": False,
            "error": f"–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}",
            "suggestion": "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É",
        }

    except SyntaxError as e:
        logger.error(f"üí• –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ Python —Ñ–∞–π–ª–µ: {e}")
        return {
            "success": False,
            "error": "–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ Python —Ñ–∞–π–ª–µ",
            "details": str(e),
            "suggestion": "–ò—Å–ø—Ä–∞–≤—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ",
        }

    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç–∏: {e}")
        return {
            "success": False,
            "error": str(e),
            "suggestion": "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–∞ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤",
        }


@mcp.tool()
def generate_architecture_diagram(
    diagram_code: str,
    output_path: str,
    detail_level: str = "High",
    image_format: str = "png",
    theme_name: str = "default",
) -> dict:
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç UML –¥–∏–∞–≥—Ä–∞–º–º—É –∏–∑ PlantUML –∫–æ–¥–∞.

    ‚ö†Ô∏è CRITICAL RULES (READ CAREFULLY):
    1. DO NOT use '!theme' or '!include' directives inside 'diagram_code'.
       The theme is applied automatically via the 'theme_name' argument.
    2. DO NOT hardcode colors (e.g., #000000, #Red) unless absolutely necessary.
       Rely on the applied theme for consistent styling.
    3. ALWAYS verify available themes using 'list_plantuml_themes' before generation.
       Do not hallucinate theme names like 'darkblue' or 'ocean'.
    4. For complex diagrams, ALWAYS verify syntax using 'get_plantuml_guide'.
    5. Use stereotypes (<<Adapter>>, <<Core>>, <<Infrastructure>>) for automatic coloring.

    ‚ö†Ô∏è –í–ê–ñ–ù–û: –¢—Ä–µ–±—É–µ—Ç—Å—è Java (JRE 8+).

    Args:
        diagram_code: Pure PlantUML code without theme imports or color overrides.
        output_path: –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ø—É—Ç—å –∫ –≤—ã—Ö–æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É.
        detail_level: –£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ ('Low', 'Medium', 'High', 'Ultra', 'Extreme').
        image_format: –§–æ—Ä–º–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ('png', 'svg', 'eps', 'pdf', 'webp').
        theme_name: –ò–º—è —Ç–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∏–∑ —Å–ø–∏—Å–∫–∞ list_plantuml_themes (–Ω–∞–ø—Ä–∏–º–µ—Ä: 'dark_gold').

    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–æ–∑–¥–∞–Ω–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º–µ.
    """
    logger.info("üì• –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å generate_architecture_diagram")

    try:
        if not os.path.isabs(output_path):
            logger.error(f"üö´ –ü—É—Ç—å –Ω–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π: {output_path}")
            return {
                "success": False,
                "error": "–ü—É—Ç—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–º",
                "suggestion": f"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä: /path/to/{output_path}",
            }

        try:
            ensure_java_environment()
        except JavaNotFoundError as e:
            logger.error("‚òï Java –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ")
            return {
                "success": False,
                "error": "Java –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ",
                "details": str(e),
                "suggestion": "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ JRE (Java Runtime Environment) –≤–µ—Ä—Å–∏–∏ 8 –∏–ª–∏ –≤—ã—à–µ",
                "install_instructions": {
                    "macOS": "brew install openjdk",
                    "Windows": "https://adoptium.net/",
                    "Linux": "sudo apt-get install default-jre",
                },
            }

        # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º detail_level –≤ scale_factor —á–µ—Ä–µ–∑ QUALITY_LEVELS
        from src.diagram_renderer import QUALITY_LEVELS

        level_key = detail_level.capitalize()
        scale_factor = QUALITY_LEVELS.get(level_key, 3.0)  # Fallback –Ω–∞ High

        result = render_diagram_from_string(
            diagram_code=diagram_code,
            output_path=output_path,
            format=image_format,
            theme_name=theme_name,
            scale_factor=scale_factor,
        )

        logger.info(f"üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç: success={result.get('success')}")
        return result

    except PlantUMLSyntaxError as e:
        logger.error(f"üí• –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ PlantUML: {e}")
        return {
            "success": False,
            "error": "–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ PlantUML –∫–æ–¥–µ",
            "details": str(e),
            "suggestion": (
                "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ PlantUML. "
                "–ü–û–î–°–ö–ê–ó–ö–ê: –í—ã–∑–æ–≤–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç get_plantuml_guide —Å –Ω—É–∂–Ω—ã–º —Ç–∏–ø–æ–º –¥–∏–∞–≥—Ä–∞–º–º—ã "
                "(class, sequence, component, activity) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø—Ä–∞–≤–∫–∏ –ø–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É "
                "–∏ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–∞–º (<<Core>>, <<Adapter>>, <<Infrastructure>>)."
            ),
        }
    except PlantUMLRenderError as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ PlantUML: {e}")
        return {
            "success": False,
            "error": "–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ PlantUML –¥–∏–∞–≥—Ä–∞–º–º—ã",
            "details": str(e),
            "suggestion": (
                "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å PlantUML –∫–æ–¥–∞. "
                "–ü–û–î–°–ö–ê–ó–ö–ê: –í—ã–∑–æ–≤–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç get_plantuml_guide —Å –Ω—É–∂–Ω—ã–º —Ç–∏–ø–æ–º –¥–∏–∞–≥—Ä–∞–º–º—ã "
                "(class, sequence, component, activity) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø—Ä–∞–≤–∫–∏ –ø–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É."
            ),
        }
    except FileNotFoundError as e:
        logger.error(f"‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {e}")
        return {
            "success": False,
            "error": "–§–∞–π–ª –∏–ª–∏ —Ä–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω",
            "details": str(e),
            "suggestion": "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ PlantUML JAR —Ñ–∞–π–ª–∞ –∏ —Ç–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è",
        }
    except Exception as e:
        logger.error(f"‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")
        return {
            "success": False,
            "error": str(e),
            "suggestion": "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–µ—Å—É—Ä—Å–æ–≤",
        }


@mcp.tool()
def generate_diagram_from_file(
    file_path: str,
    output_path: str,
    detail_level: str = "High",
    image_format: str = "png",
    theme_name: str = "default",
) -> dict:
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç UML –¥–∏–∞–≥—Ä–∞–º–º—É –∏–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ .puml —Ñ–∞–π–ª–∞.

    Use this when PlantUML diagram code is already saved in a file. This is the preferred
    way for complex diagrams to avoid generation errors and save tokens.

    ‚ö†Ô∏è –í–ê–ñ–ù–û: –¢—Ä–µ–±—É–µ—Ç—Å—è Java (JRE 8+).

    Args:
        file_path: –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ø—É—Ç—å –∫ .puml —Ñ–∞–π–ª—É —Å PlantUML –∫–æ–¥–æ–º.
        output_path: –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ø—É—Ç—å –∫ –≤—ã—Ö–æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
        detail_level: –£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ ('Low', 'Medium', 'High', 'Ultra', 'Extreme').
        image_format: –§–æ—Ä–º–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ('png', 'svg', 'eps', 'pdf', 'webp').
        theme_name: –ò–º—è —Ç–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è (default –∏–ª–∏ None).

    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–æ–∑–¥–∞–Ω–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º–µ.
    """
    logger.info(f"üì• –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å generate_diagram_from_file: {file_path}")

    try:
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
        if not os.path.isabs(file_path):
            logger.error(f"üö´ –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –Ω–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π: {file_path}")
            return {
                "success": False,
                "error": "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–º",
                "suggestion": f"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä: /path/to/{file_path}",
            }

        if not os.path.exists(file_path):
            logger.error(f"‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}")
            return {
                "success": False,
                "error": f"–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}",
                "suggestion": "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø—É—Ç–∏ –∫ .puml —Ñ–∞–π–ª—É",
            }

        # –ß—Ç–µ–Ω–∏–µ PlantUML –∫–æ–¥–∞ –∏–∑ —Ñ–∞–π–ª–∞
        logger.debug(f"üìÇ –ß—Ç–µ–Ω–∏–µ PlantUML —Ñ–∞–π–ª–∞: {file_path}")
        with open(file_path, "r", encoding="utf-8") as f:
            diagram_code = f.read()

        logger.debug(f"üìù –ü—Ä–æ—á–∏—Ç–∞–Ω–æ {len(diagram_code)} —Å–∏–º–≤–æ–ª–æ–≤ PlantUML –∫–æ–¥–∞")

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ Java –æ–∫—Ä—É–∂–µ–Ω–∏—è
        try:
            ensure_java_environment()
        except JavaNotFoundError as e:
            logger.error("‚òï Java –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ")
            return {
                "success": False,
                "error": "Java –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ",
                "details": str(e),
                "suggestion": "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ JRE (Java Runtime Environment) –≤–µ—Ä—Å–∏–∏ 8 –∏–ª–∏ –≤—ã—à–µ",
                "install_instructions": {
                    "macOS": "brew install openjdk",
                    "Windows": "https://adoptium.net/",
                    "Linux": "sudo apt-get install default-jre",
                },
            }

        # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º detail_level –≤ scale_factor —á–µ—Ä–µ–∑ QUALITY_LEVELS
        from src.diagram_renderer import QUALITY_LEVELS

        level_key = detail_level.capitalize()
        scale_factor = QUALITY_LEVELS.get(level_key, 3.0)  # Fallback –Ω–∞ High

        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∏–∞–≥—Ä–∞–º–º—É
        result = render_diagram_from_string(
            diagram_code=diagram_code,
            output_path=output_path,
            format=image_format,
            theme_name=theme_name,
            scale_factor=scale_factor,
        )

        # –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–± –∏—Å—Ç–æ—á–Ω–∏–∫–µ
        if result.get("success"):
            result["source_file"] = file_path
            result["code_length"] = len(diagram_code)

        logger.info(f"üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç: success={result.get('success')}")
        return result

    except UnicodeDecodeError:
        logger.error(f"üåê –û—à–∏–±–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ —Ñ–∞–π–ª–∞: {file_path}")
        return {
            "success": False,
            "error": "–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª –∫–∞–∫ —Ç–µ–∫—Å—Ç",
            "suggestion": "–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ .puml —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫–µ",
        }

    except PlantUMLSyntaxError as e:
        logger.error(f"üí• –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ PlantUML: {e}")
        return {
            "success": False,
            "error": "–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ PlantUML –∫–æ–¥–µ",
            "details": str(e),
            "source_file": file_path,
            "suggestion": (
                "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å PlantUML –≤ —Ñ–∞–π–ª–µ. "
                "–ü–û–î–°–ö–ê–ó–ö–ê: –í—ã–∑–æ–≤–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç get_plantuml_guide —Å –Ω—É–∂–Ω—ã–º —Ç–∏–ø–æ–º –¥–∏–∞–≥—Ä–∞–º–º—ã "
                "–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø—Ä–∞–≤–∫–∏."
            ),
        }

    except PlantUMLRenderError as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ PlantUML: {e}")
        return {
            "success": False,
            "error": "–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ PlantUML –¥–∏–∞–≥—Ä–∞–º–º—ã",
            "details": str(e),
            "source_file": file_path,
            "suggestion": "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å PlantUML –∫–æ–¥–∞ –≤ —Ñ–∞–π–ª–µ",
        }

    except Exception as e:
        logger.error(f"‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")
        return {
            "success": False,
            "error": str(e),
            "suggestion": "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å .puml —Ñ–∞–π–ª–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–µ—Å—É—Ä—Å–æ–≤",
        }


@mcp.tool()
def get_plantuml_guide(
    diagram_type: str,
    detail_level: str = "brief",
) -> dict:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É –ø–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É PlantUML –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã.

    –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –µ—Å–ª–∏ –Ω–µ —É–≤–µ—Ä–µ–Ω—ã –≤ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–µ –∏–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ –æ—à–∏–±–∫—É
    –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∏–∞–≥—Ä–∞–º–º—ã.

    Args:
        diagram_type: –¢–∏–ø –¥–∏–∞–≥—Ä–∞–º–º—ã (class, sequence, component, activity, themes).
        detail_level: –£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ ('brief' ‚Äî –∫—Ä–∞—Ç–∫–∞—è –≤—ã–∂–∏–º–∫–∞, 'detailed' ‚Äî –ø–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è).

    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º –≥–∞–π–¥–∞ –∏ —Å–ø–∏—Å–∫–æ–º –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ–º.
    """
    logger.info(f"üìö –ó–∞–ø—Ä–æ—Å –≥–∞–π–¥–∞ PlantUML: type={diagram_type}, level={detail_level}")

    full = detail_level.lower() == "detailed"
    guide_content = get_guide(diagram_type, full=full)

    available_guides = list_guides()
    available_guide_types = [g["type"] for g in available_guides]

    return {
        "success": True,
        "diagram_type": diagram_type,
        "detail_level": detail_level,
        "content": guide_content,
        "available_guides": available_guide_types,
        "hint": "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã <<Adapter>>, <<Core>>, <<Infrastructure>> –¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º.",
    }


@mcp.tool()
def list_plantuml_themes() -> dict:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –¥–ª—è PlantUML –¥–∏–∞–≥—Ä–∞–º–º.

    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–µ–º –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ –≤—ã–±–æ—Ä—É.
    """
    logger.info("üé® –ó–∞–ø—Ä–æ—Å —Å–ø–∏—Å–∫–∞ —Ç–µ–º PlantUML")

    themes = list_themes()

    return {
        "success": True,
        "themes": themes,
        "recommendation": (
            "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 'dark_gold' –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π, "
            "'light_fresh' –¥–ª—è –ø–µ—á–∞—Ç–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏, "
            "'default' –¥–ª—è –æ–±—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è."
        ),
        "stereotypes_hint": (
            "–í–æ –≤—Å–µ—Ö —Ç–µ–º–∞—Ö –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã: "
            "<<Adapter>> (–≤—Ö–æ–¥–Ω—ã–µ —Ç–æ—á–∫–∏), "
            "<<Core>> (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞), "
            "<<Infrastructure>> (–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)."
        ),
    }


if __name__ == "__main__":
    mcp.run()

```

## `src/__init__.py`

```py
"""Code to Image MCP - –ø–∞–∫–µ—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞ –∏ –¥–∏–∞–≥—Ä–∞–º–º.

–ú–æ–¥—É–ª–∏:
    code_to_image - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞
    diagram_renderer - —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ PlantUML –¥–∏–∞–≥—Ä–∞–º–º
    font_manager - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–∞–º–∏
    font_initializer - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ –¥–ª—è PlantUML
    image_utils - —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    guide_manager - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–∞–π–¥–∞–º–∏ –ø–æ PlantUML
"""

__version__ = "1.0.0"

```

## `src/code_extractor.py`

```py
"""
–ú–æ–¥—É–ª—å –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–¥–∞ –∏–∑ Python —Ñ–∞–π–ª–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º AST.

–ü–æ–∑–≤–æ–ª—è–µ—Ç —Ç–æ—á–µ—á–Ω–æ –∏–∑–≤–ª–µ–∫–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏, –∫–ª–∞—Å—Å—ã –∏ –º–µ—Ç–æ–¥—ã –∏–∑ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
–±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —á–∏—Ç–∞—Ç—å –≤–µ—Å—å —Ñ–∞–π–ª —Ü–µ–ª–∏–∫–æ–º.
"""

import ast
import logging
from pathlib import Path
from typing import Optional

logger = logging.getLogger(__name__)


class EntityNotFoundError(Exception):
    """–ò—Å–∫–ª—é—á–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º–∞—è —Å—É—â–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Ñ–∞–π–ª–µ."""

    pass


def extract_code_entity(
    file_path: str, entity_name: str, include_decorators: bool = True
) -> str:
    """
    –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–ª–∞—Å—Å–∞ –∏–ª–∏ –º–µ—Ç–æ–¥–∞ –∏–∑ Python —Ñ–∞–π–ª–∞.

    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç AST –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Å—É—â–Ω–æ—Å—Ç–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ—ë –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥,
    –≤–∫–ª—é—á–∞—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ).

    Args:
        file_path: –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ Python —Ñ–∞–π–ª—É.
        entity_name: –ò–º—è —Å—É—â–Ω–æ—Å—Ç–∏ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è:
            - "function_name" - –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏
            - "ClassName" - –¥–ª—è –∫–ª–∞—Å—Å–∞
            - "ClassName.method_name" - –¥–ª—è –º–µ—Ç–æ–¥–∞ –∫–ª–∞—Å—Å–∞
        include_decorators: –í–∫–ª—é—á–∞—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –≤ –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–π –∫–æ–¥.

    Returns:
        –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Å—É—â–Ω–æ—Å—Ç–∏ –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞.

    Raises:
        FileNotFoundError: –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
        SyntaxError: –ï—Å–ª–∏ —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ Python.
        EntityNotFoundError: –ï—Å–ª–∏ —Å—É—â–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Ñ–∞–π–ª–µ.

    Example:
        >>> code = extract_code_entity("app.py", "calculate_total")
        >>> code = extract_code_entity("models.py", "Order.validate")
    """
    logger.debug(f"üîç –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ '{entity_name}' –∏–∑ {file_path}")

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
    path = Path(file_path)
    if not path.exists():
        raise FileNotFoundError(f"–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}")

    # –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
    with open(path, "r", encoding="utf-8") as f:
        source_code = f.read()
        source_lines = source_code.splitlines(keepends=True)

    # –ü–∞—Ä—Å–∏–Ω–≥ –≤ AST
    try:
        tree = ast.parse(source_code, filename=str(path))
    except SyntaxError as e:
        logger.error(f"‚ùå –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ {file_path}: {e}")
        raise

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∏—â–µ–º –ª–∏ –º–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞ (—Ñ–æ—Ä–º–∞—Ç "ClassName.method_name")
    if "." in entity_name:
        class_name, method_name = entity_name.split(".", 1)
        logger.debug(f"üîç –ü–æ–∏—Å–∫ –º–µ—Ç–æ–¥–∞ '{method_name}' –≤ –∫–ª–∞—Å—Å–µ '{class_name}'")
        return _extract_class_method(
            tree, source_lines, class_name, method_name, include_decorators
        )
    else:
        # –ò—â–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–ª–∏ –∫–ª–∞—Å—Å –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è
        logger.debug(f"üîç –ü–æ–∏—Å–∫ —Ñ—É–Ω–∫—Ü–∏–∏/–∫–ª–∞—Å—Å–∞ '{entity_name}' –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è")
        return _extract_top_level_entity(
            tree, source_lines, entity_name, include_decorators
        )


def _extract_top_level_entity(
    tree: ast.Module,
    source_lines: list[str],
    entity_name: str,
    include_decorators: bool,
) -> str:
    """
    –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –∏–ª–∏ –∫–ª–∞—Å—Å –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è.

    Args:
        tree: AST –¥–µ—Ä–µ–≤–æ –º–æ–¥—É–ª—è.
        source_lines: –°—Ç—Ä–æ–∫–∏ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞.
        entity_name: –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ –∫–ª–∞—Å—Å–∞.
        include_decorators: –í–∫–ª—é—á–∞—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã.

    Returns:
        –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Å—É—â–Ω–æ—Å—Ç–∏.

    Raises:
        EntityNotFoundError: –ï—Å–ª–∏ —Å—É—â–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.
    """
    for node in ast.walk(tree):
        # –ò—â–µ–º —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è
        if isinstance(node, (ast.FunctionDef, ast.AsyncFunctionDef, ast.ClassDef)):
            if node.name == entity_name:
                # –ù–∞—à–ª–∏! –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–¥
                start_line = _get_start_line(node, include_decorators)
                end_line = node.end_lineno

                logger.info(
                    f"‚úÖ –ù–∞–π–¥–µ–Ω–∞ —Å—É—â–Ω–æ—Å—Ç—å '{entity_name}' (—Å—Ç—Ä–æ–∫–∏ {start_line}-{end_line})"
                )

                # –ò–∑–≤–ª–µ–∫–∞–µ–º —Å—Ç—Ä–æ–∫–∏ (AST –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 1-based –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é)
                code = "".join(source_lines[start_line - 1 : end_line])
                return code

    # –ù–µ –Ω–∞—à–ª–∏ - —Ñ–æ—Ä–º–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
    available = _list_available_entities(tree)
    error_msg = (
        f"–°—É—â–Ω–æ—Å—Ç—å '{entity_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Ñ–∞–π–ª–µ.\n"
        f"–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è: {', '.join(available)}"
    )
    logger.error(f"‚ùå {error_msg}")
    raise EntityNotFoundError(error_msg)


def _extract_class_method(
    tree: ast.Module,
    source_lines: list[str],
    class_name: str,
    method_name: str,
    include_decorators: bool,
) -> str:
    """
    –ò–∑–≤–ª–µ–∫–∞–µ—Ç –º–µ—Ç–æ–¥ –∏–∑ –∫–ª–∞—Å—Å–∞.

    Args:
        tree: AST –¥–µ—Ä–µ–≤–æ –º–æ–¥—É–ª—è.
        source_lines: –°—Ç—Ä–æ–∫–∏ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞.
        class_name: –ò–º—è –∫–ª–∞—Å—Å–∞.
        method_name: –ò–º—è –º–µ—Ç–æ–¥–∞.
        include_decorators: –í–∫–ª—é—á–∞—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã.

    Returns:
        –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –º–µ—Ç–æ–¥–∞.

    Raises:
        EntityNotFoundError: –ï—Å–ª–∏ –∫–ª–∞—Å—Å –∏–ª–∏ –º–µ—Ç–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.
    """
    # –ò—â–µ–º –∫–ª–∞—Å—Å
    class_node = None
    for node in ast.walk(tree):
        if isinstance(node, ast.ClassDef) and node.name == class_name:
            class_node = node
            break

    if class_node is None:
        available_classes = [
            node.name for node in ast.walk(tree) if isinstance(node, ast.ClassDef)
        ]
        error_msg = (
            f"–ö–ª–∞—Å—Å '{class_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω.\n"
            f"–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª–∞—Å—Å—ã: {', '.join(available_classes)}"
        )
        logger.error(f"‚ùå {error_msg}")
        raise EntityNotFoundError(error_msg)

    # –ò—â–µ–º –º–µ—Ç–æ–¥ –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞
    for node in class_node.body:
        if isinstance(node, (ast.FunctionDef, ast.AsyncFunctionDef)):
            if node.name == method_name:
                start_line = _get_start_line(node, include_decorators)
                end_line = node.end_lineno

                logger.info(
                    f"‚úÖ –ù–∞–π–¥–µ–Ω –º–µ—Ç–æ–¥ '{class_name}.{method_name}' (—Å—Ç—Ä–æ–∫–∏ {start_line}-{end_line})"
                )

                code = "".join(source_lines[start_line - 1 : end_line])
                return code

    # –ú–µ—Ç–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω
    available_methods = [
        node.name
        for node in class_node.body
        if isinstance(node, (ast.FunctionDef, ast.AsyncFunctionDef))
    ]
    error_msg = (
        f"–ú–µ—Ç–æ–¥ '{method_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–ª–∞—Å—Å–µ '{class_name}'.\n"
        f"–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã: {', '.join(available_methods)}"
    )
    logger.error(f"‚ùå {error_msg}")
    raise EntityNotFoundError(error_msg)


def _get_start_line(node: ast.AST, include_decorators: bool) -> int:
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞—á–∞–ª—å–Ω—É—é —Å—Ç—Ä–æ–∫—É —Å—É—â–Ω–æ—Å—Ç–∏ —Å —É—á—ë—Ç–æ–º –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤.

    Args:
        node: AST —É–∑–µ–ª —Ñ—É–Ω–∫—Ü–∏–∏/–∫–ª–∞—Å—Å–∞.
        include_decorators: –í–∫–ª—é—á–∞—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã.

    Returns:
        –ù–æ–º–µ—Ä –Ω–∞—á–∞–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ (1-based).
    """
    if include_decorators and hasattr(node, "decorator_list") and node.decorator_list:
        # –ë–µ—Ä—ë–º —Å—Ç—Ä–æ–∫—É –ø–µ—Ä–≤–æ–≥–æ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞
        return node.decorator_list[0].lineno
    else:
        # –ë–µ—Ä—ë–º —Å—Ç—Ä–æ–∫—É –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏/–∫–ª–∞—Å—Å–∞
        return node.lineno


def _list_available_entities(tree: ast.Module) -> list[str]:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è –≤ –º–æ–¥—É–ª–µ.

    Args:
        tree: AST –¥–µ—Ä–µ–≤–æ –º–æ–¥—É–ª—è.

    Returns:
        –°–ø–∏—Å–æ–∫ –∏–º—ë–Ω —Ñ—É–Ω–∫—Ü–∏–π –∏ –∫–ª–∞—Å—Å–æ–≤.
    """
    entities = []
    for node in tree.body:  # –¢–æ–ª—å–∫–æ –≤–µ—Ä—Ö–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å
        if isinstance(node, (ast.FunctionDef, ast.AsyncFunctionDef, ast.ClassDef)):
            entities.append(node.name)
    return entities


def list_entities(file_path: str) -> dict[str, list[str]]:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –≤ —Ñ–∞–π–ª–µ.

    Args:
        file_path: –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ Python —Ñ–∞–π–ª—É.

    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –∫–ª—é—á–∞–º–∏:
            - "functions": —Å–ø–∏—Å–æ–∫ –∏–º—ë–Ω —Ñ—É–Ω–∫—Ü–∏–π –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è
            - "classes": —Å–ø–∏—Å–æ–∫ –∏–º—ë–Ω –∫–ª–∞—Å—Å–æ–≤
            - "methods": —Å–ª–æ–≤–∞—Ä—å {class_name: [method1, method2, ...]}

    Raises:
        FileNotFoundError: –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
        SyntaxError: –ï—Å–ª–∏ —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏.

    Example:
        >>> entities = list_entities("models.py")
        >>> print(entities["classes"])
        ['Order', 'Customer']
        >>> print(entities["methods"]["Order"])
        ['validate', 'calculate_total', 'save']
    """
    logger.debug(f"üìã –°–ø–∏—Å–æ–∫ —Å—É—â–Ω–æ—Å—Ç–µ–π –≤ {file_path}")

    path = Path(file_path)
    if not path.exists():
        raise FileNotFoundError(f"–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}")

    with open(path, "r", encoding="utf-8") as f:
        source_code = f.read()

    tree = ast.parse(source_code, filename=str(path))

    functions = []
    classes = []
    methods = {}

    for node in tree.body:
        if isinstance(node, (ast.FunctionDef, ast.AsyncFunctionDef)):
            functions.append(node.name)
        elif isinstance(node, ast.ClassDef):
            classes.append(node.name)
            # –°–æ–±–∏—Ä–∞–µ–º –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞
            class_methods = [
                method.name
                for method in node.body
                if isinstance(method, (ast.FunctionDef, ast.AsyncFunctionDef))
            ]
            methods[node.name] = class_methods

    logger.info(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ: {len(functions)} —Ñ—É–Ω–∫—Ü–∏–π, {len(classes)} –∫–ª–∞—Å—Å–æ–≤")

    return {"functions": functions, "classes": classes, "methods": methods}

```

## `src/code_to_image.py`

```py
#!/usr/bin/env python3
"""–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞.

–ú–æ–¥—É–ª—å —Å–æ–∑–¥–∞—ë—Ç –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞
—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Pygments –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∏ Pillow –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏.

–§—É–Ω–∫—Ü–∏–∏:
    create_code_image(code_string, language, **options) -> Image
        –°–æ–∑–¥–∞—ë—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ –∫–æ–¥–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç PIL Image.
    create_code_screenshot(code_string, language, output_file, **options) -> dict
        LEGACY: –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ —Ñ–∞–π–ª.
"""

import io
import logging
from pathlib import Path
from typing import Literal

import pygments
from PIL import Image
from pygments.formatters import ImageFormatter
from pygments.lexers import get_lexer_by_name
from pygments.styles import get_style_by_name

from src.font_manager import get_font_path
from src.image_utils import save_image

logger = logging.getLogger(__name__)

ImageFormat = Literal["png", "jpeg", "webp"]


def create_code_image(
    code_string: str,
    language: str,
    style: str = "monokai",
    font_name: str = "JetBrainsMono",
    font_size: int = 18,
    pad: int = 25,
    scale_factor: float = 3.0,
    transparent: bool = False,
    line_numbers: bool = True,
    line_pad: int = 10,
    line_number_bg: str | None = None,
    line_number_fg: str = "#888888",
) -> Image.Image:
    """–°–æ–∑–¥–∞—ë—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ –∫–æ–¥–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç PIL Image –æ–±—ä–µ–∫—Ç.

    Args:
        code_string: –°—Ç—Ä–æ–∫–∞ —Å –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º.
        language: –Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è (–¥–ª—è –ª–µ–∫—Å–µ—Ä–∞ Pygments).
        style: –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∏–ª—è Pygments (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'monokai').
        font_name: –ò–º—è —à—Ä–∏—Ñ—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'JetBrainsMono').
        font_size: –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 18).
        pad: –û—Ç—Å—Ç—É–ø –≤–æ–∫—Ä—É–≥ –∫–æ–¥–∞ –≤ –ø–∏–∫—Å–µ–ª—è—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 25).
        scale_factor: –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –≤—ã—Å–æ–∫–æ–≥–æ DPI (1.0-5.0).
        transparent: –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é False).
        line_numbers: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é True).
        line_pad: –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –Ω–æ–º–µ—Ä–∞–º–∏ —Å—Ç—Ä–æ–∫ –∏ –∫–æ–¥–æ–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10).
        line_number_bg: –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –Ω–æ–º–µ—Ä–æ–≤ —Å—Ç—Ä–æ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ —Å—Ç–∏–ª—è).
        line_number_fg: –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –Ω–æ–º–µ—Ä–æ–≤ —Å—Ç—Ä–æ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é '#888888').

    Returns:
        PIL Image –æ–±—ä–µ–∫—Ç —Å –æ—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω–Ω—ã–º –∫–æ–¥–æ–º.

    Raises:
        ValueError: –ï—Å–ª–∏ —è–∑—ã–∫ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback 'text').
    """
    logger.info(f"üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–¥–∞ –¥–ª—è —è–∑—ã–∫–∞: {language}")

    # –ü–æ–ª—É—á–∞–µ–º –ª–µ–∫—Å–µ—Ä –¥–ª—è —è–∑—ã–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
    try:
        lexer = get_lexer_by_name(language, stripall=True)
    except pygments.util.ClassNotFound:
        logger.warning(
            f"üéØ –õ–µ–∫—Å–µ—Ä –¥–ª—è —è–∑—ã–∫–∞ '{language}' –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 'text'"
        )
        lexer = get_lexer_by_name("text", stripall=True)

    # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∏–ª—å Pygments
    style_inst = get_style_by_name(style)
    logger.debug(f"üé≠ –ü—Ä–∏–º–µ–Ω—ë–Ω —Å—Ç–∏–ª—å: {style}")

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏
    if transparent:
        style_inst.background_color = None
        logger.debug("üîç –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ñ–æ–Ω–∞")

    # –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ —Ä–∞–∑–º–µ—Ä–∞–º
    logger.debug(f"üñºÔ∏è –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ: {scale_factor}x")
    scaled_font_size = int(font_size * scale_factor)
    scaled_pad = int(pad * scale_factor)
    scaled_line_pad = int(line_pad * scale_factor)

    # –ü–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –∫ —à—Ä–∏—Ñ—Ç—É
    try:
        font_path = get_font_path(font_name)
        logger.info(f"üì¶ –ó–∞–≥—Ä—É–∂–µ–Ω —à—Ä–∏—Ñ—Ç: {font_path}")
    except (ValueError, FileNotFoundError) as e:
        logger.warning(f"üéØ {e}, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback: Consolas")
        font_path = "Consolas"

    # –§–æ–Ω –Ω–æ–º–µ—Ä–æ–≤ —Å—Ç—Ä–æ–∫
    if line_number_bg is None:
        line_number_bg = style_inst.background_color

    logger.debug(
        f"üîß –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä–∞: font_size={scaled_font_size}, "
        f"line_numbers={line_numbers}, pad={scaled_pad}"
    )

    # –°–æ–∑–¥–∞—ë–º —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    formatter = ImageFormatter(
        style=style_inst,
        full=True,
        font_name=font_path,
        font_size=scaled_font_size,
        image_pad=scaled_pad,
        line_numbers=line_numbers,
        line_pad=scaled_line_pad,
        line_number_bg=line_number_bg,
        line_number_fg=line_number_fg,
        image_format="PNG",  # Pygments –≤—Å–µ–≥–¥–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç PNG
    )

    try:
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –±–∞–π—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        image_bytes = pygments.highlight(code_string, lexer, formatter, outfile=None)
        img = Image.open(io.BytesIO(image_bytes))

        logger.info(
            f"‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: {img.width}x{img.height}px, "
            f"–º–∞—Å—à—Ç–∞–±: {scale_factor}x"
        )

        return img

    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: {e}")
        raise


def create_code_screenshot(
    code_string: str, language: str, output_file: str | Path, **options
) -> dict:
    """–°–æ–∑–¥–∞—ë—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ –∫–æ–¥–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ —Ñ–∞–π–ª.

    LEGACY —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç create_code_image()
    –∏ image_utils –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.

    Args:
        code_string: –°—Ç—Ä–æ–∫–∞ —Å –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º.
        language: –Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è (–¥–ª—è –ª–µ–∫—Å–µ—Ä–∞ Pygments).
        output_file: –ü—É—Ç—å –∫ –≤—ã—Ö–æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
        **options: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
            - style: –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∏–ª—è Pygments (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'monokai').
            - font_name: –ò–º—è —à—Ä–∏—Ñ—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'JetBrainsMono').
            - font_size: –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 18).
            - pad: –û—Ç—Å—Ç—É–ø –≤–æ–∫—Ä—É–≥ –∫–æ–¥–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 25).
            - format: –§–æ—Ä–º–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (png, jpeg, webp; –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'webp').
            - scale_factor: –§–∞–∫—Ç–æ—Ä –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3.0).
            - transparent: –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é False).
            - line_numbers: –ù—É–º–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é True).
            - line_pad: –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –Ω–æ–º–µ—Ä–∞–º–∏ –∏ –∫–æ–¥–æ–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10).
            - line_number_bg: –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –Ω–æ–º–µ—Ä–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ —Å—Ç–∏–ª—è).
            - line_number_fg: –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –Ω–æ–º–µ—Ä–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é '#888888').
            - quality: –ö–∞—á–µ—Å—Ç–≤–æ –¥–ª—è JPEG/WEBP (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 95).
            - optimize: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è PNG (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é True).

    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.

    Raises:
        ValueError: –ï—Å–ª–∏ —è–∑—ã–∫ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback 'text').
    """
    # –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    style = options.get("style", "monokai")
    font_name = options.get("font_name", "JetBrainsMono")
    font_size = options.get("font_size", 18)
    pad = options.get("pad", 25)
    scale_factor = options.get("scale_factor", 3.0)
    transparent = options.get("transparent", False)
    line_numbers = options.get("line_numbers", True)
    line_pad = options.get("line_pad", 10)
    line_number_bg = options.get("line_number_bg", None)
    line_number_fg = options.get("line_number_fg", "#888888")

    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é
    img = create_code_image(
        code_string=code_string,
        language=language,
        style=style,
        font_name=font_name,
        font_size=font_size,
        pad=pad,
        scale_factor=scale_factor,
        transparent=transparent,
        line_numbers=line_numbers,
        line_pad=line_pad,
        line_number_bg=line_number_bg,
        line_number_fg=line_number_fg,
    )

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    output_path = Path(output_file)
    save_format = options.get("format", "webp").lower()

    # –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –Ω–µ —Å–æ–≤–º–µ—Å—Ç–∏–º —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é, –º–µ–Ω—è–µ–º –Ω–∞ PNG
    if transparent and save_format not in ("png", "webp"):
        logger.warning(
            "‚ö†Ô∏è –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ PNG –∏ WEBP, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ PNG"
        )
        save_format = "png"

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–µ–∑ image_utils
    save_result = save_image(
        image=img,
        output_path=output_path,
        format=save_format,  # type: ignore
        quality=options.get("quality", 95),
    )

    return {
        "success": True,
        "output_path": save_result["path"],
        "format": save_result["format"],
        "file_size_kb": round(save_result["size_bytes"] / 1024, 2),
        "dimensions": save_result["dimensions"],
        "scale_factor": scale_factor,
        "language": language,
        "style": style,
    }


if __name__ == "__main__":
    logging.basicConfig(level=logging.DEBUG)

    print("=== Code Screenshot Generator Test ===")

    SAMPLE_CODE_TS = """
import React, { useState } from 'react';

interface UserProfile {
  username: string;
  age: number;
}

const Profile: React.FC<UserProfile> = ({ username, age }) => {
  return <div>User: {username}, Age: {age}</div>;
};
"""

    ts_options = {
        "style": "dracula",
        "font_name": "JetBrainsMono",
        "font_size": 18,
        "pad": 10,
        "format": "webp",
        "scale_factor": 3.0,
        "line_numbers": True,
        "line_pad": 5,
        "line_number_fg": "#6272A4",
        "quality": 90,
    }

    print("\n–¢–µ—Å—Ç 1: TypeScript –∫–æ–¥ (WebP, 3x scale)...")
    result1 = create_code_screenshot(
        code_string=SAMPLE_CODE_TS.strip(),
        language="typescript",
        output_file="tests/output/typescript_screenshot_styled.webp",
        **ts_options,
    )

    print(f"‚úì –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ–∑–¥–∞–Ω: {result1['output_path']}")
    print(f"  –†–∞–∑–º–µ—Ä: {result1['file_size_kb']} KB")
    print(f"  –§–æ—Ä–º–∞—Ç: {result1['format']}")
    print(f"  –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ: {result1['dimensions']}")
    print(f"  –ú–∞—Å—à—Ç–∞–±: {result1['scale_factor']}x")

    SAMPLE_CODE_SQL = """
SELECT
    u.id AS user_id,
    u.username,
    u.email
FROM
    users u
INNER JOIN
    orders o ON u.id = o.user_id
WHERE
    u.registration_date > '2023-01-01'
ORDER BY
    u.username;
"""

    sql_options = {
        "style": "github-dark",
        "font_name": "FiraCode",
        "font_size": 20,
        "pad": 40,
        "format": "png",
        "scale_factor": 2.0,
        "line_numbers": False,
        "optimize": True,
    }

    print("\n–¢–µ—Å—Ç 2: SQL –∫–æ–¥ (PNG, 2x scale, –±–µ–∑ –Ω–æ–º–µ—Ä–æ–≤ —Å—Ç—Ä–æ–∫)...")
    result2 = create_code_screenshot(
        code_string=SAMPLE_CODE_SQL.strip(),
        language="sql",
        output_file="tests/output/sql_screenshot_no_lines.png",
        **sql_options,
    )

    print(f"‚úì –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ–∑–¥–∞–Ω: {result2['output_path']}")
    print(f"  –†–∞–∑–º–µ—Ä: {result2['file_size_kb']} KB")
    print(f"  –§–æ—Ä–º–∞—Ç: {result2['format']}")
    print(f"  –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ: {result2['dimensions']}")
    print(f"  –ú–∞—Å—à—Ç–∞–±: {result2['scale_factor']}x")

```

## `src/diagram_renderer.py`

```py
#!/usr/bin/env python3
"""–†–µ–Ω–¥–µ—Ä–µ—Ä PlantUML –¥–∏–∞–≥—Ä–∞–º–º.

–ú–æ–¥—É–ª—å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é UML –¥–∏–∞–≥—Ä–∞–º–º –∏–∑ PlantUML –∫–æ–¥–∞.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç PlantUML JAR —Ñ–∞–π–ª –∏ Java –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞.

–§—É–Ω–∫—Ü–∏–∏:
    ensure_java_environment() -> str
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ Java –≤ —Å–∏—Å—Ç–µ–º–µ.
    render_diagram_to_image(diagram_code, format, theme_name, scale_factor) -> Image
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–∏–∞–≥—Ä–∞–º–º—É –∏–∑ PlantUML –∫–æ–¥–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç PIL Image.
    render_diagram_from_string(diagram_code, output_path, format, theme_name, scale_factor) -> dict
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–∏–∞–≥—Ä–∞–º–º—É –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ —Ñ–∞–π–ª (legacy, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç image_utils).

–ö–ª–∞—Å—Å—ã:
    JavaNotFoundError
        –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ Java.
    PlantUMLRenderError
        –û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ PlantUML –¥–∏–∞–≥—Ä–∞–º–º—ã.
    PlantUMLSyntaxError
        –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ PlantUML –∫–æ–¥–µ.
"""

import logging
import subprocess
import sys
from pathlib import Path
from typing import Literal

from PIL import Image

from src.font_initializer import ensure_fonts_initialized
from src.image_utils import save_image, load_image_from_bytes

logger = logging.getLogger(__name__)

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø—É—Ç–µ–π
ASSET_DIR = Path(__file__).parent.parent / "asset"
PLANTUML_JAR = ASSET_DIR / "bins" / "plantuml.jar"
THEMES_DIR = ASSET_DIR / "themes"

# –ú–∞–ø–ø–∏–Ω–≥ —É—Ä–æ–≤–Ω–µ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
# –ë–∞–∑–æ–≤—ã–π DPI = 96. Extreme (6.0) –¥–∞–µ—Ç ~576 DPI –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–µ—á–∞—Ç–∏.
QUALITY_LEVELS = {
    "Low": 1.0,  # 96 DPI (Web preview)
    "Medium": 2.0,  # 192 DPI (Standard screens)
    "High": 3.0,  # 288 DPI (High-res screens / Default)
    "Ultra": 4.0,  # 384 DPI (4K Presentations)
    "Extreme": 6.0,  # 576 DPI (Print / Deep Zoom)
}

# –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
DiagramFormat = Literal["png", "svg", "eps", "pdf"]


class JavaNotFoundError(Exception):
    """Java –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ."""

    pass


class PlantUMLRenderError(Exception):
    """–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ PlantUML –¥–∏–∞–≥—Ä–∞–º–º—ã."""

    pass


class PlantUMLSyntaxError(Exception):
    """–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ PlantUML –∫–æ–¥–µ."""

    pass


def ensure_java_environment() -> str:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ Java –≤ —Å–∏—Å—Ç–µ–º–µ.

    Returns:
        –í–µ—Ä—Å–∏—è Java.

    Raises:
        JavaNotFoundError: –ï—Å–ª–∏ Java –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –≤–µ—Ä—Å–∏—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞.
    """
    logger.debug("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Java –æ–∫—Ä—É–∂–µ–Ω–∏—è")
    try:
        result = subprocess.run(
            ["java", "-version"],
            capture_output=True,
            text=True,
            timeout=5,
        )

        version_output = result.stderr or result.stdout

        if not version_output:
            logger.error("‚ùå Java —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –Ω–æ –≤–µ—Ä—Å–∏—è –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞")
            raise JavaNotFoundError("Java —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –Ω–æ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–µ—Ä—Å–∏—é")

        version_line = version_output.split("\n")[0].strip()
        logger.info(f"‚òï Java –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞: {version_line}")

        return version_line

    except FileNotFoundError:
        logger.error("‚ùå Java –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ PATH")
        raise JavaNotFoundError(
            "Java –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ. "
            "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ JRE (Java Runtime Environment) –≤–µ—Ä—Å–∏–∏ 8 –∏–ª–∏ –≤—ã—à–µ.\n"
            "macOS: brew install openjdk\n"
            "Windows: https://adoptium.net/\n"
            "Linux: sudo apt-get install default-jre"
        )
    except subprocess.TimeoutExpired:
        logger.error("‚ùå –¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ Java")
        raise JavaNotFoundError("–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ Java. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É.")
    except JavaNotFoundError:
        raise
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ Java: {e}")
        raise JavaNotFoundError(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ Java: {str(e)}")


def _prepare_diagram_code(
    diagram_code: str, theme_path: Path | None = None, dpi: int | None = None
) -> str:
    """–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–¥ –¥–∏–∞–≥—Ä–∞–º–º—ã —Å —Ç–µ–º–æ–π, Smetana –∏ DPI.

    Args:
        diagram_code: –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ PlantUML –¥–∏–∞–≥—Ä–∞–º–º—ã.
        theme_path: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Ç–µ–º—ã (.puml).
        dpi: DPI –¥–ª—è –∏–Ω—ä–µ–∫—Ü–∏–∏ –≤ –∫–æ–¥ —á–µ—Ä–µ–∑ skinparam (–æ–±—Ö–æ–¥ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Smetana).

    Returns:
        –ö–æ–¥ –¥–∏–∞–≥—Ä–∞–º–º—ã —Å –≤–∫–ª—é—á–µ–Ω–Ω–æ–π —Ç–µ–º–æ–π, !pragma layout smetana –∏ skinparam dpi.
    """
    lines = diagram_code.strip().split("\n")
    has_startuml = lines[0].strip().startswith("@startuml")

    directives = ["!pragma layout smetana"]

    # HARD INJECTION: Smetana –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —Ñ–ª–∞–≥ -Sdpi, –ø–æ—ç—Ç–æ–º—É –≤—à–∏–≤–∞–µ–º –≤ –∫–æ–¥
    if dpi and dpi > 96:
        directives.append(f"skinparam dpi {dpi}")
        logger.debug(f"üíâ DPI –∏–Ω—ä–µ–∫—Ü–∏—è –≤ PlantUML –∫–æ–¥: skinparam dpi {dpi}")

    if theme_path and theme_path.exists():
        directives.append(f"!include {theme_path.absolute()}")

    if has_startuml:
        for i, directive in enumerate(directives, 1):
            lines.insert(i, directive)
        return "\n".join(lines)
    else:
        result = "@startuml\n" + "\n".join(directives) + "\n" + diagram_code
        if not diagram_code.strip().endswith("@enduml"):
            result += "\n@enduml"
        return result


def render_diagram_to_image(
    diagram_code: str,
    format: DiagramFormat = "png",
    theme_name: str | None = "default",
    scale_factor: float = 1.0,
) -> Image.Image:
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–∏–∞–≥—Ä–∞–º–º—É –∏–∑ PlantUML –∫–æ–¥–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç PIL Image –æ–±—ä–µ–∫—Ç.

    Args:
        diagram_code: –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ PlantUML –¥–∏–∞–≥—Ä–∞–º–º—ã.
        format: –§–æ—Ä–º–∞—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ (png, svg, eps, pdf, webp).
        theme_name: –ò–º—è —Ç–µ–º—ã –∏–∑ –ø–∞–ø–∫–∏ asset/themes –∏–ª–∏ None.
        scale_factor: –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.
                     1.0 = 96 DPI (—Å—Ç–∞–Ω–¥–∞—Ä—Ç), 2.0 = 192 DPI, 3.0 = 288 DPI.

    Returns:
        PIL Image –æ–±—ä–µ–∫—Ç.

    Raises:
        JavaNotFoundError: –ï—Å–ª–∏ Java –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.
        PlantUMLSyntaxError: –ï—Å–ª–∏ PlantUML –∫–æ–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏.
        PlantUMLRenderError: –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞.
    """
    logger.info("üìê –ù–∞—á–∞–ª–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ PlantUML –¥–∏–∞–≥—Ä–∞–º–º—ã")

    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑, –∑–∞—Ç–µ–º –∫–µ—à–∏—Ä—É–µ—Ç—Å—è)
    logger.debug("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤")
    font_init_result = ensure_fonts_initialized()

    if not font_init_result["success"]:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —à—Ä–∏—Ñ—Ç–æ–≤: {font_init_result['error']}")
        raise JavaNotFoundError(font_init_result["error"])

    if font_init_result["already_installed"]:
        logger.debug(
            f"‚úÖ –®—Ä–∏—Ñ—Ç—ã —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: {len(font_init_result['fonts'])} —Ñ–∞–π–ª–æ–≤"
        )
    else:
        logger.info(
            f"üíâ –®—Ä–∏—Ñ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ JRE: {len(font_init_result['fonts'])} —Ñ–∞–π–ª–æ–≤ "
            f"({font_init_result['java_home']})"
        )

    java_version = ensure_java_environment()

    if not PLANTUML_JAR.exists():
        logger.error(f"‚ùå PlantUML JAR –Ω–µ –Ω–∞–π–¥–µ–Ω: {PLANTUML_JAR}")
        raise FileNotFoundError(
            f"PlantUML JAR –Ω–µ –Ω–∞–π–¥–µ–Ω: {PLANTUML_JAR}\n"
            "–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ –≤—Ä—É—á–Ω—É—é."
        )

    logger.debug(f"üì¶ PlantUML JAR: {PLANTUML_JAR}")

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–º—ã
    theme_path = None
    if theme_name:
        theme_path = THEMES_DIR / f"{theme_name}.puml"
        if not theme_path.exists():
            logger.error(f"‚ùå –¢–µ–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: {theme_path}")
            raise FileNotFoundError(
                f"–¢–µ–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: {theme_path}\n"
                f"–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–º—ã –≤ {THEMES_DIR}: "
                f"{[f.stem for f in THEMES_DIR.glob('*.puml')]}"
            )
        logger.info(f"üé® –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º—ã: {theme_name}")

    # –í—ã—á–∏—Å–ª—è–µ–º DPI –Ω–∞ –æ—Å–Ω–æ–≤–µ scale_factor
    # 1.0 = 96 DPI (—Å—Ç–∞–Ω–¥–∞—Ä—Ç), 2.0 = 192 DPI, 3.0 = 288 DPI, 6.0 = 576 DPI
    dpi = int(96 * scale_factor)
    logger.debug(f"üìè Force DPI Injection: {dpi} (Scale: {scale_factor}x)")

    prepared_code = _prepare_diagram_code(diagram_code, theme_path, dpi)

    command = [
        "java",
        "-Dfile.encoding=UTF-8",
        "-Dplantuml.include.path=" + str(THEMES_DIR.absolute()),
        "-Dplantuml.smetana=true",
        "-Dplantuml.graphviz.use=false",
        f"-DPLANTUML_LIMIT_SIZE=16384",  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ª–∏–º–∏—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        "-jar",
        str(PLANTUML_JAR.absolute()),
        "-pipe",
        f"-t{format}",
        "-charset",
        "UTF-8",
    ]

    logger.debug(f"‚öôÔ∏è –ó–∞–ø—É—Å–∫ Java –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–ª—è PlantUML")

    try:
        process = subprocess.Popen(
            command,
            stdin=subprocess.PIPE,
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE,
        )

        stdout_data, stderr_data = process.communicate(
            input=prepared_code.encode("utf-8"), timeout=30
        )

        stderr_text = stderr_data.decode("utf-8", errors="replace").strip()

        if stderr_text and any(
            err in stderr_text.lower()
            for err in ["error", "syntax error", "cannot find", "exception"]
        ):
            logger.error(f"üí• –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ PlantUML: {stderr_text}")
            raise PlantUMLSyntaxError(f"PlantUML –æ–±–Ω–∞—Ä—É–∂–∏–ª –æ—à–∏–±–∫—É:\n{stderr_text}")

        if process.returncode != 0:
            error_message = stderr_text or "Unknown error"
            logger.error(f"‚ùå PlantUML –≤–µ—Ä–Ω—É–ª –∫–æ–¥ –æ—à–∏–±–∫–∏: {process.returncode}")
            raise PlantUMLRenderError(
                f"PlantUML –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É (–∫–æ–¥ {process.returncode}):\n{error_message}"
            )

        if len(stdout_data) < 100:
            logger.error(
                f"‚ùå PlantUML —Å–æ–∑–¥–∞–ª —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π —Ñ–∞–π–ª: {len(stdout_data)} bytes"
            )
            raise PlantUMLRenderError(
                f"PlantUML —Å–æ–∑–¥–∞–ª —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π —Ñ–∞–π–ª ({len(stdout_data)} bytes). "
                "–í–æ–∑–º–æ–∂–Ω–æ, –≤ –∫–æ–¥–µ –µ—Å—Ç—å –æ—à–∏–±–∫–∏."
            )

        # –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ –±–∞–π—Ç–æ–≤ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞—Å—Ç—Ä–æ–≤—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
        if format == "png":
            image = load_image_from_bytes(stdout_data, source_format=format)

            logger.info(
                f"‚úÖ –î–∏–∞–≥—Ä–∞–º–º–∞ –æ—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω–∞: {image.width}x{image.height}, "
                f"—Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö: {len(stdout_data) / 1024:.2f} KB"
            )

            return image
        else:
            # –î–ª—è SVG/EPS/PDF –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–∞–≥–ª—É—à–∫—É (—ç—Ç–∏ —Ñ–æ—Ä–º–∞—Ç—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç PIL Image)
            logger.warning(
                f"‚ö†Ô∏è –§–æ—Ä–º–∞—Ç {format} –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è render_diagram_to_image(). "
                f"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ render_diagram_from_string() –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤."
            )
            raise PlantUMLRenderError(
                f"–§–æ—Ä–º–∞—Ç {format} –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ PIL Image. "
                "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ 'png' –¥–ª—è render_diagram_to_image()."
            )

    except subprocess.TimeoutExpired:
        process.kill()
        logger.error("‚ùå –¢–∞–π–º–∞—É—Ç –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ –¥–∏–∞–≥—Ä–∞–º–º—ã (30 —Å–µ–∫—É–Ω–¥)")
        raise PlantUMLRenderError(
            "–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ –¥–∏–∞–≥—Ä–∞–º–º—ã (30 —Å–µ–∫—É–Ω–¥). "
            "–í–æ–∑–º–æ–∂–Ω–æ, –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–∞—è."
        )
    except (PlantUMLSyntaxError, PlantUMLRenderError):
        raise
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ: {e}")
        raise PlantUMLRenderError(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ –¥–∏–∞–≥—Ä–∞–º–º—ã: {str(e)}")


def render_diagram_from_string(
    diagram_code: str,
    output_path: str | Path,
    format: DiagramFormat = "png",
    theme_name: str | None = "default",
    scale_factor: float = 1.0,
) -> dict:
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–∏–∞–≥—Ä–∞–º–º—É –∏–∑ PlantUML –∫–æ–¥–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ —Ñ–∞–π–ª.

    LEGACY —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏. –î–ª—è PNG –∏—Å–ø–æ–ª—å–∑—É–µ—Ç render_diagram_to_image()
    –∏ image_utils. –î–ª—è SVG/EPS/PDF —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞–ø—Ä—è–º—É—é.

    Args:
        diagram_code: –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ PlantUML –¥–∏–∞–≥—Ä–∞–º–º—ã.
        output_path: –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ –≤—ã—Ö–æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É.
        format: –§–æ—Ä–º–∞—Ç –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (png, svg, eps, pdf, webp).
        theme_name: –ò–º—è —Ç–µ–º—ã –∏–∑ –ø–∞–ø–∫–∏ asset/themes –∏–ª–∏ None.
        scale_factor: –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è (1.0 = —Å—Ç–∞–Ω–¥–∞—Ä—Ç, 3.0 = –¥–ª—è 4K).
                     –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è PNG.

    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞.

    Raises:
        JavaNotFoundError: –ï—Å–ª–∏ Java –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.
        PlantUMLSyntaxError: –ï—Å–ª–∏ PlantUML –∫–æ–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏.
        PlantUMLRenderError: –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞.
    """
    output_path = Path(output_path)

    # –î–ª—è PNG/WebP –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é —Å PIL Image
    if format in ("png", "webp"):
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é
        image = render_diagram_to_image(
            diagram_code=diagram_code,
            format="png",  # PlantUML –≤—Å–µ–≥–¥–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç PNG, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –ø–æ—Ç–æ–º
            theme_name=theme_name,
            scale_factor=scale_factor,
        )

        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–∏–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞)
        save_format = output_path.suffix.lstrip(".").lower() or format

        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–µ–∑ image_utils
        save_result = save_image(
            image=image,
            output_path=output_path,
            format=save_format,  # type: ignore
        )

        java_version = ensure_java_environment()

        return {
            "success": True,
            "output_path": save_result["path"],
            "format": save_result["format"],
            "file_size_kb": round(save_result["size_bytes"] / 1024, 2),
            "dimensions": save_result["dimensions"],
            "java_version": java_version,
            "theme_used": theme_name,
            "scale_factor": scale_factor,
        }

    # –î–ª—è SVG/EPS/PDF –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    else:
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —à—Ä–∏—Ñ—Ç–æ–≤
        logger.debug("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤")
        font_init_result = ensure_fonts_initialized()

        if not font_init_result["success"]:
            logger.error(
                f"‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —à—Ä–∏—Ñ—Ç–æ–≤: {font_init_result['error']}"
            )
            raise JavaNotFoundError(font_init_result["error"])

        java_version = ensure_java_environment()

        if not PLANTUML_JAR.exists():
            raise FileNotFoundError(f"PlantUML JAR –Ω–µ –Ω–∞–π–¥–µ–Ω: {PLANTUML_JAR}")

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–º—ã
        theme_path = None
        if theme_name:
            theme_path = THEMES_DIR / f"{theme_name}.puml"
            if not theme_path.exists():
                raise FileNotFoundError(f"–¢–µ–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: {theme_path}")

        prepared_code = _prepare_diagram_code(diagram_code, theme_path)

        command = [
            "java",
            "-Dfile.encoding=UTF-8",
            "-Dplantuml.include.path=" + str(THEMES_DIR.absolute()),
            "-Dplantuml.smetana=true",
            "-Dplantuml.graphviz.use=false",
            "-jar",
            str(PLANTUML_JAR.absolute()),
            "-pipe",
            f"-t{format}",
            "-charset",
            "UTF-8",
        ]

        try:
            process = subprocess.Popen(
                command,
                stdin=subprocess.PIPE,
                stdout=subprocess.PIPE,
                stderr=subprocess.PIPE,
            )

            stdout_data, stderr_data = process.communicate(
                input=prepared_code.encode("utf-8"), timeout=30
            )

            stderr_text = stderr_data.decode("utf-8", errors="replace").strip()

            if stderr_text and any(
                err in stderr_text.lower()
                for err in ["error", "syntax error", "cannot find", "exception"]
            ):
                raise PlantUMLSyntaxError(f"PlantUML –æ–±–Ω–∞—Ä—É–∂–∏–ª –æ—à–∏–±–∫—É:\n{stderr_text}")

            if process.returncode != 0:
                error_message = stderr_text or "Unknown error"
                raise PlantUMLRenderError(
                    f"PlantUML –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É (–∫–æ–¥ {process.returncode}):\n{error_message}"
                )

            # –°–æ–∑–¥–∞—ë–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            output_path.parent.mkdir(parents=True, exist_ok=True)

            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–ø—Ä—è–º—É—é
            with open(output_path, "wb") as f:
                f.write(stdout_data)

            file_size = len(stdout_data)
            logger.info(
                f"‚úÖ –î–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: {output_path.name}, "
                f"—Ä–∞–∑–º–µ—Ä: {file_size / 1024:.2f} KB"
            )

            return {
                "success": True,
                "output_path": str(output_path.absolute()),
                "format": format,
                "file_size_kb": round(file_size / 1024, 2),
                "dimensions": None,  # –ù–µ—Ç –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
                "java_version": java_version,
                "theme_used": theme_name,
                "scale_factor": scale_factor if format == "png" else None,
            }

        except subprocess.TimeoutExpired:
            process.kill()
            raise PlantUMLRenderError(
                "–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ –¥–∏–∞–≥—Ä–∞–º–º—ã (30 —Å–µ–∫—É–Ω–¥). "
                "–í–æ–∑–º–æ–∂–Ω–æ, –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–∞—è."
            )
        except (PlantUMLSyntaxError, PlantUMLRenderError):
            raise
        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ: {e}")
            raise PlantUMLRenderError(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ –¥–∏–∞–≥—Ä–∞–º–º—ã: {str(e)}")


if __name__ == "__main__":
    logging.basicConfig(level=logging.DEBUG)

    print("=== PlantUML Renderer Test ===")

    try:
        java_version = ensure_java_environment()
        print(f"‚úì Java –Ω–∞–π–¥–µ–Ω–∞: {java_version}")

        if PLANTUML_JAR.exists():
            print(f"‚úì PlantUML JAR –Ω–∞–π–¥–µ–Ω: {PLANTUML_JAR}")
        else:
            print(f"‚úó PlantUML JAR –Ω–µ –Ω–∞–π–¥–µ–Ω: {PLANTUML_JAR}")
            sys.exit(1)

        themes = list(THEMES_DIR.glob("*.puml"))
        print(f"‚úì –ù–∞–π–¥–µ–Ω–æ —Ç–µ–º: {len(themes)}")
        for theme in themes:
            print(f"  - {theme.stem}")

        test_code = """
@startuml
Alice -> Bob: Authentication Request
Bob --> Alice: Authentication Response
@enduml
"""
        test_output = Path("tests/output/plantuml_test.png")

        print("\n–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ (1x scale)...")
        result = render_diagram_from_string(
            diagram_code=test_code,
            output_path=test_output,
            format="png",
            theme_name="default",
            scale_factor=1.0,
        )

        print(f"‚úì –î–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ–∑–¥–∞–Ω–∞: {result['output_path']}")
        print(f"  –†–∞–∑–º–µ—Ä: {result['file_size_kb']} KB")
        print(f"  –§–æ—Ä–º–∞—Ç: {result['format']}")
        print(f"  –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ: {result['dimensions']}")
        print(f"  –ú–∞—Å—à—Ç–∞–±: {result['scale_factor']}x")

        # –¢–µ—Å—Ç —Å –≤—ã—Å–æ–∫–∏–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º
        test_output_hq = Path("tests/output/plantuml_test_3x.png")
        print("\n–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ (3x scale –¥–ª—è 4K)...")
        result_hq = render_diagram_from_string(
            diagram_code=test_code,
            output_path=test_output_hq,
            format="png",
            theme_name="default",
            scale_factor=3.0,
        )

        print(f"‚úì –î–∏–∞–≥—Ä–∞–º–º–∞ HQ —Å–æ–∑–¥–∞–Ω–∞: {result_hq['output_path']}")
        print(f"  –†–∞–∑–º–µ—Ä: {result_hq['file_size_kb']} KB")
        print(f"  –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ: {result_hq['dimensions']}")
        print(f"  –ú–∞—Å—à—Ç–∞–±: {result_hq['scale_factor']}x")

    except Exception as e:
        print(f"‚úó –û—à–∏–±–∫–∞: {e}")
        import traceback

        traceback.print_exc()
        sys.exit(1)

```

## `src/font_initializer.py`

```py
"""–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä —à—Ä–∏—Ñ—Ç–æ–≤ –¥–ª—è PlantUML.

–ú–æ–¥—É–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤ –≤ JRE,
—á—Ç–æ–±—ã PlantUML –º–æ–≥ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

–°—Ç—Ä–∞—Ç–µ–≥–∏—è:
1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞—Ä–∫–µ—Ä-—Ñ–∞–π–ª - –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —É–∂–µ –±—ã–ª–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
2. –ù–∞—Ö–æ–¥–∏–º Java JRE
3. –ö–æ–ø–∏—Ä—É–µ–º TTF —à—Ä–∏—Ñ—Ç—ã –≤ lib/fonts JRE
4. –°–æ–∑–¥–∞–µ–º –º–∞—Ä–∫–µ—Ä-—Ñ–∞–π–ª –æ–± —É—Å–ø–µ—à–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ

–§—É–Ω–∫—Ü–∏–∏:
    ensure_fonts_initialized() -> dict
        –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —à—Ä–∏—Ñ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ JRE.
"""

import logging
import platform
import shutil
import subprocess
from pathlib import Path
import json

logger = logging.getLogger(__name__)

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
FONTS_DIR = Path(__file__).parent.parent / "asset" / "fonts"
MARKER_FILE = Path(__file__).parent.parent / ".fonts_installed.json"


class JavaNotFoundError(Exception):
    """Java –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ."""

    pass


class FontInitializationError(Exception):
    """–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —à—Ä–∏—Ñ—Ç–æ–≤."""

    pass


def _find_java_home() -> Path:
    """–ù–∞—Ö–æ–¥–∏—Ç –ø—É—Ç—å –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ Java JRE/JDK.

    Returns:
        Path: –ü—É—Ç—å –∫ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ Java.

    Raises:
        JavaNotFoundError: –ï—Å–ª–∏ Java –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.
    """
    logger.debug("üîç –ü–æ–∏—Å–∫ Java —É—Å—Ç–∞–Ω–æ–≤–∫–∏...")

    try:
        # –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å java.home —á–µ—Ä–µ–∑ Java –∫–æ–º–∞–Ω–¥—É
        result = subprocess.run(
            ["java", "-XshowSettings:properties", "-version"],
            capture_output=True,
            text=True,
            timeout=5,
        )

        # –ü–∞—Ä—Å–∏–º –≤—ã–≤–æ–¥ –¥–ª—è –ø–æ–∏—Å–∫–∞ java.home
        for line in result.stderr.split("\n"):
            if "java.home" in line:
                # –§–æ—Ä–º–∞—Ç: "    java.home = C:\Path\To\Java"
                parts = line.split("=")
                if len(parts) == 2:
                    java_home = Path(parts[1].strip())
                    if java_home.exists():
                        logger.info(f"‚òï –ù–∞–π–¥–µ–Ω–∞ Java: {java_home}")
                        return java_home

        # Fallback: –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —á–µ—Ä–µ–∑ where/which
        where_cmd = "where" if platform.system() == "Windows" else "which"
        result = subprocess.run([where_cmd, "java"], capture_output=True, text=True)

        if result.returncode == 0:
            java_exe = Path(result.stdout.strip().split("\n")[0])
            # java.exe -> bin -> JRE root
            java_home = java_exe.parent.parent

            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ java8path (Windows —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞)
            if "java8path" in str(java_home).lower():
                # –≠—Ç–æ —Å–∏–º–ª–∏–Ω–∫, –∏—â–µ–º —Ä–µ–∞–ª—å–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É –≤ Program Files
                if platform.system() == "Windows":
                    # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—É—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ JRE
                    possible_paths = [
                        Path(r"C:\Program Files\Java"),
                        Path(r"C:\Program Files (x86)\Java"),
                    ]

                    for base_path in possible_paths:
                        if base_path.exists():
                            # –ò—â–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é JRE/JDK
                            jre_dirs = sorted(base_path.glob("jre*")) + sorted(
                                base_path.glob("jdk*")
                            )
                            if jre_dirs:
                                java_home = jre_dirs[-1]
                                break

            if java_home.exists():
                logger.info(f"‚òï –ù–∞–π–¥–µ–Ω–∞ Java: {java_home}")
                return java_home

        raise JavaNotFoundError("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—É—Ç—å –∫ Java")

    except subprocess.TimeoutExpired:
        raise JavaNotFoundError("–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ Java")
    except Exception as e:
        raise JavaNotFoundError(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ Java: {e}")


def _get_jre_fonts_dir(java_home: Path) -> Path:
    """–ü–æ–ª—É—á–∞–µ—Ç –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —à—Ä–∏—Ñ—Ç–æ–≤ JRE.

    Args:
        java_home: –ü—É—Ç—å –∫ –∫–æ—Ä–Ω—é Java —É—Å—Ç–∞–Ω–æ–≤–∫–∏.

    Returns:
        Path: –ü—É—Ç—å –∫ lib/fonts –∏–ª–∏ lib/fonts/fallback.

    Raises:
        FontInitializationError: –ï—Å–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.
    """
    # –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–µ—Ä—Å–∏–∏ Java –∏ –û–°)
    possible_paths = [
        java_home / "lib" / "fonts",
        java_home / "jre" / "lib" / "fonts",
        java_home / "lib" / "fonts" / "fallback",
        java_home / "jre" / "lib" / "fonts" / "fallback",
    ]

    for fonts_path in possible_paths:
        if fonts_path.exists():
            logger.debug(f"üìÅ –ù–∞–π–¥–µ–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ JRE: {fonts_path}")
            return fonts_path

    # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, —Å–æ–∑–¥–∞–µ–º lib/fonts
    default_path = java_home / "lib" / "fonts"
    try:
        default_path.mkdir(parents=True, exist_ok=True)
        logger.info(f"üìÅ –°–æ–∑–¥–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —à—Ä–∏—Ñ—Ç–æ–≤: {default_path}")
        return default_path
    except Exception as e:
        raise FontInitializationError(
            f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —à—Ä–∏—Ñ—Ç–æ–≤: {e}\n"
            f"–í–æ–∑–º–æ–∂–Ω–æ —Ç—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞."
        )


def _copy_fonts_to_jre(jre_fonts_dir: Path) -> list[str]:
    """–ö–æ–ø–∏—Ä—É–µ—Ç TTF —à—Ä–∏—Ñ—Ç—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é JRE.

    Args:
        jre_fonts_dir: –ü—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —à—Ä–∏—Ñ—Ç–æ–≤ JRE.

    Returns:
        list[str]: –°–ø–∏—Å–æ–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤.

    Raises:
        FontInitializationError: –ï—Å–ª–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å.
    """
    if not FONTS_DIR.exists():
        raise FontInitializationError(f"–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å —à—Ä–∏—Ñ—Ç–∞–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: {FONTS_DIR}")

    copied_fonts = []

    for font_file in FONTS_DIR.glob("*.ttf"):
        try:
            destination = jre_fonts_dir / font_file.name

            # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if destination.exists():
                logger.debug(f"‚è≠Ô∏è  –®—Ä–∏—Ñ—Ç —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: {font_file.name}")
                copied_fonts.append(font_file.name)
                continue

            shutil.copy2(font_file, destination)
            logger.info(f"üíâ –®—Ä–∏—Ñ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω: {font_file.name}")
            copied_fonts.append(font_file.name)

        except PermissionError:
            raise FontInitializationError(
                f"–û—Ç–∫–∞–∑–∞–Ω–æ –≤ –¥–æ—Å—Ç—É–ø–µ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ {font_file.name}.\n"
                f"–¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —à—Ä–∏—Ñ—Ç–æ–≤ –≤ JRE."
            )
        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è {font_file.name}: {e}")

    if not copied_fonts:
        raise FontInitializationError("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∏ –æ–¥–Ω–æ–≥–æ —à—Ä–∏—Ñ—Ç–∞")

    return copied_fonts


def _create_marker_file(java_home: Path, fonts: list[str]) -> None:
    """–°–æ–∑–¥–∞–µ—Ç –º–∞—Ä–∫–µ—Ä-—Ñ–∞–π–ª –æ–± —É—Å–ø–µ—à–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ —à—Ä–∏—Ñ—Ç–æ–≤.

    Args:
        java_home: –ü—É—Ç—å –∫ Java —É—Å—Ç–∞–Ω–æ–≤–∫–µ.
        fonts: –°–ø–∏—Å–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤.
    """
    marker_data = {
        "java_home": str(java_home),
        "fonts_installed": fonts,
        "platform": platform.system(),
        "timestamp": str(Path(__file__).stat().st_mtime),
    }

    try:
        with open(MARKER_FILE, "w", encoding="utf-8") as f:
            json.dump(marker_data, f, indent=2)
        logger.debug(f"‚úÖ –°–æ–∑–¥–∞–Ω –º–∞—Ä–∫–µ—Ä-—Ñ–∞–π–ª: {MARKER_FILE}")
    except Exception as e:
        logger.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –º–∞—Ä–∫–µ—Ä-—Ñ–∞–π–ª: {e}")


def _check_marker_file() -> dict | None:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –º–∞—Ä–∫–µ—Ä-—Ñ–∞–π–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —à—Ä–∏—Ñ—Ç–æ–≤.

    Returns:
        dict | None: –î–∞–Ω–Ω—ã–µ –∏–∑ –º–∞—Ä–∫–µ—Ä–∞ –∏–ª–∏ None –µ—Å–ª–∏ —Ñ–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç/–Ω–µ–≤–∞–ª–∏–¥–µ–Ω.
    """
    if not MARKER_FILE.exists():
        return None

    try:
        with open(MARKER_FILE, "r", encoding="utf-8") as f:
            data = json.load(f)

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å (Java —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
        java_home = Path(data.get("java_home", ""))
        if java_home.exists():
            logger.debug(f"‚úÖ –ù–∞–π–¥–µ–Ω –º–∞—Ä–∫–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —à—Ä–∏—Ñ—Ç–æ–≤: {MARKER_FILE}")
            return data
        else:
            logger.debug(f"‚ö†Ô∏è Java –∏–∑ –º–∞—Ä–∫–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞")
            return None

    except Exception as e:
        logger.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä-—Ñ–∞–π–ª–∞: {e}")
        return None


def ensure_fonts_initialized() -> dict:
    """–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∫–∞—Å—Ç–æ–º–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ JRE.

    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∞—Ä–∫–µ—Ä-—Ñ–∞–π–ª –∏ –µ—Å–ª–∏ —à—Ä–∏—Ñ—Ç—ã –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã,
    –≤—ã–ø–æ–ª–Ω—è–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

    Returns:
        dict: –†–µ–∑—É–ª—å—Ç–∞—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:
            {
                "success": bool,
                "already_installed": bool,
                "java_home": str,
                "fonts": list[str],
                "error": str | None
            }

    Raises:
        JavaNotFoundError: –ï—Å–ª–∏ Java –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.
        FontInitializationError: –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å.
    """
    logger.info("üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —à—Ä–∏—Ñ—Ç–æ–≤...")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞—Ä–∫–µ—Ä
    marker_data = _check_marker_file()
    if marker_data:
        logger.info(f"‚úÖ –®—Ä–∏—Ñ—Ç—ã —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ JRE: {marker_data['java_home']}")
        return {
            "success": True,
            "already_installed": True,
            "java_home": marker_data["java_home"],
            "fonts": marker_data["fonts_installed"],
            "error": None,
        }

    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è
    logger.info("üöÄ –ù–∞—á–∞–ª–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —à—Ä–∏—Ñ—Ç–æ–≤ –≤ JRE...")

    try:
        # 1. –ù–∞—Ö–æ–¥–∏–º Java
        java_home = _find_java_home()

        # 2. –ü–æ–ª—É—á–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —à—Ä–∏—Ñ—Ç–æ–≤
        jre_fonts_dir = _get_jre_fonts_dir(java_home)

        # 3. –ö–æ–ø–∏—Ä—É–µ–º —à—Ä–∏—Ñ—Ç—ã
        installed_fonts = _copy_fonts_to_jre(jre_fonts_dir)

        # 4. –°–æ–∑–¥–∞–µ–º –º–∞—Ä–∫–µ—Ä
        _create_marker_file(java_home, installed_fonts)

        logger.info(
            f"üéâ –®—Ä–∏—Ñ—Ç—ã —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã! –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: {len(installed_fonts)}"
        )

        return {
            "success": True,
            "already_installed": False,
            "java_home": str(java_home),
            "fonts": installed_fonts,
            "error": None,
        }

    except JavaNotFoundError as e:
        error_msg = (
            f"‚ùå Java –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ.\n\n"
            f"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Java Runtime Environment (JRE) –≤–µ—Ä—Å–∏–∏ 8 –∏–ª–∏ –≤—ã—à–µ:\n"
            f"  ‚Ä¢ Windows: https://adoptium.net/\n"
            f"  ‚Ä¢ macOS: brew install openjdk\n"
            f"  ‚Ä¢ Linux: sudo apt-get install default-jre\n\n"
            f"–î–µ—Ç–∞–ª–∏: {e}"
        )
        logger.error(error_msg)
        return {
            "success": False,
            "already_installed": False,
            "java_home": None,
            "fonts": [],
            "error": error_msg,
        }

    except FontInitializationError as e:
        error_msg = f"‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —à—Ä–∏—Ñ—Ç–æ–≤: {e}"
        logger.error(error_msg)
        return {
            "success": False,
            "already_installed": False,
            "java_home": None,
            "fonts": [],
            "error": error_msg,
        }

```

## `src/font_manager.py`

```py
"""–ú–µ–Ω–µ–¥–∂–µ—Ä —à—Ä–∏—Ñ—Ç–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ TTF —Ñ–∞–π–ª–∞–º–∏ –∏ —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.

–§—É–Ω–∫—Ü–∏–∏:
    get_font_path(font_name) -> str
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Ç—å –∫ —à—Ä–∏—Ñ—Ç—É.
    list_available_fonts() -> list[str]
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤.
    load_custom_fonts() -> None
        –í—Ä–µ–º–µ–Ω–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —à—Ä–∏—Ñ—Ç—ã –≤ —Å–∏—Å—Ç–µ–º–µ (Windows) –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –≤ Java.
"""

import logging
import platform
import ctypes
from pathlib import Path

logger = logging.getLogger(__name__)

FONTS_DIR = Path(__file__).parent.parent / "asset" / "fonts"

AVAILABLE_FONTS = {
    "JetBrainsMono": "JetBrainsMono-Regular.ttf",
    "FiraCode": "FiraCode-Regular.ttf",
    "CascadiaCode": "CascadiaCode-Regular.ttf",
    "Consolas": None,
    "Courier New": None,
}


def get_font_path(font_name: str) -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Ç—å –∫ —à—Ä–∏—Ñ—Ç—É.

    Args:
        font_name: –ò–º—è —à—Ä–∏—Ñ—Ç–∞ –∏–∑ AVAILABLE_FONTS.

    Returns:
        –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ TTF —Ñ–∞–π–ª—É –∏–ª–∏ –∏–º—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —à—Ä–∏—Ñ—Ç–∞.

    Raises:
        ValueError: –ï—Å–ª–∏ —à—Ä–∏—Ñ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–ø–∏—Å–∫–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö.
        FileNotFoundError: –ï—Å–ª–∏ TTF —Ñ–∞–π–ª —à—Ä–∏—Ñ—Ç–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
    """
    logger.debug(f"üîç –ü–æ–∏—Å–∫ —à—Ä–∏—Ñ—Ç–∞: {font_name}")

    if font_name not in AVAILABLE_FONTS:
        logger.error(f"‚ùå –®—Ä–∏—Ñ—Ç '{font_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω")
        raise ValueError(
            f"–®—Ä–∏—Ñ—Ç '{font_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω. "
            f"–î–æ—Å—Ç—É–ø–Ω—ã–µ: {', '.join(AVAILABLE_FONTS.keys())}"
        )

    ttf_file = AVAILABLE_FONTS[font_name]

    if ttf_file is None:
        logger.debug(f"üì¶ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —à—Ä–∏—Ñ—Ç–∞: {font_name}")
        return font_name

    font_path = FONTS_DIR / ttf_file

    if not font_path.exists():
        logger.error(f"‚ùå –§–∞–π–ª —à—Ä–∏—Ñ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω: {font_path}")
        raise FileNotFoundError(
            f"–§–∞–π–ª —à—Ä–∏—Ñ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω: {font_path}\n"
            f"–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª '{ttf_file}' –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ asset/fonts/"
        )

    logger.info(f"üì¶ –ó–∞–≥—Ä—É–∂–µ–Ω —à—Ä–∏—Ñ—Ç: {font_path}")
    return str(font_path.absolute())


def list_available_fonts() -> list[str]:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤."""
    return list(AVAILABLE_FONTS.keys())


def load_custom_fonts() -> None:
    """
    –í—Ä–µ–º–µ–Ω–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —à—Ä–∏—Ñ—Ç—ã –∏–∑ asset/fonts –≤ GDI —Å–µ—Å—Å–∏–∏ Windows.
    –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —á—Ç–æ–±—ã –≤–Ω–µ—à–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, Java/PlantUML) –≤–∏–¥–µ–ª–∏
    —ç—Ç–∏ —à—Ä–∏—Ñ—Ç—ã –±–µ–∑ –∏—Ö —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –ø–∞–ø–∫—É C:/Windows/Fonts.
    """
    if platform.system() != "Windows":
        logger.debug("üêß –ü—Ä–æ–ø—É—Å–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —à—Ä–∏—Ñ—Ç–æ–≤ (–Ω–µ Windows)")
        return

    # –§–ª–∞–≥ FR_PRIVATE (0x10) –¥–µ–ª–∞–µ—Ç —à—Ä–∏—Ñ—Ç –≤–∏–¥–∏–º—ã–º –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏ –µ–≥–æ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤,
    # –∏ —É–¥–∞–ª—è–µ—Ç –µ–≥–æ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞. –≠—Ç–æ –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –ø–æ—Ä—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏.
    FR_PRIVATE = 0x10

    loaded_count = 0

    # –°–∫–∞–Ω–∏—Ä—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    if not FONTS_DIR.exists():
        logger.warning(f"‚ö†Ô∏è –ü–∞–ø–∫–∞ —à—Ä–∏—Ñ—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: {FONTS_DIR}")
        return

    for font_file in FONTS_DIR.glob("*.ttf"):
        try:
            # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –ø—É—Ç—å –≤ —Å—Ç—Ä–æ–∫—É
            path_str = str(font_file.absolute())

            # –í—ã–∑–æ–≤ Windows API AddFontResourceExW
            # gdi32.dll –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ª—é–±–æ–π Windows
            res = ctypes.windll.gdi32.AddFontResourceExW(path_str, FR_PRIVATE, 0)

            if res > 0:
                loaded_count += 1
                logger.debug(f"üíâ –®—Ä–∏—Ñ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: {font_file.name}")
            else:
                # –ï—Å–ª–∏ –≤–µ—Ä–Ω—É–ª 0, –≤–æ–∑–º–æ–∂–Ω–æ —à—Ä–∏—Ñ—Ç —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω –∏–ª–∏ –æ—à–∏–±–∫–∞ –ø—É—Ç–∏
                logger.debug(
                    f"‚ö†Ô∏è –®—Ä–∏—Ñ—Ç –Ω–µ –±—ã–ª –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω (–≤–æ–∑–º–æ–∂–Ω–æ —É–∂–µ –µ—Å—Ç—å): {font_file.name}"
                )

        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ GDI –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —à—Ä–∏—Ñ—Ç–∞ {font_file.name}: {e}")

    if loaded_count > 0:
        logger.info(f"üíâ –í—Ä–µ–º–µ–Ω–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ —à—Ä–∏—Ñ—Ç–æ–≤ –¥–ª—è —Å–µ—Å—Å–∏–∏: {loaded_count}")

```

## `src/guide_manager.py`

```py
"""–ú–µ–Ω–µ–¥–∂–µ—Ä –≥–∞–π–¥–æ–≤ –ø–æ PlantUML.

–ú–æ–¥—É–ª—å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —á—Ç–µ–Ω–∏–µ –∏ –ø–∞—Ä—Å–∏–Ω–≥ markdown-–≥–∞–π–¥–æ–≤ –¥–ª—è –ø–æ–º–æ—â–∏
AI-–∞–≥–µ–Ω—Ç–∞–º –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ PlantUML —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞.

–§—É–Ω–∫—Ü–∏–∏:
    get_guide(guide_type, full=False) -> str
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≥–∞–π–¥–∞ (brief –∏–ª–∏ full –≤–µ—Ä—Å–∏—é).
    list_guides() -> list[dict]
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥–∞–π–¥–æ–≤ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏.
    list_themes() -> list[dict]
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è.
"""

import json
import logging
import re
from pathlib import Path

logger = logging.getLogger(__name__)

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø—É—Ç–µ–π
GUIDES_DIR = Path(__file__).parent.parent / "doc" / "plantuml_guides"
THEMES_DIR = Path(__file__).parent.parent / "asset" / "themes"
INDEX_FILE = GUIDES_DIR / "index.json"

# –ú–∞—Ä–∫–µ—Ä—ã –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ brief/detailed —Å–µ–∫—Ü–∏–π
BRIEF_START = "<!-- BRIEF_START -->"
BRIEF_END = "<!-- BRIEF_END -->"
DETAILED_START = "<!-- DETAILED_START -->"
DETAILED_END = "<!-- DETAILED_END -->"


def _load_index() -> dict:
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–Ω–¥–µ–∫—Å –≥–∞–π–¥–æ–≤ –∏–∑ index.json."""
    if not INDEX_FILE.exists():
        logger.warning(f"‚ö†Ô∏è –ò–Ω–¥–µ–∫—Å–Ω—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {INDEX_FILE}")
        return {"guides": []}

    try:
        with open(INDEX_FILE, "r", encoding="utf-8") as f:
            return json.load(f)
    except json.JSONDecodeError as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ index.json: {e}")
        return {"guides": []}


def _extract_brief(content: str) -> str:
    """–ò–∑–≤–ª–µ–∫–∞–µ—Ç brief-—Å–µ–∫—Ü–∏—é –∏–∑ markdown-–∫–æ–Ω—Ç–µ–Ω—Ç–∞.

    Args:
        content: –ü–æ–ª–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ markdown-—Ñ–∞–π–ª–∞.

    Returns:
        –¢–µ–∫—Å—Ç –º–µ–∂–¥—É –º–∞—Ä–∫–µ—Ä–∞–º–∏ BRIEF_START –∏ BRIEF_END,
        –∏–ª–∏ –ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤ –µ—Å–ª–∏ –º–∞—Ä–∫–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.
    """
    match = re.search(
        rf"{re.escape(BRIEF_START)}(.*?){re.escape(BRIEF_END)}",
        content,
        re.DOTALL,
    )

    if match:
        return match.group(1).strip()

    logger.debug("üîç –ú–∞—Ä–∫–µ—Ä—ã BRIEF –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞")
    return content[:500] + "..." if len(content) > 500 else content


def _extract_detailed(content: str) -> str:
    """–ò–∑–≤–ª–µ–∫–∞–µ—Ç detailed-—Å–µ–∫—Ü–∏—é –∏–∑ markdown-–∫–æ–Ω—Ç–µ–Ω—Ç–∞.

    Args:
        content: –ü–æ–ª–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ markdown-—Ñ–∞–π–ª–∞.

    Returns:
        –¢–µ–∫—Å—Ç –º–µ–∂–¥—É –º–∞—Ä–∫–µ—Ä–∞–º–∏ DETAILED_START –∏ DETAILED_END,
        –∏–ª–∏ –≤–µ—Å—å —Ñ–∞–π–ª –µ—Å–ª–∏ –º–∞—Ä–∫–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.
    """
    match = re.search(
        rf"{re.escape(DETAILED_START)}(.*?){re.escape(DETAILED_END)}",
        content,
        re.DOTALL,
    )

    if match:
        return match.group(1).strip()

    logger.debug("üîç –ú–∞—Ä–∫–µ—Ä—ã DETAILED –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≤–µ—Å—å —Ñ–∞–π–ª")
    return content


def get_guide(guide_type: str, full: bool = False) -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≥–∞–π–¥–∞ –ø–æ —Ç–∏–ø—É –¥–∏–∞–≥—Ä–∞–º–º—ã.

    Args:
        guide_type: –¢–∏–ø –≥–∞–π–¥–∞ (class, sequence, component, activity, themes).
        full: –ï—Å–ª–∏ True ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é, –∏–Ω–∞—á–µ ‚Äî –∫—Ä–∞—Ç–∫—É—é.

    Returns:
        –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≥–∞–π–¥–∞ –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≥–∞–π–¥–∞–º–∏.
    """
    logger.info(f"üìö –ó–∞–ø—Ä–æ—Å –≥–∞–π–¥–∞: type={guide_type}, full={full}")

    index = _load_index()
    guides = index.get("guides", [])

    guide_info = None
    for g in guides:
        if g.get("type") == guide_type:
            guide_info = g
            break

    if not guide_info:
        available = [g.get("type") for g in guides]
        logger.warning(f"‚ö†Ô∏è –ì–∞–π–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω: {guide_type}")
        return (
            f"–ì–∞–π–¥ '{guide_type}' –Ω–µ –Ω–∞–π–¥–µ–Ω.\n\n"
            f"–î–æ—Å—Ç—É–ø–Ω—ã–µ –≥–∞–π–¥—ã: {', '.join(available)}\n\n"
            f"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ list_guides() –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞."
        )

    guide_file = GUIDES_DIR / guide_info.get("file", f"{guide_type}_diagram.md")

    if not guide_file.exists():
        logger.error(f"‚ùå –§–∞–π–ª –≥–∞–π–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω: {guide_file}")
        return f"–§–∞–π–ª –≥–∞–π–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω: {guide_file}"

    try:
        with open(guide_file, "r", encoding="utf-8") as f:
            content = f.read()
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –≥–∞–π–¥–∞: {e}")
        return f"–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –≥–∞–π–¥–∞: {e}"

    if full:
        brief = _extract_brief(content)
        detailed = _extract_detailed(content)
        logger.debug(
            f"üìñ –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª–Ω—ã–π –≥–∞–π–¥: {len(brief) + len(detailed)} —Å–∏–º–≤–æ–ª–æ–≤"
        )
        return f"{brief}\n\n{detailed}"
    else:
        brief = _extract_brief(content)
        logger.debug(f"üìñ –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫—Ä–∞—Ç–∫–∏–π –≥–∞–π–¥: {len(brief)} —Å–∏–º–≤–æ–ª–æ–≤")
        return brief


def list_guides() -> list[dict]:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥–∞–π–¥–æ–≤ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏.

    Returns:
        –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≥–∞–π–¥–∞—Ö:
        [{"type": "class", "title": "...", "description": "..."}]
    """
    logger.info("üìö –ó–∞–ø—Ä–æ—Å —Å–ø–∏—Å–∫–∞ –≥–∞–π–¥–æ–≤")

    index = _load_index()
    guides = index.get("guides", [])

    result = []
    for g in guides:
        result.append(
            {
                "type": g.get("type"),
                "title": g.get("title"),
                "description": g.get("description"),
            }
        )

    logger.debug(f"üìã –ù–∞–π–¥–µ–Ω–æ –≥–∞–π–¥–æ–≤: {len(result)}")
    return result


def list_themes() -> list[dict]:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è.

    –°–∫–∞–Ω–∏—Ä—É–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é asset/themes/ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    –æ –∫–∞–∂–¥–æ–π —Ç–µ–º–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤ —Ñ–∞–π–ª–µ.

    Returns:
        –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–µ–º–∞—Ö:
        [{"name": "dark_gold", "description": "..."}]
    """
    logger.info("üé® –ó–∞–ø—Ä–æ—Å —Å–ø–∏—Å–∫–∞ —Ç–µ–º")

    if not THEMES_DIR.exists():
        logger.warning(f"‚ö†Ô∏è –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Ç–µ–º –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: {THEMES_DIR}")
        return []

    themes = []
    theme_descriptions = {
        "default": "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ –≤ —Å—Ç–∏–ª–µ VS Code. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è.",
        "dark_gold": "–°—Ç—Ä–æ–≥–∞—è —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ —Å –∑–æ–ª–æ—Ç—ã–º –∞–∫—Ü–µ–Ω—Ç–æ–º –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π.",
        "light_fresh": "–ú—è–≥–∫–∞—è —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ —Å –º—è—Ç–Ω—ã–º–∏ —Ç–æ–Ω–∞–º–∏ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.",
    }

    for theme_file in sorted(THEMES_DIR.glob("*.puml")):
        name = theme_file.stem

        description = theme_descriptions.get(name)
        if not description:
            try:
                with open(theme_file, "r", encoding="utf-8") as f:
                    first_lines = f.read(500)
                    match = re.search(r"'\s*===\s*THEME:\s*(.+?)\s*===", first_lines)
                    if match:
                        description = match.group(1).strip()
                    else:
                        match = re.search(r"'\s*(.+)", first_lines)
                        if match:
                            description = match.group(1).strip()
                        else:
                            description = f"–¢–µ–º–∞ {name}"
            except Exception:
                description = f"–¢–µ–º–∞ {name}"

        themes.append({"name": name, "description": description})

    logger.debug(f"üé® –ù–∞–π–¥–µ–Ω–æ —Ç–µ–º: {len(themes)}")
    return themes


if __name__ == "__main__":
    logging.basicConfig(level=logging.DEBUG)

    print("=== Guide Manager Test ===\n")

    print("1. –°–ø–∏—Å–æ–∫ –≥–∞–π–¥–æ–≤:")
    for guide in list_guides():
        print(f"   - {guide['type']}: {guide['title']}")

    print("\n2. –°–ø–∏—Å–æ–∫ —Ç–µ–º:")
    for theme in list_themes():
        print(f"   - {theme['name']}: {theme['description']}")

    print("\n3. –ö—Ä–∞—Ç–∫–∏–π –≥–∞–π–¥ –ø–æ component:")
    print(get_guide("component", full=False)[:300] + "...")

    print("\n4. –ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –≥–∞–π–¥:")
    print(get_guide("unknown"))

```

## `src/image_utils.py`

```py
"""–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

–ú–æ–¥—É–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é —Ñ–æ—Ä–º–∞—Ç–æ–≤, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ.

–ü—Ä–∏–Ω—Ü–∏–ø: –º–æ–¥—É–ª—å –Ω–µ –∑–Ω–∞–µ—Ç –æ–± –∏—Å—Ç–æ—á–Ω–∏–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–∫–æ–¥/–¥–∏–∞–≥—Ä–∞–º–º–∞),
–æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –ø–∏–∫—Å–µ–ª—è–º–∏ (Pillow Image –æ–±—ä–µ–∫—Ç–∞–º–∏).

–§—É–Ω–∫—Ü–∏–∏:
    save_image(image, output_path, format, quality) -> dict
        –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π.
    resize_image(image, scale_factor) -> Image
        –£–º–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–æ–º Lanczos.
    convert_to_webp(image, quality) -> bytes
        –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ WebP —Å —Å–∂–∞—Ç–∏–µ–º.
"""

import logging
from pathlib import Path
from typing import Literal
from io import BytesIO

from PIL import Image

logger = logging.getLogger(__name__)

# –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
ImageFormat = Literal["webp", "png", "jpeg", "jpg"]

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∂–∞—Ç–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
DEFAULT_QUALITY = {
    "webp": 90,  # –ë–∞–ª–∞–Ω—Å –∫–∞—á–µ—Å—Ç–≤–æ/—Ä–∞–∑–º–µ—Ä –¥–ª—è WebP
    "jpeg": 92,  # –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è JPEG
    "jpg": 92,
    "png": None,  # PNG –±–µ–∑ –ø–æ—Ç–µ—Ä—å, –Ω–æ —Å optimize=True
}


class ImageProcessingError(Exception):
    """–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è."""

    pass


def save_image(
    image: Image.Image,
    output_path: str | Path,
    format: ImageFormat = "webp",
    quality: int | None = None,
) -> dict:
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π.

    Args:
        image: –û–±—ä–µ–∫—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è Pillow.
        output_path: –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞.
        format: –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ (webp, png, jpeg).
        quality: –ö–∞—á–µ—Å—Ç–≤–æ —Å–∂–∞—Ç–∏—è (1-100). –ï—Å–ª–∏ None, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è DEFAULT_QUALITY.

    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:
            {
                "success": bool,
                "path": str,
                "format": str,
                "size_bytes": int,
                "dimensions": tuple[int, int]
            }

    Raises:
        ImageProcessingError: –ï—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å.
    """
    output_path = Path(output_path)
    format_lower = format.lower()

    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ
    if quality is None:
        quality = DEFAULT_QUALITY.get(format_lower)

    # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    output_path.parent.mkdir(parents=True, exist_ok=True)

    logger.debug(
        f"üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {output_path.name} (—Ñ–æ—Ä–º–∞—Ç={format_lower})"
    )

    try:
        # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ñ–æ—Ä–º–∞—Ç–∞
        save_kwargs = {}

        if format_lower == "webp":
            # WebP —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –∏ –º–µ—Ç–æ–¥–æ–º 6 (–ª—É—á—à–µ–µ —Å–∂–∞—Ç–∏–µ)
            save_kwargs = {
                "format": "WEBP",
                "quality": quality,
                "method": 6,  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Å–∂–∞—Ç–∏—è (–º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ –ª—É—á—à–µ)
            }
            logger.debug(f"üé® WebP –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: quality={quality}, method=6")

        elif format_lower == "png":
            # PNG –±–µ–∑ –ø–æ—Ç–µ—Ä—å, –Ω–æ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
            save_kwargs = {
                "format": "PNG",
                "optimize": True,  # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–∞—á–µ—Å—Ç–≤–∞
                "compress_level": 6,  # –£—Ä–æ–≤–µ–Ω—å —Å–∂–∞—Ç–∏—è zlib (0-9)
            }
            logger.debug(f"üé® PNG –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: optimize=True, compress_level=6")

        elif format_lower in ("jpeg", "jpg"):
            # JPEG —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π –≤ RGB –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            if image.mode in ("RGBA", "LA", "P"):
                # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ RGB –¥–ª—è JPEG (–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å)
                rgb_image = Image.new("RGB", image.size, (255, 255, 255))
                if image.mode == "P":
                    image = image.convert("RGBA")
                rgb_image.paste(
                    image, mask=image.split()[-1] if image.mode == "RGBA" else None
                )
                image = rgb_image
                logger.debug("üîÑ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è RGBA -> RGB –¥–ª—è JPEG")

            save_kwargs = {
                "format": "JPEG",
                "quality": quality,
                "optimize": True,
                "progressive": True,  # –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
            }
            logger.debug(f"üé® JPEG –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: quality={quality}, progressive=True")

        else:
            raise ImageProcessingError(
                f"–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç: {format_lower}. "
                f"–î–æ—Å—Ç—É–ø–Ω—ã–µ: {', '.join(DEFAULT_QUALITY.keys())}"
            )

        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        image.save(output_path, **save_kwargs)

        # –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
        file_size = output_path.stat().st_size
        size_kb = file_size / 1024

        logger.info(
            f"üíæ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: {output_path.name} "
            f"({image.width}x{image.height}, {size_kb:.2f} KB)"
        )

        return {
            "success": True,
            "path": str(output_path.absolute()),
            "format": format_lower,
            "size_bytes": file_size,
            "dimensions": (image.width, image.height),
        }

    except Exception as e:
        error_msg = f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {e}"
        logger.error(f"‚ùå {error_msg}")
        raise ImageProcessingError(error_msg) from e


def resize_image(
    image: Image.Image,
    scale_factor: float = 1.0,
) -> Image.Image:
    """–£–º–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–æ–º.

    Args:
        image: –û–±—ä–µ–∫—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è Pillow.
        scale_factor: –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è (1.0 = –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä).

    Returns:
        –ù–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º.

    Raises:
        ImageProcessingError: –ï—Å–ª–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å.
    """
    if scale_factor <= 0:
        raise ImageProcessingError(f"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π scale_factor: {scale_factor}")

    if scale_factor == 1.0:
        logger.debug("‚è≠Ô∏è  –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (scale_factor=1.0)")
        return image

    try:
        original_size = image.size
        new_width = int(image.width * scale_factor)
        new_height = int(image.height * scale_factor)

        logger.debug(
            f"üñºÔ∏è  –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ: {original_size[0]}x{original_size[1]} -> "
            f"{new_width}x{new_height} (√ó{scale_factor})"
        )

        # –ò—Å–ø–æ–ª—å–∑—É–µ–º Lanczos –¥–ª—è –Ω–∞–∏–ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–∏ —Ä–µ—Å–∞–π–∑–µ
        resized = image.resize(
            (new_width, new_height),
            resample=Image.Resampling.LANCZOS,
        )

        logger.info(f"‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–æ: {new_width}x{new_height}")

        return resized

    except Exception as e:
        error_msg = f"–û—à–∏–±–∫–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {e}"
        logger.error(f"‚ùå {error_msg}")
        raise ImageProcessingError(error_msg) from e


def convert_to_webp(
    image: Image.Image,
    quality: int = 90,
) -> bytes:
    """–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ WebP —Ñ–æ—Ä–º–∞—Ç —Å —Å–∂–∞—Ç–∏–µ–º.

    Args:
        image: –û–±—ä–µ–∫—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è Pillow.
        quality: –ö–∞—á–µ—Å—Ç–≤–æ —Å–∂–∞—Ç–∏—è (1-100).

    Returns:
        –ë–∞–π—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ WebP.

    Raises:
        ImageProcessingError: –ï—Å–ª–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å.
    """
    try:
        logger.debug(f"üîÑ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ WebP (quality={quality})")

        buffer = BytesIO()
        image.save(
            buffer,
            format="WEBP",
            quality=quality,
            method=6,  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Å–∂–∞—Ç–∏—è
        )

        webp_bytes = buffer.getvalue()
        size_kb = len(webp_bytes) / 1024

        logger.info(f"‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ WebP –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ({size_kb:.2f} KB)")

        return webp_bytes

    except Exception as e:
        error_msg = f"–û—à–∏–±–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ WebP: {e}"
        logger.error(f"‚ùå {error_msg}")
        raise ImageProcessingError(error_msg) from e


def load_image_from_bytes(
    image_bytes: bytes,
    source_format: str | None = None,
) -> Image.Image:
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ –±–∞–π—Ç–æ–≤.

    Args:
        image_bytes: –ë–∞–π—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
        source_format: –§–æ—Ä–º–∞—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è).

    Returns:
        –û–±—ä–µ–∫—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è Pillow.

    Raises:
        ImageProcessingError: –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å.
    """
    try:
        logger.debug(
            f"üìÇ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –±–∞–π—Ç–æ–≤ "
            f"({len(image_bytes)} bytes{f', format={source_format}' if source_format else ''})"
        )

        buffer = BytesIO(image_bytes)
        image = Image.open(buffer)

        logger.debug(
            f"‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: {image.width}x{image.height}, mode={image.mode}"
        )

        return image

    except Exception as e:
        error_msg = f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –±–∞–π—Ç–æ–≤: {e}"
        logger.error(f"‚ùå {error_msg}")
        raise ImageProcessingError(error_msg) from e

```

## `tests/__init__.py`

```py
"""–ü–∞–∫–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è code_to_image_mcp."""

```

## `tests/assets/sample_code.py`

```py
"""
–¢–µ—Å—Ç–æ–≤—ã–π Python –º–æ–¥—É–ª—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–¥–∞.

–°–æ–¥–µ—Ä–∂–∏—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã —Å—É—â–Ω–æ—Å—Ç–µ–π –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è AST —ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä–∞.
"""

from typing import List, Optional
from dataclasses import dataclass


# –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è
def calculate_sum(a: int, b: int) -> int:
    """–í—ã—á–∏—Å–ª—è–µ—Ç —Å—É–º–º—É –¥–≤—É—Ö —á–∏—Å–µ–ª."""
    return a + b


# –î–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
def deprecated(func):
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π."""

    def wrapper(*args, **kwargs):
        print(f"Warning: {func.__name__} is deprecated!")
        return func(*args, **kwargs)

    return wrapper


@deprecated
def old_function(x: str) -> str:
    """–£—Å—Ç–∞—Ä–µ–≤—à–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞."""
    return x.upper()


# Async —Ñ—É–Ω–∫—Ü–∏—è
async def fetch_data(url: str) -> dict:
    """–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö."""
    # –ò–º–∏—Ç–∞—Ü–∏—è async –æ–ø–µ—Ä–∞—Ü–∏–∏
    return {"url": url, "status": "ok"}


# Dataclass
@dataclass
class User:
    """–ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""

    id: int
    name: str
    email: str
    is_active: bool = True

    def activate(self) -> None:
        """–ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
        self.is_active = True

    def deactivate(self) -> None:
        """–î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
        self.is_active = False


# –û–±—ã—á–Ω—ã–π –∫–ª–∞—Å—Å —Å –º–µ—Ç–æ–¥–∞–º–∏
class OrderService:
    """–°–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–æ–≤."""

    def __init__(self, db_connection):
        self.db = db_connection
        self.orders = []

    def create_order(self, user_id: int, items: List[dict]) -> dict:
        """
        –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑.

        Args:
            user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            items: –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤

        Returns:
            –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–∑–¥–∞–Ω–Ω–æ–º –∑–∞–∫–∞–∑–µ
        """
        order = {
            "id": len(self.orders) + 1,
            "user_id": user_id,
            "items": items,
            "status": "pending",
        }
        self.orders.append(order)
        return order

    @staticmethod
    def calculate_total(items: List[dict]) -> float:
        """–í—ã—á–∏—Å–ª—è–µ—Ç –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å."""
        return sum(item.get("price", 0) * item.get("quantity", 1) for item in items)

    @classmethod
    def from_config(cls, config: dict):
        """–°–æ–∑–¥–∞—ë—Ç —Å–µ—Ä–≤–∏—Å –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏."""
        return cls(config.get("db_connection"))


# –í–ª–æ–∂–µ–Ω–Ω—ã–π –∫–ª–∞—Å—Å
class PaymentProcessor:
    """–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –ø–ª–∞—Ç–µ–∂–µ–π."""

    class PaymentError(Exception):
        """–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞."""

        pass

    def __init__(self, gateway: str):
        self.gateway = gateway

    async def process_payment(self, amount: float, card_token: str) -> bool:
        """–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞."""
        if amount <= 0:
            raise self.PaymentError("Invalid amount")
        return True

```

## `tests/conftest.py`

```py
"""–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest."""

import pytest
from pathlib import Path


@pytest.fixture
def output_dir():
    """–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–æ–≤."""
    output = Path(__file__).parent / "output"
    output.mkdir(exist_ok=True)
    return output


@pytest.fixture
def test_plantuml_code():
    """–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–¥ PlantUML."""
    return """
@startuml
Alice -> Bob: Authentication Request
Bob --> Alice: Authentication Response
@enduml
"""


@pytest.fixture
def test_plantuml_code_cyrillic():
    """–¢–µ—Å—Ç–æ–≤—ã–π –∫–æ–¥ PlantUML —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π."""
    return """
@startuml
participant "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" as User
participant "–°–µ—Ä–≤–µ—Ä" as Server
participant "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö" as DB

User -> Server: –ó–∞–ø—Ä–æ—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
activate Server

Server -> DB: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—á—ë—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
activate DB
DB --> Server: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
deactivate DB

Server --> User: –¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞
deactivate Server
@enduml
"""

```

## `tests/output/theme_visual_check/VISUAL_CHECK_REPORT.md`

```md
# –û—Ç—á—ë—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–º PlantUML

## –¶–µ–ª—å –ø—Ä–æ–≤–µ—Ä–∫–∏
–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã PlantUML (title, legend, notes, database, queue, etc) 
–∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –≤—Å–µ—Ö —Ç–µ–º–∞—Ö.

## –ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- ‚úÖ Title (–∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–∏–∞–≥—Ä–∞–º–º—ã)
- ‚úÖ Legend (–ª–µ–≥–µ–Ω–¥–∞)
- ‚úÖ Notes (–∑–∞–º–µ—Ç–∫–∏/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)
- ‚úÖ Database (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- ‚úÖ Queue (–æ—á–µ—Ä–µ–¥—å)
- ‚úÖ Collections (–∫–æ–ª–ª–µ–∫—Ü–∏–∏)
- ‚úÖ Entity (—Å—É—â–Ω–æ—Å—Ç—å)
- ‚úÖ Actor (–∞–∫—Ç–æ—Ä)
- ‚úÖ Boundary (–≥—Ä–∞–Ω–∏—Ü–∞)
- ‚úÖ Control (–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä)
- ‚úÖ Partition (—Ä–∞–∑–¥–µ–ª –≤ activity)
- ‚úÖ –°—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã (<<Adapter>>, <<Core>>, <<Infrastructure>>)

## –ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ —Ç–µ–º—ã
1. **default** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ç–µ–º–∞
2. **dark_gold** ‚Äî —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ —Å –∑–æ–ª–æ—Ç—ã–º–∏ –∞–∫—Ü–µ–Ω—Ç–∞–º–∏
3. **light_fresh** ‚Äî —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ —Å –∑–µ–ª—ë–Ω—ã–º–∏ –∞–∫—Ü–µ–Ω—Ç–∞–º–∏

## –¢–∏–ø—ã –¥–∏–∞–≥—Ä–∞–º–º
1. Component Diagram
2. Sequence Diagram
3. Class Diagram
4. Activity Diagram

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–ø–∫—É `tests/output/theme_visual_check/`
2. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤—Å–µ PNG —Ñ–∞–π–ª—ã
3. **–ö—Ä–∏—Ç–µ—Ä–∏–π –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è**: –≤–µ—Å—å —Ç–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Ç–∞–µ–º—ã–º, –Ω–µ—Ç —á—ë—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —Ç—ë–º–Ω–æ–º —Ñ–æ–Ω–µ
4. –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã ‚Äî –∑–∞–ø–∏—à–∏—Ç–µ –∏—Ö –Ω–∏–∂–µ

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### default —Ç–µ–º–∞
- [ ] component_default.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___
- [ ] sequence_default.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___
- [ ] class_default.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___
- [ ] activity_default.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___

### dark_gold —Ç–µ–º–∞
- [ ] component_dark_gold.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___
- [ ] sequence_dark_gold.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___
- [ ] class_dark_gold.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___
- [ ] activity_dark_gold.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___

### light_fresh —Ç–µ–º–∞
- [ ] component_light_fresh.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___
- [ ] sequence_light_fresh.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___
- [ ] class_light_fresh.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___
- [ ] activity_light_fresh.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___

---

## –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
(–ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏)

1. 
2. 
3. 


```

## `tests/test_code_extractor.py`

```py
"""
–¢–µ—Å—Ç—ã –¥–ª—è –º–æ–¥—É–ª—è code_extractor.py
"""

import pytest
from pathlib import Path
from src.code_extractor import (
    extract_code_entity,
    list_entities,
    EntityNotFoundError,
)


# –§–∏–∫—Å—Ç—É—Ä–∞ —Å —Ç–µ—Å—Ç–æ–≤—ã–º Python —Ñ–∞–π–ª–æ–º
@pytest.fixture
def sample_python_file(tmp_path):
    """–°–æ–∑–¥–∞—ë—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π Python —Ñ–∞–π–ª —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –∏ –∫–ª–∞—Å—Å–∞–º–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è."""
    file_path = tmp_path / "test_module.py"
    content = '''"""Test module for code extraction."""


def simple_function():
    """Simple function without decorators."""
    return "Hello"


@pytest.fixture
def decorated_function():
    """Function with decorator."""
    return "World"


async def async_function():
    """Async function."""
    await something()
    return "Async"


class SimpleClass:
    """Simple class with methods."""

    def __init__(self):
        self.value = 0

    def method_one(self):
        """First method."""
        return self.value + 1

    @property
    def decorated_method(self):
        """Method with decorator."""
        return self.value * 2


class AnotherClass:
    """Another class."""

    async def async_method(self):
        """Async method in class."""
        await something()
        return "Done"
'''
    file_path.write_text(content, encoding="utf-8")
    return str(file_path)


class TestExtractCodeEntity:
    """–¢–µ—Å—Ç—ã –¥–ª—è extract_code_entity()."""

    def test_extract_simple_function(self, sample_python_file):
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏."""
        code = extract_code_entity(sample_python_file, "simple_function")

        assert "def simple_function():" in code
        assert 'return "Hello"' in code
        assert "Simple function without decorators" in code

    def test_extract_decorated_function(self, sample_python_file):
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º."""
        code = extract_code_entity(sample_python_file, "decorated_function")

        assert "@pytest.fixture" in code
        assert "def decorated_function():" in code
        assert 'return "World"' in code

    def test_extract_decorated_function_without_decorators(self, sample_python_file):
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤."""
        code = extract_code_entity(
            sample_python_file, "decorated_function", include_decorators=False
        )

        assert "@pytest.fixture" not in code
        assert "def decorated_function():" in code
        assert 'return "World"' in code

    def test_extract_async_function(self, sample_python_file):
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏."""
        code = extract_code_entity(sample_python_file, "async_function")

        assert "async def async_function():" in code
        assert "await something()" in code
        assert 'return "Async"' in code

    def test_extract_class(self, sample_python_file):
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ —Ü–µ–ª–∏–∫–æ–º."""
        code = extract_code_entity(sample_python_file, "SimpleClass")

        assert "class SimpleClass:" in code
        assert "def __init__(self):" in code
        assert "def method_one(self):" in code
        assert "@property" in code
        assert "def decorated_method(self):" in code

    def test_extract_class_method(self, sample_python_file):
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ –∫–ª–∞—Å—Å–∞."""
        code = extract_code_entity(sample_python_file, "SimpleClass.method_one")

        assert "def method_one(self):" in code
        assert "return self.value + 1" in code
        # –ö–ª–∞—Å—Å —Ü–µ–ª–∏–∫–æ–º –ù–ï –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –≤—ã–≤–æ–¥–µ
        assert "def __init__(self):" not in code

    def test_extract_decorated_method(self, sample_python_file):
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ —Å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º."""
        code = extract_code_entity(sample_python_file, "SimpleClass.decorated_method")

        assert "@property" in code
        assert "def decorated_method(self):" in code
        assert "return self.value * 2" in code

    def test_extract_decorated_method_without_decorators(self, sample_python_file):
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ –±–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞."""
        code = extract_code_entity(
            sample_python_file, "SimpleClass.decorated_method", include_decorators=False
        )

        assert "@property" not in code
        assert "def decorated_method(self):" in code

    def test_extract_async_class_method(self, sample_python_file):
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ –∫–ª–∞—Å—Å–∞."""
        code = extract_code_entity(sample_python_file, "AnotherClass.async_method")

        assert "async def async_method(self):" in code
        assert "await something()" in code
        assert 'return "Done"' in code

    def test_function_not_found(self, sample_python_file):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏: —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞."""
        with pytest.raises(EntityNotFoundError) as exc_info:
            extract_code_entity(sample_python_file, "nonexistent_function")

        error_message = str(exc_info.value)
        assert "nonexistent_function" in error_message
        assert "–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏" in error_message
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –µ—Å—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
        assert "simple_function" in error_message

    def test_class_not_found(self, sample_python_file):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏: –∫–ª–∞—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω."""
        with pytest.raises(EntityNotFoundError) as exc_info:
            extract_code_entity(sample_python_file, "NonexistentClass.method")

        error_message = str(exc_info.value)
        assert "NonexistentClass" in error_message
        assert "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª–∞—Å—Å—ã" in error_message
        assert "SimpleClass" in error_message

    def test_method_not_found(self, sample_python_file):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏: –º–µ—Ç–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –∫–ª–∞—Å—Å–µ."""
        with pytest.raises(EntityNotFoundError) as exc_info:
            extract_code_entity(sample_python_file, "SimpleClass.nonexistent_method")

        error_message = str(exc_info.value)
        assert "nonexistent_method" in error_message
        assert "SimpleClass" in error_message
        assert "–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã" in error_message
        assert "method_one" in error_message

    def test_file_not_found(self):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏: —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç."""
        with pytest.raises(FileNotFoundError):
            extract_code_entity("/nonexistent/path/file.py", "some_function")

    def test_syntax_error_in_file(self, tmp_path):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏ –≤ —Ñ–∞–π–ª–µ."""
        invalid_file = tmp_path / "invalid.py"
        invalid_file.write_text(
            "def broken(\n    # Missing closing parenthesis", encoding="utf-8"
        )

        with pytest.raises(SyntaxError):
            extract_code_entity(str(invalid_file), "broken")


class TestListEntities:
    """–¢–µ—Å—Ç—ã –¥–ª—è list_entities()."""

    def test_list_all_entities(self, sample_python_file):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –≤ —Ñ–∞–π–ª–µ."""
        entities = list_entities(sample_python_file)

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π
        assert "simple_function" in entities["functions"]
        assert "decorated_function" in entities["functions"]
        assert "async_function" in entities["functions"]
        assert len(entities["functions"]) == 3

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∞—Å—Å–æ–≤
        assert "SimpleClass" in entities["classes"]
        assert "AnotherClass" in entities["classes"]
        assert len(entities["classes"]) == 2

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç–æ–¥–æ–≤
        assert "method_one" in entities["methods"]["SimpleClass"]
        assert "decorated_method" in entities["methods"]["SimpleClass"]
        assert (
            len(entities["methods"]["SimpleClass"]) == 3
        )  # __init__, method_one, decorated_method

        assert "async_method" in entities["methods"]["AnotherClass"]
        assert len(entities["methods"]["AnotherClass"]) == 1

    def test_empty_file(self, tmp_path):
        """–°–ø–∏—Å–æ–∫ —Å—É—â–Ω–æ—Å—Ç–µ–π –≤ –ø—É—Å—Ç–æ–º —Ñ–∞–π–ª–µ."""
        empty_file = tmp_path / "empty.py"
        empty_file.write_text("# Empty file\n", encoding="utf-8")

        entities = list_entities(str(empty_file))

        assert entities["functions"] == []
        assert entities["classes"] == []
        assert entities["methods"] == {}

    def test_file_not_found_list(self):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏: —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ –ª–∏—Å—Ç–∏–Ω–≥–µ."""
        with pytest.raises(FileNotFoundError):
            list_entities("/nonexistent/file.py")


class TestIntegration:
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã."""

    def test_extract_and_verify_code_executable(self, sample_python_file):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–π –∫–æ–¥ —è–≤–ª—è–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º Python."""
        code = extract_code_entity(sample_python_file, "simple_function")

        # –ü—ã—Ç–∞–µ–º—Å—è —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–π –∫–æ–¥
        try:
            compile(code, "<extracted>", "exec")
        except SyntaxError:
            pytest.fail("–ò–∑–≤–ª–µ—á—ë–Ω–Ω—ã–π –∫–æ–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏")

    def test_extract_multiple_entities(self, sample_python_file):
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –∏–∑ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞."""
        func_code = extract_code_entity(sample_python_file, "simple_function")
        class_code = extract_code_entity(sample_python_file, "SimpleClass")
        method_code = extract_code_entity(sample_python_file, "SimpleClass.method_one")

        assert "def simple_function()" in func_code
        assert "class SimpleClass:" in class_code
        assert "def method_one(self):" in method_code

        # –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ –∫—É—Å–∫–∏ –∫–æ–¥–∞
        assert func_code != class_code
        assert class_code != method_code

```

## `tests/test_diagram_renderer.py`

```py
"""–¢–µ—Å—Ç—ã –¥–ª—è diagram_renderer –º–æ–¥—É–ª—è."""

import pytest
from pathlib import Path
import sys

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ –≤ –ø—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
sys.path.insert(0, str(Path(__file__).parent.parent))

from src.diagram_renderer import (
    render_diagram_from_string,
    render_diagram_to_image,
    ensure_java_environment,
    JavaNotFoundError,
    PlantUMLRenderError,
    PlantUMLSyntaxError,
)
from PIL import Image
from src.image_utils import save_image, convert_to_webp


class TestJavaEnvironment:
    """–¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ Java –æ–∫—Ä—É–∂–µ–Ω–∏—è."""

    def test_java_is_available(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è Java –≤ —Å–∏—Å—Ç–µ–º–µ."""
        version = ensure_java_environment()
        assert version is not None
        assert len(version) > 0
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–µ—Ä—Å–∏—è Java
        assert "java" in version.lower() or "openjdk" in version.lower()

    def test_java_version_format(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –≤–µ—Ä—Å–∏–∏ Java."""
        version = ensure_java_environment()
        # –í–µ—Ä—Å–∏—è –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ü–∏—Ñ—Ä—ã
        assert any(char.isdigit() for char in version)


class TestBasicRendering:
    """–ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –¥–∏–∞–≥—Ä–∞–º–º."""

    def test_render_simple_sequence_diagram_png(self, output_dir, test_plantuml_code):
        """–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø—Ä–æ—Å—Ç–æ–π sequence –¥–∏–∞–≥—Ä–∞–º–º—ã –≤ PNG."""
        output_file = output_dir / "test_simple_sequence.png"

        result = render_diagram_from_string(
            diagram_code=test_plantuml_code,
            output_path=str(output_file),
            format="png",
            theme_name="default",
        )

        assert result["success"] is True
        assert output_file.exists()
        assert result["format"] == "png"
        assert result["file_size_kb"] > 0
        assert "java_version" in result
        assert result["theme_used"] == "default"

    def test_render_simple_sequence_diagram_svg(self, output_dir, test_plantuml_code):
        """–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø—Ä–æ—Å—Ç–æ–π sequence –¥–∏–∞–≥—Ä–∞–º–º—ã –≤ SVG."""
        output_file = output_dir / "test_simple_sequence.svg"

        result = render_diagram_from_string(
            diagram_code=test_plantuml_code,
            output_path=str(output_file),
            format="svg",
            theme_name="default",
        )

        assert result["success"] is True
        assert output_file.exists()
        assert result["format"] == "svg"
        assert result["file_size_kb"] > 0

    def test_render_without_theme(self, output_dir, test_plantuml_code):
        """–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –±–µ–∑ —Ç–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è."""
        output_file = output_dir / "test_no_theme.png"

        result = render_diagram_from_string(
            diagram_code=test_plantuml_code,
            output_path=str(output_file),
            format="png",
            theme_name=None,
        )

        assert result["success"] is True
        assert output_file.exists()
        assert result["theme_used"] is None


class TestCyrillicSupport:
    """–¢–µ—Å—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã."""

    def test_render_cyrillic_sequence_diagram(
        self, output_dir, test_plantuml_code_cyrillic
    ):
        """–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¥–∏–∞–≥—Ä–∞–º–º—ã —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π."""
        output_file = output_dir / "test_cyrillic_sequence.png"

        result = render_diagram_from_string(
            diagram_code=test_plantuml_code_cyrillic,
            output_path=str(output_file),
            format="png",
            theme_name="default",
        )

        assert result["success"] is True
        assert output_file.exists()
        assert result["file_size_kb"] > 0

    def test_render_cyrillic_class_diagram(self, output_dir):
        """–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–ª–∞—Å—Å–æ–≤–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π."""
        code = """
@startuml
class –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {
  -–∏–º—è: str
  -email: str
  +–≤–æ–π—Ç–∏()
  +–≤—ã–π—Ç–∏()
}

class –ó–∞–∫–∞–∑ {
  -–Ω–æ–º–µ—Ä: int
  -—Å—É–º–º–∞: float
  +—Å–æ–∑–¥–∞—Ç—å()
  +–æ—Ç–º–µ–Ω–∏—Ç—å()
}

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "1" -- "*" –ó–∞–∫–∞–∑ : —Å–æ–∑–¥–∞—ë—Ç >
@enduml
"""
        output_file = output_dir / "test_cyrillic_class.svg"

        result = render_diagram_from_string(
            diagram_code=code,
            output_path=str(output_file),
            format="svg",
            theme_name="default",
        )

        assert result["success"] is True
        assert output_file.exists()


class TestDifferentDiagramTypes:
    """–¢–µ—Å—Ç—ã —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º."""

    def test_activity_diagram(self, output_dir):
        """–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ activity –¥–∏–∞–≥—Ä–∞–º–º—ã."""
        code = """
@startuml
start
:–ù–∞—á–∞–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–∞;
if (–£—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ?) then (–¥–∞)
  :–í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –ê;
else (–Ω–µ—Ç)
  :–í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –ë;
endif
:–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ;
stop
@enduml
"""
        output_file = output_dir / "test_activity.png"

        result = render_diagram_from_string(
            diagram_code=code,
            output_path=str(output_file),
            format="png",
            theme_name="default",
        )

        assert result["success"] is True
        assert output_file.exists()

    def test_use_case_diagram(self, output_dir):
        """–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ use case –¥–∏–∞–≥—Ä–∞–º–º—ã."""
        code = """
@startuml
left to right direction
actor –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
actor –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä

rectangle –°–∏—Å—Ç–µ–º–∞ {
  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -- (–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É)
  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -- (–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö)
  –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä -- (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏)
  –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä -- (–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö)
}
@enduml
"""
        output_file = output_dir / "test_usecase.png"

        result = render_diagram_from_string(
            diagram_code=code,
            output_path=str(output_file),
            format="png",
            theme_name="default",
        )

        assert result["success"] is True
        assert output_file.exists()

    def test_component_diagram(self, output_dir):
        """–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ component –¥–∏–∞–≥—Ä–∞–º–º—ã."""
        code = """
@startuml
package "Web Application" {
  [Frontend] as FE
  [Backend API] as BE
  [Database] as DB
}

FE --> BE : HTTP/REST
BE --> DB : SQL
@enduml
"""
        output_file = output_dir / "test_component.png"

        result = render_diagram_from_string(
            diagram_code=code,
            output_path=str(output_file),
            format="png",
            theme_name="default",
        )

        assert result["success"] is True
        assert output_file.exists()


class TestErrorHandling:
    """–¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫."""

    def test_invalid_theme_name(self, output_dir, test_plantuml_code):
        """–ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–µ–º—É."""
        output_file = output_dir / "test_invalid_theme.png"

        with pytest.raises(FileNotFoundError) as exc_info:
            render_diagram_from_string(
                diagram_code=test_plantuml_code,
                output_path=str(output_file),
                format="png",
                theme_name="nonexistent_theme",
            )

        assert "–¢–µ–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞" in str(exc_info.value)

    def test_create_output_directory(self, output_dir, test_plantuml_code):
        """–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –≤—ã–≤–æ–¥–∞."""
        output_file = output_dir / "subdir" / "nested" / "test.png"

        result = render_diagram_from_string(
            diagram_code=test_plantuml_code,
            output_path=str(output_file),
            format="png",
            theme_name="default",
        )

        assert result["success"] is True
        assert output_file.exists()


class TestFormats:
    """–¢–µ—Å—Ç—ã —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –≤—ã–≤–æ–¥–∞."""

    @pytest.mark.parametrize("format", ["png", "svg"])
    def test_different_formats(self, output_dir, test_plantuml_code, format):
        """–¢–µ—Å—Ç —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –≤—ã–≤–æ–¥–∞."""
        output_file = output_dir / f"test_format.{format}"

        result = render_diagram_from_string(
            diagram_code=test_plantuml_code,
            output_path=str(output_file),
            format=format,
            theme_name="default",
        )

        assert result["success"] is True
        assert output_file.exists()
        assert result["format"] == format
        assert output_file.suffix == f".{format}"


class TestRenderToImage:
    """–¢–µ—Å—Ç—ã –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ render_diagram_to_image()."""

    def test_render_to_image_returns_pil_image(self, test_plantuml_code):
        """–¢–µ—Å—Ç —á—Ç–æ render_diagram_to_image() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç PIL Image."""
        image = render_diagram_to_image(
            diagram_code=test_plantuml_code,
            format="png",
            theme_name="default",
            scale_factor=1.0,
        )

        assert isinstance(image, Image.Image)
        assert image.width > 0
        assert image.height > 0
        assert image.mode == "RGB"

    def test_render_to_image_scale_factor_1x(self, test_plantuml_code):
        """–¢–µ—Å—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å scale_factor=1.0 (96 DPI)."""
        image = render_diagram_to_image(
            diagram_code=test_plantuml_code,
            format="png",
            theme_name="default",
            scale_factor=1.0,
        )

        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —à–∏—Ä–∏–Ω—É –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        width_1x = image.width
        height_1x = image.height

        assert width_1x > 0
        assert height_1x > 0

    def test_render_to_image_scale_factor_3x(self, test_plantuml_code):
        """–¢–µ—Å—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å scale_factor=3.0 (288 DPI) - –¥–ª—è 4K/print."""
        image_1x = render_diagram_to_image(
            diagram_code=test_plantuml_code,
            format="png",
            theme_name="default",
            scale_factor=1.0,
        )

        image_3x = render_diagram_to_image(
            diagram_code=test_plantuml_code,
            format="png",
            theme_name="default",
            scale_factor=3.0,
        )

        # 3x –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ 3 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ
        assert image_3x.width > image_1x.width * 2.5
        assert image_3x.height > image_1x.height * 2.5

    def test_render_to_image_with_webp_conversion(self, test_plantuml_code, output_dir):
        """–¢–µ—Å—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ PIL Image –≤ WebP —á–µ—Ä–µ–∑ image_utils."""
        image = render_diagram_to_image(
            diagram_code=test_plantuml_code,
            format="png",
            theme_name="default",
            scale_factor=2.0,
        )

        # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ WebP
        webp_bytes = convert_to_webp(image, quality=85)

        assert isinstance(webp_bytes, bytes)
        assert len(webp_bytes) > 0

        # –ú–æ–∂–µ–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–µ–∑ save_image
        output_file = output_dir / "diagram_from_image.webp"
        result = save_image(image, output_file, format="webp")

        assert result["success"] is True
        assert output_file.exists()
        assert result["format"] == "webp"

    def test_render_to_image_without_theme(self, test_plantuml_code):
        """–¢–µ—Å—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –±–µ–∑ —Ç–µ–º—ã."""
        image = render_diagram_to_image(
            diagram_code=test_plantuml_code,
            format="png",
            theme_name=None,
            scale_factor=1.0,
        )

        assert isinstance(image, Image.Image)

    def test_render_to_image_cyrillic(self):
        """–¢–µ—Å—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã –≤ PIL Image."""
        code = """
@startuml
Alice -> Bob: –ü—Ä–∏–≤–µ—Ç!
Bob --> Alice: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π!
@enduml
"""
        image = render_diagram_to_image(
            diagram_code=code,
            format="png",
            theme_name="default",
            scale_factor=1.0,
        )

        assert isinstance(image, Image.Image)
        assert image.width > 0


class TestScaleFactorIntegration:
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã scale_factor —Å render_diagram_from_string()."""

    def test_legacy_function_with_scale_factor(self, test_plantuml_code, output_dir):
        """–¢–µ—Å—Ç —á—Ç–æ render_diagram_from_string() –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç scale_factor."""
        output_file = output_dir / "diagram_scaled_3x.png"

        result = render_diagram_from_string(
            diagram_code=test_plantuml_code,
            output_path=str(output_file),
            format="png",
            theme_name="default",
            scale_factor=3.0,
        )

        assert result["success"] is True
        assert result["scale_factor"] == 3.0
        assert output_file.exists()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        loaded = Image.open(output_file)
        assert loaded.width > 500  # –î–ª—è 3x –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–æ–µ

    def test_scale_factor_1x_vs_3x_file_sizes(self, test_plantuml_code, output_dir):
        """–¢–µ—Å—Ç —á—Ç–æ 3x –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –±–æ–ª—å—à–∏–π —Ñ–∞–π–ª —á–µ–º 1x."""
        output_1x = output_dir / "diagram_1x.png"
        output_3x = output_dir / "diagram_3x.png"

        result_1x = render_diagram_from_string(
            diagram_code=test_plantuml_code,
            output_path=str(output_1x),
            format="png",
            scale_factor=1.0,
        )

        result_3x = render_diagram_from_string(
            diagram_code=test_plantuml_code,
            output_path=str(output_3x),
            format="png",
            scale_factor=3.0,
        )

        assert result_1x["success"] is True
        assert result_3x["success"] is True

        # 3x –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç—è–∂–µ–ª–µ–µ
        assert result_3x["file_size_kb"] > result_1x["file_size_kb"]

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
        img_1x = Image.open(output_1x)
        img_3x = Image.open(output_3x)

        assert img_3x.width > img_1x.width * 2.5
        assert img_3x.height > img_1x.height * 2.5

    def test_extreme_quality_level(self, test_plantuml_code, output_dir):
        """–¢–µ—Å—Ç Extreme —É—Ä–æ–≤–Ω—è –∫–∞—á–µ—Å—Ç–≤–∞ (6.0x –º–∞—Å—à—Ç–∞–±) –¥–ª—è Deep Zoom."""
        output_extreme = output_dir / "diagram_extreme.png"

        result = render_diagram_from_string(
            diagram_code=test_plantuml_code,
            output_path=str(output_extreme),
            format="png",
            scale_factor=6.0,  # Extreme: 576 DPI
        )

        assert result["success"] is True
        assert result["output_path"] == str(output_extreme)

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω
        assert output_extreme.exists()

        # –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑–º–µ—Ä–æ–≤
        img_extreme = Image.open(output_extreme)

        # Extreme (6x) –¥–æ–ª–∂–µ–Ω –¥–∞–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä >1600px –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–µ—á–∞—Ç–∏
        assert img_extreme.width >= 1600, (
            f"Extreme –∫–∞—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –¥–∞–≤–∞—Ç—å —à–∏—Ä–∏–Ω—É >=1600px, –ø–æ–ª—É—á–µ–Ω–æ {img_extreme.width}"
        )
        assert img_extreme.height >= 900, (
            f"Extreme –∫–∞—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –¥–∞–≤–∞—Ç—å –≤—ã—Å–æ—Ç—É >=900px, –ø–æ–ª—É—á–µ–Ω–æ {img_extreme.height}"
        )

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±–æ–ª—å—à–µ —á–µ–º –¥–ª—è Low (1x)
        output_1x = output_dir / "diagram_1x_compare.png"
        result_1x = render_diagram_from_string(
            diagram_code=test_plantuml_code,
            output_path=str(output_1x),
            format="png",
            scale_factor=1.0,
        )

        img_1x = Image.open(output_1x)

        # 6x –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–æ–≤–Ω–æ –≤ 6 —Ä–∞–∑ –±–æ–ª—å—à–µ (—Å –¥–æ–ø—É—Å–∫–æ–º –Ω–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ)
        expected_width = img_1x.width * 6
        expected_height = img_1x.height * 6

        assert abs(img_extreme.width - expected_width) <= 5, (
            f"6x width –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å {expected_width}¬±5, –ø–æ–ª—É—á–µ–Ω–æ {img_extreme.width}"
        )
        assert abs(img_extreme.height - expected_height) <= 5, (
            f"6x height –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å {expected_height}¬±5, –ø–æ–ª—É—á–µ–Ω–æ {img_extreme.height}"
        )

    def test_webp_quality_levels(self, test_plantuml_code, output_dir):
        """–¢–µ—Å—Ç –≤—Å–µ—Ö —É—Ä–æ–≤–Ω–µ–π –∫–∞—á–µ—Å—Ç–≤–∞ –¥–ª—è WebP —Ñ–æ—Ä–º–∞—Ç–∞."""
        from src.diagram_renderer import QUALITY_LEVELS

        results = {}

        for level, scale in QUALITY_LEVELS.items():
            output_file = output_dir / f"webp_quality_{level.lower()}.webp"

            result = render_diagram_from_string(
                diagram_code=test_plantuml_code,
                output_path=str(output_file),
                format="webp",
                scale_factor=scale,
            )

            assert result["success"] is True
            assert output_file.exists()

            img = Image.open(output_file)
            results[level] = {
                "width": img.width,
                "height": img.height,
                "scale": scale,
            }

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å –±–æ–ª—å—à–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ
        low_width = results["Low"]["width"]

        assert results["Medium"]["width"] / low_width >= 1.9, (
            "Medium –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ~2x –æ—Ç Low"
        )
        assert results["High"]["width"] / low_width >= 2.9, (
            "High –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ~3x –æ—Ç Low"
        )
        assert results["Ultra"]["width"] / low_width >= 3.9, (
            "Ultra –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ~4x –æ—Ç Low"
        )
        assert results["Extreme"]["width"] / low_width >= 5.8, (
            "Extreme –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ~6x –æ—Ç Low"
        )

```

## `tests/test_font_diagnostic.py`

```py
"""–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —à—Ä–∏—Ñ—Ç–æ–≤ –≤ PlantUML."""

import pytest
from pathlib import Path
import sys

sys.path.insert(0, str(Path(__file__).parent.parent))

from src.diagram_renderer import render_diagram_from_string


class TestFontDiagnostic:
    """–í–∏–∑—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑–ª–∏—á–∏–π —à—Ä–∏—Ñ—Ç–æ–≤."""

    @pytest.fixture
    def comparison_diagram(self):
        """–î–∏–∞–≥—Ä–∞–º–º–∞ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤."""
        return """
@startuml
skinparam defaultFontSize 16
skinparam backgroundColor #FFFFFF

rectangle "Default Font" {
  note
    ABCDEFGHIJKLMNOPQRSTUVWXYZ
    abcdefghijklmnopqrstuvwxyz
    0123456789 !@#$%^&*()
    Illegal != 0
  end note
}
@enduml
"""

    def test_font_arial(self, output_dir, comparison_diagram):
        """–¢–µ—Å—Ç —Å Arial (–¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è)."""
        code = comparison_diagram.replace("Default Font", "Arial Font")
        code = code.replace("@startuml", '@startuml\nskinparam defaultFontName "Arial"')

        output_file = output_dir / "font_arial.png"

        result = render_diagram_from_string(
            diagram_code=code,
            output_path=str(output_file),
            format="png",
            theme_name=None,  # –ë–ï–ó —Ç–µ–º—ã
        )

        assert result["success"] is True
        print(f"\nüìÑ Arial: {output_file}")

    def test_font_jetbrains_mono(self, output_dir, comparison_diagram):
        """–¢–µ—Å—Ç —Å JetBrains Mono."""
        code = comparison_diagram.replace("Default Font", "JetBrains Mono Font")
        code = code.replace(
            "@startuml", '@startuml\nskinparam defaultFontName "JetBrains Mono"'
        )

        output_file = output_dir / "font_jetbrains_mono.png"

        result = render_diagram_from_string(
            diagram_code=code,
            output_path=str(output_file),
            format="png",
            theme_name=None,
        )

        assert result["success"] is True
        print(f"\nüìÑ JetBrains Mono: {output_file}")

    def test_font_fira_code(self, output_dir, comparison_diagram):
        """–¢–µ—Å—Ç —Å Fira Code."""
        code = comparison_diagram.replace("Default Font", "Fira Code Font")
        code = code.replace(
            "@startuml", '@startuml\nskinparam defaultFontName "Fira Code"'
        )

        output_file = output_dir / "font_fira_code.png"

        result = render_diagram_from_string(
            diagram_code=code,
            output_path=str(output_file),
            format="png",
            theme_name=None,
        )

        assert result["success"] is True
        print(f"\nüìÑ Fira Code: {output_file}")

    def test_font_courier_new(self, output_dir, comparison_diagram):
        """–¢–µ—Å—Ç —Å Courier New (—Å–∏—Å—Ç–µ–º–Ω—ã–π —à—Ä–∏—Ñ—Ç)."""
        code = comparison_diagram.replace("Default Font", "Courier New Font")
        code = code.replace(
            "@startuml", '@startuml\nskinparam defaultFontName "Courier New"'
        )

        output_file = output_dir / "font_courier_new.png"

        result = render_diagram_from_string(
            diagram_code=code,
            output_path=str(output_file),
            format="png",
            theme_name=None,
        )

        assert result["success"] is True
        print(f"\nüìÑ Courier New: {output_file}")

    def test_check_gdi_loaded_fonts(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ load_custom_fonts –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è."""
        import logging
        from src.font_manager import load_custom_fonts

        # –í–∫–ª—é—á–∞–µ–º –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        logging.basicConfig(level=logging.DEBUG)

        # –í—ã–∑—ã–≤–∞–µ–º –Ω–∞–ø—Ä—è–º—É—é
        load_custom_fonts()

        # –ï—Å–ª–∏ –Ω–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–π - —Ö–æ—Ä–æ—à–æ
        assert True

```

## `tests/test_font_initializer.py`

```py
"""–¢–µ—Å—Ç—ã –º–æ–¥—É–ª—è font_initializer."""

import pytest
from pathlib import Path
import sys
import json

sys.path.insert(0, str(Path(__file__).parent.parent))

from src.font_initializer import ensure_fonts_initialized, MARKER_FILE


class TestFontInitializer:
    """–¢–µ—Å—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ —à—Ä–∏—Ñ—Ç–æ–≤."""

    def test_ensure_fonts_initialized_success(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —à—Ä–∏—Ñ—Ç–æ–≤."""
        result = ensure_fonts_initialized()

        assert result["success"] is True
        assert result["java_home"] is not None
        assert len(result["fonts"]) > 0
        assert result["error"] is None

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤
        fonts = result["fonts"]
        assert any("JetBrains" in font for font in fonts)
        assert any("Fira" in font for font in fonts)

    def test_marker_file_created(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ä–∫–µ—Ä-—Ñ–∞–π–ª–∞."""
        # –í—ã–∑—ã–≤–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
        ensure_fonts_initialized()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –º–∞—Ä–∫–µ—Ä–∞
        assert MARKER_FILE.exists()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
        with open(MARKER_FILE, "r") as f:
            data = json.load(f)

        assert "java_home" in data
        assert "fonts_installed" in data
        assert "platform" in data
        assert "timestamp" in data

        assert len(data["fonts_installed"]) > 0

    def test_second_call_uses_cache(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–µ—à."""
        # –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤
        result1 = ensure_fonts_initialized()
        assert result1["success"] is True

        # –í—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤ (–¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–µ—à)
        result2 = ensure_fonts_initialized()
        assert result2["success"] is True
        assert result2["already_installed"] is True

        # –û–±–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–¥–µ–Ω—Ç–∏—á–Ω—ã
        assert result1["java_home"] == result2["java_home"]
        assert set(result1["fonts"]) == set(result2["fonts"])

    def test_fonts_in_jre(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —à—Ä–∏—Ñ—Ç—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ JRE."""
        result = ensure_fonts_initialized()
        assert result["success"] is True

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–æ–≤
        java_home = Path(result["java_home"])

        # –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ fonts –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
        possible_paths = [
            java_home / "lib" / "fonts",
            java_home / "jre" / "lib" / "fonts",
        ]

        fonts_dir = None
        for path in possible_paths:
            if path.exists():
                fonts_dir = path
                break

        assert fonts_dir is not None, "–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ JRE –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –Ω–∞—à–∏—Ö —à—Ä–∏—Ñ—Ç–æ–≤
        ttf_files = list(fonts_dir.glob("*.ttf"))
        font_names = [f.name for f in ttf_files]

        assert any("JetBrains" in name for name in font_names)
        assert any("Fira" in name for name in font_names)

```

## `tests/test_font_integration.py`

```py
"""–¢–µ—Å—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —à—Ä–∏—Ñ—Ç–æ–≤ —Å PlantUML."""

import pytest
from pathlib import Path
import sys
import platform

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ –≤ –ø—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
sys.path.insert(0, str(Path(__file__).parent.parent))

from src.diagram_renderer import render_diagram_from_string
from src.font_manager import load_custom_fonts, FONTS_DIR


class TestFontLoading:
    """–¢–µ—Å—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —à—Ä–∏—Ñ—Ç–æ–≤."""

    def test_fonts_directory_exists(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ —à—Ä–∏—Ñ—Ç–∞–º–∏."""
        assert FONTS_DIR.exists(), f"–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: {FONTS_DIR}"

    def test_jetbrains_mono_font_exists(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ñ–∞–π–ª–∞ JetBrains Mono."""
        jetbrains_font = FONTS_DIR / "JetBrainsMono-Regular.ttf"
        assert jetbrains_font.exists(), (
            f"–®—Ä–∏—Ñ—Ç JetBrains Mono –Ω–µ –Ω–∞–π–¥–µ–Ω: {jetbrains_font}"
        )

    def test_firacode_font_exists(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ñ–∞–π–ª–∞ Fira Code."""
        fira_font = FONTS_DIR / "FiraCode-Regular.ttf"
        assert fira_font.exists(), f"–®—Ä–∏—Ñ—Ç Fira Code –Ω–µ –Ω–∞–π–¥–µ–Ω: {fira_font}"

    @pytest.mark.skipif(
        platform.system() != "Windows", reason="–¢–µ—Å—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è Windows"
    )
    def test_load_custom_fonts_no_error(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ load_custom_fonts() –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫."""
        # –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–π
        load_custom_fonts()


class TestDiagramWithCustomFonts:
    """–¢–µ—Å—Ç—ã —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –¥–∏–∞–≥—Ä–∞–º–º —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ —à—Ä–∏—Ñ—Ç–∞–º–∏."""

    @pytest.fixture
    def diagram_code_with_jetbrains(self):
        """PlantUML –∫–æ–¥ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º JetBrains Mono."""
        return """
@startuml
skinparam defaultFontName "JetBrains Mono"
skinparam defaultFontSize 14

class CodeToImageMCP {
  + generate_code_screenshot()
  + render_diagram_from_string()
  - load_custom_fonts()
}

class FontManager {
  + get_font_path()
  + list_available_fonts()
  + load_custom_fonts()
}

CodeToImageMCP --> FontManager : uses
@enduml
"""

    @pytest.fixture
    def diagram_code_with_firacode(self):
        """PlantUML –∫–æ–¥ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º Fira Code."""
        return """
@startuml
skinparam defaultFontName "Fira Code"

Alice -> Bob: Hello != World
Bob -> Alice: foo() => bar()
note right: Ligatures: -> => != <=
@enduml
"""

    def test_render_with_jetbrains_mono(self, output_dir, diagram_code_with_jetbrains):
        """–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¥–∏–∞–≥—Ä–∞–º–º—ã —Å JetBrains Mono."""
        output_file = output_dir / "test_jetbrains_mono.png"

        result = render_diagram_from_string(
            diagram_code=diagram_code_with_jetbrains,
            output_path=str(output_file),
            format="png",
            theme_name="default",
        )

        assert result["success"] is True
        assert output_file.exists()
        assert output_file.stat().st_size > 0
        print(f"\n‚úÖ –î–∏–∞–≥—Ä–∞–º–º–∞ —Å JetBrains Mono —Å–æ–∑–¥–∞–Ω–∞: {output_file}")

    def test_render_with_firacode(self, output_dir, diagram_code_with_firacode):
        """–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¥–∏–∞–≥—Ä–∞–º–º—ã —Å Fira Code."""
        output_file = output_dir / "test_firacode.png"

        result = render_diagram_from_string(
            diagram_code=diagram_code_with_firacode,
            output_path=str(output_file),
            format="png",
            theme_name="default",
        )

        assert result["success"] is True
        assert output_file.exists()
        assert output_file.stat().st_size > 0
        print(f"\n‚úÖ –î–∏–∞–≥—Ä–∞–º–º–∞ —Å Fira Code —Å–æ–∑–¥–∞–Ω–∞: {output_file}")

    def test_render_class_diagram_with_cyrillic_jetbrains(self, output_dir):
        """–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ class –¥–∏–∞–≥—Ä–∞–º–º—ã —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π –∏ JetBrains Mono."""
        diagram_code = """
@startuml
skinparam defaultFontName "JetBrains Mono"
skinparam classAttributeFontSize 12
skinparam classFontSize 14

class –†–µ–Ω–¥–µ—Ä–µ—Ä–î–∏–∞–≥—Ä–∞–º–º {
  - java_version: str
  - plantuml_jar: Path
  + render_diagram_from_string()
  + ensure_java_environment()
}

class –ú–µ–Ω–µ–¥–∂–µ—Ä–®—Ä–∏—Ñ—Ç–æ–≤ {
  - fonts_dir: Path
  + get_font_path()
  + load_custom_fonts()
}

–†–µ–Ω–¥–µ—Ä–µ—Ä–î–∏–∞–≥—Ä–∞–º–º --> –ú–µ–Ω–µ–¥–∂–µ—Ä–®—Ä–∏—Ñ—Ç–æ–≤ : –∏—Å–ø–æ–ª—å–∑—É–µ—Ç
@enduml
"""
        output_file = output_dir / "test_cyrillic_jetbrains.png"

        result = render_diagram_from_string(
            diagram_code=diagram_code,
            output_path=str(output_file),
            format="png",
            theme_name="default",
        )

        assert result["success"] is True
        assert output_file.exists()
        assert output_file.stat().st_size > 0
        print(f"\n‚úÖ –î–∏–∞–≥—Ä–∞–º–º–∞ —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π –∏ JetBrains Mono: {output_file}")

```

## `tests/test_guide_manager.py`

```py
"""–¢–µ—Å—Ç—ã –¥–ª—è guide_manager.py."""

import pytest
from pathlib import Path

from src.guide_manager import (
    get_guide,
    list_guides,
    list_themes,
    _extract_brief,
    _extract_detailed,
    GUIDES_DIR,
    THEMES_DIR,
)


class TestListGuides:
    """–¢–µ—Å—Ç—ã –¥–ª—è list_guides()."""

    def test_list_guides_returns_list(self):
        """list_guides –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å–ø–∏—Å–æ–∫."""
        result = list_guides()
        assert isinstance(result, list)

    def test_list_guides_has_expected_types(self):
        """list_guides –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤—Å–µ —Ç–∏–ø—ã –≥–∞–π–¥–æ–≤."""
        result = list_guides()
        types = [g["type"] for g in result]

        assert "class" in types
        assert "sequence" in types
        assert "component" in types
        assert "activity" in types
        assert "themes" in types

    def test_list_guides_has_required_fields(self):
        """–ö–∞–∂–¥—ã–π –≥–∞–π–¥ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å type, title –∏ description."""
        result = list_guides()

        for guide in result:
            assert "type" in guide
            assert "title" in guide
            assert "description" in guide


class TestListThemes:
    """–¢–µ—Å—Ç—ã –¥–ª—è list_themes()."""

    def test_list_themes_returns_list(self):
        """list_themes –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å–ø–∏—Å–æ–∫."""
        result = list_themes()
        assert isinstance(result, list)

    def test_list_themes_has_expected_themes(self):
        """list_themes –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤—Å–µ —Ç–µ–º—ã."""
        result = list_themes()
        names = [t["name"] for t in result]

        assert "default" in names
        assert "dark_gold" in names
        assert "light_fresh" in names

    def test_list_themes_has_required_fields(self):
        """–ö–∞–∂–¥–∞—è —Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å name –∏ description."""
        result = list_themes()

        for theme in result:
            assert "name" in theme
            assert "description" in theme
            assert theme["description"]  # –ù–µ –ø—É—Å—Ç–æ–π


class TestGetGuide:
    """–¢–µ—Å—Ç—ã –¥–ª—è get_guide()."""

    def test_get_guide_class_brief(self):
        """get_guide –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∫—Ä–∞—Ç–∫–∏–π –≥–∞–π–¥ –ø–æ class."""
        result = get_guide("class", full=False)

        assert isinstance(result, str)
        assert len(result) > 0
        assert "<<Adapter>>" in result or "Stereotype" in result

    def test_get_guide_component_brief(self):
        """get_guide –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∫—Ä–∞—Ç–∫–∏–π –≥–∞–π–¥ –ø–æ component."""
        result = get_guide("component", full=False)

        assert isinstance(result, str)
        assert "<<Adapter>>" in result
        assert "<<Core>>" in result
        assert "<<Infrastructure>>" in result

    def test_get_guide_sequence_brief(self):
        """get_guide –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∫—Ä–∞—Ç–∫–∏–π –≥–∞–π–¥ –ø–æ sequence."""
        result = get_guide("sequence", full=False)

        assert isinstance(result, str)
        assert "participant" in result.lower() or "actor" in result.lower()

    def test_get_guide_activity_brief(self):
        """get_guide –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∫—Ä–∞—Ç–∫–∏–π –≥–∞–π–¥ –ø–æ activity."""
        result = get_guide("activity", full=False)

        assert isinstance(result, str)
        assert "start" in result.lower() or "if" in result.lower()

    def test_get_guide_themes_brief(self):
        """get_guide –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∫—Ä–∞—Ç–∫–∏–π –≥–∞–π–¥ –ø–æ themes."""
        result = get_guide("themes", full=False)

        assert isinstance(result, str)
        assert "dark_gold" in result or "light_fresh" in result

    def test_get_guide_full_longer_than_brief(self):
        """–ü–æ–ª–Ω—ã–π –≥–∞–π–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ –∫—Ä–∞—Ç–∫–æ–≥–æ."""
        brief = get_guide("component", full=False)
        full = get_guide("component", full=True)

        assert len(full) > len(brief)

    def test_get_guide_unknown_type(self):
        """–ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–∏–ø –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ."""
        result = get_guide("unknown_type", full=False)

        assert "–Ω–µ –Ω–∞–π–¥–µ–Ω" in result or "not found" in result.lower()
        assert "class" in result  # –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏–ø—ã


class TestExtractBrief:
    """–¢–µ—Å—Ç—ã –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ brief-—Å–µ–∫—Ü–∏–π.

    –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Ñ—É–Ω–∫—Ü–∏—é _extract_brief –Ω–∞–ø—Ä—è–º—É—é
    –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞ –º–∞—Ä–∫–µ—Ä–æ–≤.
    """

    def test_extract_brief_with_markers(self):
        """_extract_brief –¥–æ–ª–∂–µ–Ω –∏–∑–≤–ª–µ–∫–∞—Ç—å —Ç–µ–∫—Å—Ç –º–µ–∂–¥—É –º–∞—Ä–∫–µ—Ä–∞–º–∏."""
        content = """
Some header
<!-- BRIEF_START -->
Brief content here
<!-- BRIEF_END -->
Some footer
"""
        result = _extract_brief(content)
        assert result == "Brief content here"

    def test_extract_brief_without_markers(self):
        """_extract_brief –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞ –±–µ–∑ –º–∞—Ä–∫–µ—Ä–æ–≤."""
        content = "A" * 600
        result = _extract_brief(content)

        assert len(result) == 503  # 500 + "..."
        assert result.endswith("...")


class TestExtractDetailed:
    """–¢–µ—Å—Ç—ã –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ detailed-—Å–µ–∫—Ü–∏–π.

    –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Ñ—É–Ω–∫—Ü–∏—é _extract_detailed –Ω–∞–ø—Ä—è–º—É—é
    –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞ –º–∞—Ä–∫–µ—Ä–æ–≤.
    """

    def test_extract_detailed_with_markers(self):
        """_extract_detailed –¥–æ–ª–∂–µ–Ω –∏–∑–≤–ª–µ–∫–∞—Ç—å —Ç–µ–∫—Å—Ç –º–µ–∂–¥—É –º–∞—Ä–∫–µ—Ä–∞–º–∏."""
        content = """
<!-- DETAILED_START -->
Detailed content here
<!-- DETAILED_END -->
"""
        result = _extract_detailed(content)
        assert result == "Detailed content here"

    def test_extract_detailed_without_markers(self):
        """_extract_detailed –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –≤–µ—Å—å —Ñ–∞–π–ª –±–µ–∑ –º–∞—Ä–∫–µ—Ä–æ–≤."""
        content = "Full content without markers"
        result = _extract_detailed(content)

        assert result == content


class TestGuideFilesExist:
    """–¢–µ—Å—Ç—ã –Ω–∞–ª–∏—á–∏—è —Ñ–∞–π–ª–æ–≤ –≥–∞–π–¥–æ–≤."""

    def test_guides_directory_exists(self):
        """–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –≥–∞–π–¥–æ–≤ –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å."""
        assert GUIDES_DIR.exists()

    def test_themes_directory_exists(self):
        """–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Ç–µ–º –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å."""
        assert THEMES_DIR.exists()

    def test_index_file_exists(self):
        """–ò–Ω–¥–µ–∫—Å–Ω—ã–π —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å."""
        index_file = GUIDES_DIR / "index.json"
        assert index_file.exists()

    def test_all_guide_files_exist(self):
        """–í—Å–µ —Ñ–∞–π–ª—ã –≥–∞–π–¥–æ–≤ –∏–∑ index.json –¥–æ–ª–∂–Ω—ã —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å."""
        guides = list_guides()

        for guide in guides:
            guide_type = guide["type"]
            if guide_type == "themes":
                file_path = GUIDES_DIR / "themes.md"
            else:
                file_path = GUIDES_DIR / f"{guide_type}_diagram.md"
            assert file_path.exists(), f"–§–∞–π–ª {file_path} –Ω–µ –Ω–∞–π–¥–µ–Ω"

    def test_all_theme_files_exist(self):
        """–í—Å–µ —Ñ–∞–π–ª—ã —Ç–µ–º –¥–æ–ª–∂–Ω—ã —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å."""
        themes = list_themes()

        for theme in themes:
            theme_file = THEMES_DIR / f"{theme['name']}.puml"
            assert theme_file.exists(), f"–§–∞–π–ª {theme_file} –Ω–µ –Ω–∞–π–¥–µ–Ω"


class TestGuideContent:
    """–¢–µ—Å—Ç—ã —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –≥–∞–π–¥–æ–≤."""

    def test_component_guide_has_stereotypes(self):
        """–ì–∞–π–¥ –ø–æ component –¥–æ–ª–∂–µ–Ω –æ–ø–∏—Å—ã–≤–∞—Ç—å —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã."""
        result = get_guide("component", full=True)

        assert "<<Adapter>>" in result
        assert "<<Core>>" in result
        assert "<<Infrastructure>>" in result

    def test_class_guide_has_syntax(self):
        """–ì–∞–π–¥ –ø–æ class –¥–æ–ª–∂–µ–Ω –æ–ø–∏—Å—ã–≤–∞—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å."""
        result = get_guide("class", full=True)

        assert "class" in result.lower()
        assert "+" in result or "public" in result.lower()

    def test_themes_guide_has_theme_names(self):
        """–ì–∞–π–¥ –ø–æ themes –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏–º–µ–Ω–∞ —Ç–µ–º."""
        result = get_guide("themes", full=True)

        assert "dark_gold" in result
        assert "light_fresh" in result
        assert "default" in result

```

## `tests/test_image_utils.py`

```py
"""–¢–µ—Å—Ç—ã –¥–ª—è –º–æ–¥—É–ª—è image_utils.

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏:
- save_image() - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö
- resize_image() - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- convert_to_webp() - –∫–æ–Ω–≤–µ—Ä—Å–∏—è –≤ WebP
- load_image_from_bytes() - –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ –±–∞–π—Ç–æ–≤
"""

import io
from pathlib import Path

import pytest
from PIL import Image

from src.image_utils import (
    ImageProcessingError,
    convert_to_webp,
    load_image_from_bytes,
    resize_image,
    save_image,
)


@pytest.fixture
def test_image():
    """–°–æ–∑–¥–∞—ë—Ç —Ç–µ—Å—Ç–æ–≤–æ–µ RGB –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 100x100."""
    img = Image.new("RGB", (100, 100), color=(255, 0, 0))
    return img


@pytest.fixture
def test_image_rgba():
    """–°–æ–∑–¥–∞—ë—Ç —Ç–µ—Å—Ç–æ–≤–æ–µ RGBA –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é."""
    img = Image.new("RGBA", (100, 100), color=(0, 255, 0, 128))
    return img


@pytest.fixture
def output_dir(tmp_path):
    """–°–æ–∑–¥–∞—ë—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –≤—ã—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤."""
    output = tmp_path / "output"
    output.mkdir()
    return output


class TestSaveImage:
    """–¢–µ—Å—Ç—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ save_image."""

    def test_save_image_webp(self, test_image, output_dir):
        """–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ WebP."""
        output_path = output_dir / "test.webp"
        result = save_image(test_image, output_path, format="webp")

        assert result["success"] is True
        assert Path(result["path"]).exists()
        assert result["format"] == "webp"
        assert result["dimensions"] == (100, 100)
        assert result["size_bytes"] > 0

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª —á–∏—Ç–∞–µ—Ç—Å—è
        loaded = Image.open(output_path)
        assert loaded.size == (100, 100)

    def test_save_image_png(self, test_image, output_dir):
        """–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ PNG."""
        output_path = output_dir / "test.png"
        result = save_image(test_image, output_path, format="png")

        assert result["success"] is True
        assert result["format"] == "png"
        assert Path(result["path"]).exists()

    def test_save_image_jpeg(self, test_image, output_dir):
        """–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ JPEG."""
        output_path = output_dir / "test.jpg"
        result = save_image(test_image, output_path, format="jpeg")

        assert result["success"] is True
        assert result["format"] == "jpeg"
        assert Path(result["path"]).exists()

    def test_save_image_custom_quality(self, test_image, output_dir):
        """–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∫–∞—á–µ—Å—Ç–≤–æ–º."""
        output_path = output_dir / "test_quality.webp"
        result = save_image(test_image, output_path, format="webp", quality=50)

        assert result["success"] is True
        # –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –¥–∞–≤–∞—Ç—å –º–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä
        assert result["size_bytes"] > 0

    def test_save_image_creates_directory(self, test_image, tmp_path):
        """–¢–µ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π."""
        output_path = tmp_path / "nested" / "deep" / "test.png"
        result = save_image(test_image, output_path, format="png")

        assert result["success"] is True
        assert output_path.exists()

    def test_save_image_rgba_to_jpeg(self, test_image_rgba, output_dir):
        """–¢–µ—Å—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ RGBA –≤ JPEG (–¥–æ–ª–∂–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ RGB)."""
        output_path = output_dir / "test_rgba.jpg"
        result = save_image(test_image_rgba, output_path, format="jpeg")

        assert result["success"] is True
        # JPEG –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å, –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–æ–Ω–≤–µ—Ä—Å–∏—è
        loaded = Image.open(output_path)
        assert loaded.mode == "RGB"


class TestResizeImage:
    """–¢–µ—Å—Ç—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ resize_image."""

    def test_resize_image_downscale(self, test_image):
        """–¢–µ—Å—Ç —É–º–µ–Ω—å—à–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è."""
        resized = resize_image(test_image, scale_factor=0.5)

        assert resized.size == (50, 50)
        assert resized.mode == test_image.mode

    def test_resize_image_upscale(self, test_image):
        """–¢–µ—Å—Ç —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è."""
        resized = resize_image(test_image, scale_factor=2.0)

        assert resized.size == (200, 200)

    def test_resize_image_aspect_ratio(self):
        """–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞."""
        img = Image.new("RGB", (200, 100), color=(0, 0, 255))
        resized = resize_image(img, scale_factor=0.5)

        assert resized.size == (100, 50)  # –ü—Ä–æ–ø–æ—Ä—Ü–∏—è 2:1 —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

    def test_resize_image_same_size(self, test_image):
        """–¢–µ—Å—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —Ç–æ—Ç –∂–µ —Ä–∞–∑–º–µ—Ä (–Ω–µ –¥–æ–ª–∂–Ω–æ –Ω–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å)."""
        resized = resize_image(test_image, scale_factor=1.0)

        # –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Ç–æ –∂–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∏ scale=1.0)
        assert resized.size == test_image.size
        assert resized is test_image  # –¢–æ—Ç –∂–µ –æ–±—ä–µ–∫—Ç –ø—Ä–∏ scale=1.0

    def test_resize_image_preserve_mode(self):
        """–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è."""
        rgba_img = Image.new("RGBA", (100, 100), color=(255, 255, 255, 128))
        resized = resize_image(rgba_img, scale_factor=0.5)

        assert resized.mode == "RGBA"


class TestConvertToWebP:
    """–¢–µ—Å—Ç—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ convert_to_webp."""

    def test_convert_to_webp_rgb(self, test_image):
        """–¢–µ—Å—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ RGB –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ WebP."""
        webp_bytes = convert_to_webp(test_image)

        assert isinstance(webp_bytes, bytes)
        assert len(webp_bytes) > 0

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ
        loaded = Image.open(io.BytesIO(webp_bytes))
        assert loaded.format == "WEBP"
        assert loaded.size == test_image.size

    def test_convert_to_webp_rgba(self, test_image_rgba):
        """–¢–µ—Å—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ RGBA –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ WebP."""
        webp_bytes = convert_to_webp(test_image_rgba)

        assert isinstance(webp_bytes, bytes)
        assert len(webp_bytes) > 0

        loaded = Image.open(io.BytesIO(webp_bytes))
        assert loaded.mode in ("RGBA", "RGB")  # WebP –º–æ–∂–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∞–ª—å—Ñ–∞-–∫–∞–Ω–∞–ª

    def test_convert_to_webp_custom_quality(self, test_image):
        """–¢–µ—Å—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∫–∞—á–µ—Å—Ç–≤–æ–º."""
        # –°–æ–∑–¥–∞—ë–º –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ª—É—á—à–µ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∂–∞—Ç–∏—è
        complex_img = Image.new("RGB", (500, 500))
        pixels = complex_img.load()
        for i in range(500):
            for j in range(500):
                pixels[i, j] = (i % 256, j % 256, (i + j) % 256)

        webp_low = convert_to_webp(complex_img, quality=50)
        webp_high = convert_to_webp(complex_img, quality=95)

        assert isinstance(webp_low, bytes)
        assert isinstance(webp_high, bytes)

        # –ù–∞ —Å–ª–æ–∂–Ω–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –Ω–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –¥–∞–≤–∞—Ç—å –º–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä
        assert len(webp_low) < len(webp_high)


class TestLoadImageFromBytes:
    """–¢–µ—Å—Ç—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ load_image_from_bytes."""

    def test_load_image_from_bytes_png(self, test_image):
        """–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ PNG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –±–∞–π—Ç–æ–≤."""
        # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –±–∞–π—Ç—ã
        buffer = io.BytesIO()
        test_image.save(buffer, format="PNG")
        image_bytes = buffer.getvalue()

        # –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ
        loaded = load_image_from_bytes(image_bytes, source_format="png")

        assert loaded.size == test_image.size
        assert loaded.mode == test_image.mode

    def test_load_image_from_bytes_jpeg(self, test_image):
        """–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ JPEG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –±–∞–π—Ç–æ–≤."""
        buffer = io.BytesIO()
        test_image.save(buffer, format="JPEG")
        image_bytes = buffer.getvalue()

        loaded = load_image_from_bytes(image_bytes, source_format="jpeg")

        assert loaded.size == test_image.size
        # JPEG –≤—Å–µ–≥–¥–∞ RGB
        assert loaded.mode == "RGB"

    def test_load_image_from_bytes_webp(self, test_image):
        """–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ WebP –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –±–∞–π—Ç–æ–≤."""
        buffer = io.BytesIO()
        test_image.save(buffer, format="WEBP")
        image_bytes = buffer.getvalue()

        loaded = load_image_from_bytes(image_bytes, source_format="webp")

        assert loaded.size == test_image.size

    def test_load_image_from_bytes_invalid(self):
        """–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –±–∞–π—Ç–æ–≤."""
        invalid_bytes = b"not an image"

        with pytest.raises(ImageProcessingError):
            load_image_from_bytes(invalid_bytes, source_format="png")

    def test_load_image_from_bytes_empty(self):
        """–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –ø—É—Å—Ç—ã—Ö –±–∞–π—Ç–æ–≤."""
        with pytest.raises(ImageProcessingError):
            load_image_from_bytes(b"", source_format="png")


class TestIntegration:
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π."""

    def test_save_resize_load_cycle(self, test_image, output_dir):
        """–¢–µ—Å—Ç —Ü–∏–∫–ª–∞: —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å ‚Üí –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä ‚Üí –∑–∞–≥—Ä—É–∑–∏—Ç—å."""
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º
        output_path = output_dir / "cycle.webp"
        save_result = save_image(test_image, output_path, format="webp")
        assert save_result["success"] is True

        # –ó–∞–≥—Ä—É–∂–∞–µ–º
        loaded = Image.open(output_path)

        # –ò–∑–º–µ–Ω—è–µ–º —Ä–∞–∑–º–µ—Ä
        resized = resize_image(loaded, scale_factor=0.5)
        assert resized.size == (50, 50)

        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–Ω–æ–≤–∞
        output_path_resized = output_dir / "cycle_resized.webp"
        save_result2 = save_image(resized, output_path_resized, format="webp")
        assert save_result2["success"] is True
        assert save_result2["dimensions"] == (50, 50)

    def test_convert_multiple_formats(self, test_image, output_dir):
        """–¢–µ—Å—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞—Ç–∞–º–∏."""
        # PNG ‚Üí WebP
        png_path = output_dir / "source.png"
        save_image(test_image, png_path, format="png")

        loaded_png = Image.open(png_path)
        webp_bytes = convert_to_webp(loaded_png)

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º WebP
        loaded_webp = Image.open(io.BytesIO(webp_bytes))
        assert loaded_webp.size == test_image.size
        assert loaded_webp.format == "WEBP"

    def test_bytes_to_file_workflow(self, test_image, output_dir):
        """–¢–µ—Å—Ç —Ä–∞–±–æ—Ç—ã —Å –±–∞–π—Ç–∞–º–∏ ‚Üí —Ñ–∞–π–ª."""
        # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Üí –±–∞–π—Ç—ã
        buffer = io.BytesIO()
        test_image.save(buffer, format="PNG")
        image_bytes = buffer.getvalue()

        # –ë–∞–π—Ç—ã ‚Üí PIL Image
        loaded = load_image_from_bytes(image_bytes, source_format="png")

        # PIL Image ‚Üí WebP bytes
        webp_bytes = convert_to_webp(loaded)

        assert isinstance(webp_bytes, bytes)
        assert len(webp_bytes) > 0

        # –ú–æ–∂–µ–º —Å–Ω–æ–≤–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å
        final = Image.open(io.BytesIO(webp_bytes))
        assert final.size == test_image.size


class TestErrorHandling:
    """–¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫."""

    def test_save_image_invalid_format(self, test_image, output_dir):
        """–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ."""
        output_path = output_dir / "test.invalid"

        with pytest.raises(ImageProcessingError):
            save_image(test_image, output_path, format="invalid_format")  # type: ignore

    def test_resize_image_zero_width(self, test_image):
        """–¢–µ—Å—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –Ω–∞ –Ω—É–ª–µ–≤–æ–π scale_factor."""
        with pytest.raises(ImageProcessingError):
            resize_image(test_image, scale_factor=0)

    def test_resize_image_negative_width(self, test_image):
        """–¢–µ—Å—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π scale_factor."""
        with pytest.raises(ImageProcessingError):
            resize_image(test_image, scale_factor=-0.5)

```

## `tests/test_integration.py`

```py
"""
–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã Code to Image MCP.

–¢–µ—Å—Ç–∏—Ä—É–µ—Ç:
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—é —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞ (—Ü–µ–ª–∏–∫–æ–º, —Ñ—É–Ω–∫—Ü–∏–∏, –∫–ª–∞—Å—Å—ã, –º–µ—Ç–æ–¥—ã)
- –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ PlantUML –¥–∏–∞–≥—Ä–∞–º–º –∏–∑ —Ñ–∞–π–ª–æ–≤
- –§–æ—Ä–º–∞—Ç—ã –≤—ã—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (PNG, WebP, SVG)
- –†–∞–∑–ª–∏—á–Ω—ã–µ —Ç–µ–º—ã PlantUML
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π —Å–∏—Å—Ç–µ–º—ã
"""

import pytest
from pathlib import Path
import sys

sys.path.insert(0, str(Path(__file__).parent.parent))

from src.code_to_image import create_code_image
from src.code_extractor import extract_code_entity
from src.diagram_renderer import render_diagram_from_string
from src.image_utils import convert_to_webp
from PIL import Image


class TestCodeScreenshotsWorkflow:
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞."""

    @pytest.fixture
    def sample_code_path(self):
        """–ü—É—Ç—å –∫ —Ç–µ—Å—Ç–æ–≤–æ–º—É Python —Ñ–∞–π–ª—É."""
        return Path(__file__).parent / "assets" / "sample_code.py"

    @pytest.fixture
    def output_dir(self, tmp_path):
        """–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –≤—ã—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤."""
        output = tmp_path / "code_screenshots"
        output.mkdir(exist_ok=True)
        return output

    def test_code_screenshot_full_file(self, sample_code_path, output_dir):
        """–¢–µ—Å—Ç: —Å–∫—Ä–∏–Ω—à–æ—Ç –ø–æ–ª–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∫–æ–¥–∞ –≤ PNG."""
        output_file = output_dir / "full_code.png"

        with open(sample_code_path, "r", encoding="utf-8") as f:
            code = f.read()

        img = create_code_image(
            code_string=code,
            language="python",
            style="monokai",
            line_numbers=True,
            font_name="JetBrainsMono",
            font_size=14,
        )

        from src.image_utils import save_image

        save_image(img, str(output_file), format="png")
        result = {"success": True}

        assert result["success"] is True
        assert output_file.exists()
        assert output_file.stat().st_size > 0

        img = Image.open(output_file)
        assert img.width > 0
        assert img.height > 0

    def test_code_screenshot_single_function(self, sample_code_path, output_dir):
        """–¢–µ—Å—Ç: —Å–∫—Ä–∏–Ω—à–æ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ AST."""
        output_file = output_dir / "function_code.png"

        code = extract_code_entity(
            file_path=str(sample_code_path), entity_name="calculate_sum"
        )

        img = create_code_image(
            code_string=code,
            language="python",
            style="monokai",
            line_numbers=True,
            font_name="JetBrainsMono",
            font_size=16,
        )

        from src.image_utils import save_image

        save_image(img, str(output_file), format="png")
        result = {"success": True}

        assert result["success"] is True
        assert "calculate_sum" in code
        assert "def calculate_sum(a: int, b: int) -> int:" in code

    def test_code_screenshot_class(self, sample_code_path, output_dir):
        """–¢–µ—Å—Ç: —Å–∫—Ä–∏–Ω—à–æ—Ç —Ü–µ–ª–æ–≥–æ –∫–ª–∞—Å—Å–∞."""
        output_file = output_dir / "class_code.png"

        code = extract_code_entity(
            file_path=str(sample_code_path), entity_name="OrderService"
        )

        img = create_code_image(
            code_string=code,
            language="python",
            style="monokai",
            line_numbers=True,
            font_name="FiraCode",
            font_size=14,
        )

        from src.image_utils import save_image

        save_image(img, str(output_file), format="png")
        result = {"success": True}

        assert result["success"] is True
        assert "class OrderService:" in code
        assert "def create_order" in code

    def test_code_screenshot_method(self, sample_code_path, output_dir):
        """–¢–µ—Å—Ç: —Å–∫—Ä–∏–Ω—à–æ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ –∫–ª–∞—Å—Å–∞."""
        output_file = output_dir / "method_code.png"

        code = extract_code_entity(
            file_path=str(sample_code_path),
            entity_name="OrderService.create_order",
            include_decorators=True,
        )

        img = create_code_image(
            code_string=code,
            language="python",
            style="monokai",
            line_numbers=True,
            font_name="JetBrainsMono",
            font_size=15,
        )

        from src.image_utils import save_image

        save_image(img, str(output_file), format="png")
        result = {"success": True}

        assert result["success"] is True
        assert "def create_order" in code


class TestPlantUMLDiagramsWorkflow:
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã PlantUML –¥–∏–∞–≥—Ä–∞–º–º."""

    @pytest.fixture
    def assets_dir(self):
        """–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ .puml —Ñ–∞–π–ª–∞–º–∏."""
        return Path(__file__).parent / "assets"

    @pytest.fixture
    def output_dir(self, tmp_path):
        """–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –≤—ã—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤."""
        output = tmp_path / "diagrams"
        output.mkdir(exist_ok=True)
        return output

    @pytest.mark.parametrize(
        "diagram_name,theme",
        [
            ("sequence_diagram", "dark_gold"),
            ("class_diagram", "dark_gold"),
            ("activity_diagram", "light_fresh"),
            ("component_diagram", "default"),
        ],
    )
    def test_render_diagram_png_with_themes(
        self, assets_dir, output_dir, diagram_name, theme
    ):
        """–¢–µ—Å—Ç: —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ä–∞–∑–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º –≤ PNG —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏."""
        input_file = assets_dir / f"{diagram_name}.puml"
        output_file = output_dir / f"{diagram_name}_{theme}.png"

        with open(input_file, "r", encoding="utf-8") as f:
            diagram_code = f.read()

        result = render_diagram_from_string(
            diagram_code=diagram_code,
            output_path=str(output_file),
            format="png",
            theme_name=theme,
            scale_factor=2.0,
        )

        assert result["success"] is True
        assert output_file.exists()
        assert output_file.stat().st_size > 0

    @pytest.mark.parametrize(
        "diagram_name",
        [
            "sequence_diagram",
            "class_diagram",
            "activity_diagram",
            "component_diagram",
        ],
    )
    def test_render_diagram_svg(self, assets_dir, output_dir, diagram_name):
        """–¢–µ—Å—Ç: —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¥–∏–∞–≥—Ä–∞–º–º –≤ SVG —Ñ–æ—Ä–º–∞—Ç."""
        input_file = assets_dir / f"{diagram_name}.puml"
        output_file = output_dir / f"{diagram_name}.svg"

        with open(input_file, "r", encoding="utf-8") as f:
            diagram_code = f.read()

        result = render_diagram_from_string(
            diagram_code=diagram_code,
            output_path=str(output_file),
            format="svg",
            theme_name="dark_gold",
            scale_factor=1.0,
        )

        assert result["success"] is True
        assert output_file.exists()

        with open(output_file, "r", encoding="utf-8") as f:
            content = f.read()
            assert "<?xml" in content or "<svg" in content

    def test_png_to_webp_conversion(self, assets_dir, output_dir):
        """–¢–µ—Å—Ç: –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PNG –¥–∏–∞–≥—Ä–∞–º–º –≤ WebP —Ñ–æ—Ä–º–∞—Ç."""
        diagram_files = [
            "sequence_diagram.puml",
            "class_diagram.puml",
        ]

        for puml_file in diagram_files:
            input_path = assets_dir / puml_file
            png_output = output_dir / puml_file.replace(".puml", ".png")
            webp_output = output_dir / puml_file.replace(".puml", ".webp")

            with open(input_path, "r", encoding="utf-8") as f:
                diagram_code = f.read()

            result_png = render_diagram_from_string(
                diagram_code=diagram_code,
                output_path=str(png_output),
                format="png",
                theme_name="dark_gold",
                scale_factor=2.5,
            )

            assert result_png["success"] is True

            img = Image.open(png_output)
            webp_bytes = convert_to_webp(img, quality=85)

            with open(webp_output, "wb") as f:
                f.write(webp_bytes)
            webp_path = str(webp_output)

            assert Path(webp_path).exists()
            webp_size = Path(webp_path).stat().st_size
            png_size = png_output.stat().st_size

            assert webp_size > 0
            print(
                f"\n{puml_file}: PNG={png_size // 1024}KB, WebP={webp_size // 1024}KB"
            )


class TestEndToEndScenarios:
    """–°–∫–≤–æ–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã."""

    @pytest.fixture
    def sample_code_path(self):
        return Path(__file__).parent / "assets" / "sample_code.py"

    @pytest.fixture
    def assets_dir(self):
        return Path(__file__).parent / "assets"

    @pytest.fixture
    def output_dir(self, tmp_path):
        output = tmp_path / "e2e_output"
        output.mkdir(exist_ok=True)
        return output

    def test_documentation_generation_workflow(
        self, sample_code_path, assets_dir, output_dir
    ):
        """
        –°—Ü–µ–Ω–∞—Ä–∏–π: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (–∫–æ–¥ + –¥–∏–∞–≥—Ä–∞–º–º—ã).

        1. –°–∫—Ä–∏–Ω—à–æ—Ç –∫–ª–∞—Å—Å–∞ OrderService
        2. –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤
        3. –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        4. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ WebP
        """
        results = []

        # 1. –°–∫—Ä–∏–Ω—à–æ—Ç –∫–ª–∞—Å—Å–∞
        code = extract_code_entity(
            file_path=str(sample_code_path), entity_name="OrderService"
        )

        img = create_code_image(
            code_string=code,
            language="python",
            style="monokai",
            line_numbers=True,
            font_name="JetBrainsMono",
            font_size=14,
        )

        from src.image_utils import save_image

        save_image(img, str(output_dir / "order_service.png"), format="png")
        results.append(("Code Screenshot", True))

        # 2. –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤
        with open(assets_dir / "class_diagram.puml", "r", encoding="utf-8") as f:
            class_code = f.read()

        class_result = render_diagram_from_string(
            diagram_code=class_code,
            output_path=str(output_dir / "class_diagram.png"),
            format="png",
            theme_name="dark_gold",
            scale_factor=2.5,
        )
        results.append(("Class Diagram", class_result["success"]))

        # 3. –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        with open(assets_dir / "sequence_diagram.puml", "r", encoding="utf-8") as f:
            sequence_code = f.read()

        sequence_result = render_diagram_from_string(
            diagram_code=sequence_code,
            output_path=str(output_dir / "sequence_diagram.png"),
            format="png",
            theme_name="dark_gold",
            scale_factor=2.5,
        )
        results.append(("Sequence Diagram", sequence_result["success"]))

        # 4. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ WebP
        for png_file in output_dir.glob("*.png"):
            img = Image.open(png_file)
            webp_path = png_file.with_suffix(".webp")
            webp_bytes = convert_to_webp(img, quality=85)
            with open(webp_path, "wb") as f:
                f.write(webp_bytes)
            results.append((f"WebP {png_file.name}", webp_path.exists()))

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—Ö –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
        assert all(success for _, success in results)
        assert len(results) >= 6

    def test_multi_entity_extraction_workflow(self, sample_code_path, output_dir):
        """
        –°—Ü–µ–Ω–∞—Ä–∏–π: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π.
        """
        entities = [
            ("calculate_sum", "function"),
            ("User", "dataclass"),
            ("OrderService.create_order", "method"),
        ]

        for entity_name, entity_type in entities:
            code = extract_code_entity(
                file_path=str(sample_code_path),
                entity_name=entity_name,
                include_decorators=True,
            )

            safe_name = entity_name.replace(".", "_")
            output_file = output_dir / f"{safe_name}.png"

            img = create_code_image(
                code_string=code,
                language="python",
                style="monokai",
                line_numbers=True,
                font_name="JetBrainsMono",
                font_size=14,
            )

            from src.image_utils import save_image

            save_image(img, str(output_file), format="png")
            result = {"success": True}

            assert result["success"] is True
            assert output_file.exists()


class TestCodeScreenshotsPersistent:
    """
    –¢–µ—Å—Ç—ã —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∫–æ–¥–∞ —Å –ü–û–°–¢–û–Ø–ù–ù–´–ú —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ tests/output/.

    –ò—Å–ø–æ–ª—å–∑—É—é—Ç —Ñ–∏–∫—Å—Ç—É—Ä—É output_dir –∏–∑ conftest.py.
    –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏.
    """

    @pytest.fixture
    def sample_code_path(self):
        """–ü—É—Ç—å –∫ —Ç–µ—Å—Ç–æ–≤–æ–º—É Python —Ñ–∞–π–ª—É."""
        return Path(__file__).parent / "assets" / "sample_code.py"

    @pytest.fixture
    def output_dir(self):
        """–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –ü–û–°–¢–û–Ø–ù–ù–û–ì–û —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤."""
        output = Path(__file__).parent / "output"
        output.mkdir(exist_ok=True)
        return output

    def test_code_full_file_dark_webp(self, sample_code_path, output_dir):
        """–¢–µ—Å—Ç: —Å–∫—Ä–∏–Ω—à–æ—Ç –ø–æ–ª–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ ‚Äî dark theme + WebP + JetBrainsMono."""
        output_file = output_dir / "code_full_file_dark.webp"

        with open(sample_code_path, "r", encoding="utf-8") as f:
            code = f.read()

        img = create_code_image(
            code_string=code,
            language="python",
            style="monokai",  # dark theme
            line_numbers=True,
            font_name="JetBrainsMono",
            font_size=14,
            scale_factor=3.0,  # High quality
        )

        from src.image_utils import save_image

        result = save_image(img, str(output_file), format="webp", quality=90)

        assert result["success"] is True
        assert output_file.exists()
        assert output_file.stat().st_size > 0

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        loaded = Image.open(output_file)
        assert loaded.width >= 800  # High quality –¥–æ–ª–∂–µ–Ω –¥–∞–≤–∞—Ç—å –±–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä

    def test_code_function_dark_webp(self, sample_code_path, output_dir):
        """–¢–µ—Å—Ç: —Å–∫—Ä–∏–Ω—à–æ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî dark theme + WebP + JetBrainsMono."""
        output_file = output_dir / "code_function_dark.webp"

        code = extract_code_entity(
            file_path=str(sample_code_path),
            entity_name="calculate_sum",
        )

        img = create_code_image(
            code_string=code,
            language="python",
            style="dracula",  # another dark theme
            line_numbers=True,
            font_name="JetBrainsMono",
            font_size=16,
            scale_factor=3.0,
        )

        from src.image_utils import save_image

        result = save_image(img, str(output_file), format="webp", quality=90)

        assert result["success"] is True
        assert output_file.exists()
        assert "def calculate_sum" in code

    def test_code_class_dark_webp(self, sample_code_path, output_dir):
        """–¢–µ—Å—Ç: —Å–∫—Ä–∏–Ω—à–æ—Ç –∫–ª–∞—Å—Å–∞ ‚Äî dark theme + WebP + JetBrainsMono."""
        output_file = output_dir / "code_class_dark.webp"

        code = extract_code_entity(
            file_path=str(sample_code_path),
            entity_name="OrderService",
        )

        img = create_code_image(
            code_string=code,
            language="python",
            style="monokai",
            line_numbers=True,
            font_name="JetBrainsMono",
            font_size=14,
            scale_factor=3.0,
        )

        from src.image_utils import save_image

        result = save_image(img, str(output_file), format="webp", quality=90)

        assert result["success"] is True
        assert output_file.exists()
        assert "class OrderService:" in code

    def test_code_method_dark_webp(self, sample_code_path, output_dir):
        """–¢–µ—Å—Ç: —Å–∫—Ä–∏–Ω—à–æ—Ç –º–µ—Ç–æ–¥–∞ –∫–ª–∞—Å—Å–∞ ‚Äî dark theme + WebP + JetBrainsMono."""
        output_file = output_dir / "code_method_dark.webp"

        code = extract_code_entity(
            file_path=str(sample_code_path),
            entity_name="OrderService.create_order",
            include_decorators=True,
        )

        img = create_code_image(
            code_string=code,
            language="python",
            style="vim",  # another dark theme
            line_numbers=True,
            font_name="JetBrainsMono",
            font_size=15,
            scale_factor=3.0,
        )

        from src.image_utils import save_image

        result = save_image(img, str(output_file), format="webp", quality=90)

        assert result["success"] is True
        assert output_file.exists()
        assert "def create_order" in code

    def test_code_dataclass_dark_webp(self, sample_code_path, output_dir):
        """–¢–µ—Å—Ç: —Å–∫—Ä–∏–Ω—à–æ—Ç dataclass ‚Äî dark theme + WebP + JetBrainsMono."""
        output_file = output_dir / "code_dataclass_dark.webp"

        code = extract_code_entity(
            file_path=str(sample_code_path),
            entity_name="User",
            include_decorators=True,  # –≤–∫–ª—é—á–∏—Ç—å @dataclass
        )

        img = create_code_image(
            code_string=code,
            language="python",
            style="monokai",
            line_numbers=True,
            font_name="JetBrainsMono",
            font_size=14,
            scale_factor=3.0,
        )

        from src.image_utils import save_image

        result = save_image(img, str(output_file), format="webp", quality=90)

        assert result["success"] is True
        assert output_file.exists()
        assert "@dataclass" in code
        assert "class User:" in code

    def test_code_async_function_dark_webp(self, sample_code_path, output_dir):
        """–¢–µ—Å—Ç: —Å–∫—Ä–∏–Ω—à–æ—Ç async —Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî dark theme + WebP + JetBrainsMono."""
        output_file = output_dir / "code_async_dark.webp"

        code = extract_code_entity(
            file_path=str(sample_code_path),
            entity_name="fetch_data",
        )

        img = create_code_image(
            code_string=code,
            language="python",
            style="github-dark",
            line_numbers=True,
            font_name="JetBrainsMono",
            font_size=14,
            scale_factor=3.0,
        )

        from src.image_utils import save_image

        result = save_image(img, str(output_file), format="webp", quality=90)

        assert result["success"] is True
        assert output_file.exists()
        assert "async def fetch_data" in code

```

## `tests/test_theme_visual_check.py`

```py
"""–í–∏–∑—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–º PlantUML –Ω–∞ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö."""

import pytest
from pathlib import Path
import sys

sys.path.insert(0, str(Path(__file__).parent.parent))

from src.diagram_renderer import render_diagram_from_string


@pytest.fixture
def visual_output_dir():
    """–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤."""
    output = Path(__file__).parent / "output" / "theme_visual_check"
    output.mkdir(parents=True, exist_ok=True)
    return output


class TestThemeVisualCheck:
    """–í–∏–∑—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–≤–µ—Ç–æ–≤ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ –≤—Å–µ—Ö —Ç–µ–º–∞—Ö."""

    THEMES = ["default", "dark_gold", "light_fresh"]

    def _generate_component_diagram_full(self) -> str:
        """–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ –í–°–ï–ú–ò —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏."""
        return """
@startuml
title Component Diagram - Full Elements Test
note as N1
  –≠—Ç–∞ –¥–∏–∞–≥—Ä–∞–º–º–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç:
  * Title
  * Legend
  * Notes
  * –í—Å–µ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã
  * –°–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã PlantUML
end note

package "Presentation Layer" {
  component "Django Views" <<Adapter>> as Views
  component "REST API" <<Adapter>> as API
}

package "Business Logic Layer" {
  component "Order Service" <<Core>> as OrderSvc
  component "Payment Logic" <<Core>> as PaymentLogic
}

package "Data Access Layer" {
  database "PostgreSQL" <<Infrastructure>> as PgSQL
  queue "RabbitMQ" <<Infrastructure>> as Queue
  collections "Redis Cache" <<Infrastructure>> as Redis
}

Views --> OrderSvc
API --> OrderSvc
OrderSvc --> PaymentLogic
PaymentLogic --> PgSQL
OrderSvc --> Queue
OrderSvc --> Redis

note right of OrderSvc
  –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å
  –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã
end note

note left of PgSQL
  –û—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
end note

legend right
  |= –°—Ç–µ—Ä–µ–æ—Ç–∏–ø |= –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
  | <<Adapter>> | –í—Ö–æ–¥–Ω—ã–µ —Ç–æ—á–∫–∏ |
  | <<Core>> | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ |
  | <<Infrastructure>> | –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ |
endlegend

@enduml
"""

    def _generate_sequence_diagram_full(self) -> str:
        """Sequence –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ –í–°–ï–ú–ò —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏."""
        return """
@startuml
title Sequence Diagram - Full Elements Test

actor User as U
participant "Web App" as WA
participant "Order Service" as OS
database "PostgreSQL" as DB
entity "Order" as Order
boundary "Payment Gateway" as PG
control "Validator" as Val

note over U, Val
  –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:
  actor, participant, database,
  entity, boundary, control
end note

U -> WA: –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
activate WA

WA -> Val: validate_input()
activate Val
Val --> WA: OK
deactivate Val

WA -> OS: create_order(data)
activate OS

OS -> DB: save_order()
activate DB
DB --> OS: order_id
deactivate DB

OS -> PG: charge(amount)
activate PG
PG --> OS: transaction_id
deactivate PG

OS --> WA: order_created
deactivate OS

WA --> U: –ó–∞–∫–∞–∑ ‚Ññ12345
deactivate WA

note right of U
  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç
  –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
end note

legend bottom
  –õ–µ–≥–µ–Ω–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å
  —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —Ñ–æ–Ω–µ —Ç–µ–º—ã
endlegend

@enduml
"""

    def _generate_class_diagram_full(self) -> str:
        """Class –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ –í–°–ï–ú–ò —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏."""
        return """
@startuml
title Class Diagram - Full Elements Test

class "OrderController" <<Adapter>> {
  - order_service: OrderService
  + create_order(request): Response
  + get_order(id): Response
}

class "OrderService" <<Core>> {
  - repository: OrderRepository
  + create_order(data): Order
  + validate_order(data): bool
}

class "OrderRepository" <<Infrastructure>> {
  - db: Connection
  + save(order): int
  + find_by_id(id): Order
}

note top of OrderController
  –í—Ö–æ–¥–Ω–∞—è —Ç–æ—á–∫–∞ API
  –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã
end note

note bottom of OrderService
  –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤
end note

note left of OrderRepository
  –°–ª–æ–π –¥–∞–Ω–Ω—ã—Ö
  PostgreSQL
end note

"OrderController" --> "OrderService" : uses
"OrderService" --> "OrderRepository" : uses

legend right
  |= –¶–≤–µ—Ç |= –°–ª–æ–π |
  | –ó–µ–ª—ë–Ω—ã–π | Adapter |
  | –ó–æ–ª–æ—Ç–æ–π | Core |
  | –°–∏–Ω–∏–π | Infrastructure |
endlegend

@enduml
"""

    def _generate_activity_diagram_full(self) -> str:
        """Activity –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ –í–°–ï–ú–ò —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏."""
        return """
@startuml
title Activity Diagram - Full Elements Test

start

note right
  –¢–µ—Å—Ç–∏—Ä—É–µ–º:
  * Title
  * Notes
  * Partition
  * Fork/Join
end note

partition "–í–∞–ª–∏–¥–∞—Ü–∏—è" {
  :–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω;
  
  if (–¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω?) then (–¥–∞)
    :–ò–∑–≤–ª–µ—á—å user_id;
  else (–Ω–µ—Ç)
    :–í–µ—Ä–Ω—É—Ç—å 401;
    stop
  endif
}

partition "–û–±—Ä–∞–±–æ—Ç–∫–∞" {
  fork
    :–í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã;
  fork again
    :–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–ª–∞–¥;
  fork again
    :–ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥;
  end fork
  
  :–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑;
  
  if (–û–ø–ª–∞—Ç–∞?) then (–¥–∞)
    :–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–ª–∞—Ç—ë–∂;
    
    if (–£—Å–ø–µ—à–Ω–æ?) then (–¥–∞)
      :–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å;
      :–û—Ç–ø—Ä–∞–≤–∏—Ç—å email;
    else (–Ω–µ—Ç)
      :–û—Ç–∫–∞—Ç–∏—Ç—å;
      note right
        –û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã
      end note
      stop
    endif
  else (–Ω–µ—Ç)
    :–ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å;
  endif
}

:–í–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç;
stop

legend bottom
  –õ–µ–≥–µ–Ω–¥–∞ –≤–Ω–∏–∑—É –¥–∏–∞–≥—Ä–∞–º–º—ã
  –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–≤–µ—Ç–∞ —Ç–µ–∫—Å—Ç–∞
endlegend

@enduml
"""

    @pytest.mark.parametrize("theme", THEMES)
    def test_component_diagram_all_themes(self, visual_output_dir, theme):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ component –¥–∏–∞–≥—Ä–∞–º–º—ã –Ω–∞ –≤—Å–µ—Ö —Ç–µ–º–∞—Ö."""
        code = self._generate_component_diagram_full()
        output_file = visual_output_dir / f"component_{theme}.png"

        result = render_diagram_from_string(
            diagram_code=code,
            output_path=str(output_file),
            format="png",
            theme_name=theme,
            scale_factor=2.0,  # Medium –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
        )

        assert result["success"] is True
        assert output_file.exists()
        assert result["theme_used"] == theme

    @pytest.mark.parametrize("theme", THEMES)
    def test_sequence_diagram_all_themes(self, visual_output_dir, theme):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ sequence –¥–∏–∞–≥—Ä–∞–º–º—ã –Ω–∞ –≤—Å–µ—Ö —Ç–µ–º–∞—Ö."""
        code = self._generate_sequence_diagram_full()
        output_file = visual_output_dir / f"sequence_{theme}.png"

        result = render_diagram_from_string(
            diagram_code=code,
            output_path=str(output_file),
            format="png",
            theme_name=theme,
            scale_factor=2.0,
        )

        assert result["success"] is True
        assert output_file.exists()
        assert result["theme_used"] == theme

    @pytest.mark.parametrize("theme", THEMES)
    def test_class_diagram_all_themes(self, visual_output_dir, theme):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ class –¥–∏–∞–≥—Ä–∞–º–º—ã –Ω–∞ –≤—Å–µ—Ö —Ç–µ–º–∞—Ö."""
        code = self._generate_class_diagram_full()
        output_file = visual_output_dir / f"class_{theme}.png"

        result = render_diagram_from_string(
            diagram_code=code,
            output_path=str(output_file),
            format="png",
            theme_name=theme,
            scale_factor=2.0,
        )

        assert result["success"] is True
        assert output_file.exists()
        assert result["theme_used"] == theme

    @pytest.mark.parametrize("theme", THEMES)
    def test_activity_diagram_all_themes(self, visual_output_dir, theme):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ activity –¥–∏–∞–≥—Ä–∞–º–º—ã –Ω–∞ –≤—Å–µ—Ö —Ç–µ–º–∞—Ö."""
        code = self._generate_activity_diagram_full()
        output_file = visual_output_dir / f"activity_{theme}.png"

        result = render_diagram_from_string(
            diagram_code=code,
            output_path=str(output_file),
            format="png",
            theme_name=theme,
            scale_factor=2.0,
        )

        assert result["success"] is True
        assert output_file.exists()
        assert result["theme_used"] == theme

    def test_summary_report(self, visual_output_dir):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–≤–æ–¥–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤."""
        report_file = visual_output_dir / "VISUAL_CHECK_REPORT.md"

        report_content = """# –û—Ç—á—ë—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–º PlantUML

## –¶–µ–ª—å –ø—Ä–æ–≤–µ—Ä–∫–∏
–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã PlantUML (title, legend, notes, database, queue, etc) 
–∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –≤—Å–µ—Ö —Ç–µ–º–∞—Ö.

## –ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- ‚úÖ Title (–∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–∏–∞–≥—Ä–∞–º–º—ã)
- ‚úÖ Legend (–ª–µ–≥–µ–Ω–¥–∞)
- ‚úÖ Notes (–∑–∞–º–µ—Ç–∫–∏/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)
- ‚úÖ Database (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- ‚úÖ Queue (–æ—á–µ—Ä–µ–¥—å)
- ‚úÖ Collections (–∫–æ–ª–ª–µ–∫—Ü–∏–∏)
- ‚úÖ Entity (—Å—É—â–Ω–æ—Å—Ç—å)
- ‚úÖ Actor (–∞–∫—Ç–æ—Ä)
- ‚úÖ Boundary (–≥—Ä–∞–Ω–∏—Ü–∞)
- ‚úÖ Control (–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä)
- ‚úÖ Partition (—Ä–∞–∑–¥–µ–ª –≤ activity)
- ‚úÖ –°—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã (<<Adapter>>, <<Core>>, <<Infrastructure>>)

## –ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ —Ç–µ–º—ã
1. **default** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ç–µ–º–∞
2. **dark_gold** ‚Äî —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ —Å –∑–æ–ª–æ—Ç—ã–º–∏ –∞–∫—Ü–µ–Ω—Ç–∞–º–∏
3. **light_fresh** ‚Äî —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ —Å –∑–µ–ª—ë–Ω—ã–º–∏ –∞–∫—Ü–µ–Ω—Ç–∞–º–∏

## –¢–∏–ø—ã –¥–∏–∞–≥—Ä–∞–º–º
1. Component Diagram
2. Sequence Diagram
3. Class Diagram
4. Activity Diagram

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–ø–∫—É `tests/output/theme_visual_check/`
2. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤—Å–µ PNG —Ñ–∞–π–ª—ã
3. **–ö—Ä–∏—Ç–µ—Ä–∏–π –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è**: –≤–µ—Å—å —Ç–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Ç–∞–µ–º—ã–º, –Ω–µ—Ç —á—ë—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —Ç—ë–º–Ω–æ–º —Ñ–æ–Ω–µ
4. –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã ‚Äî –∑–∞–ø–∏—à–∏—Ç–µ –∏—Ö –Ω–∏–∂–µ

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### default —Ç–µ–º–∞
- [ ] component_default.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___
- [ ] sequence_default.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___
- [ ] class_default.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___
- [ ] activity_default.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___

### dark_gold —Ç–µ–º–∞
- [ ] component_dark_gold.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___
- [ ] sequence_dark_gold.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___
- [ ] class_dark_gold.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___
- [ ] activity_dark_gold.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___

### light_fresh —Ç–µ–º–∞
- [ ] component_light_fresh.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___
- [ ] sequence_light_fresh.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___
- [ ] class_light_fresh.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___
- [ ] activity_light_fresh.png - OK / –ü–†–û–ë–õ–ï–ú–´: ___

---

## –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
(–ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏)

1. 
2. 
3. 

"""

        report_file.write_text(report_content, encoding="utf-8")
        assert report_file.exists()

```

## `TROUBLESHOOTING.md`

```md
# üîß –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º

## üéØ –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [–ü—Ä–æ–±–ª–µ–º—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏](#–ø—Ä–æ–±–ª–µ–º—ã-—É—Å—Ç–∞–Ω–æ–≤–∫–∏)
- [–ü—Ä–æ–±–ª–µ–º—ã —Å–æ —à—Ä–∏—Ñ—Ç–∞–º–∏](#–ø—Ä–æ–±–ª–µ–º—ã-—Å–æ-—à—Ä–∏—Ñ—Ç–∞–º–∏)
- [–ü—Ä–æ–±–ª–µ–º—ã —Å PlantUML](#–ø—Ä–æ–±–ª–µ–º—ã-—Å-plantuml)
- [–ü—Ä–æ–±–ª–µ–º—ã —Å MCP —Å–µ—Ä–≤–µ—Ä–æ–º](#–ø—Ä–æ–±–ª–µ–º—ã-—Å-mcp-—Å–µ—Ä–≤–µ—Ä–æ–º)
- [–ü—Ä–æ–±–ª–µ–º—ã —Å –∫–∞—á–µ—Å—Ç–≤–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π](#–ø—Ä–æ–±–ª–µ–º—ã-—Å-–∫–∞—á–µ—Å—Ç–≤–æ–º-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)

---

## –ü—Ä–æ–±–ª–µ–º—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### ‚ùå `ModuleNotFoundError: No module named 'pygments'`

**–ü—Ä–∏—á–∏–Ω–∞:** –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Python –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä.

**–†–µ—à–µ–Ω–∏–µ:**

```powershell
# 1. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
.\venv\Scripts\Activate.ps1

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É
python -c "import pygments; print(pygments.__version__)"
```

### ‚ùå `python: command not found` (Windows)

**–ü—Ä–∏—á–∏–Ω–∞:** Python –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ PATH.

**–†–µ—à–µ–Ω–∏–µ:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ PowerShell –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
2. –î–æ–±–∞–≤—å—Ç–µ Python –≤ PATH:

   ```powershell
   # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –ø—É—Ç—å –∫ Python
   $env:Path += ";C:\Users\YourUser\AppData\Local\Programs\Python\Python311\"
   ```

3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ PowerShell

---

## –ü—Ä–æ–±–ª–µ–º—ã —Å–æ —à—Ä–∏—Ñ—Ç–∞–º–∏

### ‚ùå `Font not found: 'JetBrainsMono'`

**–ü—Ä–∏—á–∏–Ω–∞:** –®—Ä–∏—Ñ—Ç –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è Pillow.

**–†–µ—à–µ–Ω–∏–µ 1 - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —à—Ä–∏—Ñ—Ç (–±—ã—Å—Ç—Ä–æ):**

```python
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–π —à—Ä–∏—Ñ—Ç Windows
font_name="Consolas"  # –í—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ Windows
```

**–†–µ—à–µ–Ω–∏–µ 2 - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —à—Ä–∏—Ñ—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**

1. –°–∫–∞—á–∞–π—Ç–µ —à—Ä–∏—Ñ—Ç:
   - JetBrains Mono: <https://www.jetbrains.com/lp/mono/>
   - Fira Code: <https://github.com/tonsky/FiraCode>

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —à—Ä–∏—Ñ—Ç –≤ Windows:
   - –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ `.ttf` —Ñ–∞–π–ª ‚Üí "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å"
   - –ò–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤ `C:\Windows\Fonts\`

3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ 3 - –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤:**

```python
from src.font_manager import list_available_fonts

print(list_available_fonts())
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω –∏–∑ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤
```

### ‚ùå –®—Ä–∏—Ñ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –æ—à–∏–±–∫–∞

**–ü—Ä–∏—á–∏–Ω–∞:** Pillow –∫—ç—à–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ —à—Ä–∏—Ñ—Ç–æ–≤.

**–†–µ—à–µ–Ω–∏–µ:**

```powershell
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Python –∏–ª–∏ MCP —Å–µ—Ä–≤–µ—Ä
# –î–ª—è MCP —Å–µ—Ä–≤–µ—Ä–∞: –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ Cline
```

### ‚ùå –ü–ª–æ—Ö–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–∞ –≤ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞—Ö

**–ü—Ä–∏—á–∏–Ω–∞:** –ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã —Ç—Ä–µ–±—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫.

**–†–µ—à–µ–Ω–∏–µ:**

```python
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
font_size=18           # –ù–µ –º–µ–Ω—å—à–µ 16
scale_factor=3.0      # –ù–µ –º–µ–Ω—å—à–µ 2.0
font_name="JetBrainsMono"  # –ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π —à—Ä–∏—Ñ—Ç
```

---

## –ü—Ä–æ–±–ª–µ–º—ã —Å PlantUML

### ‚ùå `Java –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ`

**–ü—Ä–∏—á–∏–Ω–∞:** Java JRE –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏–ª–∏ –Ω–µ –≤ PATH.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

```powershell
java -version
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –≤–µ—Ä—Å–∏—é 8+
```

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è Windows:**

1. –°–∫–∞—á–∞–π—Ç–µ Adoptium JDK: <https://adoptium.net/>
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å –æ–ø—Ü–∏–µ–π "Add to PATH"
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ PowerShell
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: `java -version`

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è macOS:**

```bash
brew install openjdk@17
```

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è Linux:**

```bash
sudo apt-get install default-jre
```

### ‚ùå `PlantUML syntax error` –∏–ª–∏ —á–µ—Ä–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º–µ

**–ü—Ä–∏—á–∏–Ω–∞ 1:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `!theme` –¥–∏—Ä–µ–∫—Ç–∏–≤—ã –≤ –∫–æ–¥–µ.

**–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:**

```plantuml
@startuml
!theme dark_gold  ‚ùå –ù–ï –¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫!
component API
@enduml
```

**–ü–†–ê–í–ò–õ–¨–ù–û:**

```python
# –ü–µ—Ä–µ–¥–∞–π—Ç–µ —Ç–µ–º—É —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä
generate_architecture_diagram(
    diagram_code="@startuml\ncomponent API\n@enduml",
    theme_name='dark_gold'  ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
)
```

**–ü—Ä–∏—á–∏–Ω–∞ 2:** –•–∞—Ä–¥–∫–æ–¥–∏–Ω–≥ —Ü–≤–µ—Ç–æ–≤ –≤ —ç–ª–µ–º–µ–Ω—Ç–∞—Ö.

**–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:**

```plantuml
component "API" #FF0000  ‚ùå –ù–µ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å —Ü–≤–µ—Ç–∞
```

**–ü–†–ê–í–ò–õ–¨–ù–û:**

```plantuml
component "API" <<Adapter>>  ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø—ã
```

### ‚ùå –¢–µ–º–∞ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –¥–∏–∞–≥—Ä–∞–º–º–µ

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã –≤–≤–µ–¥–µ–Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:**

```python
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–º—ã
list_plantuml_themes()
# –í–µ—Ä–Ω—ë—Ç: ['default', 'dark_gold', 'light_fresh']

# 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
theme_name='dark_gold'  ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
theme_name='darkgold'   ‚ùå –û—à–∏–±–∫–∞ (–±–µ–∑ underscore)
theme_name='ocean'      ‚ùå –ù–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
```

### ‚ùå –≠–ª–µ–º–µ–Ω—Ç—ã –¥–∏–∞–≥—Ä–∞–º–º—ã –∏–º–µ—é—Ç —á–µ—Ä–Ω—ã–π —Ü–≤–µ—Ç –Ω–∞ —Ç–µ–º–Ω–æ–º —Ñ–æ–Ω–µ

**–ü—Ä–∏—á–∏–Ω–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è —Ç–µ–º—ã –±–µ–∑ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π.

**–†–µ—à–µ–Ω–∏–µ:**

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–µ–º—ã –∏–∑ `asset/themes/`
2. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã –±–µ–∑ —Å—Ç–µ—Ä–µ–æ—Ç–∏–ø–æ–≤:

**–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:**

```plantuml
database "PostgreSQL"  ‚ùå –ú–æ–∂–µ—Ç –±—ã—Ç—å —á–µ—Ä–Ω—ã–º
```

**–ü–†–ê–í–ò–õ–¨–ù–û:**

```plantuml
database "PostgreSQL" <<Infrastructure>>  ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ü–≤–µ—Ç
```

### ‚ùå `PlantUML JAR not found`

**–ü—Ä–∏—á–∏–Ω–∞:** –§–∞–π–ª `plantuml.jar` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.

**–†–µ—à–µ–Ω–∏–µ:**

```powershell
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞
Test-Path "asset\bins\plantuml.jar"

# –ï—Å–ª–∏ False - —Å–∫–∞—á–∞–π—Ç–µ:
# https://github.com/plantuml/plantuml/releases
# –ü–æ–º–µ—Å—Ç–∏—Ç–µ –≤ asset/bins/
```

---

## –ü—Ä–æ–±–ª–µ–º—ã —Å MCP —Å–µ—Ä–≤–µ—Ä–æ–º

### ‚ùå Cline –Ω–µ –≤–∏–¥–∏—Ç MCP —Å–µ—Ä–≤–µ—Ä

**–ü—Ä–∏—á–∏–Ω–∞ 1:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –∫ Python –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:**

```json
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - —Å–∏—Å—Ç–µ–º–Ω—ã–π Python
{
  "command": "python",
  "args": ["c:\\PY\\code_to_image_mcp\\server.py"]
}

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
{
  "command": "c:\\PY\\code_to_image_mcp\\venv\\Scripts\\python.exe",
  "args": ["c:\\PY\\code_to_image_mcp\\server.py"]
}
```

**–ü—Ä–∏—á–∏–Ω–∞ 2:** Cline –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:**

1. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `cline_mcp_settings.json`
2. –ù–∞–∂–º–∏—Ç–µ Ctrl+Shift+P ‚Üí "Developer: Reload Window"
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ MCP –≤ Cline

### ‚ùå `Error: Path must be absolute`

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–¥–∞–Ω –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –≤–º–µ—Å—Ç–æ –∞–±—Å–æ–ª—é—Ç–Ω–æ–≥–æ.

**–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:**

```python
output_path="screenshots/image.webp"  ‚ùå
```

**–ü–†–ê–í–ò–õ–¨–ù–û:**

```python
output_path="C:/screenshots/image.webp"  ‚úÖ
# –ò–ª–∏
output_path="c:\\PY\\screenshots\\image.webp"  ‚úÖ
```

### ‚ùå MCP —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –Ω–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π Python, –∞ –Ω–µ –≤ venv.

**–†–µ—à–µ–Ω–∏–µ:**

```powershell
# 1. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ venv
.\venv\Scripts\Activate.ps1

# 2. –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install --force-reinstall -r requirements.txt

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Cline
```

---

## –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–∞—á–µ—Å—Ç–≤–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### ‚ùå –†–∞–∑–º—ã—Ç—ã–π —Ç–µ–∫—Å—Ç –≤ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞—Ö

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–∏–∑–∫–∏–π `scale_factor` –∏–ª–∏ `detail_level`.

**–†–µ—à–µ–Ω–∏–µ:**

```python
# –î–ª—è –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
detail_level="Ultra"    # 4.0x –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
# –∏–ª–∏
detail_level="Extreme"  # 5.0x –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

# –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç:
image_format="png"  # –õ—É—á—à–µ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ —á–µ–º jpeg
```

### ‚ùå –û–≥—Ä–æ–º–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–ü—Ä–∏—á–∏–Ω–∞:** –°–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π `detail_level` –¥–ª—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–¥–∞.

**–†–µ—à–µ–Ω–∏–µ:**

```python
# –î–ª—è –≤–µ–±-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ:
detail_level="Medium"  # 2.0x, ~50-200 KB

# –î–ª—è GitHub README:
detail_level="High"    # 3.0x, ~100-300 KB

# Extreme –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—á–∞—Ç–∏:
detail_level="Extreme" # 5.0x, –º–æ–∂–µ—Ç –±—ã—Ç—å 1-5 MB
```

### ‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ü–≤–µ—Ç–∞ –≤ —Ç–µ–º–∞—Ö

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É —Å—Ç–∏–ª–µ–º Pygments –∏ —Ç–µ–º–æ–π PlantUML.

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è –∫–æ–¥–∞:**

```python
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–º–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–º–Ω—ã—Ö —Ñ–æ–Ω–æ–≤
style="monokai"      ‚úÖ –¢–µ–º–Ω—ã–π —Ñ–æ–Ω
style="dracula"      ‚úÖ –¢–µ–º–Ω—ã–π —Ñ–æ–Ω
style="github-dark"  ‚úÖ –¢–µ–º–Ω—ã–π —Ñ–æ–Ω

# –ò–∑–±–µ–≥–∞–π—Ç–µ —Å–≤–µ—Ç–ª—ã—Ö —Å—Ç–∏–ª–µ–π
style="default"      ‚ùå –°–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω (–ø–ª–æ—Ö–æ —Å monokai)
```

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º:**

```python
# –í—ã–±–∏—Ä–∞–π—Ç–µ —Ç–µ–º—É –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é:
theme_name='dark_gold'    # –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏, —Ç–µ–º–Ω—ã–µ —Å–ª–∞–π–¥—ã
theme_name='light_fresh'  # –ü–µ—á–∞—Ç—å, —Å–≤–µ—Ç–ª–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
theme_name='default'      # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è (—Ç–µ–º–Ω–∞—è VS Code)
```

### ‚ùå –ù—É–º–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–∫ —Å—ä–µ–¥–∞–µ—Ç –∫–æ–¥

**–ü—Ä–∏—á–∏–Ω–∞:** –ú–∞–ª–µ–Ω—å–∫–∏–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ —Å –Ω—É–º–µ—Ä–∞—Ü–∏–µ–π.

**–†–µ—à–µ–Ω–∏–µ:**

```python
# –í–∞—Ä–∏–∞–Ω—Ç 1: –£–≤–µ–ª–∏—á–∏—Ç—å —à—Ä–∏—Ñ—Ç
font_size=20  # –í–º–µ—Å—Ç–æ 14

# –í–∞—Ä–∏–∞–Ω—Ç 2: –û—Ç–∫–ª—é—á–∏—Ç—å –Ω—É–º–µ—Ä–∞—Ü–∏—é –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤
line_numbers=False
```

---

## –û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –æ–±—Ä–∞—â–µ–Ω–∏–µ–º –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏–∏:**

   ```powershell
   python --version  # 3.11+
   java -version     # 8+
   pip show pygments # 2.15+
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**

   ```powershell
   Get-Command python  # –î–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ venv\Scripts\python.exe
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–µ—Å—É—Ä—Å–æ–≤:**

   ```powershell
   Test-Path "asset\bins\plantuml.jar"  # True
   Test-Path "asset\fonts\"             # True
   Test-Path "asset\themes\"            # True
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   - –õ–æ–≥–∏ MCP —Å–µ—Ä–≤–µ—Ä–∞ –≤ Cline: Settings ‚Üí MCP ‚Üí Logs
   - –õ–æ–≥–∏ Python: –¥–æ–±–∞–≤—å—Ç–µ `logging.basicConfig(level=logging.DEBUG)`

### üìñ –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **PlantUML –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [doc/plantuml_guides/](doc/plantuml_guides/)
- **–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–º:** [doc/theme_creation_guide.md](doc/theme_creation_guide.md)
- **–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã:** [FAQ.md](FAQ.md)
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:** [doc/developers/architecture.md](doc/developers/architecture.md)

---

**–ù–µ –Ω–∞—à–ª–∏ —Ä–µ—à–µ–Ω–∏–µ?**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [FAQ.md](FAQ.md)
2. –ò–∑—É—á–∏—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫ (`logging.DEBUG`)
3. –°–æ–∑–¥–∞–π—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–π –ø—Ä–∏–º–µ—Ä
4. –û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É —Å –≤–µ—Ä—Å–∏—è–º–∏ Python, Java, –û–°

```


# Phase 1: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ - –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 30 –Ω–æ—è–±—Ä—è 2024  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–û**  
**–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ**: 63/63 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ (100%)

---

## üìä –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞

**–¶–µ–ª—å —Ñ–∞–∑—ã**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –æ—Ç –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏, —É–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ –≤—ã—Å–æ–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é —Ñ–æ—Ä–º–∞—Ç–æ–≤.

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

| –ú–µ—Ç—Ä–∏–∫–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---------|-----------|
| **–ù–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π** | 1 (image_utils.py, 279 —Å—Ç—Ä–æ–∫) |
| **–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π** | 3 (diagram_renderer, code_to_image, server) |
| **–ù–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤** | 33 (25 –¥–ª—è image_utils, 8 –¥–ª—è diagram_renderer) |
| **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤** | 63 (100% —É—Å–ø–µ—à–Ω–æ) |
| **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤** | WebP, PNG, JPEG (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ) |
| **–£—Ä–æ–≤–Ω–∏ –∫–∞—á–µ—Å—Ç–≤–∞** | Low (1.0x, 96 DPI) / High (3.0x, 288 DPI) |
| **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production** | ‚úÖ **100%** |

---

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (Steps 1-6)

### ‚úÖ Step 1: –°–æ–∑–¥–∞–Ω–∏–µ image_utils.py (263 —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:

```python
save_image(image, output_path, format, quality) -> dict
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å —Ñ–æ—Ä–º–∞—Ç–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
    # WebP: quality=85, method=6
    # PNG: optimize=True, compress_level=6
    # JPEG: quality=90

resize_image(image, scale_factor) -> Image
    # –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Lanczos —Ñ–∏–ª—å—Ç—Ä–æ–º
    # scale_factor: 0.5 = –ø–æ–ª–æ–≤–∏–Ω–∞, 2.0 = —É–¥–≤–æ–µ–Ω–∏–µ

convert_to_webp(image, quality=90) -> bytes
    # –ö–æ–Ω–≤–µ—Ä—Å–∏—è –≤ WebP —Å —Å–∂–∞—Ç–∏–µ–º

load_image_from_bytes(bytes, source_format) -> Image
    # –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –±–∞–π—Ç–æ–≤
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è RGBA‚ÜíRGB –¥–ª—è JPEG
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è PNG (compress_level=6)
- ‚úÖ WebP —Å–∂–∞—Ç–∏–µ —Å method=6 (–ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ/—Ä–∞–∑–º–µ—Ä)
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: WebP 85%, PNG 95%, JPEG 90%
- ‚úÖ Google-style docstrings + emoji-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–¢–µ—Å—Ç—ã**: 25 —Ç–µ—Å—Ç–æ–≤

- ‚úÖ 6 —Ç–µ—Å—Ç–æ–≤ save_image (WebP/PNG/JPEG, –∫–∞—á–µ—Å—Ç–≤–æ, RGBA‚ÜíRGB)
- ‚úÖ 5 —Ç–µ—Å—Ç–æ–≤ resize_image (0.5x, 2.0x, –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏, —Ä–µ–∂–∏–º—ã)
- ‚úÖ 3 —Ç–µ—Å—Ç–∞ convert_to_webp (RGB, RGBA, –∫–∞—á–µ—Å—Ç–≤–æ)
- ‚úÖ 5 —Ç–µ—Å—Ç–æ–≤ load_image_from_bytes (PNG/JPEG/WebP, –æ—à–∏–±–∫–∏)
- ‚úÖ 3 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞
- ‚úÖ 3 —Ç–µ—Å—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

---

### ‚úÖ Step 2: –ú–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏—è diagram_renderer.py

**–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è**:

```python
render_diagram_to_image(diagram_code, format, theme_name, scale_factor) -> Image
    # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç PIL Image –≤–º–µ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª
    # scale_factor ‚Üí PlantUML -Sdpi=X –ø–∞—Ä–∞–º–µ—Ç—Ä
    # –¢–æ–ª—å–∫–æ –¥–ª—è PNG (SVG/EPS/PDF –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è PIL)
```

**–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è**:

- ‚úÖ `scale_factor` –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ DPI: `dpi = int(96 * scale_factor)`
- ‚úÖ PlantUML –ø–∞—Ä–∞–º–µ—Ç—Ä: `-Sdpi=288` –¥–ª—è 3x (–Ω–µ `-scale`, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Ä–∞–±–æ—Ç–∞–ª!)
- ‚úÖ `render_diagram_from_string()` - legacy –æ–±—ë—Ä—Ç–∫–∞:
  - PNG: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `render_diagram_to_image()` + `image_utils`
  - SVG/EPS/PDF: –ø—Ä—è–º–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–∞–π—Ç–æ–≤ (–æ–±—Ö–æ–¥ PIL)

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:

```
1x (96 DPI):   274√ó159 px,  6.8 KB  ‚Üê Low detail
3x (288 DPI):  824√ó479 px, 29.6 KB  ‚Üê High detail (–¥–ª—è 4K/print)
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ**:

```bash
# ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢:
java -jar plantuml.jar -scale 3.0 -pipe

# ‚úÖ –†–ê–ë–û–¢–ê–ï–¢:
java -jar plantuml.jar -Sdpi=288 -pipe
```

**–¢–µ—Å—Ç—ã**: +8 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

- ‚úÖ 6 —Ç–µ—Å—Ç–æ–≤ `render_diagram_to_image()` (PIL Image, 1x/3x, WebP, –∫–∏—Ä–∏–ª–ª–∏—Ü–∞)
- ‚úÖ 2 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞ `scale_factor` (legacy —Ñ—É–Ω–∫—Ü–∏—è, —Ä–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤)

---

### ‚úÖ Step 3: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ code_to_image.py

**–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è**:

```python
create_code_image(code_string, language, scale_factor, **options) -> Image
    # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç PIL Image
    # scale_factor –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ font_size, pad, line_pad
```

**Legacy —Ñ—É–Ω–∫—Ü–∏—è**:

```python
create_code_screenshot(code_string, language, output_file, **options) -> None
    # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç create_code_image() + image_utils.save_image()
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:

```
TypeScript 3x WebP:  2152√ó770 px, 59.5 KB  ‚Üê High detail
SQL 2x PNG:          1110√ó844 px, 47.9 KB  ‚Üê Medium detail
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ PNG –ø—Ä–∏ `transparent=True` –∏ `format=JPEG`
- ‚úÖ `scale_factor` –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç `font_size`, `pad`, `line_pad` **–ø–µ—Ä–µ–¥** –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
- ‚úÖ Pygments –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ PNG ‚Üí –∫–æ–Ω–≤–µ—Ä—Å–∏—è —á–µ—Ä–µ–∑ `image_utils`

---

### ‚úÖ Step 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ MCP tools (server.py)

**–ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –≤—Å–µ—Ö 3 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤**:

```python
detail_level: str = "High"  # "Low" (1.0x) / "High" (3.0x)
image_format: str = "webp"  # "webp" / "png" / "jpeg"
```

**–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**:

1. **generate_code_screenshot()**
   - –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∫–æ–¥–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏
   - `detail_level` ‚Üí `scale_factor` –∫–æ–Ω–≤–µ—Ä—Å–∏—è

2. **generate_file_screenshot()**
   - –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∫–æ–¥–∞ –∏–∑ —Ñ–∞–π–ª–∞ (–º–∞–∫—Å. 200 —Å—Ç—Ä–æ–∫)
   - –ê–≤—Ç–æ-–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é

3. **generate_architecture_diagram()**
   - PlantUML –¥–∏–∞–≥—Ä–∞–º–º—ã
   - `scale_factor` —Ç–æ–ª—å–∫–æ –¥–ª—è PNG —Ñ–æ—Ä–º–∞—Ç–∞

**–õ–æ–≥–∏–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏**:

```python
scale_factor = 3.0 if detail_level.lower() == "high" else 1.0
```

**Breaking changes**:

- ‚ö†Ô∏è `scale_factor` ‚Üí `detail_level` (–±–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω–æ–µ –∏–º—è)
- ‚ö†Ô∏è `format` ‚Üí `image_format` (–∏–∑–±–µ–≥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)

---

### ‚úÖ Step 5: –¢–µ—Å—Ç—ã –¥–ª—è image_utils.py

**–°–æ–∑–¥–∞–Ω–æ**: `tests/test_image_utils.py` (325 —Å—Ç—Ä–æ–∫)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤**:

- **TestSaveImage**: 6 —Ç–µ—Å—Ç–æ–≤ (WebP/PNG/JPEG, –∫–∞—á–µ—Å—Ç–≤–æ, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, RGBA‚ÜíRGB)
- **TestResizeImage**: 5 —Ç–µ—Å—Ç–æ–≤ (0.5x, 2.0x, –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏, —Ä–µ–∂–∏–º—ã, same_size)
- **TestConvertToWebP**: 3 —Ç–µ—Å—Ç–∞ (RGB, RGBA, –∫–∞—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–ª–æ–∂–Ω–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏)
- **TestLoadImageFromBytes**: 5 —Ç–µ—Å—Ç–æ–≤ (PNG/JPEG/WebP, invalid, empty)
- **TestIntegration**: 3 —Ç–µ—Å—Ç–∞ (save‚Üíresize‚Üíload, —Ñ–æ—Ä–º–∞—Ç—ã, bytes‚Üífile)
- **TestErrorHandling**: 3 —Ç–µ—Å—Ç–∞ (invalid format, zero/negative scale)

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ 25/25 passed (100%)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞ –∫–∞—á–µ—Å—Ç–≤–∞**:

```python
# –°–æ–∑–¥–∞—ë–º —Å–ª–æ–∂–Ω–æ–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 500√ó500
# –ù–∞ –ø—Ä–æ—Å—Ç–æ–º –∫—Ä–∞—Å–Ω–æ–º 100√ó100 WebP quality=50 > quality=95 (–ø–∞—Ä–∞–¥–æ–∫—Å —Å–∂–∞—Ç–∏—è!)
complex_img = Image.new("RGB", (500, 500))
for i in range(500):
    for j in range(500):
        pixels[i, j] = (i % 256, j % 256, (i + j) % 256)
```

---

### ‚úÖ Step 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

**–û–±–Ω–æ–≤–ª–µ–Ω–æ**: `tests/test_diagram_renderer.py`

**–î–æ–±–∞–≤–ª–µ–Ω–æ 2 –Ω–æ–≤—ã—Ö –∫–ª–∞—Å—Å–∞ —Ç–µ—Å—Ç–æ–≤**:

#### TestRenderToImage (6 —Ç–µ—Å—Ç–æ–≤)

```python
test_render_to_image_returns_pil_image()      # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç PIL Image
test_render_to_image_scale_factor_1x()        # 96 DPI –±–∞–∑–æ–≤—ã–π
test_render_to_image_scale_factor_3x()        # 288 DPI –¥–ª—è 4K
test_render_to_image_with_webp_conversion()   # PIL ‚Üí WebP —á–µ—Ä–µ–∑ image_utils
test_render_to_image_without_theme()          # –ë–µ–∑ —Ç–µ–º—ã
test_render_to_image_cyrillic()               # –ö–∏—Ä–∏–ª–ª–∏—Ü–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

#### TestScaleFactorIntegration (2 —Ç–µ—Å—Ç–∞)

```python
test_legacy_function_with_scale_factor()      # render_diagram_from_string() + scale
test_scale_factor_1x_vs_3x_file_sizes()       # 3x —Ç—è–∂–µ–ª–µ–µ 1x
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –±–∞–≥–∞**:

```python
# –ü—Ä–æ–±–ª–µ–º–∞: SVG/EPS/PDF –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ PIL Image.open()
# PIL.UnidentifiedImageError: cannot identify image file

# –†–µ—à–µ–Ω–∏–µ: render_diagram_from_string() —Ä–∞–∑–¥–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
if format == "png":
    image = render_diagram_to_image(...)
    save_image(image, output_path, format="png")
else:
    # SVG/EPS/PDF: –ø—Ä—è–º–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–∞–π—Ç–æ–≤ PlantUML
    with open(output_path, "wb") as f:
        f.write(plantuml_stdout_bytes)
```

**–§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ 22/22 diagram_renderer —Ç–µ—Å—Ç–æ–≤, 63/63 –≤—Å–µ–≥–æ

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ diagram_renderer.py ‚îÇ‚îÄ‚îÄ‚Üí PlantUML ‚îÄ‚îÄ‚Üí [File I/O]
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ code_to_image.py‚îÇ‚îÄ‚îÄ‚Üí Pygments ‚îÄ‚îÄ‚Üí [File I/O]
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ diagram_renderer.py ‚îÇ‚îÄ‚îÄ‚Üí PlantUML ‚îÄ‚îÄ‚Üí PIL Image ‚îÄ‚îÄ‚îê
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                             ‚îÇ
                                                     ‚îú‚îÄ‚îÄ‚Üí image_utils.save_image()
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                 ‚îÇ         ‚Üì
‚îÇ code_to_image.py‚îÇ‚îÄ‚îÄ‚Üí Pygments ‚îÄ‚îÄ‚Üí PIL Image ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    [–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ —Ñ–æ—Ä–º–∞—Ç—É]
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                            ‚Üì
                                                          [WebP/PNG/JPEG]
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (SRP)**
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ‚â† –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
   - –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –¥–µ–ª–∞–µ—Ç –æ–¥–Ω–æ –¥–µ–ª–æ

2. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞**
   - `image_utils` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å–µ–º–∏ –º–æ–¥—É–ª—è–º–∏
   - –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤

3. **–ì–∏–±–∫–æ—Å—Ç—å**
   - –ú–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å PIL Image –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
   - –ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ª—é–±–æ–π —Ñ–æ—Ä–º–∞—Ç —Å –ª—é–±—ã–º –∫–∞—á–µ—Å—Ç–≤–æ–º

4. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**
   - –§—É–Ω–∫—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–±—ä–µ–∫—Ç—ã (PIL Image)
   - –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

---

## üìà –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤

| –§–æ—Ä–º–∞—Ç | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã | –¢–∏–ø–∏—á–Ω—ã–π —Ä–∞–∑–º–µ—Ä (100√ó100) | –ö–∞—á–µ—Å—Ç–≤–æ |
|--------|-----------|---------------------------|----------|
| **WebP** | quality=85, method=6 | **–°–∞–º—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π** (40-50% –º–µ–Ω—å—à–µ PNG) | –û—Ç–ª–∏—á–Ω–æ–µ |
| **PNG** | optimize=True, compress_level=6 | –°—Ä–µ–¥–Ω–∏–π | –ë–µ–∑ –ø–æ—Ç–µ—Ä—å |
| **JPEG** | quality=90 | –ö—Ä—É–ø–Ω—ã–π | –•–æ—Ä–æ—à–µ–µ (–Ω–µ—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏) |

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ PlantUML

| scale_factor | DPI | –ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------------|-----|------------------|------------|
| **1.0** | 96 | 274√ó159 | Web, –¥–æ–∫—É–º–µ–Ω—Ç—ã |
| **2.0** | 192 | ~548√ó318 | Retina –¥–∏—Å–ø–ª–µ–∏ |
| **3.0** | 288 | 824√ó479 | 4K –º–æ–Ω–∏—Ç–æ—Ä—ã, print |

### –ö–æ–º–∞–Ω–¥—ã PlantUML

```bash
# ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢ (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ -pipe —Ä–µ–∂–∏–º–µ):
-scale 3.0

# ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ (skinparam dpi):
-Sdpi=288

# ‚úÖ –ü–û–õ–ù–ê–Ø –ö–û–ú–ê–ù–î–ê:
java -Dfile.encoding=UTF-8 \
     -Dplantuml.smetana=true \
     -Dplantuml.graphviz.use=false \
     -DPLANTUML_LIMIT_SIZE=16384 \
     -jar plantuml.jar \
     -pipe \
     -tpng \
     -charset UTF-8 \
     -Sdpi=288
```

---

## üß™ –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

### –°–≤–æ–¥–∫–∞ –ø–æ –º–æ–¥—É–ª—è–º

| –ú–æ–¥—É–ª—å | –§–∞–π–ª —Ç–µ—Å—Ç–æ–≤ | –ö–æ–ª-–≤–æ —Ç–µ—Å—Ç–æ–≤ | –°—Ç–∞—Ç—É—Å |
|--------|-------------|---------------|--------|
| **image_utils.py** | test_image_utils.py | 25 | ‚úÖ 100% |
| **diagram_renderer.py** | test_diagram_renderer.py | 22 | ‚úÖ 100% |
| **font_initializer.py** | test_font_initializer.py | 4 | ‚úÖ 100% |
| **font_manager.py** | test_font_integration.py | 7 | ‚úÖ 100% |
| **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** | test_font_diagnostic.py | 5 | ‚úÖ 100% |
| **–ò–¢–û–ì–û** | ‚Äî | **63** | ‚úÖ **100%** |

### –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è image_utils —Ç–µ—Å—Ç–æ–≤

```
TestSaveImage:
  ‚úÖ test_save_image_webp
  ‚úÖ test_save_image_png
  ‚úÖ test_save_image_jpeg
  ‚úÖ test_save_image_custom_quality
  ‚úÖ test_save_image_creates_directory
  ‚úÖ test_save_image_rgba_to_jpeg

TestResizeImage:
  ‚úÖ test_resize_image_downscale (0.5x)
  ‚úÖ test_resize_image_upscale (2.0x)
  ‚úÖ test_resize_image_aspect_ratio
  ‚úÖ test_resize_image_same_size (scale=1.0)
  ‚úÖ test_resize_image_preserve_mode (RGBA)

TestConvertToWebP:
  ‚úÖ test_convert_to_webp_rgb
  ‚úÖ test_convert_to_webp_rgba
  ‚úÖ test_convert_to_webp_custom_quality

TestLoadImageFromBytes:
  ‚úÖ test_load_image_from_bytes_png
  ‚úÖ test_load_image_from_bytes_jpeg
  ‚úÖ test_load_image_from_bytes_webp
  ‚úÖ test_load_image_from_bytes_invalid
  ‚úÖ test_load_image_from_bytes_empty

TestIntegration:
  ‚úÖ test_save_resize_load_cycle
  ‚úÖ test_convert_multiple_formats
  ‚úÖ test_bytes_to_file_workflow

TestErrorHandling:
  ‚úÖ test_save_image_invalid_format
  ‚úÖ test_resize_image_zero_width
  ‚úÖ test_resize_image_negative_width
```

---

## üîç –û—Ç–∫—Ä—ã—Ç–∏—è –∏ —É—Ä–æ–∫–∏

### 1. PlantUML -scale –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ CLI

```bash
# –û–∂–∏–¥–∞–Ω–∏–µ:
java -jar plantuml.jar -pipe -scale 3.0

# –†–µ–∞–ª—å–Ω–æ—Å—Ç—å: –ø–∞—Ä–∞–º–µ—Ç—Ä –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è!
# –†–µ—à–µ–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å -Sdpi
java -jar plantuml.jar -pipe -Sdpi=288
```

### 2. WebP –¥–∞—ë—Ç –ª—É—á—à–µ–µ —Å–∂–∞—Ç–∏–µ –Ω–∞ —Å–ª–æ–∂–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö

```
–ü—Ä–æ—Å—Ç–æ–µ 100√ó100 –∫—Ä–∞—Å–Ω–æ–µ:
  quality=50: 118 bytes
  quality=95: 108 bytes  ‚Üê –ü–∞—Ä–∞–¥–æ–∫—Å!

–°–ª–æ–∂–Ω–æ–µ 500√ó500 –≥—Ä–∞–¥–∏–µ–Ω—Ç:
  quality=50: ~8 KB
  quality=95: ~15 KB  ‚Üê –û–∂–∏–¥–∞–µ–º–æ
```

### 3. Pillow –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç PNG –∏–∑ Pygments

```python
# Pygments ImageFormatter –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ PNG
formatter = ImageFormatter(image_format="PNG")

# –ö–æ–Ω–≤–µ—Ä—Å–∏—é –¥–µ–ª–∞–µ–º –ø–æ—Å–ª–µ:
img.save(output_file, format="WEBP", quality=85)
```

### 4. SVG –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å PIL Image

```python
# ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢:
svg_bytes = plantuml_generate_svg(...)
image = Image.open(BytesIO(svg_bytes))  # UnidentifiedImageError!

# ‚úÖ –†–ï–®–ï–ù–ò–ï:
if format == "png":
    image = Image.open(BytesIO(png_bytes))
else:
    # –ü—Ä—è–º–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–∞–π—Ç–æ–≤ –¥–ª—è SVG/EPS/PDF
    with open(path, "wb") as f:
        f.write(svg_bytes)
```

---

## üì¶ –§–∞–π–ª—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### –ù–æ–≤—ã–µ/–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
code_to_image_mcp/
‚îú‚îÄ‚îÄ image_utils.py                    ‚Üê –ù–û–í–´–ô (279 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ diagram_renderer.py               ‚Üê –û–ë–ù–û–í–õ–Å–ù (432 —Å—Ç—Ä–æ–∫–∏)
‚îú‚îÄ‚îÄ code_to_image.py                  ‚Üê –û–ë–ù–û–í–õ–Å–ù (282 —Å—Ç—Ä–æ–∫–∏)
‚îú‚îÄ‚îÄ server.py                         ‚Üê –û–ë–ù–û–í–õ–Å–ù (382 —Å—Ç—Ä–æ–∫–∏)
‚îÇ
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ test_image_utils.py           ‚Üê –ù–û–í–´–ô (325 —Å—Ç—Ä–æ–∫, 25 —Ç–µ—Å—Ç–æ–≤)
‚îÇ   ‚îî‚îÄ‚îÄ test_diagram_renderer.py      ‚Üê –û–ë–ù–û–í–õ–Å–ù (+8 —Ç–µ—Å—Ç–æ–≤)
‚îÇ
‚îî‚îÄ‚îÄ doc/
    ‚îî‚îÄ‚îÄ phase_1_completion_report.md  ‚Üê –≠–¢–û–¢ –î–û–ö–£–ú–ï–ù–¢
```

### –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏

```
diagram_renderer.py.backup    (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è, 345 —Å—Ç—Ä–æ–∫)
code_to_image.py.backup       (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è, 187 —Å—Ç—Ä–æ–∫)
server.py.backup              (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è, 382 —Å—Ç—Ä–æ–∫–∏)
```

---

## üéØ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### Legacy —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

‚úÖ **render_diagram_from_string()** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

```python
# –°—Ç–∞—Ä—ã–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:
result = render_diagram_from_string(
    diagram_code=code,
    output_path="output.png",
    format="png",
)
```

‚úÖ **create_code_screenshot()** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

```python
# –°—Ç–∞—Ä—ã–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:
create_code_screenshot(
    code_string=code,
    language="python",
    output_file="screenshot.webp",
)
```

### Breaking changes –¥–ª—è MCP –∫–ª–∏–µ–Ω—Ç–æ–≤

‚ö†Ô∏è **–ò–∑–º–µ–Ω–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã MCP tools**:

```python
# –ë–´–õ–û:
scale_factor: int = 3
format: str = "WEBP"

# –°–¢–ê–õ–û:
detail_level: str = "High"  # "Low" / "High"
image_format: str = "webp"  # "webp" / "png" / "jpeg"
```

**–ü—Ä–∏—á–∏–Ω–∞**: –ë–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ –¥–ª—è –∫–æ–Ω–µ—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –°—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ |
|-----------|------------|
| –ù–æ–≤—ã–π –∫–æ–¥ | ~800 —Å—Ç—Ä–æ–∫ (image_utils + —Ç–µ—Å—Ç—ã) |
| –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–π –∫–æ–¥ | ~600 —Å—Ç—Ä–æ–∫ (diagram/code/server —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥) |
| –£–¥–∞–ª—ë–Ω–Ω—ã–π –∫–æ–¥ | ~150 —Å—Ç—Ä–æ–∫ (–¥—É–±–ª–∏–∫–∞—Ç—ã –ª–æ–≥–∏–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è) |
| **–ò—Ç–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π** | **~1350 —Å—Ç—Ä–æ–∫** |

### –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ Phase 1 | –ü–æ—Å–ª–µ Phase 1 |
|---------|------------|---------------|
| –í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤ | 38 | **63** (+25) |
| –ú–æ–¥—É–ª–µ–π —Å —Ç–µ—Å—Ç–∞–º–∏ | 3 | **4** (+1) |
| –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö | 100% | **100%** |

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ production

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω—ã
- ‚úÖ –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `render_diagram_to_image()` —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ MCP tools –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ WebP/PNG/JPEG
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ 1x-5x —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

- ‚úÖ Google-style docstrings –≤–µ–∑–¥–µ
- ‚úÖ Emoji-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É `doc/logging.md`
- ‚úÖ Type hints –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- ‚úÖ 63/63 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏ (100%)
- ‚úÖ Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- ‚úÖ Error handling —Ç–µ—Å—Ç—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- ‚úÖ Docstrings –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ –≠—Ç–æ—Ç –æ—Ç—á—ë—Ç —Å–æ–∑–¥–∞–Ω
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ç–µ—Å—Ç–∞—Ö

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ WebP —Å–∂–∞—Ç–∏–µ –¥–∞—ë—Ç 40-50% —ç–∫–æ–Ω–æ–º–∏—é
- ‚úÖ PlantUML -Sdpi –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ä–∞–∑—É –Ω—É–∂–Ω—ã–π —Ä–∞–∑–º–µ—Ä
- ‚úÖ –ù–µ—Ç –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–æ–∫

---

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production: 100% ‚úÖ

**Phase 1 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production!**

### –ß—Ç–æ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å

1. ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã (3x –¥–ª—è 4K)
2. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ WebP —Å 40-50% —ç–∫–æ–Ω–æ–º–∏–µ–π –º–µ—Å—Ç–∞
3. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PIL Image –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
4. ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–∞—á–µ—Å—Ç–≤–∞
5. ‚úÖ –†–∞–±–æ—Ç–∞—Ç—å —Å SVG/EPS/PDF –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –≥—Ä–∞—Ñ–∏–∫–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —Ñ–∞–∑

**Phase 2** (–±—É–¥—É—â–µ–µ):

- –î–æ–±–∞–≤–∏—Ç—å –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏
- Batch processing –¥–∏–∞–≥—Ä–∞–º–º
- –ê–≤—Ç–æ-–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
- –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ WebP –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π

**Phase 3** (–±—É–¥—É—â–µ–µ):

- GPU-—É—Å–∫–æ—Ä–µ–Ω–∏–µ –¥–ª—è resize_image()
- AVIF —Ñ–æ—Ä–º–∞—Ç (—Å–ª–µ–¥—É—é—â–µ–µ –ø–æ–∫–æ–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ WebP)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ HDR –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

---

## üìù –§–∏–Ω–∞–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ

- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: —á–∏—Å—Ç–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: 100% –ø–æ–∫—Ä—ã—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: PlantUML -Sdpi –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ä–∞–∑—É –Ω—É–∂–Ω—ã–π —Ä–∞–∑–º–µ—Ä
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: WebP –¥–∞—ë—Ç –æ—Ç–ª–∏—á–Ω–æ–µ —Å–∂–∞—Ç–∏–µ

### –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- ‚ö†Ô∏è `render_diagram_to_image()` —Ç–æ–ª—å–∫–æ –¥–ª—è PNG (SVG/EPS/PDF –Ω–µ PIL Image)
- ‚ö†Ô∏è `scale_factor` > 5.0 –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ–≥—Ä–æ–º–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚ö†Ô∏è WebP –∫–∞—á–µ—Å—Ç–≤–æ –Ω–∞ –ø—Ä–æ—Å—Ç—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ (–ø–∞—Ä–∞–¥–æ–∫—Å —Å–∂–∞—Ç–∏—è)

### Breaking changes

- ‚ö†Ô∏è MCP tools: `scale_factor` ‚Üí `detail_level`, `format` ‚Üí `image_format`
- ‚ÑπÔ∏è Legacy —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

---

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**: Phase 1 –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –Ω–∞ 100%. –í—Å–µ —Ü–µ–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã, —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç, –∫–æ–¥ –≥–æ—Ç–æ–≤ –∫ production. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å—Ç–∞–ª–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —á–∏—â–µ –∏ –≥–∏–±—á–µ, –∞ –∫–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —É–ª—É—á—à–∏–ª–æ—Å—å –±–ª–∞–≥–æ–¥–∞—Ä—è –≤—ã—Å–æ–∫–æ–º—É DPI –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤.

**–ê–≤—Ç–æ—Ä**: GitHub Copilot (Claude Sonnet 4.5)  
**–î–∞—Ç–∞**: 30 –Ω–æ—è–±—Ä—è 2024  
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞**: code_to_image_mcp v1.1.0 (–ø–æ—Å–ª–µ Phase 1)
